var CKFinder=function(){function internalCKFinderInit(e,t,i){var n=t.getElementsByTagName("head")[0],r=t.createElement("script");r[r.innerText?"innerText":"innerHTML"]=i+".CKFinder._setup( window, document );CKFinder.start("+JSON.stringify(e)+");",n.appendChild(r)}function configOrDefault(e,t){return e?e:t}function createUrlParams(e){var t=[];for(var i in e)t.push(encodeURIComponent(i)+"="+encodeURIComponent(e[i]));return"?"+t.join("&")}function extendObject(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e}function updateIOSConfig(e,t){e._iosWidgetHeight=parseInt(getComputedStyle(t).height),e._iosWidgetWidth=parseInt(getComputedStyle(t).width)}function checkOnInit(e,t){if(e&&!e._omitCheckOnInit&&"function"==typeof e.onInit){var i=e.onInit;delete e.onInit,t.addEventListener("ckfinderReady",function(t){e._initCalled||(e._initCalled=!0,i(t.detail.ckfinder))})}}function S(e){for(var t="",i=e.charCodeAt(0),n=1;n<e.length;++n)t+=String.fromCharCode(e.charCodeAt(n)^n+i&127);return t}function isIE9(){var e,t,i=-1;return"Microsoft Internet Explorer"==navigator.appName&&(e=navigator.userAgent,t=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})"),null!==t.exec(e)&&(i=parseFloat(RegExp.$1))),9===i}var basePath=function(){if(parent&&parent.CKFinder&&parent.CKFinder.basePath)return parent.CKFinder.basePath;var e,t,i,n=document.getElementsByTagName("script");for(e=0;e<n.length&&(t=n[e],i=void 0!==t.getAttribute.length?t.src:t.getAttribute("src"),!i||"ckfinder.js"!==i.split("/").slice(-1)[0]);e++);return i.split("/").slice(0,-1).join("/")+"/"}(),Modal={open:function(e){function t(e,t,i){t.forEach(function(t){e.addEventListener(t,i)})}function i(e,t,i){t.forEach(function(t){e.removeEventListener(t,i)})}function n(e){return 0===e.type.indexOf("touch")?{x:e.touches[0].pageX,y:e.touches[0].pageY}:{x:document.all?window.event.clientX:e.pageX,y:document.all?window.event.clientX:e.pageY}}function r(e){var t=n(e);p=t.x,m=t.y;var i=m-x;y.style.left=p-F+"px",y.style.top=(0>i?0:i)+"px"}function o(e){var t,i,r=n(e);f?(t=l-(S-r.x),i=d-(V-r.y),t>200&&(E.style.width=t+"px"),i>200&&(E.style.height=i+"px")):h&&(t=l+(S-r.x),i=d-(V-r.y),t>200&&(E.style.width=t+"px",y.style.left=F-(S-r.x)+"px"),i>200&&(E.style.height=i+"px"))}function s(){K.parentNode===E&&E.removeChild(K),f=!1,h=!1,i(document,["mousemove","touchmove"],o),i(document,["mouseup","touchend"],s)}function a(e){e.preventDefault();var i=n(e);S=i.x,V=i.y,l=E.clientWidth,d=E.clientHeight,E.appendChild(K),t(document,["mousemove","touchmove"],o),t(document,["mouseup","touchend"],s)}if(e=e||{},!Modal.div){Modal.heightAdded=48,Modal.widthAdded=2;var l,d,c=Math.min(configOrDefault(e.width,1e3),window.innerWidth-Modal.widthAdded),u=Math.min(configOrDefault(e.height,700),window.innerHeight-Modal.heightAdded),f=!1,h=!1,g=!1,p=0,m=0,v=e.width,w=e.height;e.width=e.height="100%";var y=Modal.div=document.createElement("div");y.id="ckf-modal",y.style.position="fixed",y.style.top=(document.documentElement.clientHeight-Modal.heightAdded)/2-u/2+"px",y.style.left=(document.documentElement.clientWidth-Modal.widthAdded)/2-c/2+"px",y.style.background="#fff",y.style.border="1px solid #aaa",y.style.boxShadow="3px 3px 5px rgba(0,0,0,0.2)",y.style.borderTopLeftRadius=y.style.borderTopRightRadius="5px",y.style.zIndex=8999,y.innerHTML='<div id="ckf-modal-header" style="cursor: move; border-top-left-radius:5px; border-top-right-radius:5px; background: url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiA/Pgo8c3ZnIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgdmlld0JveD0iMCAwIDEgMSIgcHJlc2VydmVBc3BlY3RSYXRpbz0ibm9uZSI+CiAgPGxpbmVhckdyYWRpZW50IGlkPSJncmFkLXVjZ2ctZ2VuZXJhdGVkIiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgeDE9IjAlIiB5MT0iMCUiIHgyPSIwJSIgeTI9IjEwMCUiPgogICAgPHN0b3Agb2Zmc2V0PSIwJSIgc3RvcC1jb2xvcj0iI2Y3ZjdmNyIgc3RvcC1vcGFjaXR5PSIxIi8+CiAgICA8c3RvcCBvZmZzZXQ9IjEwMCUiIHN0b3AtY29sb3I9IiNhZGFkYWQiIHN0b3Atb3BhY2l0eT0iMSIvPgogIDwvbGluZWFyR3JhZGllbnQ+CiAgPHJlY3QgeD0iMCIgeT0iMCIgd2lkdGg9IjEiIGhlaWdodD0iMSIgZmlsbD0idXJsKCNncmFkLXVjZ2ctZ2VuZXJhdGVkKSIgLz4KPC9zdmc+);border-bottom:1px solid #c9c9c9;height:35px !important;"><a style="float: right; padding: 7px 10px 0 !important; margin: 0 !important; font-family: Arial, sans-serif !important; font-weight:bold; font-size: 20px !important; line-height: 20px !important; text-decoration: none !important; color: #888 !important;" id="ckf-modal-close" href="#">×</a></div><div id="ckf-modal-body" style="position: relative;width: '+c+"px; height: "+u+'px"></div><div id="ckf-modal-footer" style="height: 10px !important; background: #f3f3f3"><span id="ckf-modal-resize-handle-sw" style="cursor: sw-resize; width: 7px; height: 7px; display: block; float: left; border-left: 3px solid #ddd; border-bottom: 3px solid #ddd;"></span><span id="ckf-modal-resize-handle-se" style="cursor: se-resize; width: 7px; height: 7px; display: block; float: right; border-right: 3px solid #ddd; border-bottom: 3px solid #ddd;"></span></div>',document.body.appendChild(y),CKFinder.widget("ckf-modal-body",e),Modal.footer=document.getElementById("ckf-modal-footer"),window.addEventListener("orientationchange",function(){Modal.maximized||setTimeout(function(){c=Math.min(configOrDefault(v,1e3),document.documentElement.clientWidth-Modal.widthAdded),u=Math.min(configOrDefault(w,700),document.documentElement.clientHeight-Modal.heightAdded);var e=document.getElementById("ckf-modal-body");e.style.width=c+"px",e.style.height=u+"px",y.style.top=(document.documentElement.clientHeight-Modal.heightAdded)/2-u/2+"px",y.style.left=(document.documentElement.clientWidth-Modal.widthAdded)/2-c/2+"px"},100)});var b=document.getElementById("ckf-modal-close");t(b,["click","touchend"],function(e){e.stopPropagation(),e.preventDefault(),Modal.close()});var C=Modal.header=document.getElementById("ckf-modal-header"),F=y.offsetLeft,x=y.offsetTop;t(C,["mousedown","touchstart"],function(e){e.preventDefault(),g=!0;var i=n(e);p=i.x,m=i.y,F=p-y.offsetLeft,x=m-y.offsetTop,E.appendChild(K),t(document,["mousemove","touchmove"],r)}),t(C,["mouseup","touchend"],function(){g=!1,K.parentNode===E&&E.removeChild(K),i(document,["mousemove","touchmove"],r)});var k=document.getElementById("ckf-modal-resize-handle-se"),M=document.getElementById("ckf-modal-resize-handle-sw"),E=Modal.body=document.getElementById("ckf-modal-body"),K=document.createElement("div");K.style.position="absolute",K.style.top=K.style.right=K.style.bottom=K.style.left=0,K.style.zIndex=1e5,t(k,["mousedown","touchstart"],function(e){f=!0,a(e)}),t(M,["mousedown","touchstart"],function(e){F=y.offsetLeft,h=!0,a(e)});var S,V}},close:function(){Modal.div&&(document.body.removeChild(Modal.div),Modal.div=null,Modal.maximized&&(document.documentElement.style.overflow=Modal.preDocumentOverflow,document.documentElement.style.width=Modal.preDocumentWidth,document.documentElement.style.height=Modal.preDocumentHeight))},maximize:function(e){e?(Modal.preDocumentOverflow=document.documentElement.style.overflow,Modal.preDocumentWidth=document.documentElement.style.width,Modal.preDocumentHeight=document.documentElement.style.height,document.documentElement.style.overflow="hidden",document.documentElement.style.width=0,document.documentElement.style.height=0,Modal.preLeft=Modal.div.style.left,Modal.preTop=Modal.div.style.top,Modal.preWidth=Modal.body.style.width,Modal.preHeight=Modal.body.style.height,Modal.preBorder=Modal.div.style.border,Modal.div.style.left=Modal.div.style.top=Modal.div.style.right=Modal.div.style.bottom=0,Modal.body.style.width="100%",Modal.body.style.height="100%",Modal.div.style.border="",Modal.header.style.display="none",Modal.footer.style.display="none",Modal.maximized=!0):(document.documentElement.style.overflow=Modal.preDocumentOverflow,document.documentElement.style.width=Modal.preDocumentWidth,document.documentElement.style.height=Modal.preDocumentHeight,Modal.div.style.right=Modal.div.style.bottom="",Modal.div.style.left=Modal.preLeft,Modal.div.style.top=Modal.preTop,Modal.div.style.border=Modal.preBorder,Modal.body.style.width=Modal.preWidth,Modal.body.style.height=Modal.preHeight,Modal.header.style.display="block",Modal.footer.style.display="block",Modal.maximized=!1)}},_r=/(window|S("A0&5j4"))/,ckfPopupWindow;return{basePath:basePath,modal:function(e){return"close"===e?Modal.close():"visible"===e?!!Modal.div:"maximize"===e?Modal.maximize(!0):"minimize"===e?Modal.maximize(!1):void Modal.open(e)},config:function(e){CKFinder._config=e},widget:function(e,t){function i(e){return e+(/^[0-9]+$/.test(e)?"px":"")}if(t=t||{},!e)throw'No "id" option defined in CKFinder.widget() call.';var n="border:none;";n+="width:"+i(configOrDefault(t.width,"100%"))+";",n+="height:"+i(configOrDefault(t.height,"400"))+";";var r=document.createElement("iframe");r.src="",r.setAttribute("style",n),r.setAttribute("seamless","seamless"),r.setAttribute("scrolling","auto"),r.setAttribute("tabindex",configOrDefault(t.tabindex,0)),r.attachEvent?r.attachEvent("onload",function(){internalCKFinderInit(t,r.contentDocument,"parent")}):r.onload=function(){/iPad|iPhone|iPod/.test(navigator.platform)&&(updateIOSConfig(t,r),r.contentWindow.addEventListener("ckfinderReady",function(e){e.detail.ckfinder.on("ui:resize",function(e){updateIOSConfig(e.finder.config,r)},null,null,1)})),internalCKFinderInit(t,r.contentDocument,"parent")};var o=document.getElementById(e);if(!o)throw'CKFinder.widget(): could not find element with id "'+e+'".';o.innerHTML="",o.appendChild(r),checkOnInit(t,r.contentWindow)},popup:function(e){function t(){ckfPopupWindow&&(r=ckfPopupWindow.document,r.open(),r.write('<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"><title>CKFinder 3 - File Browser</title></head><body><script src="'+window.CKFinder.basePath+'ckfinder.js" charset="utf-8"></script><script>window.isCKFinderPopup=true;window.onload=function() {CKFinder.start( window.opener.CKFinder._popupOptions );}</script></body></html>'),r.close(),ckfPopupWindow.focus())}e=e||{},window.CKFinder._popupOptions=e;var i=isIE9()?window.CKFinder.basePath+"ckfinder.html":"about:blank",n="location=no,menubar=no,toolbar=no,dependent=yes,minimizable=no,modal=yes,alwaysRaised=yes,resizable=yes,scrollbars=yes";n+=",width="+configOrDefault(e.width,1e3),n+=",height="+configOrDefault(e.height,700),n+=",top=50",n+=",left=100","undefined"==typeof ckfPopupWindow||ckfPopupWindow.closed||ckfPopupWindow.close();var r;try{var o="CKFPopup"+Date.now();ckfPopupWindow=window.open(i,o,n,!0)}catch(e){return}return/iPad|iPhone|iPod/.test(navigator.platform)?setTimeout(t,100):t(),ckfPopupWindow},start:function(e){if(!e){var t=window.opener,i={};e={};var n=window.location.search.substring(1);if(n)for(var r=n.split("&"),o=0;o<r.length;++o){var s=r[o].split("=");i[s[0]]=s[1]||null}if(i.popup&&(window.isCKFinderPopup=!0),t&&i.configId&&t.CKFinder&&t.CKFinder._popupOptions){var a=decodeURIComponent(i.configId);e=t.CKFinder._popupOptions[a]||{},e._omitCheckOnInit=!0}}CKFinder._setup(window,document),checkOnInit(e,window),CKFinder.start(e)},setupCKEditor:function(e,t,i){function n(e){if(/^(http(s)?:)?\/\/.+/i.test(e))return e;0!==e.indexOf("/")&&(e="/"+e);var t=window.parent?window.parent.location:window.location,i=t.protocol+"//"+t.host;return i+e}if(!e){for(var r in CKEDITOR.instances)CKFinder.setupCKEditor(CKEDITOR.instances[r]);return void CKEDITOR.on("instanceCreated",function(e){CKFinder.setupCKEditor(e.editor)})}e.config.filebrowserBrowseUrl=window.CKFinder.basePath+"ckfinder.html",i=extendObject({command:"QuickUpload",type:"Files"},i);var o=window.CKFinder.basePath+"core/connector/php/connector.php";t=extendObject(window.CKFinder._config||{},t),Object.keys(t).length&&(window.CKFinder._popupOptions||(window.CKFinder._popupOptions={}),t._omitCheckOnInit=!0,window.CKFinder._popupOptions[e.name]=t,e.config.filebrowserBrowseUrl+="?popup=1&configId="+encodeURIComponent(e.name),t.connectorPath?o=n(t.connectorPath):t.connectorLanguage&&(o=window.CKFinder.basePath+"core/connector/"+t.connectorLanguage+"/connector."+t.connectorLanguage)),e.config.filebrowserUploadUrl=o+createUrlParams(i)},_setup:function(window,document){window.CKFinder=window.CKFinder||{},window.CKFinder.basePath=function(){if(window.parent&&window.parent.CKFinder&&window.parent.CKFinder.basePath)return window.parent.CKFinder.basePath;for(var e,t,i=document.getElementsByTagName("script"),n=0;n<i.length&&(e=i[n],t=void 0!==e.getAttribute.length?e.src:e.getAttribute("src"),!t||"ckfinder.js"!==t.split("/").slice(-1)[0]);n++);return t.split("/").slice(0,-1).join("/")+"/"}();var CKFinder;!function(){if(!CKFinder||!CKFinder.requirejs){CKFinder?require=CKFinder:CKFinder={};var requirejs,require,define;!function(global){function isFunction(e){return"[object Function]"===ostring.call(e)}function isArray(e){return"[object Array]"===ostring.call(e)}function each(e,t){if(e){var i;for(i=0;i<e.length&&(!e[i]||!t(e[i],i,e));i+=1);}}function eachReverse(e,t){if(e){var i;for(i=e.length-1;i>-1&&(!e[i]||!t(e[i],i,e));i-=1);}}function hasProp(e,t){return hasOwn.call(e,t)}function getOwn(e,t){return hasProp(e,t)&&e[t]}function eachProp(e,t){var i;for(i in e)if(hasProp(e,i)&&t(e[i],i))break}function mixin(e,t,i,n){return t&&eachProp(t,function(t,r){(i||!hasProp(e,r))&&(!n||"object"!=typeof t||!t||isArray(t)||isFunction(t)||t instanceof RegExp?e[r]=t:(e[r]||(e[r]={}),mixin(e[r],t,i,n)))}),e}function bind(e,t){return function(){return t.apply(e,arguments)}}function scripts(){return document.getElementsByTagName("script")}function defaultOnError(e){throw e}function getGlobal(e){if(!e)return e;var t=global;return each(e.split("."),function(e){t=t[e]}),t}function makeError(e,t,i,n){var r=new Error(t+"http://requirejs.org/docs/errors.html#"+e);return r.requireType=e,r.requireModules=n,i&&(r.originalError=i),r}function newContext(e){function t(e){var t,i;for(t=0;t<e.length;t++)if(i=e[t],"."===i)e.splice(t,1),t-=1;else if(".."===i){if(0===t||1===t&&".."===e[2]||".."===e[t-1])continue;t>0&&(e.splice(t-1,2),t-=2)}}function i(e,i,n){var r,o,s,a,l,d,c,u,f,h,g,p,m=i&&i.split("/"),v=x.map,w=v&&v["*"];if(e&&(e=e.split("/"),c=e.length-1,x.nodeIdCompat&&jsSuffixRegExp.test(e[c])&&(e[c]=e[c].replace(jsSuffixRegExp,"")),"."===e[0].charAt(0)&&m&&(p=m.slice(0,m.length-1),e=p.concat(e)),t(e),e=e.join("/")),n&&v&&(m||w)){s=e.split("/");e:for(a=s.length;a>0;a-=1){if(d=s.slice(0,a).join("/"),m)for(l=m.length;l>0;l-=1)if(o=getOwn(v,m.slice(0,l).join("/")),o&&(o=getOwn(o,d))){u=o,f=a;break e}!h&&w&&getOwn(w,d)&&(h=getOwn(w,d),g=a)}!u&&h&&(u=h,f=g),u&&(s.splice(0,f,u),e=s.join("/"))}return r=getOwn(x.pkgs,e),r?r:e}function n(e){isBrowser&&each(scripts(),function(t){return t.getAttribute("data-requiremodule")===e&&t.getAttribute("data-requirecontext")===b.contextName?(t.parentNode.removeChild(t),!0):void 0})}function r(e){var t=getOwn(x.paths,e);return t&&isArray(t)&&t.length>1?(t.shift(),b.require.undef(e),b.makeRequire(null,{skipMap:!0})([e]),!0):void 0}function o(e){var t,i=e?e.indexOf("!"):-1;return i>-1&&(t=e.substring(0,i),e=e.substring(i+1,e.length)),[t,e]}function s(e,t,n,r){var s,a,l,d,c=null,u=t?t.name:null,f=e,h=!0,g="";return e||(h=!1,e="_@r"+(T+=1)),d=o(e),c=d[0],e=d[1],c&&(c=i(c,u,r),a=getOwn(S,c)),e&&(c?g=a&&a.normalize?a.normalize(e,function(e){return i(e,u,r)}):-1===e.indexOf("!")?i(e,u,r):e:(g=i(e,u,r),d=o(g),c=d[0],g=d[1],n=!0,s=b.nameToUrl(g))),l=!c||a||n?"":"_unnormalized"+(_+=1),{prefix:c,name:g,parentMap:t,unnormalized:!!l,url:s,originalName:f,isDefine:h,id:(c?c+"!"+g:g)+l}}function a(e){var t=e.id,i=getOwn(k,t);return i||(i=k[t]=new b.Module(e)),i}function l(e,t,i){var n=e.id,r=getOwn(k,n);!hasProp(S,n)||r&&!r.defineEmitComplete?(r=a(e),r.error&&"error"===t?i(r.error):r.on(t,i)):"defined"===t&&i(S[n])}function d(e,t){var i=e.requireModules,n=!1;t?t(e):(each(i,function(t){var i=getOwn(k,t);i&&(i.error=e,i.events.error&&(n=!0,i.emit("error",e)))}),n||req.onError(e))}function c(){globalDefQueue.length&&(each(globalDefQueue,function(e){var t=e[0];"string"==typeof t&&(b.defQueueMap[t]=!0),K.push(e)}),globalDefQueue=[])}function u(e){delete k[e],delete M[e]}function f(e,t,i){var n=e.map.id;e.error?e.emit("error",e.error):(t[n]=!0,each(e.depMaps,function(n,r){var o=n.id,s=getOwn(k,o);!s||e.depMatched[r]||i[o]||(getOwn(t,o)?(e.defineDep(r,S[o]),e.check()):f(s,t,i))}),i[n]=!0)}function h(){var e,t,i=1e3*x.waitSeconds,o=i&&b.startTime+i<(new Date).getTime(),s=[],a=[],l=!1,c=!0;if(!w){if(w=!0,eachProp(M,function(e){var i=e.map,d=i.id;if(e.enabled&&(i.isDefine||a.push(e),!e.error))if(!e.inited&&o)r(d)?(t=!0,l=!0):(s.push(d),n(d));else if(!e.inited&&e.fetched&&i.isDefine&&(l=!0,!i.prefix))return c=!1}),o&&s.length)return e=makeError("timeout","Load timeout for modules: "+s,null,s),e.contextName=b.contextName,d(e);c&&each(a,function(e){f(e,{},{})}),o&&!t||!l||!isBrowser&&!isWebWorker||F||(F=setTimeout(function(){F=0,h()},50)),w=!1}}function g(e){hasProp(S,e[0])||a(s(e[0],null,!0)).init(e[1],e[2])}function p(e,t,i,n){e.detachEvent&&!isOpera?n&&e.detachEvent(n,t):e.removeEventListener(i,t,!1)}function m(e){var t=e.currentTarget||e.srcElement;return p(t,b.onScriptLoad,"load","onreadystatechange"),p(t,b.onScriptError,"error"),{node:t,id:t&&t.getAttribute("data-requiremodule")}}function v(){var e;for(c();K.length;){if(e=K.shift(),null===e[0])return d(makeError("mismatch","Mismatched anonymous define() module: "+e[e.length-1]));g(e)}b.defQueueMap={}}var w,y,b,C,F,x={waitSeconds:7,baseUrl:"./",paths:{},bundles:{},pkgs:{},shim:{},config:{}},k={},M={},E={},K=[],S={},V={},I={},T=1,_=1;return C={require:function(e){return e.require?e.require:e.require=b.makeRequire(e.map)},exports:function(e){return e.usingExports=!0,e.map.isDefine?e.exports?S[e.map.id]=e.exports:e.exports=S[e.map.id]={}:void 0},module:function(e){return e.module?e.module:e.module={id:e.map.id,uri:e.map.url,config:function(){return getOwn(x.config,e.map.id)||{}},exports:e.exports||(e.exports={})}}},y=function(e){this.events=getOwn(E,e.id)||{},this.map=e,this.shim=getOwn(x.shim,e.id),this.depExports=[],this.depMaps=[],this.depMatched=[],this.pluginMaps={},this.depCount=0},y.prototype={init:function(e,t,i,n){n=n||{},this.inited||(this.factory=t,i?this.on("error",i):this.events.error&&(i=bind(this,function(e){this.emit("error",e)})),this.depMaps=e&&e.slice(0),this.errback=i,this.inited=!0,this.ignore=n.ignore,n.enabled||this.enabled?this.enable():this.check())},defineDep:function(e,t){this.depMatched[e]||(this.depMatched[e]=!0,this.depCount-=1,this.depExports[e]=t)},fetch:function(){if(!this.fetched){this.fetched=!0,b.startTime=(new Date).getTime();var e=this.map;return this.shim?void b.makeRequire(this.map,{enableBuildCallback:!0})(this.shim.deps||[],bind(this,function(){return e.prefix?this.callPlugin():this.load()})):e.prefix?this.callPlugin():this.load()}},load:function(){var e=this.map.url;V[e]||(V[e]=!0,b.load(this.map.id,e))},check:function(){if(this.enabled&&!this.enabling){var e,t,i=this.map.id,n=this.depExports,r=this.exports,o=this.factory;if(this.inited){if(this.error)this.emit("error",this.error);else if(!this.defining){if(this.defining=!0,this.depCount<1&&!this.defined){if(isFunction(o)){try{r=b.execCb(i,o,n,r)}catch(t){e=t}if(this.map.isDefine&&void 0===r&&(t=this.module,t?r=t.exports:this.usingExports&&(r=this.exports)),e){if(this.events.error&&this.map.isDefine||req.onError!==defaultOnError)return e.requireMap=this.map,e.requireModules=this.map.isDefine?[this.map.id]:null,e.requireType=this.map.isDefine?"define":"require",d(this.error=e);"undefined"!=typeof console&&console.error?console.error(e):req.onError(e)}}else r=o;if(this.exports=r,this.map.isDefine&&!this.ignore&&(S[i]=r,req.onResourceLoad)){var s=[];each(this.depMaps,function(e){s.push(e.normalizedMap||e)}),req.onResourceLoad(b,this.map,s)}u(i),this.defined=!0}this.defining=!1,this.defined&&!this.defineEmitted&&(this.defineEmitted=!0,this.emit("defined",this.exports),this.defineEmitComplete=!0)}}else hasProp(b.defQueueMap,i)||this.fetch()}},callPlugin:function(){var e=this.map,t=e.id,n=s(e.prefix);this.depMaps.push(n),l(n,"defined",bind(this,function(n){var r,o,c,f=getOwn(I,this.map.id),h=this.map.name,g=this.map.parentMap?this.map.parentMap.name:null,p=b.makeRequire(e.parentMap,{enableBuildCallback:!0});return this.map.unnormalized?(n.normalize&&(h=n.normalize(h,function(e){return i(e,g,!0)})||""),o=s(e.prefix+"!"+h,this.map.parentMap),l(o,"defined",bind(this,function(e){this.map.normalizedMap=o,this.init([],function(){return e},null,{enabled:!0,ignore:!0})})),c=getOwn(k,o.id),void(c&&(this.depMaps.push(o),this.events.error&&c.on("error",bind(this,function(e){this.emit("error",e)})),c.enable()))):f?(this.map.url=b.nameToUrl(f),void this.load()):(r=bind(this,function(e){this.init([],function(){return e},null,{enabled:!0})}),r.error=bind(this,function(e){this.inited=!0,this.error=e,e.requireModules=[t],eachProp(k,function(e){0===e.map.id.indexOf(t+"_unnormalized")&&u(e.map.id)}),d(e)}),r.fromText=bind(this,function(i,n){var o=e.name,l=s(o),c=useInteractive;n&&(i=n),c&&(useInteractive=!1),a(l),hasProp(x.config,t)&&(x.config[o]=x.config[t]);try{req.exec(i)}catch(e){return d(makeError("fromtexteval","fromText eval for "+t+" failed: "+e,e,[t]))}c&&(useInteractive=!0),this.depMaps.push(l),b.completeLoad(o),p([o],r)}),void n.load(e.name,p,r,x))})),b.enable(n,this),this.pluginMaps[n.id]=n},enable:function(){M[this.map.id]=this,this.enabled=!0,this.enabling=!0,each(this.depMaps,bind(this,function(e,t){var i,n,r;if("string"==typeof e){if(e=s(e,this.map.isDefine?this.map:this.map.parentMap,!1,!this.skipMap),this.depMaps[t]=e,r=getOwn(C,e.id))return void(this.depExports[t]=r(this));this.depCount+=1,l(e,"defined",bind(this,function(e){this.undefed||(this.defineDep(t,e),this.check())})),this.errback?l(e,"error",bind(this,this.errback)):this.events.error&&l(e,"error",bind(this,function(e){this.emit("error",e)}))}i=e.id,n=k[i],hasProp(C,i)||!n||n.enabled||b.enable(e,this)})),eachProp(this.pluginMaps,bind(this,function(e){var t=getOwn(k,e.id);t&&!t.enabled&&b.enable(e,this)})),this.enabling=!1,this.check()},on:function(e,t){var i=this.events[e];i||(i=this.events[e]=[]),i.push(t)},emit:function(e,t){each(this.events[e],function(e){e(t)}),"error"===e&&delete this.events[e]}},b={config:x,contextName:e,registry:k,defined:S,urlFetched:V,defQueue:K,defQueueMap:{},Module:y,makeModuleMap:s,nextTick:req.nextTick,onError:d,configure:function(e){e.baseUrl&&"/"!==e.baseUrl.charAt(e.baseUrl.length-1)&&(e.baseUrl+="/");var t=x.shim,i={paths:!0,bundles:!0,config:!0,map:!0};eachProp(e,function(e,t){i[t]?(x[t]||(x[t]={}),mixin(x[t],e,!0,!0)):x[t]=e}),e.bundles&&eachProp(e.bundles,function(e,t){each(e,function(e){e!==t&&(I[e]=t)})}),e.shim&&(eachProp(e.shim,function(e,i){isArray(e)&&(e={deps:e}),!e.exports&&!e.init||e.exportsFn||(e.exportsFn=b.makeShimExports(e)),t[i]=e}),x.shim=t),e.packages&&each(e.packages,function(e){var t,i;e="string"==typeof e?{name:e}:e,i=e.name,t=e.location,t&&(x.paths[i]=e.location),x.pkgs[i]=e.name+"/"+(e.main||"main").replace(currDirRegExp,"").replace(jsSuffixRegExp,"")}),eachProp(k,function(e,t){e.inited||e.map.unnormalized||(e.map=s(t,null,!0))}),(e.deps||e.callback)&&b.require(e.deps||[],e.callback)},makeShimExports:function(e){function t(){var t;return e.init&&(t=e.init.apply(global,arguments)),t||e.exports&&getGlobal(e.exports)}return t},makeRequire:function(t,r){function o(i,n,l){var c,u,f;return r.enableBuildCallback&&n&&isFunction(n)&&(n.__requireJsBuild=!0),"string"==typeof i?isFunction(n)?d(makeError("requireargs","Invalid require call"),l):t&&hasProp(C,i)?C[i](k[t.id]):req.get?req.get(b,i,t,o):(u=s(i,t,!1,!0),c=u.id,hasProp(S,c)?S[c]:d(makeError("notloaded",'Module name "'+c+'" has not been loaded yet for context: '+e+(t?"":". Use require([])")))):(v(),b.nextTick(function(){v(),f=a(s(null,t)),f.skipMap=r.skipMap,f.init(i,n,l,{enabled:!0}),h()}),o)}return r=r||{},mixin(o,{isBrowser:isBrowser,toUrl:function(e){var n,r=e.lastIndexOf("."),o=e.split("/")[0],s="."===o||".."===o;return-1!==r&&(!s||r>1)&&(n=e.substring(r,e.length),e=e.substring(0,r)),b.nameToUrl(i(e,t&&t.id,!0),n,!0)},defined:function(e){return hasProp(S,s(e,t,!1,!0).id)},specified:function(e){return e=s(e,t,!1,!0).id,hasProp(S,e)||hasProp(k,e)}}),t||(o.undef=function(e){c();var i=s(e,t,!0),r=getOwn(k,e);r.undefed=!0,n(e),delete S[e],delete V[i.url],delete E[e],eachReverse(K,function(t,i){t[0]===e&&K.splice(i,1)}),delete b.defQueueMap[e],r&&(r.events.defined&&(E[e]=r.events),u(e))}),o},enable:function(e){var t=getOwn(k,e.id);t&&a(e).enable()},completeLoad:function(e){var t,i,n,o=getOwn(x.shim,e)||{},s=o.exports;for(c();K.length;){if(i=K.shift(),null===i[0]){if(i[0]=e,t)break;t=!0}else i[0]===e&&(t=!0);g(i)}if(b.defQueueMap={},n=getOwn(k,e),!t&&!hasProp(S,e)&&n&&!n.inited){if(!(!x.enforceDefine||s&&getGlobal(s)))return r(e)?void 0:d(makeError("nodefine","No define call for "+e,null,[e]));g([e,o.deps||[],o.exportsFn])}h()},nameToUrl:function(e,t,i){var n,r,o,s,a,l,d,c=getOwn(x.pkgs,e);if(c&&(e=c),d=getOwn(I,e))return b.nameToUrl(d,t,i);if(req.jsExtRegExp.test(e))a=e+(t||"");else{for(n=x.paths,r=e.split("/"),o=r.length;o>0;o-=1)if(s=r.slice(0,o).join("/"),l=getOwn(n,s)){isArray(l)&&(l=l[0]),r.splice(0,o,l);break}a=r.join("/"),a+=t||(/^data\:|\?/.test(a)||i?"":".js"),a=("/"===a.charAt(0)||a.match(/^[\w\+\.\-]+:/)?"":x.baseUrl)+a}return x.urlArgs?a+((-1===a.indexOf("?")?"?":"&")+x.urlArgs):a},load:function(e,t){req.load(b,e,t)},execCb:function(e,t,i,n){return t.apply(n,i)},onScriptLoad:function(e){if("load"===e.type||readyRegExp.test((e.currentTarget||e.srcElement).readyState)){interactiveScript=null;var t=m(e);b.completeLoad(t.id)}},onScriptError:function(e){var t=m(e);if(!r(t.id)){var i=[];return eachProp(k,function(e,n){0!==n.indexOf("_@r")&&each(e.depMaps,function(e){return e.id===t.id&&i.push(n),!0})}),d(makeError("scripterror",'Script error for "'+t.id+(i.length?'", needed by: '+i.join(", "):'"'),e,[t.id]))}}},b.require=b.makeRequire(),b}function getInteractiveScript(){return interactiveScript&&"interactive"===interactiveScript.readyState?interactiveScript:(eachReverse(scripts(),function(e){return"interactive"===e.readyState?interactiveScript=e:void 0}),interactiveScript)}var req,s,head,baseElement,dataMain,src,interactiveScript,currentlyAddingScript,mainScript,subPath,version="2.1.22",commentRegExp=/(\/\*([\s\S]*?)\*\/|([^:]|^)\/\/(.*)$)/gm,cjsRequireRegExp=/[^.]\s*require\s*\(\s*["']([^'"\s]+)["']\s*\)/g,jsSuffixRegExp=/\.js$/,currDirRegExp=/^\.\//,op=Object.prototype,ostring=op.toString,hasOwn=op.hasOwnProperty,ap=Array.prototype,isBrowser=!("undefined"==typeof window||"undefined"==typeof navigator||!window.document),isWebWorker=!isBrowser&&"undefined"!=typeof importScripts,readyRegExp=isBrowser&&"PLAYSTATION 3"===navigator.platform?/^complete$/:/^(complete|loaded)$/,defContextName="_",isOpera="undefined"!=typeof opera&&"[object Opera]"===opera.toString(),contexts={},cfg={},globalDefQueue=[],useInteractive=!1;if("undefined"==typeof define){if("undefined"!=typeof requirejs){if(isFunction(requirejs))return;cfg=requirejs,requirejs=void 0}"undefined"==typeof require||isFunction(require)||(cfg=require,require=void 0),req=requirejs=function(e,t,i,n){var r,o,s=defContextName;return isArray(e)||"string"==typeof e||(o=e,isArray(t)?(e=t,t=i,i=n):e=[]),o&&o.context&&(s=o.context),r=getOwn(contexts,s),r||(r=contexts[s]=req.s.newContext(s)),o&&r.configure(o),r.require(e,t,i)},req.config=function(e){return req(e)},req.nextTick="undefined"!=typeof setTimeout?function(e){setTimeout(e,4)}:function(e){e()},require||(require=req),req.version=version,req.jsExtRegExp=/^\/|:|\?|\.js$/,req.isBrowser=isBrowser,s=req.s={contexts:contexts,newContext:newContext},req({}),each(["toUrl","undef","defined","specified"],function(e){req[e]=function(){var t=contexts[defContextName];return t.require[e].apply(t,arguments)}}),isBrowser&&(head=s.head=document.getElementsByTagName("head")[0],baseElement=document.getElementsByTagName("base")[0],baseElement&&(head=s.head=baseElement.parentNode)),req.onError=defaultOnError,req.createNode=function(e,t,i){var n=e.xhtml?document.createElementNS("http://www.w3.org/1999/xhtml","html:script"):document.createElement("script");return n.type=e.scriptType||"text/javascript",n.charset="utf-8",n.async=!0,n},req.load=function(e,t,i){var n,r=e&&e.config||{};if(isBrowser)return n=req.createNode(r,t,i),r.onNodeCreated&&r.onNodeCreated(n,r,t,i),n.setAttribute("data-requirecontext",e.contextName),n.setAttribute("data-requiremodule",t),!n.attachEvent||n.attachEvent.toString&&n.attachEvent.toString().indexOf("[native code")<0||isOpera?(n.addEventListener("load",e.onScriptLoad,!1),n.addEventListener("error",e.onScriptError,!1)):(useInteractive=!0,n.attachEvent("onreadystatechange",e.onScriptLoad)),n.src=i,currentlyAddingScript=n,baseElement?head.insertBefore(n,baseElement):head.appendChild(n),currentlyAddingScript=null,n;if(isWebWorker)try{importScripts(i),e.completeLoad(t)}catch(n){e.onError(makeError("importscripts","importScripts failed for "+t+" at "+i,n,[t]))}},isBrowser&&!cfg.skipDataMain&&eachReverse(scripts(),function(e){return head||(head=e.parentNode),dataMain=e.getAttribute("data-main"),dataMain?(mainScript=dataMain,cfg.baseUrl||(src=mainScript.split("/"),mainScript=src.pop(),subPath=src.length?src.join("/")+"/":"./",cfg.baseUrl=subPath),mainScript=mainScript.replace(jsSuffixRegExp,""),req.jsExtRegExp.test(mainScript)&&(mainScript=dataMain),cfg.deps=cfg.deps?cfg.deps.concat(mainScript):[mainScript],!0):void 0}),define=function(e,t,i){var n,r;"string"!=typeof e&&(i=t,t=e,e=null),isArray(t)||(i=t,t=null),!t&&isFunction(i)&&(t=[],i.length&&(i.toString().replace(commentRegExp,"").replace(cjsRequireRegExp,function(e,i){t.push(i)}),t=(1===i.length?["require"]:["require","exports","module"]).concat(t))),useInteractive&&(n=currentlyAddingScript||getInteractiveScript(),n&&(e||(e=n.getAttribute("data-requiremodule")),r=contexts[n.getAttribute("data-requirecontext")])),r?(r.defQueue.push([e,t,i]),r.defQueueMap[e]=!0):globalDefQueue.push([e,t,i])},define.amd={jQuery:!0},req.exec=function(text){return eval(text)},req(cfg)}}(this),CKFinder.requirejs=requirejs,CKFinder.require=require,CKFinder.define=define}}(),CKFinder.define("requireLib",function(){}),function(){function e(e,t,i){for(var n=(i||0)-1,r=e?e.length:0;++n<r;)if(e[n]===t)return n;return-1}function t(t,i){var n=typeof i;if(t=t.cache,"boolean"==n||null==i)return t[i]?0:-1;"number"!=n&&"string"!=n&&(n="object");var r="number"==n?i:v+i;return t=(t=t[n])&&t[r],"object"==n?t&&e(t,i)>-1?0:-1:t?0:-1}function i(e){var t=this.cache,i=typeof e;if("boolean"==i||null==e)t[e]=!0;else{"number"!=i&&"string"!=i&&(i="object");var n="number"==i?e:v+e,r=t[i]||(t[i]={});"object"==i?(r[n]||(r[n]=[])).push(e):r[n]=!0}}function n(e){return e.charCodeAt(0)}function r(e,t){for(var i=e.criteria,n=t.criteria,r=-1,o=i.length;++r<o;){var s=i[r],a=n[r];if(s!==a){if(s>a||"undefined"==typeof s)return 1;if(a>s||"undefined"==typeof a)return-1}}return e.index-t.index}function o(e){var t=-1,n=e.length,r=e[0],o=e[n/2|0],s=e[n-1];if(r&&"object"==typeof r&&o&&"object"==typeof o&&s&&"object"==typeof s)return!1;var a=l();a.false=a.null=a.true=a.undefined=!1;var d=l();for(d.array=e,d.cache=a,d.push=i;++t<n;)d.push(e[t]);return d}function s(e){return"\\"+G[e]}function a(){return g.pop()||[]}function l(){return p.pop()||{array:null,cache:null,criteria:null,false:!1,index:0,null:!1,number:null,object:null,push:null,string:null,true:!1,undefined:!1,value:null}}function d(e){e.length=0,g.length<y&&g.push(e)}function c(e){var t=e.cache;t&&c(t),e.array=e.cache=e.criteria=e.object=e.number=e.string=e.value=null,p.length<y&&p.push(e)}function u(e,t,i){t||(t=0),"undefined"==typeof i&&(i=e?e.length:0);for(var n=-1,r=i-t||0,o=Array(0>r?0:r);++n<r;)o[n]=e[t+n];return o}function f(i){function g(e){return e&&"object"==typeof e&&!Yi(e)&&qi.call(e,"__wrapped__")?e:new p(e)}function p(e,t){this.__chain__=!!t,this.__wrapped__=e;
}function y(e){function t(){if(n){var e=u(n);Ri.apply(e,arguments)}if(this instanceof t){var o=G(i.prototype),s=i.apply(o,e||arguments);return Ie(s)?s:o}return i.apply(r,e||arguments)}var i=e[0],n=e[2],r=e[4];return Ji(t,e),t}function S(e,t,i,n,r){if(i){var o=i(e);if("undefined"!=typeof o)return o}var s=Ie(e);if(!s)return e;var l=Ei.call(e);if(!L[l])return e;var c=Gi[l];switch(l){case D:case O:return new c(+e);case A:case U:return new c(e);case N:return o=c(e.source,M.exec(e)),o.lastIndex=e.lastIndex,o}var f=Yi(e);if(t){var h=!n;n||(n=a()),r||(r=a());for(var g=n.length;g--;)if(n[g]==e)return r[g];o=f?c(e.length):{}}else o=f?u(e):on({},e);return f&&(qi.call(e,"index")&&(o.index=e.index),qi.call(e,"input")&&(o.input=e.input)),t?(n.push(e),r.push(o),(f?Je:ln)(e,function(e,s){o[s]=S(e,t,i,n,r)}),h&&(d(n),d(r)),o):o}function G(e,t){return Ie(e)?Bi(e):{}}function J(e,t,i){if("function"!=typeof e)return Yt;if("undefined"==typeof t||!("prototype"in e))return e;var n=e.__bindData__;if("undefined"==typeof n&&(Xi.funcNames&&(n=!e.name),n=n||!Xi.funcDecomp,!n)){var r=Ti.call(e);Xi.funcNames||(n=!E.test(r)),n||(n=T.test(r),Ji(e,n))}if(n===!1||n!==!0&&1&n[1])return e;switch(i){case 1:return function(i){return e.call(t,i)};case 2:return function(i,n){return e.call(t,i,n)};case 3:return function(i,n,r){return e.call(t,i,n,r)};case 4:return function(i,n,r,o){return e.call(t,i,n,r,o)}}return Rt(e,t)}function Y(e){function t(){var e=l?s:this;if(r){var g=u(r);Ri.apply(g,arguments)}if((o||c)&&(g||(g=u(arguments)),o&&Ri.apply(g,o),c&&g.length<a))return n|=16,Y([i,f?n:-4&n,g,null,s,a]);if(g||(g=arguments),d&&(i=e[h]),this instanceof t){e=G(i.prototype);var p=i.apply(e,g);return Ie(p)?p:e}return i.apply(e,g)}var i=e[0],n=e[1],r=e[2],o=e[3],s=e[4],a=e[5],l=1&n,d=2&n,c=4&n,f=8&n,h=i;return Ji(t,e),t}function Q(i,n){var r=-1,s=le(),a=i?i.length:0,l=a>=w&&s===e,d=[];if(l){var u=o(n);u?(s=t,n=u):l=!1}for(;++r<a;){var f=i[r];s(n,f)<0&&d.push(f)}return l&&c(n),d}function Z(e,t,i,n){for(var r=(n||0)-1,o=e?e.length:0,s=[];++r<o;){var a=e[r];if(a&&"object"==typeof a&&"number"==typeof a.length&&(Yi(a)||fe(a))){t||(a=Z(a,t,i));var l=-1,d=a.length,c=s.length;for(s.length+=d;++l<d;)s[c++]=a[l]}else i||s.push(a)}return s}function te(e,t,i,n,r,o){if(i){var s=i(e,t);if("undefined"!=typeof s)return!!s}if(e===t)return 0!==e||1/e==1/t;var l=typeof e,c=typeof t;if(!(e!==e||e&&W[l]||t&&W[c]))return!1;if(null==e||null==t)return e===t;var u=Ei.call(e),f=Ei.call(t);if(u==P&&(u=H),f==P&&(f=H),u!=f)return!1;switch(u){case D:case O:return+e==+t;case A:return e!=+e?t!=+t:0==e?1/e==1/t:e==+t;case N:case U:return e==Ci(t)}var h=u==z;if(!h){var g=qi.call(e,"__wrapped__"),p=qi.call(t,"__wrapped__");if(g||p)return te(g?e.__wrapped__:e,p?t.__wrapped__:t,i,n,r,o);if(u!=H)return!1;var m=e.constructor,v=t.constructor;if(m!=v&&!(Ve(m)&&m instanceof m&&Ve(v)&&v instanceof v)&&"constructor"in e&&"constructor"in t)return!1}var w=!r;r||(r=a()),o||(o=a());for(var y=r.length;y--;)if(r[y]==e)return o[y]==t;var b=0;if(s=!0,r.push(e),o.push(t),h){if(y=e.length,b=t.length,s=b==y,s||n)for(;b--;){var C=y,F=t[b];if(n)for(;C--&&!(s=te(e[C],F,i,n,r,o)););else if(!(s=te(e[b],F,i,n,r,o)))break}}else an(t,function(t,a,l){return qi.call(l,a)?(b++,s=qi.call(e,a)&&te(e[a],t,i,n,r,o)):void 0}),s&&!n&&an(e,function(e,t,i){return qi.call(i,t)?s=--b>-1:void 0});return r.pop(),o.pop(),w&&(d(r),d(o)),s}function ie(e,t,i,n,r){(Yi(t)?Je:ln)(t,function(t,o){var s,a,l=t,d=e[o];if(t&&((a=Yi(t))||dn(t))){for(var c=n.length;c--;)if(s=n[c]==t){d=r[c];break}if(!s){var u;i&&(l=i(d,t),(u="undefined"!=typeof l)&&(d=l)),u||(d=a?Yi(d)?d:[]:dn(d)?d:{}),n.push(t),r.push(d),u||ie(d,t,i,n,r)}}else i&&(l=i(d,t),"undefined"==typeof l&&(l=t)),"undefined"!=typeof l&&(d=l);e[o]=d})}function ne(e,t){return e+Ii(Wi()*(t-e+1))}function re(i,n,r){var s=-1,l=le(),u=i?i.length:0,f=[],h=!n&&u>=w&&l===e,g=r||h?a():f;if(h){var p=o(g);l=t,g=p}for(;++s<u;){var m=i[s],v=r?r(m,s,i):m;(n?!s||g[g.length-1]!==v:l(g,v)<0)&&((r||h)&&g.push(v),f.push(m))}return h?(d(g.array),c(g)):r&&d(g),f}function oe(e){return function(t,i,n){var r={};i=g.createCallback(i,n,3);var o=-1,s=t?t.length:0;if("number"==typeof s)for(;++o<s;){var a=t[o];e(r,a,i(a,o,t),t)}else ln(t,function(t,n,o){e(r,t,i(t,n,o),o)});return r}}function se(e,t,i,n,r,o){var s=1&t,a=2&t,l=4&t,d=16&t,c=32&t;if(!a&&!Ve(e))throw new Fi;d&&!i.length&&(t&=-17,d=i=!1),c&&!n.length&&(t&=-33,c=n=!1);var f=e&&e.__bindData__;if(f&&f!==!0)return f=u(f),f[2]&&(f[2]=u(f[2])),f[3]&&(f[3]=u(f[3])),!s||1&f[1]||(f[4]=r),!s&&1&f[1]&&(t|=8),!l||4&f[1]||(f[5]=o),d&&Ri.apply(f[2]||(f[2]=[]),i),c&&Di.apply(f[3]||(f[3]=[]),n),f[1]|=t,se.apply(null,f);var h=1==t||17===t?y:Y;return h([e,t,i,n,r,o])}function ae(e){return en[e]}function le(){var t=(t=g.indexOf)===vt?e:t;return t}function de(e){return"function"==typeof e&&Ki.test(e)}function ce(e){var t,i;return!!(e&&Ei.call(e)==H&&(t=e.constructor,!Ve(t)||t instanceof t))&&(an(e,function(e,t){i=t}),"undefined"==typeof i||qi.call(e,i))}function ue(e){return tn[e]}function fe(e){return e&&"object"==typeof e&&"number"==typeof e.length&&Ei.call(e)==P||!1}function he(e,t,i,n){return"boolean"!=typeof t&&null!=t&&(n=i,i=t,t=!1),S(e,t,"function"==typeof i&&J(i,n,1))}function ge(e,t,i){return S(e,!0,"function"==typeof t&&J(t,i,1))}function pe(e,t){var i=G(e);return t?on(i,t):i}function me(e,t,i){var n;return t=g.createCallback(t,i,3),ln(e,function(e,i,r){return t(e,i,r)?(n=i,!1):void 0}),n}function ve(e,t,i){var n;return t=g.createCallback(t,i,3),ye(e,function(e,i,r){return t(e,i,r)?(n=i,!1):void 0}),n}function we(e,t,i){var n=[];an(e,function(e,t){n.push(t,e)});var r=n.length;for(t=J(t,i,3);r--&&t(n[r--],n[r],e)!==!1;);return e}function ye(e,t,i){var n=Zi(e),r=n.length;for(t=J(t,i,3);r--;){var o=n[r];if(t(e[o],o,e)===!1)break}return e}function be(e){var t=[];return an(e,function(e,i){Ve(e)&&t.push(i)}),t.sort()}function Ce(e,t){return!!e&&qi.call(e,t)}function Fe(e){for(var t=-1,i=Zi(e),n=i.length,r={};++t<n;){var o=i[t];r[e[o]]=o}return r}function xe(e){return e===!0||e===!1||e&&"object"==typeof e&&Ei.call(e)==D||!1}function ke(e){return e&&"object"==typeof e&&Ei.call(e)==O||!1}function Me(e){return e&&1===e.nodeType||!1}function Ee(e){var t=!0;if(!e)return t;var i=Ei.call(e),n=e.length;return i==z||i==U||i==P||i==H&&"number"==typeof n&&Ve(e.splice)?!n:(ln(e,function(){return t=!1}),t)}function Ke(e,t,i,n){return te(e,t,"function"==typeof i&&J(i,n,2))}function Se(e){return Hi(e)&&!Ni(parseFloat(e))}function Ve(e){return"function"==typeof e}function Ie(e){return!(!e||!W[typeof e])}function Te(e){return qe(e)&&e!=+e}function _e(e){return null===e}function qe(e){return"number"==typeof e||e&&"object"==typeof e&&Ei.call(e)==A||!1}function Re(e){return e&&"object"==typeof e&&Ei.call(e)==N||!1}function Pe(e){return"string"==typeof e||e&&"object"==typeof e&&Ei.call(e)==U||!1}function ze(e){return"undefined"==typeof e}function De(e,t,i){var n={};return t=g.createCallback(t,i,3),ln(e,function(e,i,r){n[i]=t(e,i,r)}),n}function Oe(e){var t=arguments,i=2;if(!Ie(e))return e;if("number"!=typeof t[2]&&(i=t.length),i>3&&"function"==typeof t[i-2])var n=J(t[--i-1],t[i--],2);else i>2&&"function"==typeof t[i-1]&&(n=t[--i]);for(var r=u(arguments,1,i),o=-1,s=a(),l=a();++o<i;)ie(e,r[o],n,s,l);return d(s),d(l),e}function Be(e,t,i){var n={};if("function"!=typeof t){var r=[];an(e,function(e,t){r.push(t)}),r=Q(r,Z(arguments,!0,!1,1));for(var o=-1,s=r.length;++o<s;){var a=r[o];n[a]=e[a]}}else t=g.createCallback(t,i,3),an(e,function(e,i,r){t(e,i,r)||(n[i]=e)});return n}function Ae(e){for(var t=-1,i=Zi(e),n=i.length,r=hi(n);++t<n;){var o=i[t];r[t]=[o,e[o]]}return r}function He(e,t,i){var n={};if("function"!=typeof t)for(var r=-1,o=Z(arguments,!0,!1,1),s=Ie(e)?o.length:0;++r<s;){var a=o[r];a in e&&(n[a]=e[a])}else t=g.createCallback(t,i,3),an(e,function(e,i,r){t(e,i,r)&&(n[i]=e)});return n}function Ne(e,t,i,n){var r=Yi(e);if(null==i)if(r)i=[];else{var o=e&&e.constructor,s=o&&o.prototype;i=G(s)}return t&&(t=g.createCallback(t,n,4),(r?Je:ln)(e,function(e,n,r){return t(i,e,n,r)})),i}function Ue(e){for(var t=-1,i=Zi(e),n=i.length,r=hi(n);++t<n;)r[t]=e[i[t]];return r}function Le(e){for(var t=arguments,i=-1,n=Z(t,!0,!1,1),r=t[2]&&t[2][t[1]]===e?1:n.length,o=hi(r);++i<r;)o[i]=e[n[i]];return o}function $e(e,t,i){var n=-1,r=le(),o=e?e.length:0,s=!1;return i=(0>i?Li(0,o+i):i)||0,Yi(e)?s=r(e,t,i)>-1:"number"==typeof o?s=(Pe(e)?e.indexOf(t,i):r(e,t,i))>-1:ln(e,function(e){return++n>=i?!(s=e===t):void 0}),s}function je(e,t,i){var n=!0;t=g.createCallback(t,i,3);var r=-1,o=e?e.length:0;if("number"==typeof o)for(;++r<o&&(n=!!t(e[r],r,e)););else ln(e,function(e,i,r){return n=!!t(e,i,r)});return n}function We(e,t,i){var n=[];t=g.createCallback(t,i,3);var r=-1,o=e?e.length:0;if("number"==typeof o)for(;++r<o;){var s=e[r];t(s,r,e)&&n.push(s)}else ln(e,function(e,i,r){t(e,i,r)&&n.push(e)});return n}function Ge(e,t,i){t=g.createCallback(t,i,3);var n=-1,r=e?e.length:0;if("number"!=typeof r){var o;return ln(e,function(e,i,n){return t(e,i,n)?(o=e,!1):void 0}),o}for(;++n<r;){var s=e[n];if(t(s,n,e))return s}}function Xe(e,t,i){var n;return t=g.createCallback(t,i,3),Ye(e,function(e,i,r){return t(e,i,r)?(n=e,!1):void 0}),n}function Je(e,t,i){var n=-1,r=e?e.length:0;if(t=t&&"undefined"==typeof i?t:J(t,i,3),"number"==typeof r)for(;++n<r&&t(e[n],n,e)!==!1;);else ln(e,t);return e}function Ye(e,t,i){var n=e?e.length:0;if(t=t&&"undefined"==typeof i?t:J(t,i,3),"number"==typeof n)for(;n--&&t(e[n],n,e)!==!1;);else{var r=Zi(e);n=r.length,ln(e,function(e,i,o){return i=r?r[--n]:--n,t(o[i],i,o)})}return e}function Qe(e,t){var i=u(arguments,2),n=-1,r="function"==typeof t,o=e?e.length:0,s=hi("number"==typeof o?o:0);return Je(e,function(e){s[++n]=(r?t:e[t]).apply(e,i)}),s}function Ze(e,t,i){var n=-1,r=e?e.length:0;if(t=g.createCallback(t,i,3),"number"==typeof r)for(var o=hi(r);++n<r;)o[n]=t(e[n],n,e);else o=[],ln(e,function(e,i,r){o[++n]=t(e,i,r)});return o}function et(e,t,i){var r=-(1/0),o=r;if("function"!=typeof t&&i&&i[t]===e&&(t=null),null==t&&Yi(e))for(var s=-1,a=e.length;++s<a;){var l=e[s];l>o&&(o=l)}else t=null==t&&Pe(e)?n:g.createCallback(t,i,3),Je(e,function(e,i,n){var s=t(e,i,n);s>r&&(r=s,o=e)});return o}function tt(e,t,i){var r=1/0,o=r;if("function"!=typeof t&&i&&i[t]===e&&(t=null),null==t&&Yi(e))for(var s=-1,a=e.length;++s<a;){var l=e[s];o>l&&(o=l)}else t=null==t&&Pe(e)?n:g.createCallback(t,i,3),Je(e,function(e,i,n){var s=t(e,i,n);r>s&&(r=s,o=e)});return o}function it(e,t,i,n){if(!e)return i;var r=arguments.length<3;t=g.createCallback(t,n,4);var o=-1,s=e.length;if("number"==typeof s)for(r&&(i=e[++o]);++o<s;)i=t(i,e[o],o,e);else ln(e,function(e,n,o){i=r?(r=!1,e):t(i,e,n,o)});return i}function nt(e,t,i,n){var r=arguments.length<3;return t=g.createCallback(t,n,4),Ye(e,function(e,n,o){i=r?(r=!1,e):t(i,e,n,o)}),i}function rt(e,t,i){return t=g.createCallback(t,i,3),We(e,function(e,i,n){return!t(e,i,n)})}function ot(e,t,i){if(e&&"number"!=typeof e.length&&(e=Ue(e)),null==t||i)return e?e[ne(0,e.length-1)]:h;var n=st(e);return n.length=$i(Li(0,t),n.length),n}function st(e){var t=-1,i=e?e.length:0,n=hi("number"==typeof i?i:0);return Je(e,function(e){var i=ne(0,++t);n[t]=n[i],n[i]=e}),n}function at(e){var t=e?e.length:0;return"number"==typeof t?t:Zi(e).length}function lt(e,t,i){var n;t=g.createCallback(t,i,3);var r=-1,o=e?e.length:0;if("number"==typeof o)for(;++r<o&&!(n=t(e[r],r,e)););else ln(e,function(e,i,r){return!(n=t(e,i,r))});return!!n}function dt(e,t,i){var n=-1,o=Yi(t),s=e?e.length:0,u=hi("number"==typeof s?s:0);for(o||(t=g.createCallback(t,i,3)),Je(e,function(e,i,r){var s=u[++n]=l();o?s.criteria=Ze(t,function(t){return e[t]}):(s.criteria=a())[0]=t(e,i,r),s.index=n,s.value=e}),s=u.length,u.sort(r);s--;){var f=u[s];u[s]=f.value,o||d(f.criteria),c(f)}return u}function ct(e){return e&&"number"==typeof e.length?u(e):Ue(e)}function ut(e){for(var t=-1,i=e?e.length:0,n=[];++t<i;){var r=e[t];r&&n.push(r)}return n}function ft(e){return Q(e,Z(arguments,!0,!0,1))}function ht(e,t,i){var n=-1,r=e?e.length:0;for(t=g.createCallback(t,i,3);++n<r;)if(t(e[n],n,e))return n;return-1}function gt(e,t,i){var n=e?e.length:0;for(t=g.createCallback(t,i,3);n--;)if(t(e[n],n,e))return n;return-1}function pt(e,t,i){var n=0,r=e?e.length:0;if("number"!=typeof t&&null!=t){var o=-1;for(t=g.createCallback(t,i,3);++o<r&&t(e[o],o,e);)n++}else if(n=t,null==n||i)return e?e[0]:h;return u(e,0,$i(Li(0,n),r))}function mt(e,t,i,n){return"boolean"!=typeof t&&null!=t&&(n=i,i="function"!=typeof t&&n&&n[t]===e?null:t,t=!1),null!=i&&(e=Ze(e,i,n)),Z(e,t)}function vt(t,i,n){if("number"==typeof n){var r=t?t.length:0;n=0>n?Li(0,r+n):n||0}else if(n){var o=Et(t,i);return t[o]===i?o:-1}return e(t,i,n)}function wt(e,t,i){var n=0,r=e?e.length:0;if("number"!=typeof t&&null!=t){var o=r;for(t=g.createCallback(t,i,3);o--&&t(e[o],o,e);)n++}else n=null==t||i?1:t||n;return u(e,0,$i(Li(0,r-n),r))}function yt(){for(var i=[],n=-1,r=arguments.length,s=a(),l=le(),u=l===e,f=a();++n<r;){var h=arguments[n];(Yi(h)||fe(h))&&(i.push(h),s.push(u&&h.length>=w&&o(n?i[n]:f)))}var g=i[0],p=-1,m=g?g.length:0,v=[];e:for(;++p<m;){var y=s[0];if(h=g[p],(y?t(y,h):l(f,h))<0){for(n=r,(y||f).push(h);--n;)if(y=s[n],(y?t(y,h):l(i[n],h))<0)continue e;v.push(h)}}for(;r--;)y=s[r],y&&c(y);return d(s),d(f),v}function bt(e,t,i){var n=0,r=e?e.length:0;if("number"!=typeof t&&null!=t){var o=r;for(t=g.createCallback(t,i,3);o--&&t(e[o],o,e);)n++}else if(n=t,null==n||i)return e?e[r-1]:h;return u(e,Li(0,r-n))}function Ct(e,t,i){var n=e?e.length:0;for("number"==typeof i&&(n=(0>i?Li(0,n+i):$i(i,n-1))+1);n--;)if(e[n]===t)return n;return-1}function Ft(e){for(var t=arguments,i=0,n=t.length,r=e?e.length:0;++i<n;)for(var o=-1,s=t[i];++o<r;)e[o]===s&&(zi.call(e,o--,1),r--);return e}function xt(e,t,i){e=+e||0,i="number"==typeof i?i:+i||1,null==t&&(t=e,e=0);for(var n=-1,r=Li(0,Si((t-e)/(i||1))),o=hi(r);++n<r;)o[n]=e,e+=i;return o}function kt(e,t,i){var n=-1,r=e?e.length:0,o=[];for(t=g.createCallback(t,i,3);++n<r;){var s=e[n];t(s,n,e)&&(o.push(s),zi.call(e,n--,1),r--)}return o}function Mt(e,t,i){if("number"!=typeof t&&null!=t){var n=0,r=-1,o=e?e.length:0;for(t=g.createCallback(t,i,3);++r<o&&t(e[r],r,e);)n++}else n=null==t||i?1:Li(0,t);return u(e,n)}function Et(e,t,i,n){var r=0,o=e?e.length:r;for(i=i?g.createCallback(i,n,1):Yt,t=i(t);o>r;){var s=r+o>>>1;i(e[s])<t?r=s+1:o=s}return r}function Kt(){return re(Z(arguments,!0,!0))}function St(e,t,i,n){return"boolean"!=typeof t&&null!=t&&(n=i,i="function"!=typeof t&&n&&n[t]===e?null:t,t=!1),null!=i&&(i=g.createCallback(i,n,3)),re(e,t,i)}function Vt(e){return Q(e,u(arguments,1))}function It(){for(var e=-1,t=arguments.length;++e<t;){var i=arguments[e];if(Yi(i)||fe(i))var n=n?re(Q(n,i).concat(Q(i,n))):i}return n||[]}function Tt(){for(var e=arguments.length>1?arguments:arguments[0],t=-1,i=e?et(hn(e,"length")):0,n=hi(0>i?0:i);++t<i;)n[t]=hn(e,t);return n}function _t(e,t){var i=-1,n=e?e.length:0,r={};for(t||!n||Yi(e[0])||(t=[]);++i<n;){var o=e[i];t?r[o]=t[i]:o&&(r[o[0]]=o[1])}return r}function qt(e,t){if(!Ve(t))throw new Fi;return function(){return--e<1?t.apply(this,arguments):void 0}}function Rt(e,t){return arguments.length>2?se(e,17,u(arguments,2),null,t):se(e,1,null,null,t)}function Pt(e){for(var t=arguments.length>1?Z(arguments,!0,!1,1):be(e),i=-1,n=t.length;++i<n;){var r=t[i];e[r]=se(e[r],1,null,null,e)}return e}function zt(e,t){return arguments.length>2?se(t,19,u(arguments,2),null,e):se(t,3,null,null,e)}function Dt(){for(var e=arguments,t=e.length;t--;)if(!Ve(e[t]))throw new Fi;return function(){for(var t=arguments,i=e.length;i--;)t=[e[i].apply(this,t)];return t[0]}}function Ot(e,t){return t="number"==typeof t?t:+t||e.length,se(e,4,null,null,null,t)}function Bt(e,t,i){var n,r,o,s,a,l,d,c=0,u=!1,f=!0;if(!Ve(e))throw new Fi;if(t=Li(0,t)||0,i===!0){var g=!0;f=!1}else Ie(i)&&(g=i.leading,u="maxWait"in i&&(Li(t,i.maxWait)||0),f="trailing"in i?i.trailing:f);var p=function(){var i=t-(pn()-s);if(0>=i){r&&Vi(r);var u=d;r=l=d=h,u&&(c=pn(),o=e.apply(a,n),l||r||(n=a=null))}else l=Pi(p,i)},m=function(){l&&Vi(l),r=l=d=h,(f||u!==t)&&(c=pn(),o=e.apply(a,n),l||r||(n=a=null))};return function(){if(n=arguments,s=pn(),a=this,d=f&&(l||!g),u===!1)var i=g&&!l;else{r||g||(c=s);var h=u-(s-c),v=0>=h;v?(r&&(r=Vi(r)),c=s,o=e.apply(a,n)):r||(r=Pi(m,h))}return v&&l?l=Vi(l):l||t===u||(l=Pi(p,t)),i&&(v=!0,o=e.apply(a,n)),!v||l||r||(n=a=null),o}}function At(e){if(!Ve(e))throw new Fi;var t=u(arguments,1);return Pi(function(){e.apply(h,t)},1)}function Ht(e,t){if(!Ve(e))throw new Fi;var i=u(arguments,2);return Pi(function(){e.apply(h,i)},t)}function Nt(e,t){if(!Ve(e))throw new Fi;var i=function(){var n=i.cache,r=t?t.apply(this,arguments):v+arguments[0];return qi.call(n,r)?n[r]:n[r]=e.apply(this,arguments)};return i.cache={},i}function Ut(e){var t,i;if(!Ve(e))throw new Fi;return function(){return t?i:(t=!0,i=e.apply(this,arguments),e=null,i)}}function Lt(e){return se(e,16,u(arguments,1))}function $t(e){return se(e,32,null,u(arguments,1))}function jt(e,t,i){var n=!0,r=!0;if(!Ve(e))throw new Fi;return i===!1?n=!1:Ie(i)&&(n="leading"in i?i.leading:n,r="trailing"in i?i.trailing:r),$.leading=n,$.maxWait=t,$.trailing=r,Bt(e,t,$)}function Wt(e,t){return se(t,16,[e])}function Gt(e){return function(){return e}}function Xt(e,t,i){var n=typeof e;if(null==e||"function"==n)return J(e,t,i);if("object"!=n)return ti(e);var r=Zi(e),o=r[0],s=e[o];return 1!=r.length||s!==s||Ie(s)?function(t){for(var i=r.length,n=!1;i--&&(n=te(t[r[i]],e[r[i]],null,!0)););return n}:function(e){var t=e[o];return s===t&&(0!==s||1/s==1/t)}}function Jt(e){return null==e?"":Ci(e).replace(rn,ae)}function Yt(e){return e}function Qt(e,t,i){var n=!0,r=t&&be(t);t&&(i||r.length)||(null==i&&(i=t),o=p,t=e,e=g,r=be(t)),i===!1?n=!1:Ie(i)&&"chain"in i&&(n=i.chain);var o=e,s=Ve(o);Je(r,function(i){var r=e[i]=t[i];s&&(o.prototype[i]=function(){var t=this.__chain__,i=this.__wrapped__,s=[i];Ri.apply(s,arguments);var a=r.apply(e,s);if(n||t){if(i===a&&Ie(a))return this;a=new o(a),a.__chain__=t}return a})})}function Zt(){return i._=Mi,this}function ei(){}function ti(e){return function(t){return t[e]}}function ii(e,t,i){var n=null==e,r=null==t;if(null==i&&("boolean"==typeof e&&r?(i=e,e=1):r||"boolean"!=typeof t||(i=t,r=!0)),n&&r&&(t=1),e=+e||0,r?(t=e,e=0):t=+t||0,i||e%1||t%1){var o=Wi();return $i(e+o*(t-e+parseFloat("1e-"+((o+"").length-1))),t)}return ne(e,t)}function ni(e,t){if(e){var i=e[t];return Ve(i)?e[t]():i}}function ri(e,t,i){var n=g.templateSettings;e=Ci(e||""),i=sn({},i,n);var r,o=sn({},i.imports,n.imports),a=Zi(o),l=Ue(o),d=0,c=i.interpolate||I,u="__p += '",f=bi((i.escape||I).source+"|"+c.source+"|"+(c===K?k:I).source+"|"+(i.evaluate||I).source+"|$","g");e.replace(f,function(t,i,n,o,a,l){return n||(n=o),u+=e.slice(d,l).replace(_,s),i&&(u+="' + __e("+i+") + '"),a&&(r=!0,u+="'; "+a+"; __p += '"),n&&(u+="' + ((__t = ("+n+")) == null ? '' : __t) + '"),d=l+t.length,t}),u+="';";var p=i.variable,m=p;m||(p="obj",u="with ("+p+") {"+u+"}"),u=(r?u.replace(C,""):u).replace(F,"$1").replace(x,"$1;"),u="function("+p+") {"+(m?"":p+" || ("+p+" = {});")+"var __t, __p = '', __e = _.escape"+(r?", __j = Array.prototype.join;function print() { __p += __j.call(arguments, '') }":";")+u+"return __p}";var v="/*//# sourceURL="+(i.sourceURL||"/lodash/template/source["+R++ +"]")+"*/";try{var w=mi(a,"return "+u+v).apply(h,l)}catch(e){throw e.source=u,e}return t?w(t):(w.source=u,w)}function oi(e,t,i){e=(e=+e)>-1?e:0;var n=-1,r=hi(e);for(t=J(t,i,1);++n<e;)r[n]=t(n);return r}function si(e){return null==e?"":Ci(e).replace(nn,ue)}function ai(e){var t=++m;return Ci(null==e?"":e)+t}function li(e){return e=new p(e),e.__chain__=!0,e}function di(e,t){return t(e),e}function ci(){return this.__chain__=!0,this}function ui(){return Ci(this.__wrapped__)}function fi(){return this.__wrapped__}i=i?ee.defaults(X.Object(),i,ee.pick(X,q)):X;var hi=i.Array,gi=i.Boolean,pi=i.Date,mi=i.Function,vi=i.Math,wi=i.Number,yi=i.Object,bi=i.RegExp,Ci=i.String,Fi=i.TypeError,xi=[],ki=yi.prototype,Mi=i._,Ei=ki.toString,Ki=bi("^"+Ci(Ei).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/toString| for [^\]]+/g,".*?")+"$"),Si=vi.ceil,Vi=i.clearTimeout,Ii=vi.floor,Ti=mi.prototype.toString,_i=de(_i=yi.getPrototypeOf)&&_i,qi=ki.hasOwnProperty,Ri=xi.push,Pi=i.setTimeout,zi=xi.splice,Di=xi.unshift,Oi=function(){try{var e={},t=de(t=yi.defineProperty)&&t,i=t(e,e,e)&&t}catch(e){}return i}(),Bi=de(Bi=yi.create)&&Bi,Ai=de(Ai=hi.isArray)&&Ai,Hi=i.isFinite,Ni=i.isNaN,Ui=de(Ui=yi.keys)&&Ui,Li=vi.max,$i=vi.min,ji=i.parseInt,Wi=vi.random,Gi={};Gi[z]=hi,Gi[D]=gi,Gi[O]=pi,Gi[B]=mi,Gi[H]=yi,Gi[A]=wi,Gi[N]=bi,Gi[U]=Ci,p.prototype=g.prototype;var Xi=g.support={};Xi.funcDecomp=!de(i.WinRTError)&&T.test(f),Xi.funcNames="string"==typeof mi.name,g.templateSettings={escape:/<%-([\s\S]+?)%>/g,evaluate:/<%([\s\S]+?)%>/g,interpolate:K,variable:"",imports:{_:g}},Bi||(G=function(){function e(){}return function(t){if(Ie(t)){e.prototype=t;var n=new e;e.prototype=null}return n||i.Object()}}());var Ji=Oi?function(e,t){j.value=t,Oi(e,"__bindData__",j),j.value=null}:ei,Yi=Ai||function(e){return e&&"object"==typeof e&&"number"==typeof e.length&&Ei.call(e)==z||!1},Qi=function(e){var t,i=e,n=[];if(!i)return n;if(!W[typeof e])return n;for(t in i)qi.call(i,t)&&n.push(t);return n},Zi=Ui?function(e){return Ie(e)?Ui(e):[]}:Qi,en={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},tn=Fe(en),nn=bi("("+Zi(tn).join("|")+")","g"),rn=bi("["+Zi(en).join("")+"]","g"),on=function(e,t,i){var n,r=e,o=r;if(!r)return o;var s=arguments,a=0,l="number"==typeof i?2:s.length;if(l>3&&"function"==typeof s[l-2])var d=J(s[--l-1],s[l--],2);else l>2&&"function"==typeof s[l-1]&&(d=s[--l]);for(;++a<l;)if(r=s[a],r&&W[typeof r])for(var c=-1,u=W[typeof r]&&Zi(r),f=u?u.length:0;++c<f;)n=u[c],o[n]=d?d(o[n],r[n]):r[n];return o},sn=function(e,t,i){var n,r=e,o=r;if(!r)return o;for(var s=arguments,a=0,l="number"==typeof i?2:s.length;++a<l;)if(r=s[a],r&&W[typeof r])for(var d=-1,c=W[typeof r]&&Zi(r),u=c?c.length:0;++d<u;)n=c[d],"undefined"==typeof o[n]&&(o[n]=r[n]);return o},an=function(e,t,i){var n,r=e,o=r;if(!r)return o;if(!W[typeof r])return o;t=t&&"undefined"==typeof i?t:J(t,i,3);for(n in r)if(t(r[n],n,e)===!1)return o;return o},ln=function(e,t,i){var n,r=e,o=r;if(!r)return o;if(!W[typeof r])return o;t=t&&"undefined"==typeof i?t:J(t,i,3);for(var s=-1,a=W[typeof r]&&Zi(r),l=a?a.length:0;++s<l;)if(n=a[s],t(r[n],n,e)===!1)return o;return o},dn=_i?function(e){if(!e||Ei.call(e)!=H)return!1;var t=e.valueOf,i=de(t)&&(i=_i(t))&&_i(i);return i?e==i||_i(e)==i:ce(e)}:ce,cn=oe(function(e,t,i){qi.call(e,i)?e[i]++:e[i]=1}),un=oe(function(e,t,i){(qi.call(e,i)?e[i]:e[i]=[]).push(t)}),fn=oe(function(e,t,i){e[i]=t}),hn=Ze,gn=We,pn=de(pn=pi.now)&&pn||function(){return(new pi).getTime()},mn=8==ji(b+"08")?ji:function(e,t){return ji(Pe(e)?e.replace(V,""):e,t||0)};return g.after=qt,g.assign=on,g.at=Le,g.bind=Rt,g.bindAll=Pt,g.bindKey=zt,g.chain=li,g.compact=ut,g.compose=Dt,g.constant=Gt,g.countBy=cn,g.create=pe,g.createCallback=Xt,g.curry=Ot,g.debounce=Bt,g.defaults=sn,g.defer=At,g.delay=Ht,g.difference=ft,g.filter=We,g.flatten=mt,g.forEach=Je,g.forEachRight=Ye,g.forIn=an,g.forInRight=we,g.forOwn=ln,g.forOwnRight=ye,g.functions=be,g.groupBy=un,g.indexBy=fn,g.initial=wt,g.intersection=yt,g.invert=Fe,g.invoke=Qe,g.keys=Zi,g.map=Ze,g.mapValues=De,g.max=et,g.memoize=Nt,g.merge=Oe,g.min=tt,g.omit=Be,g.once=Ut,g.pairs=Ae,g.partial=Lt,g.partialRight=$t,g.pick=He,g.pluck=hn,g.property=ti,g.pull=Ft,g.range=xt,g.reject=rt,g.remove=kt,g.rest=Mt,g.shuffle=st,g.sortBy=dt,g.tap=di,g.throttle=jt,g.times=oi,g.toArray=ct,g.transform=Ne,g.union=Kt,g.uniq=St,g.values=Ue,g.where=gn,g.without=Vt,g.wrap=Wt,g.xor=It,g.zip=Tt,g.zipObject=_t,g.collect=Ze,g.drop=Mt,g.each=Je,g.eachRight=Ye,g.extend=on,g.methods=be,g.object=_t,g.select=We,g.tail=Mt,g.unique=St,g.unzip=Tt,Qt(g),g.clone=he,g.cloneDeep=ge,g.contains=$e,g.escape=Jt,g.every=je,g.find=Ge,g.findIndex=ht,g.findKey=me,g.findLast=Xe,g.findLastIndex=gt,g.findLastKey=ve,g.has=Ce,g.identity=Yt,g.indexOf=vt,g.isArguments=fe,g.isArray=Yi,g.isBoolean=xe,g.isDate=ke,g.isElement=Me,g.isEmpty=Ee,g.isEqual=Ke,g.isFinite=Se,g.isFunction=Ve,g.isNaN=Te,g.isNull=_e,g.isNumber=qe,g.isObject=Ie,g.isPlainObject=dn,g.isRegExp=Re,g.isString=Pe,g.isUndefined=ze,g.lastIndexOf=Ct,g.mixin=Qt,g.noConflict=Zt,g.noop=ei,g.now=pn,g.parseInt=mn,g.random=ii,g.reduce=it,g.reduceRight=nt,g.result=ni,g.runInContext=f,g.size=at,g.some=lt,g.sortedIndex=Et,g.template=ri,g.unescape=si,g.uniqueId=ai,g.all=je,g.any=lt,g.detect=Ge,g.findWhere=Ge,g.foldl=it,g.foldr=nt,g.include=$e,g.inject=it,Qt(function(){var e={};return ln(g,function(t,i){g.prototype[i]||(e[i]=t)}),e}(),!1),g.first=pt,g.last=bt,g.sample=ot,g.take=pt,g.head=pt,ln(g,function(e,t){var i="sample"!==t;g.prototype[t]||(g.prototype[t]=function(t,n){var r=this.__chain__,o=e(this.__wrapped__,t,n);return r||null!=t&&(!n||i&&"function"==typeof t)?new p(o,r):o})}),g.VERSION="2.4.2",g.prototype.chain=ci,g.prototype.toString=ui,g.prototype.value=fi,g.prototype.valueOf=fi,Je(["join","pop","shift"],function(e){var t=xi[e];g.prototype[e]=function(){var e=this.__chain__,i=t.apply(this.__wrapped__,arguments);return e?new p(i,e):i}}),Je(["push","reverse","sort","unshift"],function(e){var t=xi[e];g.prototype[e]=function(){return t.apply(this.__wrapped__,arguments),this}}),Je(["concat","slice","splice"],function(e){var t=xi[e];g.prototype[e]=function(){return new p(t.apply(this.__wrapped__,arguments),this.__chain__)}}),g}var h,g=[],p=[],m=0,v=+new Date+"",w=75,y=40,b=S("!*/)ﻘ")+S("906——")+S("3ᚴᠻ‶‶››‾‾››‶‶⁊⁮”ぃ"),C=/\b__p \+= '';/g,F=/\b(__p \+=) '' \+/g,x=/(__e\(.*?\)|\b__t\)) \+\n'';/g,k=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,M=/\w*$/,E=/^\s*function[ \n\r\t]+\w/,K=/<%=([\s\S]+?)%>/g,V=RegExp("^["+b+"]*0+(?=.$)"),I=/($^)/,T=/\bthis\b/,_=/['\n\r\t\u2028\u2029\\]/g,q=["Array","Boolean","Date","Function","Math","Number","Object","RegExp","String","_","attachEvent","clearTimeout","isFinite","isNaN","parseInt","setTimeout"],R=0,P="[object Arguments]",z="[object Array]",D="[object Boolean]",O="[object Date]",B="[object Function]",A="[object Number]",H="[object Object]",N="[object RegExp]",U="[object String]",L={};L[B]=!1,L[P]=L[z]=L[D]=L[O]=L[A]=L[H]=L[N]=L[U]=!0;var $={leading:!1,maxWait:0,trailing:!1},j={configurable:!1,enumerable:!1,value:null,writable:!1},W={boolean:!1,function:!0,object:!0,number:!1,string:!1,undefined:!1},G={"\\":"\\","'":"'","\n":"n","\r":"r","   ":"t","\u2028":"u2028","\u2029":"u2029"},X=W[typeof window]&&window||this,J=W[typeof exports]&&exports&&!exports.nodeType&&exports,Y=W[typeof module]&&module&&!module.nodeType&&module,Q=Y&&Y.exports===J&&J,Z=W[typeof global]&&global;!Z||Z.global!==Z&&Z.window!==Z||(X=Z);var ee=f();"function"==typeof CKFinder.define&&"object"==typeof CKFinder.define.amd&&CKFinder.define.amd?(X._=ee,CKFinder.define("underscore",[],function(){return ee})):J&&Y?Q?(Y.exports=ee)._=ee:J._=ee:X._=ee}.call(this),function(){function e(t,i,n){return("string"==typeof i?i:i.toString()).replace(t.define||s,function(e,i,r,o){return 0===i.indexOf("def.")&&(i=i.substring(4)),i in n||(":"===r?(t.defineParams&&o.replace(t.defineParams,function(e,t,r){n[i]={arg:t,text:r}}),i in n||(n[i]=o)):new Function("def","def['"+i+"']="+o)(n)),""}).replace(t.use||s,function(i,r){t.useParams&&(r=r.replace(t.useParams,function(e,t,i,r){return n[i]&&n[i].arg&&r?(e=(i+":"+r).replace(/'|\\/g,"_"),n.__exp=n.__exp||{},n.__exp[e]=n[i].text.replace(new RegExp("(^|[^w$])"+n[i].arg+"([^w$])","g"),"$1"+r+"$2"),t+"def.__exp['"+e+"']"):void 0}));var o=new Function("def","return "+r)(n);return o?e(t,o,n):o})}function t(e){return e.replace(/\\('|\\)/g,"$1").replace(/[\r\t\n]/g," ")}var i,n={version:"1.0.3",templateSettings:{evaluate:/\{\{([\s\S]+?(\}?)+)\}\}/g,interpolate:/\{\{=([\s\S]+?)\}\}/g,encode:/\{\{!([\s\S]+?)\}\}/g,use:/\{\{#([\s\S]+?)\}\}/g,useParams:/(^|[^\w$])def(?:\.|\[[\'\"])([\w$\.]+)(?:[\'\"]\])?\s*\:\s*([\w$\.]+|\"[^\"]+\"|\'[^\']+\'|\{[^\}]+\})/g,define:/\{\{##\s*([\w\.$]+)\s*(\:|=)([\s\S]+?)#\}\}/g,defineParams:/^\s*([\w$]+):([\s\S]+)/,conditional:/\{\{\?(\?)?\s*([\s\S]*?)\s*\}\}/g,iterate:/\{\{~\s*(?:\}\}|([\s\S]+?)\s*\:\s*([\w$]+)\s*(?:\:\s*([\w$]+))?\s*\}\})/g,varname:"it",strip:!0,append:!0,selfcontained:!1,doNotSkipEncoded:!1},template:void 0,compile:void 0};n.encodeHTMLSource=function(e){var t={"&":"&#38;","<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","/":"&#47;"},i=e?/[&<>"'\/]/g:/&(?!#?\w+;)|<|>|"|'|\//g;return function(e){return e?e.toString().replace(i,function(e){return t[e]||e}):""}},i=function(){return this||(0,eval)("this")}(),"undefined"!=typeof module&&module.exports?module.exports=n:"function"==typeof CKFinder.define&&CKFinder.define.amd?CKFinder.define("doT",[],function(){return n}):i.doT=n;var r={start:"'+(",end:")+'",startencode:"'+encodeHTML("},o={start:"';out+=(",end:");out+='",startencode:"';out+=encodeHTML("},s=/$^/;n.template=function(a,l,d){l=l||n.templateSettings;var c,u,f=l.append?r:o,h=0;a=l.use||l.define?e(l,a,d||{}):a,a=("var out='"+(l.strip?a.replace(/(^|\r|\n)\t* +| +\t*(\r|\n|$)/g," ").replace(/\r|\n|\t|\/\*[\s\S]*?\*\//g,""):a).replace(/'|\\/g,"\\$&").replace(l.interpolate||s,function(e,i){return f.start+t(i)+f.end}).replace(l.encode||s,function(e,i){return c=!0,f.startencode+t(i)+f.end}).replace(l.conditional||s,function(e,i,n){return i?n?"';}else if("+t(n)+"){out+='":"';}else{out+='":n?"';if("+t(n)+"){out+='":"';}out+='"}).replace(l.iterate||s,function(e,i,n,r){return i?(h+=1,u=r||"i"+h,i=t(i),"';var arr"+h+"="+i+";if(arr"+h+"){var "+n+","+u+"=-1,l"+h+"=arr"+h+".length-1;while("+u+"<l"+h+"){"+n+"=arr"+h+"["+u+"+=1];out+='"):"';} } out+='"}).replace(l.evaluate||s,function(e,i){return"';"+t(i)+"out+='"})+"';return out;").replace(/\n/g,"\n").replace(/\t/g,"\t").replace(/\r/g,"\r").replace(/(\s|;|\}|^|\{)out\+='';/g,"$1").replace(/\+''/g,""),c&&(l.selfcontained||!i||i._encodeHTML||(i._encodeHTML=n.encodeHTMLSource(l.doNotSkipEncoded)),a="var encodeHTML = typeof _encodeHTML !== 'undefined' ? _encodeHTML : ("+n.encodeHTMLSource.toString()+"("+(l.doNotSkipEncoded||"")+"));"+a);try{return new Function(l.varname,a)}catch(e){throw"undefined"!=typeof console&&console.log("Could not create a template function: "+a),e}},n.compile=function(e,t){return n.template(e,null,t)}}(),function(e,t){if("function"==typeof CKFinder.define&&CKFinder.define.amd)CKFinder.define("backbone",["underscore","jquery","exports"],function(i,n,r){e.Backbone=t(e,r,i,n)});else if("undefined"!=typeof exports){var i=require("underscore");t(e,exports,i)}else e.Backbone=t(e,{},e._,e.jQuery||e.Zepto||e.ender||e.$)}(this,function(e,t,i,n){var r=e.Backbone,o=[],s=(o.push,o.slice);o.splice,t.VERSION="1.1.2",t.$=n,t.noConflict=function(){return e.Backbone=r,this},t.emulateHTTP=!1,t.emulateJSON=!1;var a=t.Events={on:function(e,t,i){if(!d(this,"on",e,[t,i])||!t)return this;this._events||(this._events={});var n=this._events[e]||(this._events[e]=[]);return n.push({callback:t,context:i,ctx:i||this}),this},once:function(e,t,n){if(!d(this,"once",e,[t,n])||!t)return this;var r=this,o=i.once(function(){r.off(e,o),t.apply(this,arguments)});return o._callback=t,this.on(e,o,n)},off:function(e,t,n){var r,o,s,a,l,c,u,f;if(!this._events||!d(this,"off",e,[t,n]))return this;if(!e&&!t&&!n)return this._events=void 0,this;for(a=e?[e]:i.keys(this._events),l=0,c=a.length;c>l;l++)if(e=a[l],s=this._events[e]){if(this._events[e]=r=[],t||n)for(u=0,f=s.length;f>u;u++)o=s[u],(t&&t!==o.callback&&t!==o.callback._callback||n&&n!==o.context)&&r.push(o);r.length||delete this._events[e]}return this},trigger:function(e){if(!this._events)return this;var t=s.call(arguments,1);if(!d(this,"trigger",e,t))return this;var i=this._events[e],n=this._events.all;return i&&c(i,t),n&&c(n,arguments),this},stopListening:function(e,t,n){var r=this._listeningTo;if(!r)return this;var o=!t&&!n;n||"object"!=typeof t||(n=this),e&&((r={})[e._listenId]=e);for(var s in r)e=r[s],e.off(t,n,this),(o||i.isEmpty(e._events))&&delete this._listeningTo[s];return this}},l=/\s+/,d=function(e,t,i,n){if(!i)return!0;if("object"==typeof i){for(var r in i)e[t].apply(e,[r,i[r]].concat(n));
return!1}if(l.test(i)){for(var o=i.split(l),s=0,a=o.length;a>s;s++)e[t].apply(e,[o[s]].concat(n));return!1}return!0},c=function(e,t){var i,n=-1,r=e.length,o=t[0],s=t[1],a=t[2];switch(t.length){case 0:for(;++n<r;)(i=e[n]).callback.call(i.ctx);return;case 1:for(;++n<r;)(i=e[n]).callback.call(i.ctx,o);return;case 2:for(;++n<r;)(i=e[n]).callback.call(i.ctx,o,s);return;case 3:for(;++n<r;)(i=e[n]).callback.call(i.ctx,o,s,a);return;default:for(;++n<r;)(i=e[n]).callback.apply(i.ctx,t);return}},u={listenTo:"on",listenToOnce:"once"};i.each(u,function(e,t){a[t]=function(t,n,r){var o=this._listeningTo||(this._listeningTo={}),s=t._listenId||(t._listenId=i.uniqueId("l"));return o[s]=t,r||"object"!=typeof n||(r=this),t[e](n,r,this),this}}),a.bind=a.on,a.unbind=a.off,i.extend(t,a);var f=t.Model=function(e,t){var n=e||{};t||(t={}),this.cid=i.uniqueId("c"),this.attributes={},t.collection&&(this.collection=t.collection),t.parse&&(n=this.parse(n,t)||{}),n=i.defaults({},n,i.result(this,"defaults")),this.set(n,t),this.changed={},this.initialize.apply(this,arguments)};i.extend(f.prototype,a,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(e){return i.clone(this.attributes)},sync:function(){return t.sync.apply(this,arguments)},get:function(e){return this.attributes[e]},escape:function(e){return i.escape(this.get(e))},has:function(e){return null!=this.get(e)},set:function(e,t,n){var r,o,s,a,l,d,c,u;if(null==e)return this;if("object"==typeof e?(o=e,n=t):(o={})[e]=t,n||(n={}),!this._validate(o,n))return!1;s=n.unset,l=n.silent,a=[],d=this._changing,this._changing=!0,d||(this._previousAttributes=i.clone(this.attributes),this.changed={}),u=this.attributes,c=this._previousAttributes,this.idAttribute in o&&(this.id=o[this.idAttribute]);for(r in o)t=o[r],i.isEqual(u[r],t)||a.push(r),i.isEqual(c[r],t)?delete this.changed[r]:this.changed[r]=t,s?delete u[r]:u[r]=t;if(!l){a.length&&(this._pending=n);for(var f=0,h=a.length;h>f;f++)this.trigger("change:"+a[f],this,u[a[f]],n)}if(d)return this;if(!l)for(;this._pending;)n=this._pending,this._pending=!1,this.trigger("change",this,n);return this._pending=!1,this._changing=!1,this},unset:function(e,t){return this.set(e,void 0,i.extend({},t,{unset:!0}))},clear:function(e){var t={};for(var n in this.attributes)t[n]=void 0;return this.set(t,i.extend({},e,{unset:!0}))},hasChanged:function(e){return null==e?!i.isEmpty(this.changed):i.has(this.changed,e)},changedAttributes:function(e){if(!e)return!!this.hasChanged()&&i.clone(this.changed);var t,n=!1,r=this._changing?this._previousAttributes:this.attributes;for(var o in e)i.isEqual(r[o],t=e[o])||((n||(n={}))[o]=t);return n},previous:function(e){return null!=e&&this._previousAttributes?this._previousAttributes[e]:null},previousAttributes:function(){return i.clone(this._previousAttributes)},fetch:function(e){e=e?i.clone(e):{},void 0===e.parse&&(e.parse=!0);var t=this,n=e.success;return e.success=function(i){return!!t.set(t.parse(i,e),e)&&(n&&n(t,i,e),void t.trigger("sync",t,i,e))},D(this,e),this.sync("read",this,e)},save:function(e,t,n){var r,o,s,a=this.attributes;if(null==e||"object"==typeof e?(r=e,n=t):(r={})[e]=t,n=i.extend({validate:!0},n),r&&!n.wait){if(!this.set(r,n))return!1}else if(!this._validate(r,n))return!1;r&&n.wait&&(this.attributes=i.extend({},a,r)),void 0===n.parse&&(n.parse=!0);var l=this,d=n.success;return n.success=function(e){l.attributes=a;var t=l.parse(e,n);return n.wait&&(t=i.extend(r||{},t)),!(i.isObject(t)&&!l.set(t,n))&&(d&&d(l,e,n),void l.trigger("sync",l,e,n))},D(this,n),o=this.isNew()?"create":n.patch?"patch":"update","patch"===o&&(n.attrs=r),s=this.sync(o,this,n),r&&n.wait&&(this.attributes=a),s},destroy:function(e){e=e?i.clone(e):{};var t=this,n=e.success,r=function(){t.trigger("destroy",t,t.collection,e)};if(e.success=function(i){(e.wait||t.isNew())&&r(),n&&n(t,i,e),t.isNew()||t.trigger("sync",t,i,e)},this.isNew())return e.success(),!1;D(this,e);var o=this.sync("delete",this,e);return e.wait||r(),o},url:function(){var e=i.result(this,"urlRoot")||i.result(this.collection,"url")||z();return this.isNew()?e:e.replace(/([^\/])$/,"$1/")+encodeURIComponent(this.id)},parse:function(e,t){return e},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(e){return this._validate({},i.extend(e||{},{validate:!0}))},_validate:function(e,t){if(!t.validate||!this.validate)return!0;e=i.extend({},this.attributes,e);var n=this.validationError=this.validate(e,t)||null;return!n||(this.trigger("invalid",this,n,i.extend(t,{validationError:n})),!1)}});var h=["keys","values","pairs","invert","pick","omit"];i.each(h,function(e){f.prototype[e]=function(){var t=s.call(arguments);return t.unshift(this.attributes),i[e].apply(i,t)}});var g=t.Collection=function(e,t){t||(t={}),t.model&&(this.model=t.model),void 0!==t.comparator&&(this.comparator=t.comparator),this._reset(),this.initialize.apply(this,arguments),e&&this.reset(e,i.extend({silent:!0},t))},p={add:!0,remove:!0,merge:!0},m={add:!0,remove:!1};i.extend(g.prototype,a,{model:f,initialize:function(){},toJSON:function(e){return this.map(function(t){return t.toJSON(e)})},sync:function(){return t.sync.apply(this,arguments)},add:function(e,t){return this.set(e,i.extend({merge:!1},t,m))},remove:function(e,t){var n=!i.isArray(e);e=n?[e]:i.clone(e),t||(t={});var r,o,s,a;for(r=0,o=e.length;o>r;r++)a=e[r]=this.get(e[r]),a&&(delete this._byId[a.id],delete this._byId[a.cid],s=this.indexOf(a),this.models.splice(s,1),this.length--,t.silent||(t.index=s,a.trigger("remove",a,this,t)),this._removeReference(a,t));return n?e[0]:e},set:function(e,t){t=i.defaults({},t,p),t.parse&&(e=this.parse(e,t));var n=!i.isArray(e);e=n?e?[e]:[]:i.clone(e);var r,o,s,a,l,d,c,u=t.at,h=this.model,g=this.comparator&&null==u&&t.sort!==!1,m=i.isString(this.comparator)?this.comparator:null,v=[],w=[],y={},b=t.add,C=t.merge,F=t.remove,x=!(g||!b||!F)&&[];for(r=0,o=e.length;o>r;r++){if(l=e[r]||{},s=l instanceof f?a=l:l[h.prototype.idAttribute||"id"],d=this.get(s))F&&(y[d.cid]=!0),C&&(l=l===a?a.attributes:l,t.parse&&(l=d.parse(l,t)),d.set(l,t),g&&!c&&d.hasChanged(m)&&(c=!0)),e[r]=d;else if(b){if(a=e[r]=this._prepareModel(l,t),!a)continue;v.push(a),this._addReference(a,t)}a=d||a,!x||!a.isNew()&&y[a.id]||x.push(a),y[a.id]=!0}if(F){for(r=0,o=this.length;o>r;++r)y[(a=this.models[r]).cid]||w.push(a);w.length&&this.remove(w,t)}if(v.length||x&&x.length)if(g&&(c=!0),this.length+=v.length,null!=u)for(r=0,o=v.length;o>r;r++)this.models.splice(u+r,0,v[r]);else{x&&(this.models.length=0);var k=x||v;for(r=0,o=k.length;o>r;r++)this.models.push(k[r])}if(c&&this.sort({silent:!0}),!t.silent){for(r=0,o=v.length;o>r;r++)(a=v[r]).trigger("add",a,this,t);(c||x&&x.length)&&this.trigger("sort",this,t)}return n?e[0]:e},reset:function(e,t){t||(t={});for(var n=0,r=this.models.length;r>n;n++)this._removeReference(this.models[n],t);return t.previousModels=this.models,this._reset(),e=this.add(e,i.extend({silent:!0},t)),t.silent||this.trigger("reset",this,t),e},push:function(e,t){return this.add(e,i.extend({at:this.length},t))},pop:function(e){var t=this.at(this.length-1);return this.remove(t,e),t},unshift:function(e,t){return this.add(e,i.extend({at:0},t))},shift:function(e){var t=this.at(0);return this.remove(t,e),t},slice:function(){return s.apply(this.models,arguments)},get:function(e){return null==e?void 0:this._byId[e]||this._byId[e.id]||this._byId[e.cid]},at:function(e){return this.models[e]},where:function(e,t){return i.isEmpty(e)?t?void 0:[]:this[t?"find":"filter"](function(t){for(var i in e)if(e[i]!==t.get(i))return!1;return!0})},findWhere:function(e){return this.where(e,!0)},sort:function(e){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return e||(e={}),i.isString(this.comparator)||1===this.comparator.length?this.models=this.sortBy(this.comparator,this):this.models.sort(i.bind(this.comparator,this)),e.silent||this.trigger("sort",this,e),this},pluck:function(e){return i.invoke(this.models,"get",e)},fetch:function(e){e=e?i.clone(e):{},void 0===e.parse&&(e.parse=!0);var t=e.success,n=this;return e.success=function(i){var r=e.reset?"reset":"set";n[r](i,e),t&&t(n,i,e),n.trigger("sync",n,i,e)},D(this,e),this.sync("read",this,e)},create:function(e,t){if(t=t?i.clone(t):{},!(e=this._prepareModel(e,t)))return!1;t.wait||this.add(e,t);var n=this,r=t.success;return t.success=function(e,i){t.wait&&n.add(e,t),r&&r(e,i,t)},e.save(null,t),e},parse:function(e,t){return e},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(e,t){if(e instanceof f)return e;t=t?i.clone(t):{},t.collection=this;var n=new this.model(e,t);return n.validationError?(this.trigger("invalid",this,n.validationError,t),!1):n},_addReference:function(e,t){this._byId[e.cid]=e,null!=e.id&&(this._byId[e.id]=e),e.collection||(e.collection=this),e.on("all",this._onModelEvent,this)},_removeReference:function(e,t){this===e.collection&&delete e.collection,e.off("all",this._onModelEvent,this)},_onModelEvent:function(e,t,i,n){("add"!==e&&"remove"!==e||i===this)&&("destroy"===e&&this.remove(t,n),t&&e==="change:"+t.idAttribute&&(delete this._byId[t.previous(t.idAttribute)],null!=t.id&&(this._byId[t.id]=t)),this.trigger.apply(this,arguments))}});var v=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","difference","indexOf","shuffle","lastIndexOf","isEmpty","chain","sample"];i.each(v,function(e){g.prototype[e]=function(){var t=s.call(arguments);return t.unshift(this.models),i[e].apply(i,t)}});var w=["groupBy","countBy","sortBy","indexBy"];i.each(w,function(e){g.prototype[e]=function(t,n){var r=i.isFunction(t)?t:function(e){return e.get(t)};return i[e](this.models,r,n)}});var y=t.View=function(e){this.cid=i.uniqueId("view"),e||(e={}),i.extend(this,i.pick(e,C)),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},b=/^(\S+)\s*(.*)$/,C=["model","collection","el","id","attributes","className","tagName","events"];i.extend(y.prototype,a,{tagName:"div",$:function(e){return this.$el.find(e)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this.stopListening(),this},setElement:function(e,i){return this.$el&&this.undelegateEvents(),this.$el=e instanceof t.$?e:t.$(e),this.el=this.$el[0],i!==!1&&this.delegateEvents(),this},delegateEvents:function(e){if(!e&&!(e=i.result(this,"events")))return this;this.undelegateEvents();for(var t in e){var n=e[t];if(i.isFunction(n)||(n=this[e[t]]),n){var r=t.match(b),o=r[1],s=r[2];n=i.bind(n,this),o+=".delegateEvents"+this.cid,""===s?this.$el.on(o,n):this.$el.on(o,s,n)}}return this},undelegateEvents:function(){return this.$el.off(".delegateEvents"+this.cid),this},_ensureElement:function(){if(this.el)this.setElement(i.result(this,"el"),!1);else{var e=i.extend({},i.result(this,"attributes"));this.id&&(e.id=i.result(this,"id")),this.className&&(e.class=i.result(this,"className"));var n=t.$("<"+i.result(this,"tagName")+">").attr(e);this.setElement(n,!1)}}}),t.sync=function(e,n,r){var o=x[e];i.defaults(r||(r={}),{emulateHTTP:t.emulateHTTP,emulateJSON:t.emulateJSON});var s={type:o,dataType:"json"};if(r.url||(s.url=i.result(n,"url")||z()),null!=r.data||!n||"create"!==e&&"update"!==e&&"patch"!==e||(s.contentType="application/json",s.data=JSON.stringify(r.attrs||n.toJSON(r))),r.emulateJSON&&(s.contentType="application/x-www-form-urlencoded",s.data=s.data?{model:s.data}:{}),r.emulateHTTP&&("PUT"===o||"DELETE"===o||"PATCH"===o)){s.type="POST",r.emulateJSON&&(s.data._method=o);var a=r.beforeSend;r.beforeSend=function(e){return e.setRequestHeader("X-HTTP-Method-Override",o),a?a.apply(this,arguments):void 0}}"GET"===s.type||r.emulateJSON||(s.processData=!1),"PATCH"===s.type&&F&&(s.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")});var l=r.xhr=t.ajax(i.extend(s,r));return n.trigger("request",n,l,r),l};var F=!("undefined"==typeof window||!window.ActiveXObject||window.XMLHttpRequest&&(new XMLHttpRequest).dispatchEvent),x={create:"POST",update:"PUT",patch:"PATCH",delete:"DELETE",read:"GET"};t.ajax=function(){return t.$.ajax.apply(t.$,arguments)};var k=t.Router=function(e){e||(e={}),e.routes&&(this.routes=e.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},M=/\((.*?)\)/g,E=/(\(\?)?:\w+/g,K=/\*\w+/g,S=/[\-{}\[\]+?.,\\\^$|#\s]/g;i.extend(k.prototype,a,{initialize:function(){},route:function(e,n,r){i.isRegExp(e)||(e=this._routeToRegExp(e)),i.isFunction(n)&&(r=n,n=""),r||(r=this[n]);var o=this;return t.history.route(e,function(i){var s=o._extractParameters(e,i);o.execute(r,s),o.trigger.apply(o,["route:"+n].concat(s)),o.trigger("route",n,s),t.history.trigger("route",o,n,s)}),this},execute:function(e,t){e&&e.apply(this,t)},navigate:function(e,i){return t.history.navigate(e,i),this},_bindRoutes:function(){if(this.routes){this.routes=i.result(this,"routes");for(var e,t=i.keys(this.routes);null!=(e=t.pop());)this.route(e,this.routes[e])}},_routeToRegExp:function(e){return e=e.replace(S,"\\$&").replace(M,"(?:$1)?").replace(E,function(e,t){return t?e:"([^/?]+)"}).replace(K,"([^?]*?)"),new RegExp("^"+e+"(?:?([sS]*))?$")},_extractParameters:function(e,t){var n=e.exec(t).slice(1);return i.map(n,function(e,t){return t===n.length-1?e||null:e?decodeURIComponent(e):null})}});var V=t.History=function(){this.handlers=[],i.bindAll(this,"checkUrl"),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},I=/^[#\/]|\s+$/g,T=/^\/+|\/+$/g,_=/msie [\w.]+/,q=/\/$/,R=/#.*$/;V.started=!1,i.extend(V.prototype,a,{interval:50,atRoot:function(){return this.location.pathname.replace(/[^\/]$/,"$&//")===this.root},getHash:function(e){var t=(e||this).location.href.match(/#(.*)$/);return t?t[1]:""},getFragment:function(e,t){if(null==e)if(this._hasPushState||!this._wantsHashChange||t){e=decodeURI(this.location.pathname+this.location.search);var i=this.root.replace(q,"");e.indexOf(i)||(e=e.slice(i.length))}else e=this.getHash();return e.replace(I,"")},start:function(e){if(V.started)throw new Error("Backbone.history has already been started");V.started=!0,this.options=i.extend({root:"/"},this.options,e),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var n=this.getFragment(),r=document.documentMode,o=_.exec(navigator.userAgent.toLowerCase())&&(!r||7>=r);if(this.root=("/"+this.root+"/").replace(T,"/"),o&&this._wantsHashChange){var s=t.$('<iframe src="javascript:0" tabindex="-1">');this.iframe=s.hide().appendTo("body")[0].contentWindow,this.navigate(n)}this._hasPushState?t.$(window).on("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!o?t.$(window).on("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=n;var a=this.location;if(this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot())return this.fragment=this.getFragment(null,!0),this.location.replace(this.root+"#"+this.fragment),!0;this._hasPushState&&this.atRoot()&&a.hash&&(this.fragment=this.getHash().replace(I,""),this.history.replaceState({},document.title,this.root+this.fragment))}return this.options.silent?void 0:this.loadUrl()},stop:function(){t.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl),this._checkUrlInterval&&clearInterval(this._checkUrlInterval),V.started=!1},route:function(e,t){this.handlers.unshift({route:e,callback:t})},checkUrl:function(e){var t=this.getFragment();return t===this.fragment&&this.iframe&&(t=this.getFragment(this.getHash(this.iframe))),t!==this.fragment&&(this.iframe&&this.navigate(t),void this.loadUrl())},loadUrl:function(e){return e=this.fragment=this.getFragment(e),i.any(this.handlers,function(t){return t.route.test(e)?(t.callback(e),!0):void 0})},navigate:function(e,t){if(!V.started)return!1;t&&t!==!0||(t={trigger:!!t});var i=this.root+(e=this.getFragment(e||""));if(e=e.replace(R,""),this.fragment!==e){if(this.fragment=e,""===e&&"/"!==i&&(i=i.slice(0,-1)),this._hasPushState)this.history[t.replace?"replaceState":"pushState"]({},document.title,i);else{if(!this._wantsHashChange)return this.location.assign(i);this._updateHash(this.location,e,t.replace),this.iframe&&e!==this.getFragment(this.getHash(this.iframe))&&(t.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,e,t.replace))}return t.trigger?this.loadUrl(e):void 0}},_updateHash:function(e,t,i){if(i){var n=e.href.replace(/(javascript:|#).*$/,"");e.replace(n+"#"+t)}else e.hash="#"+t}}),t.history=new V;var P=function(e,t){var n,r=this;n=e&&i.has(e,"constructor")?e.constructor:function(){return r.apply(this,arguments)},i.extend(n,r,t);var o=function(){this.constructor=n};return o.prototype=r.prototype,n.prototype=new o,e&&i.extend(n.prototype,e),n.__super__=r.prototype,n};f.extend=g.extend=k.extend=y.extend=V.extend=P;var z=function(){throw new Error('A "url" property or function must be specified')},D=function(e,t){var i=t.error;t.error=function(n){i&&i(e,n,t),e.trigger("error",e,n,t)}};return t}),CKFinder.define("CKFinder/Config",[],function(){"use strict";var e={id:"",configPath:"config.js",language:"",languages:{bg:1,ca:1,cs:1,cy:1,da:1,de:1,el:1,en:1,eo:1,es:1,"es-mx":1,et:1,eu:1,fa:1,fi:1,fr:1,gu:1,he:1,hi:1,hr:1,hu:1,it:1,ja:1,ko:1,ku:1,lt:1,lv:1,nb:1,nl:1,no:1,nn:1,pl:1,"pt-br":1,ro:1,ru:1,sk:1,sl:1,sr:1,sv:1,tr:1,vi:1,"zh-cn":1,"zh-tw":1},defaultLanguage:"en",removeModules:"",plugins:"",tabIndex:0,resourceType:null,type:null,startupPath:"",startupFolderExpanded:!0,readOnly:!1,readOnlyExclude:"",connectorPath:"",connectorLanguage:"php",pass:"",connectorInfo:"",dialogMinWidth:"18em",dialogMinHeight:"4em",dialogFocusItem:!0,dialogOverlaySwatch:!1,loaderOverlaySwatch:!1,width:"100%",height:400,fileIcons:{default:"unknown.png",folder:"directory.png","7z":"7z.png",accdb:"access.png",avi:"video.png",bmp:"image.png",css:"css.png",csv:"csv.png",doc:"msword.png",docx:"msword.png",flac:"audio.png",gif:"image.png",gz:"tar.png",htm:"html.png",html:"html.png",jpeg:"image.png",jpg:"image.png",js:"javascript.png",log:"log.png",mp3:"audio.png",mp4:"video.png",odg:"draw.png",odp:"impress.png",ods:"calc.png",odt:"writer.png",ogg:"audio.png",opus:"audio.png",pdf:"pdf.png",php:"php.png",png:"image.png",ppt:"powerpoint.png",pptx:"powerpoint.png",rar:"rar.png",README:"readme.png",rtf:"rtf.png",sql:"sql.png",tar:"tar.png",tiff:"image.png",txt:"plain.png",wav:"audio.png",weba:"audio.png",webm:"video.png",xls:"excel.png",xlsx:"excel.png",zip:"zip.png"},fileIconsPath:"skins/core/file-icons/",fileIconsSizes:"256,128,64,48,32,22,16",defaultDisplayFileName:!0,defaultDisplayDate:!0,defaultDisplayFileSize:!0,defaultViewType:"thumbnails",defaultSortBy:"name",defaultSortByOrder:"asc",listViewIconSize:32,thumbnailDelay:50,thumbnailDefaultSize:150,thumbnailMinSize:null,thumbnailMaxSize:null,thumbnailSizeStep:2,thumbnailClasses:{120:"small",180:"medium"},chooseFiles:!1,chooseFilesOnDblClick:!0,chooseFilesClosePopup:!0,resizeImages:!0,rememberLastFolder:!0,skin:"moono",swatch:"a",displayFoldersPanel:!0,jquery:"libs/jquery.js",jqueryMobile:"libs/jquery.mobile.js",jqueryMobileStructureCSS:"libs/jquery.mobile.structure.css",jqueryMobileIconsCSS:"",iconsCSS:"",themeCSS:"",coreCSS:"skins/core/ckfinder.css",primaryPanelWidth:"",secondaryPanelWidth:"",cors:!1,corsSelect:!1,editImageMode:"",editImageAdjustments:["brightness","contrast","exposure","saturation","sepia","sharpen"],editImagePresets:["clarity","herMajesty","nostalgia","pinhole","sunrise","vintage"],autoCloseHTML5Upload:5,uiModeThreshold:48};return e}),CKFinder.define("CKFinder/Event",[],function(){"use strict";function e(){}function t(e){var t=e.getPrivate&&e.getPrivate()||e._ev||(e._ev={});return t.events||(t.events={})}function i(e){this.name=e,this.listeners=[]}function n(e){var n=t(this);return n[e]||(n[e]=new i(e))}return i.prototype={getListenerIndex:function(e){for(var t=0,i=this.listeners;t<i.length;t++)if(i[t].fn===e)return t;return-1}},e.prototype={on:function(e,t,i,r,o){function s(n,o,s,l){var d={name:e,sender:this,finder:n,data:o,listenerData:r,stop:s,cancel:l,removeListener:a},c=t.call(i,d);return c!==!1&&d.data}function a(){u.removeListener(e,t)}var l,d,c=n.call(this,e),u=this;if(c.getListenerIndex(t)<0){for(l=c.listeners,i||(i=this),isNaN(o)&&(o=10),s.fn=t,s.priority=o,d=l.length-1;d>=0;d--)if(l[d].priority<=o)return l.splice(d+1,0,s),{removeListener:a};l.unshift(s)}return{removeListener:a}},once:function(){var e=arguments[1];return arguments[1]=function(t){return t.removeListener(),e.apply(this,arguments)},this.on.apply(this,arguments)},fire:function(){var e=0,i=function(){e=1},n=0,r=function(){n=1};return function(o,s,a){var l,d,c,u,f=t(this)[o],h=e,g=n;if(e=0,n=0,f&&(c=f.listeners,c.length))for(c=c.slice(0),l=0;l<c.length;l++){if(f.errorProof)try{u=c[l].call(this,a,s,i,r)}catch(e){}else u=c[l].call(this,a,s,i,r);if(u===!1?n=1:"undefined"!=typeof u&&(s=u),e||n)break}return d=!n&&("undefined"==typeof s||s),e=h,n=g,d}}(),fireOnce:function(e,i,n){var r=this.fire(e,i,n);return delete t(this)[e],r},removeListener:function(e,i){var n,r=t(this)[e];r&&(n=r.getListenerIndex(i),n>=0&&r.listeners.splice(n,1))},removeAllListeners:function(){var e,i=t(this);for(e in i)delete i[e]},hasListeners:function(e){var i=t(this)[e];return i&&i.listeners.length>0}},e}),CKFinder.define("CKFinder/Util/Util",["underscore"],function(e){"use strict";var t={url:function(e){return/^(http(s)?:)?\/\/.+/i.test(e)?e:CKFinder.require.toUrl(e)},asyncArrayTraverse:function(e,t,i){var n,r=50,o=10,s=0;i||(i=null),t=t.bind(i),(n=function(){for(var i,a=0,l=(new Date).getTime();;){if(i=e.item?e.item(s):e[s],!i||t(i,s,e)===!1)return;if(s+=1,a+=1,a>=o&&(new Date).getTime()-l>r)return setTimeout(n,r)}}).call()},isPopup:function(){return window!==window.parent&&!!window.opener||window.isCKFinderPopup},isModal:function(){return window.parent.CKFinder&&window.parent.CKFinder.modal&&window.parent.CKFinder.modal("visible")},isWidget:function(){return window!==window.parent&&!window.opener},toGet:function(t){var i="";return e.forOwn(t,function(e,n){i+="&"+encodeURIComponent(n)+"="+encodeURIComponent(t[n])}),i.substring(1)},cssEntities:function(e){return e.replace(/\(/g,"&#92;&#40;").replace(/\)/g,"&#92;&#41;")},jsCssEntities:function(e){return e.replace(/\(/g,"%28").replace(/\)/g,"%29")},getUrlParams:function(){var e={};return window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(t,i,n){e[i]=n}),e},parentFolder:function(e){return e.split("/").slice(0,-1).join("/")},isShortcut:function(t,i){var n=i.split("+"),r=!!t.ctrlKey||!!t.metaKey,o=!!t.altKey,s=!!t.shiftKey,a=r===!!e.contains(n,"ctrl"),l=o===!!e.contains(n,"alt"),d=s===!!e.contains(n,"shift");return a&&l&&d},randomString:function(e,t){t||(t="abcdefghijklmnopqrstuvwxyz0123456789");for(var i="",n=0;e>n;n++)i+=t.charAt(Math.floor(Math.random()*t.length));return i},escapeHtml:function(e){var t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return e.replace(/[&<>"']/g,function(e){return t[e]})}};return t}),CKFinder.define("CKFinder/Util/Lang",["underscore","jquery","ckf_global"],function(e,t,i){"use strict";function n(e,t,n,o){function s(t){o(e,JSON.parse(t))}function a(){o(e)}e||(e=r.getSupportedLanguage(navigator.userLanguage||navigator.language,n)),n[t]||(t="en");var l,d="lang/"+t+".json";n[e]&&(l="lang/"+e+".json"),l||(l=d),i.require(["text!"+i.require.toUrl(l)+"?ver=js6uhv"],s,a)}var r={loadPluginLang:function(t,n,r,o){var s,a=r.lang.split(",");if(e.indexOf(a,t)>=0)s=t;else{if(!(e.indexOf(a,n)>=0))return void o({});s=n}i.require(["text!"+i.require.toUrl(r.path)+"lang/"+s+".json"],function(e){var t;try{t=JSON.parse(e)}catch(e){t={}}o(t)},function(){o({})})},init:function(i){var r=new t.Deferred;return n(i.language,i.defaultLanguage,i.languages,function(t,i){if(!i)return void r.reject();var n=i;n.formatDate=function(){var e="['"+n.DateAmPm.join("','")+"']",t=n.DateTime.replace(/dd|mm|yyyy|hh|HH|MM|aa|d|m|yy|h|H|M|a/g,function(t){var i={d:"day.replace(/^0/,'')",dd:"day",m:"month.replace(/^0/,'')",mm:"month",yy:"year.substr(2)",yyyy:"year",H:"hour.replace(/^0/,'')",HH:"hour",h:"( hour < 12 ? hour : ( ( hour - 12 ) + 100 ).toString().substr( 1 ) ).replace(/^0/,'')",hh:"( hour < 12 ? hour : ( ( hour - 12 ) + 100 ).toString().substr( 1 ) )",M:"minute.replace(/^0/,'')",MM:"minute",a:e+"[ hour < 12 ? 0 : 1 ].charAt(0)",aa:e+"[ hour < 12 ? 0 : 1 ]"};return"',"+i[t]+",'"});return t="'"+t+"'",t=t.replace(/('',)|,''$/g,""),new Function("year","month","day","hour","minute","return ["+t+'].join("");')}(),n.formatDateString=function(t){return t=t||"",e.isNumber(t)&&(t=t.toString()),t.length<12?"":n.formatDate(t.substr(0,4),t.substr(4,2),t.substr(6,2),t.substr(8,2),t.substr(10,2))},n.formatFileSize=function(e){var t=1024,i=t*t,r=i*t;return e>=r?n.Gb.replace("%1",(e/r).toFixed(1)):e>=i?n.Mb.replace("%1",(e/i).toFixed(1)):e>=t?n.Kb.replace("%1",(e/t).toFixed(1)):"%1 B".replace("%1",e)},n.formatTransfer=function(e){return n.SizePerSecond.replace("%1",n.formatFileSize(parseInt(e)))},n.formatFilesCount=function(e){return n[1===e?"FilesCountOne":"FilesCountMany"].replace("%1",e)},r.resolve(n)}),r.promise()},getSupportedLanguage:function(e,t){if(!e)return!1;var i=e.toLowerCase().match(/([a-z]+)(?:-([a-z]+))?/),n=i[1],r=i[2];return t[n+"-"+r]?n=n+"-"+r:t[n]||(n=!1),n}};return r}),CKFinder.define("CKFinder/Util/KeyCode",{up:38,down:40,left:37,right:39,backspace:8,tab:9,enter:13,space:32,escape:27,end:35,home:36,delete:46,menu:93,slash:191,a:65,r:82,u:85,f2:113,f5:116,f7:118,f8:119,f9:120,f10:121}),CKFinder.define("CKFinder/UI/UIHacks",["underscore","jquery","CKFinder/Util/KeyCode"],function(e,t,i){"use strict";function n(){var i=["transition"];e.forEach(i,function(e){o(e)&&t("body").addClass("ckf-feature-css-"+e)})}function r(e){var i=void 0===document.documentMode,n=window.chrome;i&&!n?t(window).on("focusin",function(t){t.target===window&&setTimeout(function(){e.fire("ui:focus",null,e)},a)}).on("focusout",function(t){t.target===window&&e.fire("ui:blur",null,e)}):window.addEventListener?(window.addEventListener("focus",function(){setTimeout(function(){e.fire("ui:focus",null,e)},a)},!1),window.addEventListener("blur",function(){e.fire("ui:blur",null,e)},!1)):(window.attachEvent("focus",function(){setTimeout(function(){e.fire("ui:focus",null,e)},a)}),window.attachEvent("blur",function(){e.fire("ui:blur",null,e)}))}function o(e){var t=document.body||document.documentElement,i=t.style;if("string"==typeof i[e])return!0;var n=["Moz","webkit","Webkit","Khtml","O","ms"];e=e.charAt(0).toUpperCase()+e.substr(1);for(var r=0;r<n.length;r++)if("string"==typeof i[n[r]+e])return!0;return!1}function s(e,t,i){t&&e.removeClass("ckf-ui-mode-"+t),e.addClass("ckf-ui-mode-"+i)}var a=300;return{init:function(e){n(),r(e);var o=t("body");o.attr({"data-theme":e.config.swatch,role:"application"}),navigator.userAgent.toLowerCase().indexOf("trident/")>-1&&o.addClass("ckf-ie"),t("html").attr({dir:e.lang.dir,lang:e.lang.LangCode}),"ltr"!==e.lang.dir&&o.addClass("ckf-rtl"),e.setHandler("ui:getMode",function(){var i,n,r=window.matchMedia?function(){return void 0===n&&(n="(max-width: "+e.config.uiModeThreshold+"em)"),window.matchMedia(n).matches}:function(){return void 0===i&&(i=parseFloat(t("body").css("font-size"))*e.config.uiModeThreshold),window.innerWidth<=i};return function(){return r.call(this)?"mobile":"desktop"}}());var a=e.request("ui:getMode");s(o,null,a),t(window).bind("throttledresize",function(){var t=e.request("ui:getMode"),i=a!==t;i&&(s(o,a,t),a=t),e.fire("ui:resize",{modeChanged:i,mode:a},e)});var l=t.event.special.swipe.start;t.event.special.swipe.start=function(e){var t=l(e);return t.ckfOrigin=e.originalEvent.type,t},t(window).bind("swipeleft",function(t){0!==t.swipestart.ckfOrigin.indexOf("mouse")&&e.fire("ui:swipeleft",{evt:t},e)}),t(window).bind("swiperight",function(t){0!==t.swipestart.ckfOrigin.indexOf("mouse")&&e.fire("ui:swiperight",{evt:t},e)}),e.setHandler("closePopup",function(){e.util.isPopup()?window.close():window.top&&window.top.CKFinder&&window.top.CKFinder.modal&&window.top.CKFinder.modal("close")}),t(document).on("selectstart","[draggable]",function(e){e.preventDefault(),e.dragDrop&&e.dragDrop()}),e.once("app:ready",function(e){e.finder.request("key:listen",{key:i.space}),e.finder.on("keydown:"+i.space,function(e){e.data.evt.preventDefault()})})}}}),CKFinder.define("CKFinder/Plugins/Plugin",["underscore","jquery","backbone"],function(e,t,i){"use strict";function n(){}return n.extend=i.Model.extend,e.extend(n.prototype,{addCss:function(e){t("<style>").text(e).appendTo("head")},init:function(){}}),n}),CKFinder.define("CKFinder/Plugins/Plugins",["underscore","jquery","backbone","CKFinder/Plugins/Plugin","CKFinder/Util/Lang"],function(e,t,i,n,r){"use strict";function o(e,t,i){function n(){t.init(e),e._plugins.add(t),i.loaded=!0,e.fire("plugin:ready",{plugin:t},e)}return t.path=e.util.parentFolder(i.url)+"/",t.lang?void r.loadPluginLang(e.lang.LangCode,e.config.defaultLanguage,t,function(t){t.name&&t.values&&(e.lang[t.name]=t.values),n()}):void n()}var s=i.Collection.extend({load:function(t){function i(){var i=e.countBy(r,"loaded");i.undefined||(t.fire("plugin:allReady",null,t),i.false&&e.forEach(e.where(r,{loaded:!1}),function(e){t.fire("plugin:loadError",{configKey:e.config,url:e.url})}))}var r=[],s=t.config.plugins;return s.length<1?void t.fire("plugin:allReady",null,t):(e.isString(s)&&(s=s.split(",")),e.forEach(s,function(e){var t=e;-1===e.search("/")&&(t=CKFinder.require.toUrl("plugins/"+e+"/"+e+".js")),r.push({config:e,url:t,loaded:void 0})}),t.on("plugin:ready",function(){i()}),void e.forEach(r,function(e){CKFinder.require([e.url],function(i){var r=n.extend(i);o(t,new r,e)},function(){e.loaded=!1,i()})}))}});return s}),CKFinder.define("CKFinder/Modules/CsrfTokenManager/CsrfTokenManager",[],function(){"use strict";function e(e){e.setHandler("csrf:getToken",t)}function t(){var e=i(o);return e.length!=s&&(e=r(s),n(o,e)),e}function i(e){e=e.toLowerCase();for(var t=document.cookie.split(";"),i=0;i<t.length;i++){var n=t[i].split("="),r=decodeURIComponent(n[0].trim().toLowerCase()),o=n.length>1?n[1]:"";if(r===e)return decodeURIComponent(o)}return""}function n(e,t){document.cookie=encodeURIComponent(e)+"="+encodeURIComponent(t)+";path=/"}function r(e){var t="abcdefghijklmnopqrstuvwxyz0123456789",i=[],n="";if(window.crypto&&window.crypto.getRandomValues)i=new Uint8Array(e),window.crypto.getRandomValues(i);else for(var r=0;e>r;r++)i.push(Math.floor(256*Math.random()));for(var o=0;o<i.length;o++){var s=t.charAt(i[o]%t.length);n+=Math.random()>.5?s.toUpperCase():s}return n}var o="ckCsrfToken",s=40;return e}),CKFinder.define("CKFinder/Modules/Connector/Transport",["jquery","underscore"],function(e,t){"use strict";function i(e,t){this.url=e,this.config=t,this.onDone=o,this.onFail=o,this.request=null}function n(t){var i,n;i=new XDomainRequest,n=null,"post"===t.config.type&&(n=e.param(t.config.post)),i.open(t.config.type,t.url),i.onload=function(){t.onDone(this.responseText)},i.onprogress=o,i.ontimeout=o,i.onerror=function(){t.onFail()},t.request=i,setTimeout(function(){i.send(n)},0)}function r(i){var n,r;n=new XMLHttpRequest,r=null,n.open(i.config.type,i.url,!0),n.onreadystatechange=function(){4===this.readyState&&i.onDone(this.responseText)},n.onerror=function(){i.onFail()},t.isFunction(i.config.uploadProgress)&&n.upload&&(n.upload.onprogress=i.config.uploadProgress),t.isFunction(i.config.uploadEnd)&&n.upload&&(n.upload.onload=i.config.uploadEnd),"post"===i.config.type&&(r=e.param(t.extend(i.config.post)),n.setRequestHeader("Content-Type","application/x-www-form-urlencoded")),
n.send(r),i.request=n}var o=function(){};return i.prototype.done=function(e){this.onDone=e},i.prototype.fail=function(e){this.onFail=e},i.prototype.send=function(){window.XMLHttpRequest?r(this):n(this)},i.prototype.abort=function(){this.request&&this.request.abort()},i}),CKFinder.define("CKFinder/Modules/Connector/Connector",["underscore","jquery","ckf_global","CKFinder/Modules/Connector/Transport"],function(e,t,i,n){"use strict";function r(e){function t(e){if(/^(http(s)?:)?\/\/.+/i.test(e))return e;0!==e.indexOf("/")&&(e="/"+e);var t=window.parent?window.parent.location:window.location,i=t.protocol+"//"+t.host;return i+e}var n=e.config,r=n.connectorLanguage;this.finder=e,this.config=n,n.connectorPath?this.baseUrl=t(n.connectorPath):this.baseUrl=i.require.toUrl("./core/connector/"+r+"/connector."+r),e.setHandlers({"command:send":{callback:s,context:this},"command:url":{callback:function(e){return o.call(this,e.command,e.params,e.folder)},context:this}})}function o(t,i,n){var r=this.finder,o=r.config,s={command:t,lang:r.lang.LangCode},a=o.connectorInfo;if(n&&(s.type=n.get("resourceType"),s.currentFolder=n.getPath(),s.hash=n.getHash()),o.pass.length){var l=o.pass.split(",");e.forEach(l,function(e){s[e]=r.config[e]})}o.id&&(s.id=o.id);var d=this.baseUrl+"?"+r.util.toGet(e.extend(s,i));return a.length>0&&(d+="&"+a),d}function s(i){var r=this.finder,s=i.name,l=t.Deferred(),d={name:s,response:{error:{number:109}}};if(e.has(i,"context")&&(d.context=i.context),r.fire("command:before",i,r)&&r.fire("command:before:"+s,i,r)){var c=e.extend({type:"get",post:{}},i),u={};u.type=c.type,"post"===c.type&&(c.post.ckCsrfToken=r.request("csrf:getToken"),u.post=c.sendPostAsJson?{jsonData:JSON.stringify(c.post)}:c.post),c.uploadProgress&&(u.uploadProgress=c.uploadProgress),c.uploadEnd&&(u.uploadEnd=c.uploadEnd);var f=o.call(this,s,i.params,i.folder),h=new n(f,u);return h.done(function(t){var n,o,c=!1;try{o=JSON.parse(t),n={name:s,response:o,rawResponse:t},c=!0}catch(e){var u=d;return u.response.error.message=t,a(s,u,r),void l.reject(u)}c&&l.resolve(o),e.has(i,"context")&&(n.context=i.context),!o||o.error?r.fire("command:error:"+s,n,r)&&(i.context&&i.context.silentConnectorErrors||r.fire("command:error",n,r)):r.fire("command:ok:"+s,n,r),r.fire("command:after",n,r),r.fire("command:after:"+s,n,r)}),h.fail(function(){a(s,d,r),l.reject(d)}),h.send(),i.returnTransport?h:l.promise()}}function a(e,t,i){i.fire("command:error:"+e,t,i)&&i.fire("command:error",t,i),i.fire("command:after",t,i),i.fire("command:after:"+e,t,i)}return r}),function(e,t){if("function"==typeof CKFinder.define&&CKFinder.define.amd)CKFinder.define("marionette",["backbone","underscore"],function(i,n){return e.Marionette=e.Mn=t(e,i,n)});else if("undefined"!=typeof exports){var i=require("backbone"),n=require("underscore");module.exports=t(e,i,n)}else e.Marionette=e.Mn=t(e,e.Backbone,e._)}(this,function(e,t,i){"use strict";!function(e,t){var i=e.ChildViewContainer;return e.ChildViewContainer=function(e,t){var i=function(e){this._views={},this._indexByModel={},this._indexByCustom={},this._updateLength(),t.each(e,this.add,this)};t.extend(i.prototype,{add:function(e,t){var i=e.cid;return this._views[i]=e,e.model&&(this._indexByModel[e.model.cid]=i),t&&(this._indexByCustom[t]=i),this._updateLength(),this},findByModel:function(e){return this.findByModelCid(e.cid)},findByModelCid:function(e){var t=this._indexByModel[e];return this.findByCid(t)},findByCustom:function(e){var t=this._indexByCustom[e];return this.findByCid(t)},findByIndex:function(e){return t.values(this._views)[e]},findByCid:function(e){return this._views[e]},remove:function(e){var i=e.cid;return e.model&&delete this._indexByModel[e.model.cid],t.any(this._indexByCustom,function(e,t){return e===i?(delete this._indexByCustom[t],!0):void 0},this),delete this._views[i],this._updateLength(),this},call:function(e){this.apply(e,t.tail(arguments))},apply:function(e,i){t.each(this._views,function(n){t.isFunction(n[e])&&n[e].apply(n,i||[])})},_updateLength:function(){this.length=t.size(this._views)}});var n=["forEach","each","map","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","toArray","first","initial","rest","last","without","isEmpty","pluck","reduce"];return t.each(n,function(e){i.prototype[e]=function(){var i=t.values(this._views),n=[i].concat(t.toArray(arguments));return t[e].apply(t,n)}}),i}(e,t),e.ChildViewContainer.VERSION="0.1.10",e.ChildViewContainer.noConflict=function(){return e.ChildViewContainer=i,this},e.ChildViewContainer}(t,i),function(e,t){var i=e.Wreqr,n=e.Wreqr={};return e.Wreqr.VERSION="1.3.5",e.Wreqr.noConflict=function(){return e.Wreqr=i,this},n.Handlers=function(e,t){var i=function(e){this.options=e,this._wreqrHandlers={},t.isFunction(this.initialize)&&this.initialize(e)};return i.extend=e.Model.extend,t.extend(i.prototype,e.Events,{setHandlers:function(e){t.each(e,function(e,i){var n=null;t.isObject(e)&&!t.isFunction(e)&&(n=e.context,e=e.callback),this.setHandler(i,e,n)},this)},setHandler:function(e,t,i){var n={callback:t,context:i};this._wreqrHandlers[e]=n,this.trigger("handler:add",e,t,i)},hasHandler:function(e){return!!this._wreqrHandlers[e]},getHandler:function(e){var t=this._wreqrHandlers[e];if(t)return function(){return t.callback.apply(t.context,arguments)}},removeHandler:function(e){delete this._wreqrHandlers[e]},removeAllHandlers:function(){this._wreqrHandlers={}}}),i}(e,t),n.CommandStorage=function(){var i=function(e){this.options=e,this._commands={},t.isFunction(this.initialize)&&this.initialize(e)};return t.extend(i.prototype,e.Events,{getCommands:function(e){var t=this._commands[e];return t||(t={command:e,instances:[]},this._commands[e]=t),t},addCommand:function(e,t){var i=this.getCommands(e);i.instances.push(t)},clearCommands:function(e){var t=this.getCommands(e);t.instances=[]}}),i}(),n.Commands=function(e,t){return e.Handlers.extend({storageType:e.CommandStorage,constructor:function(t){this.options=t||{},this._initializeStorage(this.options),this.on("handler:add",this._executeCommands,this),e.Handlers.prototype.constructor.apply(this,arguments)},execute:function(e){e=arguments[0];var i=t.rest(arguments);this.hasHandler(e)?this.getHandler(e).apply(this,i):this.storage.addCommand(e,i)},_executeCommands:function(e,i,n){var r=this.storage.getCommands(e);t.each(r.instances,function(e){i.apply(n,e)}),this.storage.clearCommands(e)},_initializeStorage:function(e){var i,n=e.storageType||this.storageType;i=t.isFunction(n)?new n:n,this.storage=i}})}(n,t),n.RequestResponse=function(e,t){return e.Handlers.extend({request:function(e){return this.hasHandler(e)?this.getHandler(e).apply(this,t.rest(arguments)):void 0}})}(n,t),n.EventAggregator=function(e,t){var i=function(){};return i.extend=e.Model.extend,t.extend(i.prototype,e.Events),i}(e,t),n.Channel=function(i){var n=function(t){this.vent=new e.Wreqr.EventAggregator,this.reqres=new e.Wreqr.RequestResponse,this.commands=new e.Wreqr.Commands,this.channelName=t};return t.extend(n.prototype,{reset:function(){return this.vent.off(),this.vent.stopListening(),this.reqres.removeAllHandlers(),this.commands.removeAllHandlers(),this},connectEvents:function(e,t){return this._connect("vent",e,t),this},connectCommands:function(e,t){return this._connect("commands",e,t),this},connectRequests:function(e,t){return this._connect("reqres",e,t),this},_connect:function(e,i,n){if(i){n=n||this;var r="vent"===e?"on":"setHandler";t.each(i,function(i,o){this[e][r](o,t.bind(i,n))},this)}}}),n}(n),n.radio=function(e,t){var i=function(){this._channels={},this.vent={},this.commands={},this.reqres={},this._proxyMethods()};t.extend(i.prototype,{channel:function(e){if(!e)throw new Error("Channel must receive a name");return this._getChannel(e)},_getChannel:function(t){var i=this._channels[t];return i||(i=new e.Channel(t),this._channels[t]=i),i},_proxyMethods:function(){t.each(["vent","commands","reqres"],function(e){t.each(n[e],function(t){this[e][t]=r(this,e,t)},this)},this)}});var n={vent:["on","off","trigger","once","stopListening","listenTo","listenToOnce"],commands:["execute","setHandler","setHandlers","removeHandler","removeAllHandlers"],reqres:["request","setHandler","setHandlers","removeHandler","removeAllHandlers"]},r=function(e,i,n){return function(r){var o=e._getChannel(r)[i];return o[n].apply(o,t.rest(arguments))}};return new i}(n,t),e.Wreqr}(t,i);var n=e.Marionette,r=e.Mn,o=t.Marionette={};o.VERSION="2.4.4",o.noConflict=function(){return e.Marionette=n,e.Mn=r,this},t.Marionette=o,o.Deferred=t.$.Deferred,o.extend=t.Model.extend,o.isNodeAttached=function(e){return t.$.contains(document.documentElement,e)},o.mergeOptions=function(e,t){e&&i.extend(this,i.pick(e,t))},o.getOption=function(e,t){return e&&t?e.options&&void 0!==e.options[t]?e.options[t]:e[t]:void 0},o.proxyGetOption=function(e){return o.getOption(this,e)},o._getValue=function(e,t,n){return i.isFunction(e)&&(e=n?e.apply(t,n):e.call(t)),e},o.normalizeMethods=function(e){return i.reduce(e,function(e,t,n){return i.isFunction(t)||(t=this[t]),t&&(e[n]=t),e},{},this)},o.normalizeUIString=function(e,t){return e.replace(/@ui\.[a-zA-Z_$0-9]*/g,function(e){return t[e.slice(4)]})},o.normalizeUIKeys=function(e,t){return i.reduce(e,function(e,i,n){var r=o.normalizeUIString(n,t);return e[r]=i,e},{})},o.normalizeUIValues=function(e,t,n){return i.each(e,function(r,s){i.isString(r)?e[s]=o.normalizeUIString(r,t):i.isObject(r)&&i.isArray(n)&&(i.extend(r,o.normalizeUIValues(i.pick(r,n),t)),i.each(n,function(e){var n=r[e];i.isString(n)&&(r[e]=o.normalizeUIString(n,t))}))}),e},o.actAsCollection=function(e,t){var n=["forEach","each","map","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","toArray","first","initial","rest","last","without","isEmpty","pluck"];i.each(n,function(n){e[n]=function(){var e=i.values(i.result(this,t)),r=[e].concat(i.toArray(arguments));return i[n].apply(i,r)}})};var s=o.deprecate=function(e,t){i.isObject(e)&&(e=e.prev+" is going to be removed in the future. Please use "+e.next+" instead."+(e.url?" See: "+e.url:"")),void 0!==t&&t||s._cache[e]||(s._warn("Deprecation warning: "+e),s._cache[e]=!0)};s._warn="undefined"!=typeof console&&(console.warn||console.log)||function(){},s._cache={},o._triggerMethod=function(){function e(e,t,i){return i.toUpperCase()}var t=/(^|:)(\w)/gi;return function(n,r,o){var s=arguments.length<3;s&&(o=r,r=o[0]);var a,l="on"+r.replace(t,e),d=n[l];return i.isFunction(d)&&(a=d.apply(n,s?i.rest(o):o)),i.isFunction(n.trigger)&&(s+o.length>1?n.trigger.apply(n,s?o:[r].concat(i.drop(o,0))):n.trigger(r)),a}}(),o.triggerMethod=function(e){return o._triggerMethod(this,arguments)},o.triggerMethodOn=function(e){var t=i.isFunction(e.triggerMethod)?e.triggerMethod:o.triggerMethod;return t.apply(e,i.rest(arguments))},o.MonitorDOMRefresh=function(e){function t(){e._isShown=!0,n()}function i(){e._isRendered=!0,n()}function n(){e._isShown&&e._isRendered&&o.isNodeAttached(e.el)&&o.triggerMethodOn(e,"dom:refresh",e)}e._isDomRefreshMonitored||(e._isDomRefreshMonitored=!0,e.on({show:t,render:i}))},function(e){function t(t,n,r,o){var s=o.split(/\s+/);i.each(s,function(i){var o=t[i];if(!o)throw new e.Error('Method "'+i+'" was configured as an event handler, but does not exist.');t.listenTo(n,r,o)})}function n(e,t,i,n){e.listenTo(t,i,n)}function r(e,t,n,r){var o=r.split(/\s+/);i.each(o,function(i){var r=e[i];e.stopListening(t,n,r)})}function o(e,t,i,n){e.stopListening(t,i,n)}function s(t,n,r,o,s){if(n&&r){if(!i.isObject(r))throw new e.Error({message:"Bindings must be an object or function.",url:"marionette.functions.html#marionettebindentityevents"});r=e._getValue(r,t),i.each(r,function(e,r){i.isFunction(e)?o(t,n,r,e):s(t,n,r,e)})}}e.bindEntityEvents=function(e,i,r){s(e,i,r,n,t)},e.unbindEntityEvents=function(e,t,i){s(e,t,i,o,r)},e.proxyBindEntityEvents=function(t,i){return e.bindEntityEvents(this,t,i)},e.proxyUnbindEntityEvents=function(t,i){return e.unbindEntityEvents(this,t,i)}}(o);var a=["description","fileName","lineNumber","name","message","number"];return o.Error=o.extend.call(Error,{urlRoot:"http://marionettejs.com/docs/v"+o.VERSION+"/",constructor:function(e,t){i.isObject(e)?(t=e,e=t.message):t||(t={});var n=Error.call(this,e);i.extend(this,i.pick(n,a),i.pick(t,a)),this.captureStackTrace(),t.url&&(this.url=this.urlRoot+t.url)},captureStackTrace:function(){Error.captureStackTrace&&Error.captureStackTrace(this,o.Error)},toString:function(){return this.name+": "+this.message+(this.url?" See: "+this.url:"")}}),o.Error.extend=o.extend,o.Callbacks=function(){this._deferred=o.Deferred(),this._callbacks=[]},i.extend(o.Callbacks.prototype,{add:function(e,t){var n=i.result(this._deferred,"promise");this._callbacks.push({cb:e,ctx:t}),n.then(function(i){t&&(i.context=t),e.call(i.context,i.options)})},run:function(e,t){this._deferred.resolve({options:e,context:t})},reset:function(){var e=this._callbacks;this._deferred=o.Deferred(),this._callbacks=[],i.each(e,function(e){this.add(e.cb,e.ctx)},this)}}),o.Controller=function(e){this.options=e||{},i.isFunction(this.initialize)&&this.initialize(this.options)},o.Controller.extend=o.extend,i.extend(o.Controller.prototype,t.Events,{destroy:function(){return o._triggerMethod(this,"before:destroy",arguments),o._triggerMethod(this,"destroy",arguments),this.stopListening(),this.off(),this},triggerMethod:o.triggerMethod,mergeOptions:o.mergeOptions,getOption:o.proxyGetOption}),o.Object=function(e){this.options=i.extend({},i.result(this,"options"),e),this.initialize.apply(this,arguments)},o.Object.extend=o.extend,i.extend(o.Object.prototype,t.Events,{initialize:function(){},destroy:function(e){return e=e||{},this.triggerMethod("before:destroy",e),this.triggerMethod("destroy",e),this.stopListening(),this},triggerMethod:o.triggerMethod,mergeOptions:o.mergeOptions,getOption:o.proxyGetOption,bindEntityEvents:o.proxyBindEntityEvents,unbindEntityEvents:o.proxyUnbindEntityEvents}),o.Region=o.Object.extend({constructor:function(e){if(this.options=e||{},this.el=this.getOption("el"),this.el=this.el instanceof t.$?this.el[0]:this.el,!this.el)throw new o.Error({name:"NoElError",message:'An "el" must be specified for a region.'});this.$el=this.getEl(this.el),o.Object.call(this,e)},show:function(e,t){if(this._ensureElement()){this._ensureViewIsIntact(e),o.MonitorDOMRefresh(e);var n=t||{},r=e!==this.currentView,s=!!n.preventDestroy,a=!!n.forceShow,l=!!this.currentView,d=r&&!s,c=r||a;if(l&&this.triggerMethod("before:swapOut",this.currentView,this,t),this.currentView&&delete this.currentView._parent,d?this.empty():l&&c&&this.currentView.off("destroy",this.empty,this),c){e.once("destroy",this.empty,this),e._parent=this,this._renderView(e),l&&this.triggerMethod("before:swap",e,this,t),this.triggerMethod("before:show",e,this,t),o.triggerMethodOn(e,"before:show",e,this,t),l&&this.triggerMethod("swapOut",this.currentView,this,t);var u=o.isNodeAttached(this.el),f=[],h=i.extend({triggerBeforeAttach:this.triggerBeforeAttach,triggerAttach:this.triggerAttach},n);return u&&h.triggerBeforeAttach&&(f=this._displayedViews(e),this._triggerAttach(f,"before:")),this.attachHtml(e),this.currentView=e,u&&h.triggerAttach&&(f=this._displayedViews(e),this._triggerAttach(f)),l&&this.triggerMethod("swap",e,this,t),this.triggerMethod("show",e,this,t),o.triggerMethodOn(e,"show",e,this,t),this}return this}},triggerBeforeAttach:!0,triggerAttach:!0,_triggerAttach:function(e,t){var n=(t||"")+"attach";i.each(e,function(e){o.triggerMethodOn(e,n,e,this)},this)},_displayedViews:function(e){return i.union([e],i.result(e,"_getNestedViews")||[])},_renderView:function(e){e.supportsRenderLifecycle||o.triggerMethodOn(e,"before:render",e),e.render(),e.supportsRenderLifecycle||o.triggerMethodOn(e,"render",e)},_ensureElement:function(){if(i.isObject(this.el)||(this.$el=this.getEl(this.el),this.el=this.$el[0]),!this.$el||0===this.$el.length){if(this.getOption("allowMissingEl"))return!1;throw new o.Error('An "el" '+this.$el.selector+" must exist in DOM")}return!0},_ensureViewIsIntact:function(e){if(!e)throw new o.Error({name:"ViewNotValid",message:"The view passed is undefined and therefore invalid. You must pass a view instance to show."});if(e.isDestroyed)throw new o.Error({name:"ViewDestroyedError",message:'View (cid: "'+e.cid+'") has already been destroyed and cannot be used.'})},getEl:function(e){return t.$(e,o._getValue(this.options.parentEl,this))},attachHtml:function(e){this.$el.contents().detach(),this.el.appendChild(e.el)},empty:function(e){var t=this.currentView,i=e||{},n=!!i.preventDestroy;return t?(t.off("destroy",this.empty,this),this.triggerMethod("before:empty",t),n||this._destroyView(),this.triggerMethod("empty",t),delete this.currentView,n&&this.$el.contents().detach(),this):this},_destroyView:function(){var e=this.currentView;e.isDestroyed||(e.supportsDestroyLifecycle||o.triggerMethodOn(e,"before:destroy",e),e.destroy?e.destroy():(e.remove(),e.isDestroyed=!0),e.supportsDestroyLifecycle||o.triggerMethodOn(e,"destroy",e))},attachView:function(e){return this.currentView&&delete this.currentView._parent,e._parent=this,this.currentView=e,this},hasView:function(){return!!this.currentView},reset:function(){return this.empty(),this.$el&&(this.el=this.$el.selector),delete this.$el,this}},{buildRegion:function(e,t){if(i.isString(e))return this._buildRegionFromSelector(e,t);if(e.selector||e.el||e.regionClass)return this._buildRegionFromObject(e,t);if(i.isFunction(e))return this._buildRegionFromRegionClass(e);throw new o.Error({message:"Improper region configuration type.",url:"marionette.region.html#region-configuration-types"})},_buildRegionFromSelector:function(e,t){return new t({el:e})},_buildRegionFromObject:function(e,t){var n=e.regionClass||t,r=i.omit(e,"selector","regionClass");return e.selector&&!r.el&&(r.el=e.selector),new n(r)},_buildRegionFromRegionClass:function(e){return new e}}),o.RegionManager=o.Controller.extend({constructor:function(e){this._regions={},this.length=0,o.Controller.call(this,e),this.addRegions(this.getOption("regions"))},addRegions:function(e,t){return e=o._getValue(e,this,arguments),i.reduce(e,function(e,n,r){return i.isString(n)&&(n={selector:n}),n.selector&&(n=i.defaults({},n,t)),e[r]=this.addRegion(r,n),e},{},this)},addRegion:function(e,t){var i;return i=t instanceof o.Region?t:o.Region.buildRegion(t,o.Region),this.triggerMethod("before:add:region",e,i),i._parent=this,this._store(e,i),this.triggerMethod("add:region",e,i),i},get:function(e){return this._regions[e]},getRegions:function(){return i.clone(this._regions)},removeRegion:function(e){var t=this._regions[e];return this._remove(e,t),t},removeRegions:function(){var e=this.getRegions();return i.each(this._regions,function(e,t){this._remove(t,e)},this),e},emptyRegions:function(){var e=this.getRegions();return i.invoke(e,"empty"),e},destroy:function(){return this.removeRegions(),o.Controller.prototype.destroy.apply(this,arguments)},_store:function(e,t){this._regions[e]||this.length++,this._regions[e]=t},_remove:function(e,t){this.triggerMethod("before:remove:region",e,t),t.empty(),t.stopListening(),delete t._parent,delete this._regions[e],this.length--,this.triggerMethod("remove:region",e,t)}}),o.actAsCollection(o.RegionManager.prototype,"_regions"),o.TemplateCache=function(e){this.templateId=e},i.extend(o.TemplateCache,{templateCaches:{},get:function(e,t){var i=this.templateCaches[e];return i||(i=new o.TemplateCache(e),this.templateCaches[e]=i),i.load(t)},clear:function(){var e,t=i.toArray(arguments),n=t.length;if(n>0)for(e=0;n>e;e++)delete this.templateCaches[t[e]];else this.templateCaches={}}}),i.extend(o.TemplateCache.prototype,{load:function(e){if(this.compiledTemplate)return this.compiledTemplate;var t=this.loadTemplate(this.templateId,e);return this.compiledTemplate=this.compileTemplate(t,e),this.compiledTemplate},loadTemplate:function(e,i){var n=t.$(e);if(!n.length)throw new o.Error({name:"NoTemplateError",message:'Could not find template: "'+e+'"'});return n.html()},compileTemplate:function(e,t){return i.template(e,t)}}),o.Renderer={render:function(e,t){if(!e)throw new o.Error({name:"TemplateNotFoundError",message:"Cannot render the template since its false, null or undefined."});var n=i.isFunction(e)?e:o.TemplateCache.get(e);return n(t)}},o.View=t.View.extend({isDestroyed:!1,supportsRenderLifecycle:!0,supportsDestroyLifecycle:!0,constructor:function(e){this.render=i.bind(this.render,this),e=o._getValue(e,this),this.options=i.extend({},i.result(this,"options"),e),this._behaviors=o.Behaviors(this),t.View.call(this,this.options),o.MonitorDOMRefresh(this)},getTemplate:function(){return this.getOption("template")},serializeModel:function(e){return e.toJSON.apply(e,i.rest(arguments))},mixinTemplateHelpers:function(e){e=e||{};var t=this.getOption("templateHelpers");return t=o._getValue(t,this),i.extend(e,t)},normalizeUIKeys:function(e){var t=i.result(this,"_uiBindings");return o.normalizeUIKeys(e,t||i.result(this,"ui"))},normalizeUIValues:function(e,t){var n=i.result(this,"ui"),r=i.result(this,"_uiBindings");return o.normalizeUIValues(e,r||n,t)},configureTriggers:function(){if(this.triggers){var e=this.normalizeUIKeys(i.result(this,"triggers"));return i.reduce(e,function(e,t,i){return e[i]=this._buildViewTrigger(t),e},{},this)}},delegateEvents:function(e){return this._delegateDOMEvents(e),this.bindEntityEvents(this.model,this.getOption("modelEvents")),this.bindEntityEvents(this.collection,this.getOption("collectionEvents")),i.each(this._behaviors,function(e){e.bindEntityEvents(this.model,e.getOption("modelEvents")),e.bindEntityEvents(this.collection,e.getOption("collectionEvents"))},this),this},_delegateDOMEvents:function(e){var n=o._getValue(e||this.events,this);n=this.normalizeUIKeys(n),i.isUndefined(e)&&(this.events=n);var r={},s=i.result(this,"behaviorEvents")||{},a=this.configureTriggers(),l=i.result(this,"behaviorTriggers")||{};i.extend(r,s,n,a,l),t.View.prototype.delegateEvents.call(this,r)},undelegateEvents:function(){return t.View.prototype.undelegateEvents.apply(this,arguments),this.unbindEntityEvents(this.model,this.getOption("modelEvents")),this.unbindEntityEvents(this.collection,this.getOption("collectionEvents")),i.each(this._behaviors,function(e){e.unbindEntityEvents(this.model,e.getOption("modelEvents")),e.unbindEntityEvents(this.collection,e.getOption("collectionEvents"))},this),this},_ensureViewIsIntact:function(){if(this.isDestroyed)throw new o.Error({name:"ViewDestroyedError",message:'View (cid: "'+this.cid+'") has already been destroyed and cannot be used.'})},destroy:function(){if(this.isDestroyed)return this;var e=i.toArray(arguments);return this.triggerMethod.apply(this,["before:destroy"].concat(e)),this.isDestroyed=!0,this.triggerMethod.apply(this,["destroy"].concat(e)),this.unbindUIElements(),this.isRendered=!1,this.remove(),i.invoke(this._behaviors,"destroy",e),this},bindUIElements:function(){this._bindUIElements(),i.invoke(this._behaviors,this._bindUIElements)},_bindUIElements:function(){if(this.ui){this._uiBindings||(this._uiBindings=this.ui);var e=i.result(this,"_uiBindings");this.ui={},i.each(e,function(e,t){this.ui[t]=this.$(e)},this)}},unbindUIElements:function(){this._unbindUIElements(),i.invoke(this._behaviors,this._unbindUIElements)},_unbindUIElements:function(){this.ui&&this._uiBindings&&(i.each(this.ui,function(e,t){delete this.ui[t]},this),this.ui=this._uiBindings,delete this._uiBindings)},_buildViewTrigger:function(e){var t=i.defaults({},e,{preventDefault:!0,stopPropagation:!0}),n=i.isObject(e)?t.event:e;return function(e){e&&(e.preventDefault&&t.preventDefault&&e.preventDefault(),e.stopPropagation&&t.stopPropagation&&e.stopPropagation());var i={view:this,model:this.model,collection:this.collection};this.triggerMethod(n,i)}},setElement:function(){var e=t.View.prototype.setElement.apply(this,arguments);return i.invoke(this._behaviors,"proxyViewProperties",this),e},triggerMethod:function(){var e=o._triggerMethod(this,arguments);return this._triggerEventOnBehaviors(arguments),this._triggerEventOnParentLayout(arguments[0],i.rest(arguments)),e},_triggerEventOnBehaviors:function(e){for(var t=o._triggerMethod,i=this._behaviors,n=0,r=i&&i.length;r>n;n++)t(i[n],e)},_triggerEventOnParentLayout:function(e,t){var n=this._parentLayoutView();if(n){var r=o.getOption(n,"childViewEventPrefix"),s=r+":"+e,a=[this].concat(t);o._triggerMethod(n,s,a);var l=o.getOption(n,"childEvents");l=o._getValue(l,n);var d=n.normalizeMethods(l);d&&i.isFunction(d[e])&&d[e].apply(n,a)}},_getImmediateChildren:function(){return[]},_getNestedViews:function(){var e=this._getImmediateChildren();return e.length?i.reduce(e,function(e,t){return t._getNestedViews?e.concat(t._getNestedViews()):e},e):e},_parentLayoutView:function(){for(var e=this._parent;e;){if(e instanceof o.LayoutView)return e;e=e._parent}},normalizeMethods:o.normalizeMethods,mergeOptions:o.mergeOptions,getOption:o.proxyGetOption,bindEntityEvents:o.proxyBindEntityEvents,unbindEntityEvents:o.proxyUnbindEntityEvents}),o.ItemView=o.View.extend({constructor:function(){o.View.apply(this,arguments)},serializeData:function(){if(!this.model&&!this.collection)return{};var e=[this.model||this.collection];return arguments.length&&e.push.apply(e,arguments),this.model?this.serializeModel.apply(this,e):{items:this.serializeCollection.apply(this,e)}},serializeCollection:function(e){return e.toJSON.apply(e,i.rest(arguments))},render:function(){return this._ensureViewIsIntact(),this.triggerMethod("before:render",this),this._renderTemplate(),this.isRendered=!0,this.bindUIElements(),this.triggerMethod("render",this),this},_renderTemplate:function(){var e=this.getTemplate();if(e!==!1){if(!e)throw new o.Error({name:"UndefinedTemplateError",message:"Cannot render the template since it is null or undefined."});var t=this.mixinTemplateHelpers(this.serializeData()),i=o.Renderer.render(e,t,this);return this.attachElContent(i),this}},attachElContent:function(e){return this.$el.html(e),this}}),o.CollectionView=o.View.extend({childViewEventPrefix:"childview",sort:!0,constructor:function(e){this.once("render",this._initialEvents),this._initChildViewStorage(),o.View.apply(this,arguments),this.on({"before:show":this._onBeforeShowCalled,show:this._onShowCalled,"before:attach":this._onBeforeAttachCalled,attach:this._onAttachCalled}),this.initRenderBuffer()},initRenderBuffer:function(){this._bufferedChildren=[]},startBuffering:function(){this.initRenderBuffer(),this.isBuffering=!0},endBuffering:function(){var e,t=this._isShown&&o.isNodeAttached(this.el);this.isBuffering=!1,this._isShown&&this._triggerMethodMany(this._bufferedChildren,this,"before:show"),t&&this._triggerBeforeAttach&&(e=this._getNestedViews(),this._triggerMethodMany(e,this,"before:attach")),this.attachBuffer(this,this._createBuffer()),t&&this._triggerAttach&&(e=this._getNestedViews(),this._triggerMethodMany(e,this,"attach")),this._isShown&&this._triggerMethodMany(this._bufferedChildren,this,"show"),this.initRenderBuffer()},_triggerMethodMany:function(e,t,n){var r=i.drop(arguments,3);i.each(e,function(e){o.triggerMethodOn.apply(e,[e,n,e,t].concat(r))})},_initialEvents:function(){this.collection&&(this.listenTo(this.collection,"add",this._onCollectionAdd),this.listenTo(this.collection,"remove",this._onCollectionRemove),this.listenTo(this.collection,"reset",this.render),this.getOption("sort")&&this.listenTo(this.collection,"sort",this._sortViews))},_onCollectionAdd:function(e,t,n){var r=void 0!==n.at&&(n.index||t.indexOf(e));if((this.getOption("filter")||r===!1)&&(r=i.indexOf(this._filteredSortedModels(r),e)),this._shouldAddChild(e,r)){this.destroyEmptyView();var o=this.getChildView(e);this.addChild(e,o,r)}},_onCollectionRemove:function(e){var t=this.children.findByModel(e);this.removeChildView(t),this.checkEmpty()},_onBeforeShowCalled:function(){this._triggerBeforeAttach=this._triggerAttach=!1,this.children.each(function(e){o.triggerMethodOn(e,"before:show",e)})},_onShowCalled:function(){this.children.each(function(e){o.triggerMethodOn(e,"show",e)})},_onBeforeAttachCalled:function(){this._triggerBeforeAttach=!0},_onAttachCalled:function(){this._triggerAttach=!0},render:function(){return this._ensureViewIsIntact(),this.triggerMethod("before:render",this),this._renderChildren(),this.isRendered=!0,this.triggerMethod("render",this),this},reorder:function(){var e=this.children,t=this._filteredSortedModels(),n=i.some(t,function(t){return!e.findByModel(t)});if(n)this.render();else{var r=i.map(t,function(t,i){var n=e.findByModel(t);return n._index=i,n.el}),o=e.filter(function(e){return!i.contains(r,e.el)});this.triggerMethod("before:reorder"),this._appendReorderedChildren(r),i.each(o,this.removeChildView,this),this.checkEmpty(),this.triggerMethod("reorder")}},resortView:function(){o.getOption(this,"reorderOnSort")?this.reorder():this.render()},_sortViews:function(){var e=this._filteredSortedModels(),t=i.find(e,function(e,t){var i=this.children.findByModel(e);return!i||i._index!==t},this);t&&this.resortView()},_emptyViewIndex:-1,_appendReorderedChildren:function(e){this.$el.append(e)},_renderChildren:function(){this.destroyEmptyView(),this.destroyChildren({checkEmpty:!1}),this.isEmpty(this.collection)?this.showEmptyView():(this.triggerMethod("before:render:collection",this),this.startBuffering(),this.showCollection(),this.endBuffering(),this.triggerMethod("render:collection",this),this.children.isEmpty()&&this.getOption("filter")&&this.showEmptyView())},showCollection:function(){var e,t=this._filteredSortedModels();i.each(t,function(t,i){e=this.getChildView(t),this.addChild(t,e,i)},this)},_filteredSortedModels:function(e){var t=this.getViewComparator(),n=this.collection.models;if(e=Math.min(Math.max(e,0),n.length-1),t){var r;e&&(r=n[e],n=n.slice(0,e).concat(n.slice(e+1))),n=this._sortModelsBy(n,t),r&&n.splice(e,0,r)}return this.getOption("filter")&&(n=i.filter(n,function(e,t){return this._shouldAddChild(e,t)},this)),n},_sortModelsBy:function(e,t){return"string"==typeof t?i.sortBy(e,function(e){return e.get(t)},this):1===t.length?i.sortBy(e,t,this):e.sort(i.bind(t,this))},showEmptyView:function(){var e=this.getEmptyView();if(e&&!this._showingEmptyView){this.triggerMethod("before:render:empty"),this._showingEmptyView=!0;var i=new t.Model;this.addEmptyView(i,e),this.triggerMethod("render:empty")}},destroyEmptyView:function(){this._showingEmptyView&&(this.triggerMethod("before:remove:empty"),this.destroyChildren(),delete this._showingEmptyView,this.triggerMethod("remove:empty"))},getEmptyView:function(){return this.getOption("emptyView")},addEmptyView:function(e,t){var n,r=this._isShown&&!this.isBuffering&&o.isNodeAttached(this.el),s=this.getOption("emptyViewOptions")||this.getOption("childViewOptions");i.isFunction(s)&&(s=s.call(this,e,this._emptyViewIndex));var a=this.buildChildView(e,t,s);a._parent=this,this.proxyChildEvents(a),a.once("render",function(){this._isShown&&o.triggerMethodOn(a,"before:show",a),r&&this._triggerBeforeAttach&&(n=this._getViewAndNested(a),this._triggerMethodMany(n,this,"before:attach"))},this),this.children.add(a),this.renderChildView(a,this._emptyViewIndex),r&&this._triggerAttach&&(n=this._getViewAndNested(a),this._triggerMethodMany(n,this,"attach")),this._isShown&&o.triggerMethodOn(a,"show",a)},getChildView:function(e){var t=this.getOption("childView");if(!t)throw new o.Error({name:"NoChildViewError",message:'A "childView" must be specified'});return t},addChild:function(e,t,i){var n=this.getOption("childViewOptions");n=o._getValue(n,this,[e,i]);var r=this.buildChildView(e,t,n);return this._updateIndices(r,!0,i),this.triggerMethod("before:add:child",r),this._addChildView(r,i),this.triggerMethod("add:child",r),r._parent=this,r},_updateIndices:function(e,t,i){this.getOption("sort")&&(t&&(e._index=i),this.children.each(function(i){i._index>=e._index&&(i._index+=t?1:-1)}))},_addChildView:function(e,t){var i,n=this._isShown&&!this.isBuffering&&o.isNodeAttached(this.el);this.proxyChildEvents(e),e.once("render",function(){
this._isShown&&!this.isBuffering&&o.triggerMethodOn(e,"before:show",e),n&&this._triggerBeforeAttach&&(i=this._getViewAndNested(e),this._triggerMethodMany(i,this,"before:attach"))},this),this.children.add(e),this.renderChildView(e,t),n&&this._triggerAttach&&(i=this._getViewAndNested(e),this._triggerMethodMany(i,this,"attach")),this._isShown&&!this.isBuffering&&o.triggerMethodOn(e,"show",e)},renderChildView:function(e,t){return e.supportsRenderLifecycle||o.triggerMethodOn(e,"before:render",e),e.render(),e.supportsRenderLifecycle||o.triggerMethodOn(e,"render",e),this.attachHtml(this,e,t),e},buildChildView:function(e,t,n){var r=i.extend({model:e},n),s=new t(r);return o.MonitorDOMRefresh(s),s},removeChildView:function(e){return e?(this.triggerMethod("before:remove:child",e),e.supportsDestroyLifecycle||o.triggerMethodOn(e,"before:destroy",e),e.destroy?e.destroy():e.remove(),e.supportsDestroyLifecycle||o.triggerMethodOn(e,"destroy",e),delete e._parent,this.stopListening(e),this.children.remove(e),this.triggerMethod("remove:child",e),this._updateIndices(e,!1),e):e},isEmpty:function(){return!this.collection||0===this.collection.length},checkEmpty:function(){this.isEmpty(this.collection)&&this.showEmptyView()},attachBuffer:function(e,t){e.$el.append(t)},_createBuffer:function(){var e=document.createDocumentFragment();return i.each(this._bufferedChildren,function(t){e.appendChild(t.el)}),e},attachHtml:function(e,t,i){e.isBuffering?e._bufferedChildren.splice(i,0,t):e._insertBefore(t,i)||e._insertAfter(t)},_insertBefore:function(e,t){var i,n=this.getOption("sort")&&t<this.children.length-1;return n&&(i=this.children.find(function(e){return e._index===t+1})),!!i&&(i.$el.before(e.el),!0)},_insertAfter:function(e){this.$el.append(e.el)},_initChildViewStorage:function(){this.children=new t.ChildViewContainer},destroy:function(){return this.isDestroyed?this:(this.triggerMethod("before:destroy:collection"),this.destroyChildren({checkEmpty:!1}),this.triggerMethod("destroy:collection"),o.View.prototype.destroy.apply(this,arguments))},destroyChildren:function(e){var t=e||{},n=!0,r=this.children.map(i.identity);return i.isUndefined(t.checkEmpty)||(n=t.checkEmpty),this.children.each(this.removeChildView,this),n&&this.checkEmpty(),r},_shouldAddChild:function(e,t){var n=this.getOption("filter");return!i.isFunction(n)||n.call(this,e,t,this.collection)},proxyChildEvents:function(e){var t=this.getOption("childViewEventPrefix");this.listenTo(e,"all",function(){var n=i.toArray(arguments),r=n[0],o=this.normalizeMethods(i.result(this,"childEvents"));n[0]=t+":"+r,n.splice(1,0,e),"undefined"!=typeof o&&i.isFunction(o[r])&&o[r].apply(this,n.slice(1)),this.triggerMethod.apply(this,n)})},_getImmediateChildren:function(){return i.values(this.children._views)},_getViewAndNested:function(e){return[e].concat(i.result(e,"_getNestedViews")||[])},getViewComparator:function(){return this.getOption("viewComparator")}}),o.CompositeView=o.CollectionView.extend({constructor:function(){o.CollectionView.apply(this,arguments)},_initialEvents:function(){this.collection&&(this.listenTo(this.collection,"add",this._onCollectionAdd),this.listenTo(this.collection,"remove",this._onCollectionRemove),this.listenTo(this.collection,"reset",this._renderChildren),this.getOption("sort")&&this.listenTo(this.collection,"sort",this._sortViews))},getChildView:function(e){var t=this.getOption("childView")||this.constructor;return t},serializeData:function(){var e={};return this.model&&(e=i.partial(this.serializeModel,this.model).apply(this,arguments)),e},render:function(){return this._ensureViewIsIntact(),this._isRendering=!0,this.resetChildViewContainer(),this.triggerMethod("before:render",this),this._renderTemplate(),this._renderChildren(),this._isRendering=!1,this.isRendered=!0,this.triggerMethod("render",this),this},_renderChildren:function(){(this.isRendered||this._isRendering)&&o.CollectionView.prototype._renderChildren.call(this)},_renderTemplate:function(){var e={};e=this.serializeData(),e=this.mixinTemplateHelpers(e),this.triggerMethod("before:render:template");var t=this.getTemplate(),i=o.Renderer.render(t,e,this);this.attachElContent(i),this.bindUIElements(),this.triggerMethod("render:template")},attachElContent:function(e){return this.$el.html(e),this},attachBuffer:function(e,t){var i=this.getChildViewContainer(e);i.append(t)},_insertAfter:function(e){var t=this.getChildViewContainer(this,e);t.append(e.el)},_appendReorderedChildren:function(e){var t=this.getChildViewContainer(this);t.append(e)},getChildViewContainer:function(e,t){if(e.$childViewContainer)return e.$childViewContainer;var i,n=o.getOption(e,"childViewContainer");if(n){var r=o._getValue(n,e);if(i="@"===r.charAt(0)&&e.ui?e.ui[r.substr(4)]:e.$(r),i.length<=0)throw new o.Error({name:"ChildViewContainerMissingError",message:'The specified "childViewContainer" was not found: '+e.childViewContainer})}else i=e.$el;return e.$childViewContainer=i,i},resetChildViewContainer:function(){this.$childViewContainer&&(this.$childViewContainer=void 0)}}),o.LayoutView=o.ItemView.extend({regionClass:o.Region,options:{destroyImmediate:!1},childViewEventPrefix:"childview",constructor:function(e){e=e||{},this._firstRender=!0,this._initializeRegions(e),o.ItemView.call(this,e)},render:function(){return this._ensureViewIsIntact(),this._firstRender?this._firstRender=!1:this._reInitializeRegions(),o.ItemView.prototype.render.apply(this,arguments)},destroy:function(){return this.isDestroyed?this:(this.getOption("destroyImmediate")===!0&&this.$el.remove(),this.regionManager.destroy(),o.ItemView.prototype.destroy.apply(this,arguments))},showChildView:function(e,t,n){var r=this.getRegion(e);return r.show.apply(r,i.rest(arguments))},getChildView:function(e){return this.getRegion(e).currentView},addRegion:function(e,t){var i={};return i[e]=t,this._buildRegions(i)[e]},addRegions:function(e){return this.regions=i.extend({},this.regions,e),this._buildRegions(e)},removeRegion:function(e){return delete this.regions[e],this.regionManager.removeRegion(e)},getRegion:function(e){return this.regionManager.get(e)},getRegions:function(){return this.regionManager.getRegions()},_buildRegions:function(e){var t={regionClass:this.getOption("regionClass"),parentEl:i.partial(i.result,this,"el")};return this.regionManager.addRegions(e,t)},_initializeRegions:function(e){var t;this._initRegionManager(),t=o._getValue(this.regions,this,[e])||{};var n=this.getOption.call(e,"regions");n=o._getValue(n,this,[e]),i.extend(t,n),t=this.normalizeUIValues(t,["selector","el"]),this.addRegions(t)},_reInitializeRegions:function(){this.regionManager.invoke("reset")},getRegionManager:function(){return new o.RegionManager},_initRegionManager:function(){this.regionManager=this.getRegionManager(),this.regionManager._parent=this,this.listenTo(this.regionManager,"before:add:region",function(e){this.triggerMethod("before:add:region",e)}),this.listenTo(this.regionManager,"add:region",function(e,t){this[e]=t,this.triggerMethod("add:region",e,t)}),this.listenTo(this.regionManager,"before:remove:region",function(e){this.triggerMethod("before:remove:region",e)}),this.listenTo(this.regionManager,"remove:region",function(e,t){delete this[e],this.triggerMethod("remove:region",e,t)})},_getImmediateChildren:function(){return i.chain(this.regionManager.getRegions()).pluck("currentView").compact().value()}}),o.Behavior=o.Object.extend({constructor:function(e,t){this.view=t,this.defaults=i.result(this,"defaults")||{},this.options=i.extend({},this.defaults,e),this.ui=i.extend({},i.result(t,"ui"),i.result(this,"ui")),o.Object.apply(this,arguments)},$:function(){return this.view.$.apply(this.view,arguments)},destroy:function(){return this.stopListening(),this},proxyViewProperties:function(e){this.$el=e.$el,this.el=e.el}}),o.Behaviors=function(e,t){function i(e,n){return t.isObject(e.behaviors)?(n=i.parseBehaviors(e,n||t.result(e,"behaviors")),i.wrap(e,n,t.keys(s)),n):{}}function n(e,t){this._view=e,this._behaviors=t,this._triggers={}}function r(e){return e._uiBindings||e.ui}var o=/^(\S+)\s*(.*)$/,s={behaviorTriggers:function(e,t){var i=new n(this,t);return i.buildBehaviorTriggers()},behaviorEvents:function(i,n){var s={};return t.each(n,function(i,n){var a={},l=t.clone(t.result(i,"events"))||{};l=e.normalizeUIKeys(l,r(i));var d=0;t.each(l,function(e,r){var s=r.match(o),l=s[1]+"."+[this.cid,n,d++," "].join(""),c=s[2],u=l+c,f=t.isFunction(e)?e:i[e];a[u]=t.bind(f,i)},this),s=t.extend(s,a)},this),s}};return t.extend(i,{behaviorsLookup:function(){throw new e.Error({message:"You must define where your behaviors are stored.",url:"marionette.behaviors.html#behaviorslookup"})},getBehaviorClass:function(t,n){return t.behaviorClass?t.behaviorClass:e._getValue(i.behaviorsLookup,this,[t,n])[n]},parseBehaviors:function(e,n){return t.chain(n).map(function(n,r){var o=i.getBehaviorClass(n,r),s=new o(n,e),a=i.parseBehaviors(e,t.result(s,"behaviors"));return[s].concat(a)}).flatten().value()},wrap:function(e,i,n){t.each(n,function(n){e[n]=t.partial(s[n],e[n],i)})}}),t.extend(n.prototype,{buildBehaviorTriggers:function(){return t.each(this._behaviors,this._buildTriggerHandlersForBehavior,this),this._triggers},_buildTriggerHandlersForBehavior:function(i,n){var o=t.clone(t.result(i,"triggers"))||{};o=e.normalizeUIKeys(o,r(i)),t.each(o,t.bind(this._setHandlerForBehavior,this,i,n))},_setHandlerForBehavior:function(e,t,i,n){var r=n.replace(/^\S+/,function(e){return e+".behaviortriggers"+t});this._triggers[r]=this._view._buildViewTrigger(i)}}),i}(o,i),o.AppRouter=t.Router.extend({constructor:function(e){this.options=e||{},t.Router.apply(this,arguments);var i=this.getOption("appRoutes"),n=this._getController();this.processAppRoutes(n,i),this.on("route",this._processOnRoute,this)},appRoute:function(e,t){var i=this._getController();this._addAppRoute(i,e,t)},_processOnRoute:function(e,t){if(i.isFunction(this.onRoute)){var n=i.invert(this.getOption("appRoutes"))[e];this.onRoute(e,n,t)}},processAppRoutes:function(e,t){if(t){var n=i.keys(t).reverse();i.each(n,function(i){this._addAppRoute(e,i,t[i])},this)}},_getController:function(){return this.getOption("controller")},_addAppRoute:function(e,t,n){var r=e[n];if(!r)throw new o.Error('Method "'+n+'" was not found on the controller');this.route(t,n,i.bind(r,e))},mergeOptions:o.mergeOptions,getOption:o.proxyGetOption,triggerMethod:o.triggerMethod,bindEntityEvents:o.proxyBindEntityEvents,unbindEntityEvents:o.proxyUnbindEntityEvents}),o.Application=o.Object.extend({constructor:function(e){this._initializeRegions(e),this._initCallbacks=new o.Callbacks,this.submodules={},i.extend(this,e),this._initChannel(),o.Object.apply(this,arguments)},execute:function(){this.commands.execute.apply(this.commands,arguments)},request:function(){return this.reqres.request.apply(this.reqres,arguments)},addInitializer:function(e){this._initCallbacks.add(e)},start:function(e){this.triggerMethod("before:start",e),this._initCallbacks.run(e,this),this.triggerMethod("start",e)},addRegions:function(e){return this._regionManager.addRegions(e)},emptyRegions:function(){return this._regionManager.emptyRegions()},removeRegion:function(e){return this._regionManager.removeRegion(e)},getRegion:function(e){return this._regionManager.get(e)},getRegions:function(){return this._regionManager.getRegions()},module:function(e,t){var n=o.Module.getClass(t),r=i.toArray(arguments);return r.unshift(this),n.create.apply(n,r)},getRegionManager:function(){return new o.RegionManager},_initializeRegions:function(e){var t=i.isFunction(this.regions)?this.regions(e):this.regions||{};this._initRegionManager();var n=o.getOption(e,"regions");return i.isFunction(n)&&(n=n.call(this,e)),i.extend(t,n),this.addRegions(t),this},_initRegionManager:function(){this._regionManager=this.getRegionManager(),this._regionManager._parent=this,this.listenTo(this._regionManager,"before:add:region",function(){o._triggerMethod(this,"before:add:region",arguments)}),this.listenTo(this._regionManager,"add:region",function(e,t){this[e]=t,o._triggerMethod(this,"add:region",arguments)}),this.listenTo(this._regionManager,"before:remove:region",function(){o._triggerMethod(this,"before:remove:region",arguments)}),this.listenTo(this._regionManager,"remove:region",function(e){delete this[e],o._triggerMethod(this,"remove:region",arguments)})},_initChannel:function(){this.channelName=i.result(this,"channelName")||"global",this.channel=i.result(this,"channel")||t.Wreqr.radio.channel(this.channelName),this.vent=i.result(this,"vent")||this.channel.vent,this.commands=i.result(this,"commands")||this.channel.commands,this.reqres=i.result(this,"reqres")||this.channel.reqres}}),o.Module=function(e,t,n){this.moduleName=e,this.options=i.extend({},this.options,n),this.initialize=n.initialize||this.initialize,this.submodules={},this._setupInitializersAndFinalizers(),this.app=t,i.isFunction(this.initialize)&&this.initialize(e,t,this.options)},o.Module.extend=o.extend,i.extend(o.Module.prototype,t.Events,{startWithParent:!0,initialize:function(){},addInitializer:function(e){this._initializerCallbacks.add(e)},addFinalizer:function(e){this._finalizerCallbacks.add(e)},start:function(e){this._isInitialized||(i.each(this.submodules,function(t){t.startWithParent&&t.start(e)}),this.triggerMethod("before:start",e),this._initializerCallbacks.run(e,this),this._isInitialized=!0,this.triggerMethod("start",e))},stop:function(){this._isInitialized&&(this._isInitialized=!1,this.triggerMethod("before:stop"),i.invoke(this.submodules,"stop"),this._finalizerCallbacks.run(void 0,this),this._initializerCallbacks.reset(),this._finalizerCallbacks.reset(),this.triggerMethod("stop"))},addDefinition:function(e,t){this._runModuleDefinition(e,t)},_runModuleDefinition:function(e,n){if(e){var r=i.flatten([this,this.app,t,o,t.$,i,n]);e.apply(this,r)}},_setupInitializersAndFinalizers:function(){this._initializerCallbacks=new o.Callbacks,this._finalizerCallbacks=new o.Callbacks},triggerMethod:o.triggerMethod}),i.extend(o.Module,{create:function(e,t,n){var r=e,o=i.drop(arguments,3);t=t.split(".");var s=t.length,a=[];return a[s-1]=n,i.each(t,function(t,i){var s=r;r=this._getModule(s,t,e,n),this._addModuleDefinition(s,r,a[i],o)},this),r},_getModule:function(e,t,n,r,o){var s=i.extend({},r),a=this.getClass(r),l=e[t];return l||(l=new a(t,n,s),e[t]=l,e.submodules[t]=l),l},getClass:function(e){var t=o.Module;return e?e.prototype instanceof t?e:e.moduleClass||t:t},_addModuleDefinition:function(e,t,i,n){var r=this._getDefine(i),o=this._getStartWithParent(i,t);r&&t.addDefinition(r,n),this._addStartWithParent(e,t,o)},_getStartWithParent:function(e,t){var n;return i.isFunction(e)&&e.prototype instanceof o.Module?(n=t.constructor.prototype.startWithParent,!!i.isUndefined(n)||n):!i.isObject(e)||(n=e.startWithParent,!!i.isUndefined(n)||n)},_getDefine:function(e){return!i.isFunction(e)||e.prototype instanceof o.Module?i.isObject(e)?e.define:null:e},_addStartWithParent:function(e,t,i){t.startWithParent=t.startWithParent&&i,t.startWithParent&&!t.startWithParentIsConfigured&&(t.startWithParentIsConfigured=!0,e.addInitializer(function(e){t.startWithParent&&t.start(e)}))}}),o}),CKFinder.define("CKFinder/Views/Base/Common",["underscore","doT","marionette"],function(e,t,i){"use strict";var n={proto:{getTemplate:function(){var n=this,r=i.getOption(n,"template"),o=i.getOption(n,"imports");e.isFunction(o)&&(o=o.call(this));var s={imports:o,name:n.name,template:r};return n.finder.fire("template",s,n.finder),n.finder.fire("template:"+n.name,s,n.finder),t.template(s.template,null,s.imports)},mixinTemplateHelpers:function(t){t=t||{};var n=this.getOption("templateHelpers");return n=i._getValue(n,this),e.extend(t,{lang:this.finder.lang,config:this.finder.config},n)}},util:{construct:function(e){if(!this.name){if(!e.name)throw"name parameter must be specified";this.name=e.name}if(!this.finder){if(!e.finder)throw"Finder parameter must be specified for view: "+this.name;this.finder=e.finder}this.finder.fire("view:"+this.name,{view:this},this.finder)}}};return n}),CKFinder.define("CKFinder/Views/Base/CompositeView",["underscore","marionette","CKFinder/Views/Base/Common"],function(e,t,i){"use strict";var n=t.CompositeView,r=n.extend(i.proto),o=r.extend({constructor:function(e){i.util.construct.call(this,e),n.prototype.constructor.apply(this,Array.prototype.slice.call(arguments))},buildChildView:function(t,i,n){var r=e.extend({model:t,finder:this.finder},n);return new i(r)},attachBuffer:function(e,t){var i=this.getChildViewContainer(e);i.append(t),this.triggerMethod("attachBuffer")}});return o}),CKFinder.define("CKFinder/Views/Base/ItemView",["marionette","CKFinder/Views/Base/Common"],function(e,t){"use strict";var i=e.ItemView,n=i.extend(t.proto),r=n.extend({constructor:function(e){t.util.construct.call(this,e),i.prototype.constructor.apply(this,Array.prototype.slice.call(arguments))}});return r}),CKFinder.define("text",["module"],function(e){"use strict";var t,i,n,r,o,s=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],a=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,l=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,d="undefined"!=typeof location&&location.href,c=d&&location.protocol&&location.protocol.replace(/\:/,""),u=d&&location.hostname,f=d&&(location.port||void 0),h={},g=e.config&&e.config()||{};return t={version:"2.0.14",strip:function(e){if(e){e=e.replace(a,"");var t=e.match(l);t&&(e=t[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"$1").replace(/[\f]/g,"\f").replace(/[\b]/g,"\b").replace(/[\n]/g,"\n").replace(/[\t]/g,"\t").replace(/[\r]/g,"\r").replace(/[\u2028]/g,"\u2028").replace(/[\u2029]/g,"\u2029")},createXhr:g.createXhr||function(){var e,t,i;if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;if("undefined"!=typeof ActiveXObject)for(t=0;3>t;t+=1){i=s[t];try{e=new ActiveXObject(i)}catch(e){}if(e){s=[i];break}}return e},parseName:function(e){var t,i,n,r=!1,o=e.lastIndexOf("."),s=0===e.indexOf("./")||0===e.indexOf("../");return-1!==o&&(!s||o>1)?(t=e.substring(0,o),i=e.substring(o+1)):t=e,n=i||t,o=n.indexOf("!"),-1!==o&&(r="strip"===n.substring(o+1),n=n.substring(0,o),i?i=n:t=n),{moduleName:t,ext:i,strip:r}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,i,n,r){var o,s,a,l=t.xdRegExp.exec(e);return!l||(o=l[2],s=l[3],s=s.split(":"),a=s[1],s=s[0],!(o&&o!==i||s&&s.toLowerCase()!==n.toLowerCase()||(a||s)&&a!==r))},finishLoad:function(e,i,n,r){n=i?t.strip(n):n,g.isBuild&&(h[e]=n),r(n)},load:function(e,i,n,r){if(r&&r.isBuild&&!r.inlineText)return void n();g.isBuild=r&&r.isBuild;var o=t.parseName(e),s=o.moduleName+(o.ext?"."+o.ext:""),a=i.toUrl(s),l=g.useXhr||t.useXhr;return 0===a.indexOf("empty:")?void n():void(!d||l(a,c,u,f)?t.get(a,function(i){t.finishLoad(e,o.strip,i,n)},function(e){n.error&&n.error(e)}):i([s],function(e){t.finishLoad(o.moduleName+"."+o.ext,o.strip,e,n)}))},write:function(e,i,n,r){if(h.hasOwnProperty(i)){var o=t.jsEscape(h[i]);n.asModule(e+"!"+i,"define(function () { return '"+o+"';});")}},writeFile:function(e,i,n,r,o){var s=t.parseName(i),a=s.ext?"."+s.ext:"",l=s.moduleName+a,d=n.toUrl(s.moduleName+a)+".js";t.load(l,n,function(i){var n=function(e){return r(d,e)};n.asModule=function(e,t){return r.asModule(e,d,t)},t.write(e,l,n,o)},o)}},"node"===g.env||!g.env&&"undefined"!=typeof process&&process.versions&&process.versions.node&&!process.versions["node-webkit"]&&!process.versions["atom-shell"]?(i=require.nodeRequire("fs"),t.get=function(e,t,n){try{var r=i.readFileSync(e,"utf8");"\ufeff"===r[0]&&(r=r.substring(1)),t(r)}catch(e){n&&n(e)}}):"xhr"===g.env||!g.env&&t.createXhr()?t.get=function(e,i,n,r){var o,s=t.createXhr();if(s.open("GET",e,!0),r)for(o in r)r.hasOwnProperty(o)&&s.setRequestHeader(o.toLowerCase(),r[o]);g.onXhr&&g.onXhr(s,e),s.onreadystatechange=function(t){var r,o;4===s.readyState&&(r=s.status||0,r>399&&600>r?(o=new Error(e+" HTTP status: "+r),o.xhr=s,n&&n(o)):i(s.responseText),g.onXhrComplete&&g.onXhrComplete(s,e))},s.send(null)}:"rhino"===g.env||!g.env&&"undefined"!=typeof Packages&&"undefined"!=typeof java?t.get=function(e,t){var i,n,r="utf-8",o=new java.io.File(e),s=java.lang.System.getProperty("line.separator"),a=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(o),r)),l="";try{for(i=new java.lang.StringBuffer,n=a.readLine(),n&&n.length()&&65279===n.charAt(0)&&(n=n.substring(1)),null!==n&&i.append(n);null!==(n=a.readLine());)i.append(s),i.append(n);l=String(i.toString())}finally{a.close()}t(l)}:("xpconnect"===g.env||!g.env&&"undefined"!=typeof Components&&Components.classes&&Components.interfaces)&&(n=Components.classes,r=Components.interfaces,Components.utils.import("resource://gre/modules/FileUtils.jsm"),o="@mozilla.org/windows-registry-key;1"in n,t.get=function(e,t){var i,s,a,l={};o&&(e=e.replace(/\//g,"\\")),a=new FileUtils.File(e);try{i=n["@mozilla.org/network/file-input-stream;1"].createInstance(r.nsIFileInputStream),i.init(a,1,0,!1),s=n["@mozilla.org/intl/converter-input-stream;1"].createInstance(r.nsIConverterInputStream),s.init(i,"utf-8",i.available(),r.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER),s.readString(i.available(),l),s.close(),i.close(),t(l.value)}catch(e){throw new Error((a&&a.path||"")+": "+e)}}),t}),CKFinder.define("text!CKFinder/Templates/ContextMenu/ContextMenuItem.dot",[],function(){return'{{? it.divider }}{{??}}<a tabindex="-1" class="ui-btn {{? !it.isActive }}ui-state-disabled {{?}}{{? it.icon }}ui-btn-icon-{{? it.lang.dir === \'ltr\' }}left{{??}}right{{?}} ui-icon-{{= it.icon }}{{?}}" {{? !it.isActive }}aria-disabled="true"{{?}} data-ckf-name="{{= it.name }}" {{? it.linkAttributes }}{{~ it.linkAttributes :attribute}}{{=attribute.name}}="{{=attribute.value}}"{{~}}{{?}}>{{= it.label }}</a>{{?}}'}),CKFinder.define("CKFinder/Modules/ContextMenu/Views/ContextMenuView",["underscore","jquery","CKFinder/Views/Base/CompositeView","CKFinder/Views/Base/ItemView","text!CKFinder/Templates/ContextMenu/ContextMenuItem.dot","CKFinder/Util/KeyCode"],function(e,t,i,n,r,o){"use strict";function s(e,t){var i=e.x,n=e.y,r=t.height(),o=t.width();return{x:parseInt(i+(window.innerWidth<i+o?-1:1)*o/2,10),y:parseInt(n+(window.innerHeight<n+r?-1:1)*r/2+document.body.scrollTop,10)}}var a=i.extend({name:"ContextMenu",template:"<ul></ul>",childViewContainer:"ul",emptyView:n.extend({name:"ContextMenuEmpty",template:'<div class="ckf-message"></div>'}),initialize:function(i){function n(t){var n=t.model.get("action"),r=t.evt;e.isFunction(n)&&(r.stopPropagation(),r.preventDefault(),n(i.forView)),setTimeout(function(){a.destroy()},10)}function r(e){!a||a.$el.find(e.target).length||a.isDestroyed||a.destroy()}var a=this,l=t(document),d="mousedown contextmenu",c=i.position,u=i.positionToEl;if(!c&&u){var f=u.get(0).getBoundingClientRect();c={x:f.left+u.width()/2,y:f.top+u.height()/2}}a.$el.attr("data-theme",a.finder.config.swatch),a.on("destroy",function(){l.off(d,r),a.$el.length&&a.$el.remove()}),a.on("render",function(){a.$el.find("ul").listview(),t(".ui-popup-container").remove(),a.$el.popup().popup("open"),a.$el.find(".ui-btn:first").focus(),c&&c.x&&c.y&&a.$el.popup("reposition",s(c,a.$el)),setTimeout(function(){l.one(d,r)},0)}),a.on("childview:itemclicked",function(e,t){a.destroy(),n(t)}),a.on("childview:itemkeydown",function(t,i){var r,s,l,d=i.evt;d.keyCode===o.up&&(d.stopPropagation(),d.preventDefault(),r=a.$el.find("a"),s=e.indexOf(r,t.$el.find("a")[0]),l=s-1,r[l>=0?l:r.length-1].focus()),d.keyCode===o.down&&(d.stopPropagation(),d.preventDefault(),r=a.$el.find("a"),s=e.indexOf(r,t.$el.find("a")[0]),l=s+1,r[l<=r.length-1?l:0].focus()),(d.keyCode===o.enter||d.keyCode===o.space)&&(a.destroy(),n(i)),d.keyCode===o.escape&&(d.stopPropagation(),d.preventDefault(),a.destroy())})},getChildView:function(e){var t={contextmenu:function(e){e.preventDefault(),e.stopPropagation()}};e.get("divider")||(t["click a"]=function(e){this.trigger("itemclicked",{evt:e,view:this,model:this.model})},t["keydown a"]=function(e){this.trigger("itemkeydown",{evt:e,view:this,model:this.model})});var i={name:"ContextMenuItem",finder:this.finder,template:r,events:t,tagName:"li",modelEvents:{"change:active":"render"}};return e.get("divider")&&(i.attributes={"data-role":"list-divider"}),n.extend(i)}});return a}),CKFinder.define("CKFinder/Modules/ContextMenu/ContextMenu",["underscore","backbone","CKFinder/Modules/ContextMenu/Views/ContextMenuView"],function(e,t,i){"use strict";function n(e){function t(){i.lastView&&i.lastView.destroy()}this.finder=e,e.setHandler("contextMenu",r,this);var i=this;e.on("ui:blur",t),e.on("ui:resize",t),e.on("shortcuts:list:general",function(e){e.data.shortcuts.add({label:e.finder.lang.Shortcuts.general.showContextMenu,shortcuts:"{shift}+{f10}"})},null,null,50)}function r(e){var n=this,r=n.finder,o=new t.Collection,s={groups:o,context:e.context};if(r.fire("contextMenu",s,r)&&r.fire("contextMenu:"+e.name,s,r)){o.forEach(function(i){var n=new t.Collection;r.fire("contextMenu:"+e.name+":"+i.get("name"),{items:n,context:e.context},r),i.set("items",n)});var a=new t.Collection;o.forEach(function(e){var t=e.get("items");t.length&&(a.length&&a.add({divider:!0}),a.add(t.models))}),n.lastView&&n.lastView.destroy();var l=!(!e.evt||!e.evt.clientX)&&{x:e.evt.clientX,y:e.evt.clientY},d=e.positionToEl?e.positionToEl:null;r.request("focus:remember"),n.lastView=new i({finder:r,className:"ckf-contextmenu",collection:a,position:l,positionToEl:d,forView:e.view}),n.lastView.on("destroy",function(){r.request("focus:restore")}),n.lastView.render()}}return n}),CKFinder.define("CKFinder/Models/FoldersCollection",["backbone","CKFinder/Models/Folder"],function(e,t){"use strict";var i=e.Collection.extend({model:t,initialize:function(){this.on("change:name",this.sort)},comparator:function(e,t){return e.get("name").localeCompare(t.get("name"))}});return i}),CKFinder.define("CKFinder/Models/Folder",["backbone","CKFinder/Models/FoldersCollection"],function(e,t){"use strict";var i=e.Model.extend({defaults:{name:"",hasChildren:!1,resourceType:"",isRoot:!1,parent:null,isPending:!1,"view:isFolder":!0},initialize:function(){function e(){o.set("hasChildren",!!o.get("children").length)}this.set("name",this.get("name").toString(),{silent:!0}),this.set("children",new t,{silent:!0});var i=this.get("children");i.on("change",e),i.on("remove",e),this.on("change:children",function(t,i){i&&(i.on("change",e),i.on("remove",e))});var n=this.get("allowedExtensions");n&&"string"==typeof n&&this.set("allowedExtensions",n.split(","),{silent:!0});var r=this.get("allowedExtensions");r&&"string"==typeof r&&this.set("allowedExtensions",n.split(","),{silent:!0});var o=this},getPath:function(e){var t,i;return t=this.get("parent"),i=t?t.getPath(e).toString()+this.get("name")+"/":"/",this.get("isRoot")&&e&&e.full&&(i=this.get("resourceType")+":"+i),i},getHash:function(){if(this.has("hash"))return this.get("hash");var e=this.get("parent");return e.getHash()},getUrl:function(){if(this.has("url"))return this.get("url");var e=this.get("parent");if(!e)return!1;var t=e.getUrl();return t&&t+encodeURIComponent(this.get("name"))+"/"},isPath:function(e,t){return e===this.getPath()&&t===this.get("resourceType")},getResourceType:function(){for(var e=this;!e.get("isRoot");)e=e.get("parent");return e}},{isValidName:function(e){var t=/[\\\/:\*\?"<>\|]/;return!t.test(e)}});return i}),CKFinder.define("text!CKFinder/Templates/Folders/FolderNameDialogTemplate.dot",[],function(){return'<form action="#"><label>{{! it.dialogMessage }}<input name="newFolderName" value="{{! it.folderName }}" tabindex="1" aria-required="true" dir="auto"></label></form><p class="error-message"></p>'}),CKFinder.define("CKFinder/Modules/Folders/Views/FolderNameDialogView",["CKFinder/Views/Base/ItemView","CKFinder/Models/Folder","text!CKFinder/Templates/Folders/FolderNameDialogTemplate.dot"],function(e,t,i){"use strict";return e.extend({name:"FolderNameDialogView",template:i,ui:{error:".error-message",folderName:'input[name="newFolderName"]'},events:{"input @ui.folderName":function(){var e=this.ui.folderName.val().toString().trim();t.isValidName(e)?this.model.unset("error"):this.model.set("error",this.finder.lang.ErrorMsg.FolderInvChar),this.model.set("folderName",e)},submit:function(e){this.trigger("submit:form"),e.preventDefault()}},modelEvents:{"change:error":function(e,t){t?(this.ui.error.show(),this.ui.error.html(t)):this.ui.error.hide()}}})}),CKFinder.define("CKFinder/Modules/CreateFolder/CreateFolder",["backbone","CKFinder/Modules/Folders/Views/FolderNameDialogView"],function(e,t){"use strict";function i(i){i.setHandler("folder:create",function(n){var r=n.parent,o=n.newFolderName;if(o)i.request("loader:show",{text:i.lang.PleaseWait}),i.request("command:send",{name:"CreateFolder",type:"post",folder:r,params:{newFolderName:o},context:{folder:r}});else{var s=new e.Model({dialogMessage:i.lang.FolderNew,folderName:n.newFolderName,error:!1}),a=i.request("dialog",{view:new t({finder:i,model:s}),name:"CreateFolder",title:i.lang.NewNameDlgTitle,context:{parent:r}});s.on("change:error",function(e,t){t?a.disableButton("ok"):a.enableButton("ok")})}}),i.on("dialog:CreateFolder:ok",function(e){var t=e.data.view.model;if(!t.get("error")){var n=t.get("folderName");e.finder.request("dialog:destroy"),i.request("folder:create",{parent:e.data.context.parent,newFolderName:n})}}),i.on("contextMenu:folder:edit",function(e){var t=e.finder,i=e.data.context.folder;e.data.items.add({name:"CreateFolder",label:t.lang.NewSubFolder,isActive:i.get("acl").folderCreate,icon:"ckf-folder-add",action:function(){t.request("folder:create",{parent:i})}})}),i.on("toolbar:reset:Main:folder",function(e){var t=e.data.folder;t.get("acl").folderCreate&&e.data.toolbar.push({type:"button",name:"CreateFolder",priority:70,icon:"ckf-folder-add",label:e.finder.lang.NewSubFolder,action:function(){i.request("folder:create",{parent:t})}})}),i.on("command:after:CreateFolder",n)}function n(e){function t(e){e.data.context.parent.cid===i.cid&&(e.data.response.error||i.trigger("ui:expand"),e.finder.removeListener("command:after:GetFolders",t))}var i=e.data.context.folder;e.finder.request("loader:hide"),e.data.response.error||(i.set("hasChildren",!0),e.finder.once("command:after:GetFolders",t),e.finder.request("command:send",{name:"GetFolders",folder:i,context:{parent:i}},null,null,30))}return i}),CKFinder.define("text!CKFinder/Templates/DeleteFile/DeleteFileError.dot",[],function(){return"{{? it.msg }}<p>{{= it.msg }}</p>{{?}}<ul>{{~ it.errors :error }}<li>{{= error }}</li>{{~}}</ul>"}),CKFinder.define("CKFinder/Modules/DeleteFile/DeleteFile",["underscore","backbone","text!CKFinder/Templates/DeleteFile/DeleteFileError.dot","CKFinder/Util/KeyCode"],function(e,t,i,n){"use strict";function r(e){this.finder=e,e.setHandler("files:delete",o,this),e.on("dialog:DeleteFileConfirm:ok",l),e.on("command:after:DeleteFiles",d),e.on("command:error:DeleteFiles",c),e.on("contextMenu:file",function(e){e.data.groups.add({name:"delete"})},null,null,40),e.on("contextMenu:file:delete",a,this),e.on("toolbar:reset:Main:file",function(t){s(t,e.lang.Delete)}),e.on("toolbar:reset:Main:files",function(t){s(t,e.lang.DeleteFiles)}),u(e)}function o(e){var t,i=this.finder,n=e.files;t=n.length>1?i.lang.FilesDelete.replace("%1",n.length):i.lang.FileDelete.replace("%1",i.util.escapeHtml(n[0].get("name"))),i.request("dialog:confirm",{name:"DeleteFileConfirm",msg:t,context:{files:n}})}function s(e,t){var i=e.finder.request("folder:getActive");i.get("acl").fileDelete&&e.data.toolbar.push({type:"button",name:"DeleteFiles",priority:10,icon:"ckf-file-delete",label:t,action:function(){e.finder.request("files:delete",{files:e.finder.request("files:getSelected").toArray()})}})}function a(e){var t=this,i=t.finder,n=i.request("files:getSelected"),r=n.length>1;e.data.items.add({name:"DeleteFiles",label:r?i.lang.DeleteFiles:i.lang.Delete,isActive:e.data.context.file.get("folder").get("acl").fileDelete,icon:"ckf-file-delete",action:function(){i.request("files:delete",{files:r?n:[e.data.context.file]})}})}
function l(i){var n=i.data.context.files,r=[],o=i.finder;n instanceof t.Collection&&(n=n.toArray()),e.forEach(n,function(e){var t=e.get("folder");r.push({name:e.get("name"),type:t.get("resourceType"),folder:t.getPath()})});var s=o.request("folder:getActive");o.request("loader:show",{text:o.lang.PleaseWait}),o.request("command:send",{name:"DeleteFiles",type:"post",post:{files:r},sendPostAsJson:!0,folder:s,context:{files:n}})}function d(t){var i=t.data.response;t.finder.request("loader:hide"),i.error||(e.forEach(t.data.context.files,function(e){var t=e.get("folder");t.get("children").remove(e)}),t.finder.fire("files:deleted",{files:t.data.context.files},t.finder))}function c(n){var r=n.data.response;if(r.error.number===f){n.cancel();var o=!!r.deleted,s=n.finder.lang.Errors[f],a=[];e.forEach(r.error.errors,function(e){a.push(e.name+": "+n.finder.lang.Errors[e.number]),117===e.number&&(o=!0)}),n.finder.request("dialog",{name:"DeleteFilesErrors",title:n.finder.lang.OperationCompletedErrors,template:i,templateModel:new t.Model({deleted:r.deleted,errors:a,msg:s}),buttons:["okClose"]}),o&&n.finder.request("folder:refreshFiles")}}function u(e){e.on("file:keydown",function(t){if(t.data.evt.keyCode===n.delete&&e.util.isShortcut(t.data.evt,"")){var i=e.request("files:getSelected");e.request("files:delete",{files:i.length>1?i:[t.data.file]})}}),e.on("shortcuts:list:files",function(e){e.data.shortcuts.add({label:e.finder.lang.Shortcuts.files.delete,shortcuts:"{del}"})},null,null,30)}var f=302;return r}),CKFinder.define("CKFinder/Modules/DeleteFolder/DeleteFolder",["CKFinder/Util/KeyCode"],function(e){"use strict";function t(e){e.on("dialog:DeleteFolderConfirm:ok",function(t){var i=t.data.context.folder;e.request("loader:show",{text:e.lang.PleaseWait}),e.request("command:send",{name:"DeleteFolder",type:"post",folder:i,context:{folder:i}},e)}),e.on("command:after:DeleteFolder",function(t){var i=t.data.response,n=t.data.context.folder;if(e.request("loader:hide"),!i.error){var r=n.get("parent");n.unset("parent"),r.get("children").remove(n);var o=e.request("folder:getActive");o.cid===n.cid&&e.request("folder:select",{folder:r}),e.fire("folder:deleted",{folder:n})}}),e.on("toolbar:reset:Main:folder",function(t){var i=t.data.folder;!i.get("isRoot")&&i.get("acl").folderDelete&&t.data.toolbar.push({type:"button",name:"DeleteFolder",priority:20,icon:"ckf-folder-delete",label:t.finder.lang.Delete,action:function(){e.request("folder:delete",{folder:i})}})}),e.on("contextMenu:folder",function(e){e.data.groups.add({name:"delete"})},null,null,20),e.on("contextMenu:folder:delete",function(e){var t=e.finder,i=e.data.context.folder,n=i.get("isRoot"),r=i.get("acl");e.data.items.add({name:"DeleteFolder",label:t.lang.Delete,isActive:!n&&r.folderDelete,icon:"ckf-folder-delete",action:function(){t.request("folder:delete",{folder:i})}})}),e.setHandler("folder:delete",function(t){var i=t.folder;e.request("dialog:confirm",{name:"DeleteFolderConfirm",context:{folder:i},msg:e.lang.FolderDelete.replace("%1",e.util.escapeHtml(i.get("name")))})}),i(e)}function i(t){t.on("folder:keydown",function(i){i.data.folder.get("isRoot")||i.data.evt.keyCode===e.delete&&i.finder.util.isShortcut(i.data.evt,"")&&(i.data.evt.preventDefault(),i.data.evt.stopPropagation(),t.request("folder:delete",{folder:i.data.folder}))}),t.on("shortcuts:list:folders",function(e){e.data.shortcuts.add({label:e.finder.lang.Shortcuts.folders.delete,shortcuts:"{del}"})},null,null,30)}return t}),CKFinder.define("CKFinder/Views/Base/LayoutView",["marionette","CKFinder/Views/Base/Common"],function(e,t){"use strict";var i=e.LayoutView,n=i.extend(t.proto),r=n.extend({constructor:function(i){t.util.construct.call(this,i),e.LayoutView.prototype.constructor.apply(this,Array.prototype.slice.call(arguments))}});return r}),CKFinder.define("CKFinder/Views/Base/CollectionView",["underscore","marionette","CKFinder/Views/Base/Common"],function(e,t,i){"use strict";var n=t.CollectionView,r=n.extend(i.proto),o=r.extend({constructor:function(e){i.util.construct.call(this,e),n.prototype.constructor.apply(this,Array.prototype.slice.call(arguments))},buildChildView:function(t,i,n){var r=e.extend({model:t,finder:this.finder},n);return new i(r)}});return o}),CKFinder.define("CKFinder/Modules/Dialogs/Views/DialogButtonView",["CKFinder/Util/KeyCode","CKFinder/Views/Base/ItemView"],function(e,t){"use strict";return t.extend({name:"DialogButton",tagName:"button",template:"{{= it.label }}",attributes:{tabindex:1},events:{click:function(){this.trigger("button")},keydown:function(t){(t.keyCode===e.enter||t.keyCode===e.space)&&(t.preventDefault(),this.trigger("button"))}},onRender:function(){this.$el.attr("data-inline",!0).attr("data-ckf-button",this.model.get("name"))}})}),CKFinder.define("CKFinder/Modules/Dialogs/Views/DialogButtonsView",["underscore","backbone","CKFinder/Views/Base/CollectionView","CKFinder/Modules/Dialogs/Views/DialogButtonView"],function(e,t,i,n){"use strict";function r(i,n){var r=new t.Collection;return e.forEach(i,function(t){var i=e.isString(t)?t:t.name;r.push(e.extend({icons:{},label:i,name:i,event:i.toLocaleLowerCase()},e.isString(t)?n[i]:t))}),r}return i.extend({name:"DialogButtons",childView:n,initialize:function(e){this.collection=r(e.buttons,{ok:{label:this.finder.lang.OkBtn,icons:{primary:"ui-icon-check"}},okClose:{label:this.finder.lang.OkBtn,icons:{primary:"ui-icon-check"},event:"ok"},cancel:{label:this.finder.lang.CancelBtn,icons:{primary:"ui-icon-close"}}})}})}),CKFinder.define("text!CKFinder/Templates/Dialogs/DialogLayout.dot",[],function(){return'{{? it.title }}<div data-role="header" class="ui-title"><h1>{{= it.title }}</h1></div>{{?}}<div id="ckf-dialog-contents-{{= it.id }}" class="ckf-dialog-contents {{= it.contentClassName }}"></div>{{? it.hasButtons }}<div class="ui-content ckf-dialog-buttons" id="ckf-dialog-buttons-{{= it.id }}"></div>{{?}}'}),CKFinder.define("CKFinder/Modules/Dialogs/Views/DialogView",["underscore","jquery","CKFinder/Util/KeyCode","CKFinder/Views/Base/LayoutView","CKFinder/Modules/Dialogs/Views/DialogButtonsView","text!CKFinder/Templates/Dialogs/DialogLayout.dot"],function(e,t,i,n,r,o){"use strict";var s=20,a=n.extend({template:o,className:"ckf-dialog",ui:{title:".ui-title:first"},attributes:{role:"dialog"},regions:function(e){return{contents:"#ckf-dialog-contents-"+e.id,buttons:"#ckf-dialog-buttons-"+e.id}},initialize:function(){this.listenTo(this.contents,"show",function(){this.$el.trigger("create")},this),t(".ui-popup-container").remove()},onRender:function(){var t=e.uniqueId(),n="ckf-dialog-label-"+t;this.$el.attr("data-theme",this.finder.config.swatch).attr("aria-labelledby",n).attr("aria-describedby",this.regions.contents.replace("#","")).appendTo("body"),this.options.ariaLabelId&&this.$el.attr("aria-labelledby",this.$el.attr("aria-labelledby")+" "+this.regions.contents.replace("#","")),this.ui.title.attr({id:n,"aria-live":"polite"}),this.contents.show(this.getOption("innerView")),this._addButtons(),this.$el.trigger("create"),this.$el.popup(this._getUiConfig()),this.$el.parent().addClass("ui-dialog-popup");try{this.$el.popup("open",this.options.uiOpen||{})}catch(e){}this.$el.find('.ckf-dialog-buttons button[data-ckf-button="okClose"],.ckf-dialog-buttons button[data-ckf-button="ok"]').first().focus();var r=this.getOption("focusItem");if(r){var o=e.isString(r)?r:"input, textarea, select",s=this.$el.find(o).first();s.length&&s.focus()}return this.options.restrictHeight&&this.restrictHeight(),this.$el.on("keydown",function(e){e.keyCode!==i.tab&&e.stopPropagation()}),this},onDestroy:function(){try{this.$el.popup("close"),this.$el.off("keydown"),this.$el.remove()}catch(e){}},getButton:function(e){return this.$el.popup("widget").find('button[data-ckf-button="'+e+'"]')},enableButton:function(e){this.getButton(e).removeClass("ui-state-disabled").attr("aria-disabled","false")},disableButton:function(e){this.getButton(e).addClass("ui-state-disabled").attr("aria-disabled","true")},restrictHeight:function(){if(!this.isDestroyed){var e=t(window).height()-this.ui.title.outerHeight()-this.buttons.$el.outerHeight()-this.$el.parent().position().top-s;this.contents.$el.css("max-height",parseInt(e,10)+"px")}},_fixTopOffset:function(){var e=this.$el.parent().css("top"),t=parseInt(e)-(window.scrollY||window.pageYOffset);this.$el.parent().css("top",t)},_addButtons:function(){var e=this.getOption("buttons");if(e){var t=this,i=new r({finder:this.finder,buttons:e});this.listenTo(i,"childview:button",function(e){var i=e.model.get("event"),n=e.model.get("name");("cancel"===n||"okClose"===n)&&t.destroy(),t.finder.fire("dialog:"+t.getOption("name")+":"+i,t.getOption("clickData"),t.finder)}),this.buttons.show(i)}},_getUiConfig:function(){function t(e,t,i){n[e]&&n[e].apply(t,i)}var i=this,n={},r=this.getOption("uiOptions");r&&e.forEach(["create","afterclose","beforeposition"],function(e){n[e]=r[e],delete r[e]});var o={create:function(){i.contents.$el.css({minWidth:i.getOption("minWidth"),minHeight:i.getOption("minHeight"),maxHeight:window.innerHeight}),t("create",this,arguments)},afterclose:function(){i.destroy(),i.finder.fire("dialog:close:"+i.getOption("name"),{context:i.context,me:i}),t("afterclose",this,arguments)},afteropen:function(){i._fixTopOffset(),t("afteropen",this,arguments)},beforeposition:function(e,n){r&&r.positionTo&&(delete n.x,delete n.y,n.positionTo=r.positionTo),setTimeout(function(){i.options.restrictHeight&&i.restrictHeight()},0),t("beforeposition",this,arguments)}},s=i.finder.config.dialogOverlaySwatch;return s&&(o.overlayTheme=e.isBoolean(s)?i.finder.config.swatch:s),e.extend(o,r)}});return a}),CKFinder.define("CKFinder/Views/MessageView",["underscore","backbone","CKFinder/Views/Base/ItemView"],function(e,t,i){"use strict";var n=i.extend({name:"MessageView",className:"ckf-message",template:'<span id="{{= it.id }}">{{= it.msg }}</span>',initialize:function(i){this.model=new t.Model({msg:i.msg,id:i.id?i.id:e.uniqueId()})}});return n}),CKFinder.define("CKFinder/Modules/Dialogs/Dialogs",["underscore","jquery","backbone","CKFinder/Util/KeyCode","CKFinder/Modules/Dialogs/Views/DialogView","CKFinder/Views/Base/ItemView","CKFinder/Views/MessageView"],function(e,t,i,n,r,o,s){"use strict";function a(e){this.finder=e,e.setHandlers({dialog:{callback:l,context:this},"dialog:info":{callback:d,context:this},"dialog:confirm":{callback:c,context:this},"dialog:destroy":h}),e.request("key:listen",{key:n.escape}),e.on("keyup:27",function(e){var i,n;n=t(".ckf-dialog"),n.length&&(i=e.data.evt,i.preventDefault(),i.stopPropagation(),h())},null,null,20)}function l(t){var i=this.finder;if(h(),!t.name)throw"Name parameter must be specified for dialog";var n=!!e.isUndefined(t.captureFormSubmit)||t.captureFormSubmit,o=u(t,i,n),s=f(i,t,o),a=new r(s);return i.request("focus:remember"),a.on("destroy",function(){i.request("focus:restore")}),n&&a.listenTo(o,"submit:form",function(){return i.fire("dialog:"+t.name+":ok",s.clickData,i),!1}),a.render(),i.request("focus:trap",{node:a.$el}),a}function d(t){var i=e.uniqueId("ckf-message-"),n=e.extend({name:"Info",buttons:!1,view:new s({msg:t.msg,finder:this.finder,id:i}),transition:"flip",ariaLabelId:i},t);return l.call(this,n)}function c(t){var i=e.uniqueId("ckf-message-"),n=e.extend({name:"Confirm",buttons:["okClose","cancel"],title:this.finder.lang.common.messageTitle,view:new s({msg:t.msg,finder:this.finder,id:i}),ariaLabelId:i},t);return l.call(this,n)}function u(e,t,i){var n;if(e.view)n=e.view;else{var r={name:e.name,finder:t,template:e.template};i&&(r.triggers={"submit form":{event:"submit:form",preventDefault:!0,stopPropagation:!1}}),n=new(o.extend(r))({model:e.templateModel})}return n}function f(t,n,r){var o={context:n.context,finder:t,name:n.name,id:e.uniqueId("ckf"),minWidth:n.minWidth?n.minWidth:t.config.dialogMinWidth,minHeight:n.minHeight?n.minHeight:t.config.dialogMinHeight,focusItem:e.isUndefined(n.focusItem)?t.config.dialogFocusItem:n.focusItem,buttons:e.isUndefined(n.buttons)?["ok","cancel"]:n.buttons,captureFormSubmit:!!e.isUndefined(n.captureFormSubmit)||n.captureFormSubmit,restrictHeight:!e.isUndefined(n.restrictHeight)&&n.restrictHeight,uiOptions:n.uiOptions};return n.ariaLabelId&&(o.ariaLabelId=n.ariaLabelId),o.model=new i.Model({id:o.id,title:n.title,hasButtons:!e.isUndefined(o.buttons),contentClassName:e.isUndefined(n.contentClassName)?" ui-content":n.contentClassName===!1?"":" "+n.contentClassName}),o.clickData={model:n.templateModel,view:r,context:n.context},o.innerView=r,o}function h(){t(".ckf-dialog").popup("close"),t(".ui-popup-container").remove()}return a}),CKFinder.define("text!CKFinder/Templates/EditImage/EditImageLayout.dot",[],function(){return'<div class="ckf-ei-wrapper"><div id="ckf-ei-preview" class="ckf-ei-preview"></div><div id="ckf-ei-actions" class="ckf-ei-controls ui-body-{{= it.swatch }}"></div></div>'}),CKFinder.define("CKFinder/Modules/EditImage/Views/EditImageLayout",["CKFinder/Views/Base/LayoutView","text!CKFinder/Templates/EditImage/EditImageLayout.dot"],function(e,t){"use strict";return e.extend({name:"EditImageLayout",template:t,regions:{preview:"#ckf-ei-preview",actions:"#ckf-ei-actions"},templateHelpers:function(){return{swatch:this.finder.config.swatch}},onActionsExpand:function(){this.preview.$el.addClass("ckf-ei-preview-reduced")},onActionsCollapse:function(){this.preview.$el.removeClass("ckf-ei-preview-reduced")}})}),CKFinder.define("text!CKFinder/Templates/EditImage/ImagePreview.dot",[],function(){return'<canvas class="ckf-ei-canvas"></canvas>'}),CKFinder.define("CKFinder/Modules/EditImage/Views/ImagePreviewView",["CKFinder/Views/Base/ItemView","text!CKFinder/Templates/EditImage/ImagePreview.dot"],function(e,t){"use strict";return e.extend({name:"ImagePreview",template:t,ui:{canvas:".ckf-ei-canvas"}})}),CKFinder.define("text!CKFinder/Templates/EditImage/Action.dot",[],function(){return'<div data-role="collapsible" data-collapsed-icon="{{= it.icon}}" data-expanded-icon="{{= it.icon}}" data-iconpos="right" data-inset="false" tabindex="-1"><h4 id="{{= it.id }}-tab" class="ckf-ei-action-title" role="tab" aria-controls="{{= it.id }}-tabpanel">{{= it.title }}</h4><div class="ckf-ei-action-controls"></div></div>'}),CKFinder.define("CKFinder/Modules/EditImage/Views/ActionView",["underscore","jquery","CKFinder/Util/KeyCode","CKFinder/Views/Base/LayoutView","text!CKFinder/Templates/EditImage/Action.dot"],function(e,t,i,n,r){"use strict";return n.extend({name:"ActionView",template:r,className:"ckf-ei-action",ui:{heading:".ckf-ei-action-title",controls:".ckf-ei-action-controls"},regions:{action:".ckf-ei-action-controls"},events:{collapsiblecollapse:function(){this.model.get("tool").trigger("collapse"),this.ui.heading.attr("aria-expanded","false").find(".ui-btn").removeClass("ui-btn-active"),this.trigger("collapse"),this.isExpanded=!1,this.ui.controls.find("[tabindex]").attr("tabindex","-1")},collapsibleexpand:function(){this.model.get("tool").trigger("expand"),this.ui.heading.attr("aria-expanded","true").find(".ui-btn").addClass("ui-btn-active"),this.trigger("expand"),this.isExpanded=!0,this.ui.controls.find("[tabindex]").attr("tabindex",this.model.get("tabindex"))},collapsiblecreate:function(){this.$el.find(".ui-collapsible-heading-toggle").attr("tabindex",this.model.get("tabindex")),this.ui.heading.attr("aria-expanded","false"),this.isExpanded=!1;var e=this.model.get("id");this.$el.find(".ui-collapsible-content").attr({id:e+"-tabpanel",role:"tabpanel","aria-labelledby":e+"-tab"})},"keydown .ui-collapsible-heading-toggle":function(e){if(e.keyCode===i.space||e.keyCode===i.enter){e.stopPropagation(),e.preventDefault();var t=this.$el.find(".ui-collapsible").collapsible("option","collapsed")?"expand":"collapse";this.$el.find(".ui-collapsible").collapsible(t)}},"keydown [tabindex]":function(e){e.keyCode===i.tab&&(!this.isExpanded&&e.target===this.ui.heading.find(".ui-collapsible-heading-toggle").get(0)||this.ui.controls.find("[tabindex]").last().get(0)===e.target)&&this.trigger("tabRequest",e)}},initialize:function(){this.model.set("id",e.uniqueId())},collapse:function(){this.$el.find(".ui-collapsible").collapsible("collapse")},onRender:function(){this.action.show(this.model.get("tool").getView(this.finder)),this.$el.attr("data-ckf-ei-tool",this.model.get("tool").get("name"))}})}),CKFinder.define("CKFinder/Modules/EditImage/Views/ActionsView",["jquery","CKFinder/Views/Base/CollectionView","CKFinder/Modules/EditImage/Views/ActionView"],function(e,t,i){"use strict";function n(t,i){var n="desktop"===t;e(".ckf-ei-controls .ui-collapsible-heading-toggle").toggleClass("ui-corner-all ui-btn-icon-notext",!n).toggleClass("ltr"===i.lang.dir?"ui-btn-icon-left":"right",n)}function r(e){e.data.modeChanged&&n(e.data.mode,e.finder)}return t.extend({name:"ActionsView",attributes:{"data-role":"collapsibleset",role:"tablist"},childView:i,childViewContainer:"#ckf-edit-image-actions",childEvents:{expand:function(e){this.children.forEach(function(t){t.cid===e.cid||t.ui.heading.hasClass("ui-collapsible-heading-collapsed")||t.collapse()})},tabRequest:function(e,t){this.finder.util.isShortcut(t,"")&&this.children.last()!==e&&this.finder.request("focus:next",{node:e.$el.find("[tabindex]").not('[tabindex="-1"]').last(),event:t})}},initialize:function(){var t=this.finder;this.collection.on("imageData:ready",function(){n(t.request("ui:getMode"),t),e.mobile.resetActivePageHeight()}),t.on("ui:resize",r)},onDestroy:function(){this.finder.removeListener("ui:resize",r)},focusFirst:function(){this.$el.find(".ui-collapsible-heading-toggle").first().focus()}})}),CKFinder.define("CKFinder/Modules/EditImage/Models/EditImageData",["backbone"],function(e){"use strict";var t=e.Model.extend({defaults:{file:null,caman:null,imagePreview:"",fullImagePreview:"",actions:null},initialize:function(){this.set("actions",new e.Collection)}});return t}),CKFinder.define("CKFinder/Modules/EditImage/Tools/Tool",["backbone"],function(e){"use strict";return e.Model.extend({getActionData:function(){return new e.Model({})},saveDeferred:function(e,t){return t},getView:function(e){var t=this.get("viewClass"),i=new t({finder:e,model:this.getActionData()});return this.set("view",i),i}})}),CKFinder.define("text!CKFinder/Templates/EditImage/Crop.dot",[],function(){return'<div class="ckf-ei-crop-controls-inputs"><label>{{= it.lang.EditImage.keepAspectRatio }}<input name="ckfCropKeepAspectRatio" tabindex="{{= it.tabindex }}" type="checkbox"{{? it.keepAspectRatio }} checked="checked"{{?}} data-iconpos="{{? it.lang.dir == \'ltr\'}}left{{??}}right{{?}}"></label><button id="ckf-ei-crop-apply" tabindex="{{= it.tabindex }}" data-icon="ckf-tick" data-iconpos="{{? it.lang.dir == \'ltr\'}}left{{??}}right{{?}}">{{= it.lang.EditImage.apply }}</button></div>'}),CKFinder.define("CKFinder/Modules/EditImage/Views/CropView",["CKFinder/Util/KeyCode","CKFinder/Views/Base/ItemView","text!CKFinder/Templates/EditImage/Crop.dot"],function(e,t,i){"use strict";return t.extend({name:"CropView",template:i,className:"ckf-ei-crop-controls",ui:{keepAspectRatio:'input[name="ckfCropKeepAspectRatio"]',apply:"#ckf-ei-crop-apply"},triggers:{"click @ui.apply":"apply"},events:{"change @ui.keepAspectRatio":function(e){e.stopPropagation(),e.preventDefault(),this.model.set("keepAspectRatio",this.ui.keepAspectRatio.is(":checked"))},"keyup @ui.keepAspectRatio":function(t){(t.keyCode===e.space||t.keyCode===e.enter)&&(t.preventDefault(),t.stopPropagation(),this.ui.keepAspectRatio.prop("checked",!this.ui.keepAspectRatio.is(":checked")).checkboxradio("refresh").trigger("change"))},"keydown @ui.apply":function(t){(t.keyCode===e.space||t.keyCode===e.enter)&&this.trigger("apply")}}})}),CKFinder.define("text!CKFinder/Templates/EditImage/CropBox.dot",[],function(){return'<div class="ckf-ei-crop"><div class="ckf-ei-crop-resize" tabindex="{{= it.tabindex + 1 }}"></div><div class="ckf-ei-crop-info"></div></div>'}),CKFinder.define("CKFinder/Modules/EditImage/Views/CropBoxView",["jquery","CKFinder/Views/Base/ItemView","text!CKFinder/Templates/EditImage/CropBox.dot"],function(e,t,i){"use strict";var n=t.extend({name:"CropView",className:"ckf-ei-crop-wrap",template:i,ui:{cropBox:".ckf-ei-crop",cropResize:".ckf-ei-crop-resize",cropInfo:".ckf-ei-crop-info"},events:{"vmousedown @ui.cropBox":"onMouseDown","vmouseup @ui.cropBox":"onMouseUp","vmousedown @ui.cropResize":"onMouseDownOnResize","vmouseup @ui.cropResize":"onMouseUpOnResize"},modelEvents:{change:"updatePosition","change:keepAspectRatio":function(){if(this.model.get("keepAspectRatio")){var e=this.model.get("renderHeight"),t=this.model.get("maxRenderHeight"),i=this.model.get("maxRenderWidth"),n=t-this.model.get("renderY"),r=i-this.model.get("renderX");e>n&&(e=n);var o=parseInt(e*i/t,10);o>r&&(o=r,e=parseInt(o*t/i,10)),this.model.set({renderWidth:o,renderHeight:e})}}},onRender:function(){var e;e=this.model.get("canvas"),this.$el.css({width:this.model.get("maxRenderWidth"),height:this.model.get("maxRenderHeight")}),this.ui.cropBox.css({backgroundImage:"url("+e.toDataURL()+")",backgroundSize:this.model.get("maxRenderWidth")+"px "+this.model.get("maxRenderHeight")+"px"}),this.updatePosition()},onMouseDown:function(t){var i=this;t.stopPropagation(),e(window).on("vmousemove",{model:i.model,view:i,moveStart:{x:t.clientX-i.model.get("renderX"),y:t.clientY-i.model.get("renderY")}},i.mouseMove),e(window).one("vmouseup",function(){i.onMouseUp()})},onMouseUp:function(t){t&&t.stopPropagation(),e(window).off("vmousemove",this.mouseMove)},mouseMove:function(e){var t,i,n,r,o,s,a,l;t=e.data.model,i=e.data.view.ui.cropBox,n=e.clientX-e.data.moveStart.x,r=e.clientY-e.data.moveStart.y,o=i.outerWidth(),s=i.outerHeight(),a=t.get("maxRenderWidth")-o,l=t.get("maxRenderHeight")-s,n=0>n?0:n,r=0>r?0:r,n=n>a?a:n,r=r>l?l:r,t.set({renderX:n,renderY:r})},onMouseDownOnResize:function(t){var i=this;t.stopPropagation(),e(window).on("vmousemove",{model:i.model,view:i,moveStart:{x:t.clientX-i.model.get("renderWidth"),y:t.clientY-i.model.get("renderHeight")}},i.mouseResize),e(window).one("vmouseup",function(){i.onMouseUpOnResize()})},onMouseUpOnResize:function(){e(window).off("vmousemove",this.mouseResize)},mouseResize:function(e){var t,i,n,r,o,s;t=e.data.model,i=t.get("minCrop"),n=e.clientX-e.data.moveStart.x,r=e.clientY-e.data.moveStart.y,o=t.get("maxRenderWidth")-t.get("renderX"),s=t.get("maxRenderHeight")-t.get("renderY"),r=i>r?i:r,n=i>n?i:n,t.get("keepAspectRatio")&&(n=parseInt(r*t.get("maxRenderWidth")/t.get("maxRenderHeight"),10)),n=n>o?o:n,r=r>s?s:r,t.set({renderWidth:n,renderHeight:r})},updatePosition:function(){var e=this.model.get("renderX"),t=this.model.get("renderY"),i=(this.ui.cropBox.outerWidth()-this.ui.cropBox.width())/2;this.ui.cropBox.css({top:t+"px",left:e+"px",width:this.model.get("renderWidth")-2*i+"px",height:this.model.get("renderHeight")-2*i+"px",backgroundPosition:-e-i+"px "+(-t-i)+"px"}),this.ui.cropInfo.text(this.model.get("width")+"x"+this.model.get("height")),this.ui.cropInfo.attr("data-ckf-position",this.model.get("x")+","+this.model.get("y"))}});return n}),CKFinder.define("CKFinder/Modules/EditImage/Tools/CropTool",["backbone","jquery","CKFinder/Modules/EditImage/Tools/Tool","CKFinder/Modules/EditImage/Views/CropView","CKFinder/Modules/EditImage/Views/CropBoxView"],function(e,t,i,n,r){"use strict";return i.extend({defaults:{name:"Crop",viewClass:n,view:null,isVisible:!1},initialize:function(){function i(e){var t,i,n;n=e.get("renderWidth"),i=e.get("renderHeight"),t=e.get("imageWidth")/e.get("maxRenderWidth"),e.set("width",parseInt(n*t,10)),e.set("height",parseInt(i*t,10)),e.set("x",parseInt(e.get("renderX")*t,10)),e.set("y",parseInt(e.get("renderY")*t,10))}function n(){r.get("isVisible")&&(r.closeCropBox(),r.openCropBox())}this.viewModel=new e.Model({x:0,y:0,width:0,height:0,renderWidth:0,renderHeight:0,maxWidth:0,maxHeight:0,imageWidth:0,imageHeight:0,keepAspectRatio:!1,tabindex:this.get("tabindex")}),this.viewModel.on("change:renderWidth",i),this.viewModel.on("change:renderHeight",i),this.viewModel.on("change:renderX",i),this.viewModel.on("change:renderY",i),this.collection.on("imageData:ready",function(){var e,i,n,r,o,s;e=this.get("editImageData"),s=e.get("caman").renderingCanvas,i=t(s).width(),n=t(s).height(),r=parseInt(i/2,10),o=parseInt(n/2,10),this.viewModel.set({canvas:e.get("caman").renderingCanvas,minCrop:10,x:e.get("imageWidth"),y:e.get("imageHeight"),renderX:parseInt((i-r)/2,10),renderY:parseInt((n-o)/2,10),width:e.get("imageWidth"),height:e.get("imageHeight"),renderWidth:r,renderHeight:o,maxRenderWidth:i,maxRenderHeight:n,imageWidth:e.get("imageInfo").width,imageHeight:e.get("imageInfo").height}),this.get("view").on("apply",function(){this.cropView()},this)},this),this.on("expand",this.openCropBox,this),this.on("collapse",this.closeCropBox,this);var r=this;this.collection.on("tool:reset:after",n),this.collection.on("ui:resize",n)},cropView:function(){var e=this.get("editImageData"),t=e.get("caman").renderingCanvas,i=t.width/this.viewModel.get("maxRenderWidth");e.get("caman").crop(parseInt(i*this.viewModel.get("renderWidth"),10),parseInt(i*this.viewModel.get("renderHeight"),10),parseInt(i*this.viewModel.get("renderX"),10),parseInt(i*this.viewModel.get("renderY"),10)),this.collection.requestThrottler();var n=!1;e.get("actions").forEach(function(e){"Rotate"===e.get("tool")&&(n=!n)}),i=(n?e.get("imageHeight"):e.get("imageWidth"))/this.viewModel.get("maxRenderWidth"),e.get("actions").push({tool:this.get("name"),data:{width:parseInt(i*this.viewModel.get("renderWidth"),10),height:parseInt(i*this.viewModel.get("renderHeight"),10),x:parseInt(i*this.viewModel.get("renderX"),10),y:parseInt(i*this.viewModel.get("renderY"),10)}}),this.closeCropBox()},openCropBox:function(){var e=this.get("editImageData").get("caman").renderingCanvas,i=t(e).width(),n=t(e).height(),o=parseInt(i/2,10),s=parseInt(n/2,10);this.viewModel.set({maxRenderWidth:i,maxRenderHeight:n,renderWidth:o,renderHeight:s,renderX:parseInt((i-o)/2,10),renderY:parseInt((n-s)/2,10)}),this.cropBox=new r({finder:this.collection.finder,model:this.viewModel}),this.cropBox.render().$el.appendTo(t(this.get("editImageData").get("caman").renderingCanvas).parent()),this.set("isVisible",!0)},closeCropBox:function(){this.cropBox&&this.cropBox.destroy(),this.set("isVisible",!1)},saveDeferred:function(e,i){var n,r;return n=new t.Deferred,r=n.promise(),i.then(function(t){t.crop(e.width,e.height,e.x,e.y).render(function(){n.resolve(this)})}),r},getActionData:function(){return this.viewModel}})}),CKFinder.define("text!CKFinder/Templates/EditImage/Rotate.dot",[],function(){return'<div class="ckf-ei-rotate-controls-inputs"><button id="ckf-ei-rotate-anticlockwise" tabindex="{{= it.tabindex }}" data-icon="ckf-rotate-left" data-iconpos="{{? it.lang.dir == \'ltr\'}}left{{??}}right{{?}}">{{= it.lang.EditImage.rotateAntiClockwise }}</button><button id="ckf-ei-rotate-clockwise" tabindex="{{= it.tabindex }}" data-icon="ckf-rotate-right" data-iconpos="{{? it.lang.dir == \'ltr\'}}left{{??}}right{{?}}">{{= it.lang.EditImage.rotateClockwise }}</button></div>'}),CKFinder.define("CKFinder/Modules/EditImage/Views/RotateView",["CKFinder/Util/KeyCode","CKFinder/Views/Base/ItemView","text!CKFinder/Templates/EditImage/Rotate.dot"],function(e,t,i){"use strict";return t.extend({name:"RotateView",template:i,ui:{clockwise:"#ckf-ei-rotate-clockwise",antiClockwise:"#ckf-ei-rotate-anticlockwise"},events:{"click @ui.clockwise":"onClockwise","click @ui.antiClockwise":"onAntiClockwise","keydown @ui.clockwise":function(t){(t.keyCode===e.space||t.keyCode===e.enter)&&this.onClockwise()},"keydown @ui.antiClockwise":function(t){(t.keyCode===e.space||t.keyCode===e.enter)&&this.onAntiClockwise()}},onClockwise:function(){this.model.unset("lastRotationAngle",{silent:!0}),this.model.set("lastRotationAngle",90)},onAntiClockwise:function(){this.model.unset("lastRotationAngle",{silent:!0}),this.model.set("lastRotationAngle",-90)}})}),CKFinder.define("CKFinder/Modules/EditImage/Tools/RotateTool",["jquery","backbone","CKFinder/Modules/EditImage/Tools/Tool","CKFinder/Modules/EditImage/Views/RotateView"],function(e,t,i,n){"use strict";return i.extend({defaults:{name:"Rotate",viewClass:n,view:null,rotationApplied:!1},initialize:function(){function e(){var e=i.get("editImageData").get("actions");e.remove(e.where({tool:i.get("name")})),i.viewModel.set("angle",0),i.viewModel.set("lastRotationAngle",0)}var i=this;this.viewModel=new t.Model({angle:0,lastRotationAngle:0,tabindex:this.get("tabindex")}),this.viewModel.on("change:lastRotationAngle",function(e,t){this.get("editImageData").get("actions").push({tool:this.get("name"),data:t}),this.set("rotationApplied",!1),this.collection.requestThrottler()},this),this.collection.on("throttle",function(e){this.get("rotationApplied")||(e.rotate(this.viewModel.get("lastRotationAngle")),e.render(),this.set("rotationApplied",!0))},this),this.collection.on("tool:reset:"+this.get("name"),e),this.collection.on("tool:reset:all",e)},saveDeferred:function(t,i){var n,r;return n=new e.Deferred,r=n.promise(),i.then(function(e){e.rotate(t).render(function(){n.resolve(this)})}),r},getActionData:function(){return this.viewModel}})}),CKFinder.define("text!CKFinder/Templates/EditImage/Adjust.dot",[],function(){return'{{~ it.filters: filter }}<div class="ckf-ei-filter"><label class="ckf-ei-filter-icon ui-btn ui-btn-icon-left ui-icon-{{= filter.icon }}" for="{{= filter.name }}">{{= filter.label }}</label><input class="ckf-ei-filter-slider" name="{{= filter.name }}" id="{{= filter.name }}" min="{{= filter.config.min }}" max="{{= filter.config.max }}" step="{{= filter.config.step }}" value="{{= filter.config.init }}" type="range" data-filter="{{= filter.name }}" data-initial="{{= filter.config.init }}" tabindex="{{= it.tabindex }}"></div>{{~}}'}),CKFinder.define("CKFinder/Modules/EditImage/Views/AdjustView",["jquery","backbone","CKFinder/Views/Base/ItemView","text!CKFinder/Templates/EditImage/Adjust.dot"],function(e,t,i,n){"use strict";var r=100;return i.extend({isSliding:!1,applyFilterInterval:null,lastFilterEvent:null,name:"AdjustView",template:n,events:{"slidestart .ckf-ei-filter-slider":"onSlideStart","slidestop .ckf-ei-filter-slider":"onSlideStop","change .ckf-ei-filter-slider":"onFilter","keyup .ckf-ei-filter-slider":"onFilter"},initialize:function(){this.model.get("activeFilters").on("reset",function(){this.render()},this)},onSlideStart:function(){this.isSliding=!0},onSlideStop:function(e){this.isSliding=!1,this.applyFilters(e)},onRender:function(){this.$el.trigger("create")},onFilter:function(e){var t=this;t.isSliding||(this.lastFilterEvent=e,this.applyFilterInterval||(this.applyFilterInterval=setInterval(function(){Date.now()-t.lastFilterEvent.timeStamp>100&&(t.applyFilters(t.lastFilterEvent),clearInterval(t.applyFilterInterval),t.applyFilterInterval=null)},r)))},applyFilters:function(i){var n,r,o;o=this.model.get("activeFilters"),r=e(i.currentTarget).data("filter"),n=o.where({filter:r})[0],n||(n=new t.Model({filter:r}),o.push(n)),n.set("value",e(i.currentTarget).val())}})}),CKFinder.define("CKFinder/Modules/EditImage/Tools/AdjustTool",["jquery","backbone","underscore","CKFinder/Modules/EditImage/Tools/Tool","CKFinder/Modules/EditImage/Views/AdjustView"],function(e,t,i,n,r){"use strict";return n.extend({defaults:function(){var e=this.collection.finder.config,t=[{name:"brightness",icon:"ckf-brightness",config:{min:-100,max:100,step:1,init:0}},{name:"contrast",icon:"ckf-contrast",config:{min:-100,max:100,step:1,init:0}},{name:"saturation",icon:"ckf-saturation",config:{min:-100,max:100,step:1,init:0}},{name:"vibrance",icon:"ckf-vibrance",config:{min:-100,max:100,step:1,init:0}},{name:"exposure",icon:"ckf-exposure",config:{min:-100,max:100,step:1,init:0}},{name:"hue",icon:"ckf-hue",config:{min:0,max:100,step:1,init:0}},{name:"sepia",icon:"ckf-sepia",config:{min:0,max:100,step:1,init:0}},{name:"gamma",icon:"ckf-gamma",config:{min:0,max:10,step:.1,init:1}},{name:"noise",icon:"ckf-noise",config:{min:0,max:100,step:1,init:0}},{name:"clip",icon:"ckf-clip",
config:{min:0,max:100,step:1,init:0}},{name:"sharpen",icon:"ckf-sharpen",config:{min:0,max:100,step:1,init:0}},{name:"stackBlur",icon:"ckf-blur",config:{min:0,max:20,step:1,init:0}}],n=i.filter(t,function(t){return i.contains(e.editImageAdjustments,t.name)});return{name:"Adjust",viewClass:r,view:null,filters:n}},initialize:function(){function e(){var e=i.get("editImageData").get("actions");e.remove(e.where({tool:i.get("name")})),n.reset()}var i=this,n=new t.Collection;n.on("add",function(){i.collection.resetTool("Presets")}),i.collection.on("tool:reset:"+i.get("name"),e),i.collection.on("tool:reset:all",e),n.on("change",function(){var e,n,r,o;o=i.get("editImageData"),r=o.get("actions"),n=r.where({tool:i.get("name")})[0],e=this.toJSON(),n||(n=new t.Model({tool:i.get("name")}),r.push(n)),n.set("data",e),i.collection.requestThrottler()});var r=new t.Model({filters:this.get("filters"),activeFilters:n,tabindex:this.get("tabindex")});this.on("change:editImageData",function(e,t){r.set("file",t.get("file"))}),this.collection.on("throttle",function(e){n.length&&n.clone().forEach(function(t){e[t.get("filter")](parseFloat(t.get("value")))})}),this.viewModel=r,this.activeFilters=n},getActionData:function(){return this.viewModel},saveDeferred:function(t,i){var n=new e.Deferred,r=n.promise();return i.then(function(i){e.each(t,function(e,t){i[t.filter](parseFloat(t.value))}),i.render(function(){n.resolve(this)})}),r}})}),CKFinder.define("text!CKFinder/Templates/EditImage/Presets.dot",[],function(){return'{{~ it.presets: preset }}<button class="ckf-ei-preset" data-preset="{{= preset.name }}" tabindex="{{= it.tabindex }}"><img class="ckf-ei-preset-preview" alt="{{= preset.label }}" /> {{= preset.label }}</button>{{~}}'}),CKFinder.define("CKFinder/Modules/EditImage/Views/PresetsView",["underscore","jquery","CKFinder/Util/KeyCode","CKFinder/Views/Base/ItemView","text!CKFinder/Templates/EditImage/Presets.dot"],function(e,t,i,n,r){"use strict";var o=240,s=80;return n.extend({name:"PresetsView",template:r,events:{"click .ckf-ei-preset":"onPreset","keydown .ckf-ei-preset":function(e){(e.keyCode===i.space||e.keyCode===i.enter)&&this.onPreset(e)}},onRender:function(){function i(){if(u.length){var e,r;e=t(u.shift()),r=e.data("preset"),l("#"+d,n,function(){this.revert(!1),this[r]().render(function(){e.find("img").attr("src",this.toBase64()),i()})})}else c.remove()}var n,r=this.model.get("file");if(this.finder.config.initConfigInfo.thumbs){var a;e.forEach(this.finder.config.initConfigInfo.thumbs,function(e){var t=parseInt(e.split("x")[0]);!a&&t>=o&&(a=t)}),a&&(n=this.finder.request("file:getThumb",{file:r}))}n&&this.finder.config.initConfigInfo.thumbs||(n=this.finder.request("image:previewUrl",{file:r,maxWidth:o,maxHeight:s,noCache:!0}));var l=this.model.get("Caman"),d=e.uniqueId("ckf-"),c=t("<canvas>").attr("id",d).attr("width",o).attr("height",o).css("display","none").appendTo("body"),u=this.$el.find(".ckf-ei-preset").toArray();i()},onPreset:function(e){this.model.set("active",t(e.currentTarget).data("preset"))}})}),CKFinder.define("CKFinder/Modules/EditImage/Tools/PresetsTool",["jquery","underscore","backbone","CKFinder/Modules/EditImage/Tools/Tool","CKFinder/Modules/EditImage/Views/PresetsView"],function(e,t,i,n,r){"use strict";return n.extend({defaults:function(){var e,i,n;return e=this.collection.finder.config,i=[{name:"clarity"},{name:"concentrate"},{name:"crossProcess"},{name:"glowingSun"},{name:"grungy"},{name:"hazyDays"},{name:"hemingway"},{name:"herMajesty"},{name:"jarques"},{name:"lomo"},{name:"love"},{name:"nostalgia"},{name:"oldBoot"},{name:"orangePeel"},{name:"pinhole"},{name:"sinCity"},{name:"sunrise"},{name:"vintage"}],n=t.filter(i,function(i){return t.contains(e.editImagePresets,i.name)}),{name:"Presets",viewClass:r,view:null,presets:n}},initialize:function(){function e(){var e=t.get("editImageData").get("actions");n.set("active",null),e.remove(e.where({tool:t.get("name")}))}var t=this,n=new i.Model({Caman:this.get("Caman"),active:null,presets:this.get("presets"),tabindex:this.get("tabindex")});n.on("change:active",function(e,i){var n,r;i&&(t.collection.resetTool("Adjust"),n=t.get("editImageData"),r=n.get("actions"),r.remove(r.where({tool:t.get("name")})),r.push({tool:t.get("name"),data:i}),t.collection.requestThrottler())}),t.collection.on("throttle",function(e){var i=t.viewModel.get("active");i&&e[i]()}),t.collection.on("tool:reset:"+t.get("name"),e),t.collection.on("tool:reset:all",e),this.on("change:editImageData",function(e,t){n.set("file",t.get("file"))}),this.viewModel=n},saveDeferred:function(t,i){var n,r;return n=new e.Deferred,r=n.promise(),i.then(function(e){e[t]().render(function(){n.resolve(this)})}),r},getActionData:function(){return this.viewModel}})}),CKFinder.define("text!CKFinder/Templates/EditImage/Resize.dot",[],function(){return'<div class="ui-grid-a"><div class="ckf-ei-resize-controls-inputs"><input name="ckfResizeWidth" value="{{= it.displayWidth }}" tabindex="{{= it.tabindex }}"><p class="ckf-ei-resize-controls-text">x</p><input name="ckfResizeHeight" value="{{= it.displayHeight }}" tabindex="{{= it.tabindex }}"><p class="ckf-ei-resize-controls-text">{{= it.lang.PixelShort}}</p></div></div><label>{{= it.lang.EditImage.keepAspectRatio }}<input type="checkbox" tabindex="{{= it.tabindex }}" name="ckfResizeKeepAspectRatio" {{? it.keepAspectRatio }}checked="checked"{{?}} data-iconpos="{{? it.lang.dir == \'ltr\'}}left{{??}}right{{?}}"></label><button id="ckf-ei-resize-apply" tabindex="{{= it.tabindex }}" data-icon="ckf-tick" data-iconpos="{{? it.lang.dir == \'ltr\'}}left{{??}}right{{?}}">{{= it.lang.EditImage.apply }}</button>'}),CKFinder.define("CKFinder/Modules/EditImage/Views/ResizeView",["CKFinder/Util/KeyCode","CKFinder/Views/Base/ItemView","text!CKFinder/Templates/EditImage/Resize.dot"],function(e,t,i){"use strict";return t.extend({name:"ResizeView",template:i,className:"ckf-ei-resize-controls",ui:{width:'input[name="ckfResizeWidth"]',height:'input[name="ckfResizeHeight"]',keepAspectRatio:'input[name="ckfResizeKeepAspectRatio"]',apply:"#ckf-ei-resize-apply"},triggers:{"click @ui.apply":"apply"},events:{"change @ui.width":"onWidth","change @ui.height":"onHeight","change @ui.keepAspectRatio":"onAspectRatio","keyup @ui.keepAspectRatio":function(t){(t.keyCode===e.space||t.keyCode===e.enter)&&(t.preventDefault(),t.stopPropagation(),this.ui.keepAspectRatio.prop("checked",!this.ui.keepAspectRatio.is(":checked")).checkboxradio("refresh").trigger("change"))},"keydown @ui.apply":function(t){(t.keyCode===e.space||t.keyCode===e.enter)&&this.trigger("apply")}},modelEvents:{"change:realWidth":"render","change:displayWidth":"setWidth","change:displayHeight":"setHeight"},onRender:function(){this.$el.trigger("create")},onAspectRatio:function(){var e=this.ui.keepAspectRatio.is(":checked");this.model.set("keepAspectRatio",e),e&&this.onWidth()},onWidth:function(){if(!this.dontRender){var e=this.model.get("displayWidth");if(!(0>e)){var t=parseInt(this.ui.width.val(),10);(isNaN(t)||0>=t)&&(t=1);var i=this.model.get("realWidth");t>i&&(t=i);var n=this.model.get("displayHeight");if(this.model.get("keepAspectRatio")){var r=i/this.model.get("realHeight");n=parseInt(t/r,10)}0>=n&&(n=1),this.updateSizes(t,n)}}},onHeight:function(){if(!this.dontRender){var e=this.model.get("displayHeight");if(!(0>e)){var t=parseInt(this.ui.height.val(),10),i=this.model.get("realHeight");(isNaN(t)||0>=t)&&(t=1),t>i&&(t=i);var n=this.model.get("displayWidth");if(this.model.get("keepAspectRatio")){var r=this.model.get("realWidth")/i;n=parseInt(t*r,10)}0>=n&&(n=1),this.updateSizes(n,t)}}},updateSizes:function(e,t){this.model.set({displayWidth:e,displayHeight:t}),this.dontRender=!0,this.ui.width.val(e),this.ui.height.val(t),this.dontRender=!1},setWidth:function(){this.ui.width.val(this.model.get("displayWidth"))},setHeight:function(){this.ui.height.val(this.model.get("displayHeight"))},focusButton:function(){this.ui.apply.focus()}})}),CKFinder.define("CKFinder/Modules/EditImage/Tools/ResizeTool",["jquery","backbone","CKFinder/Modules/EditImage/Tools/Tool","CKFinder/Modules/EditImage/Views/ResizeView"],function(e,t,i,n){"use strict";var r=t.Model.extend({defaults:{realWidth:-1,realHeight:-1,displayWidth:-1,displayHeight:-1,renderWidth:-1,renderHeight:-1,maxRenderWidth:-1,maxRenderHeight:-1,keepAspectRatio:!0}});return i.extend({defaults:{name:"Resize",viewClass:n,view:null},initialize:function(){this.viewModel=new r({tabindex:this.get("tabindex")}),this.collection.on("imageData:ready",function(){var e=this.get("editImageData");this.viewModel.set({realWidth:e.get("imageWidth"),realHeight:e.get("imageHeight"),displayWidth:e.get("imageWidth"),displayHeight:e.get("imageHeight"),renderWidth:e.get("renderWidth"),renderHeight:e.get("renderHeight"),maxRenderWidth:e.get("renderWidth"),maxRenderHeight:e.get("renderHeight")}),this.get("view").on("apply",function(){this.resizeView()},this)},this),this.collection.on("tool:reset:all",function(){var e,t;e=this.get("editImageData"),t=e.get("imageInfo"),this.viewModel.set({realWidth:t.width,realHeight:t.height,displayWidth:t.width,displayHeight:t.height,renderWidth:e.get("renderWidth"),renderHeight:e.get("renderHeight"),maxRenderWidth:e.get("renderWidth"),maxRenderHeight:e.get("renderHeight")})},this)},resizeView:function(){var e,t,i,n=this.viewModel,r=this.get("editImageData"),o=n.get("displayWidth"),s=n.get("displayHeight"),a=n.get("maxRenderWidth"),l=n.get("maxRenderHeight");s>l||o>a?(e=s>o?l/s:a/o,t=parseInt(e*s,10),i=parseInt(e*o,10)):(i=o,t=s),n.set({realWidth:o,realHeight:s}),r.get("actions").push({tool:this.get("name"),data:{width:o,height:s}}),r.set({imageWidth:o,imageHeight:s}),r.get("caman").resize({width:i,height:t}),this.collection.requestThrottler(),this.get("view").focusButton()},saveDeferred:function(t,i){var n=new e.Deferred,r=n.promise();return i.then(function(e){e.resize({width:t.width,height:t.height}).render(function(){n.resolve(this)})}),r},getActionData:function(){return this.viewModel}})}),CKFinder.define("CKFinder/Modules/EditImage/Tools",["underscore","jquery","backbone","CKFinder/Modules/EditImage/Tools/CropTool","CKFinder/Modules/EditImage/Tools/RotateTool","CKFinder/Modules/EditImage/Tools/AdjustTool","CKFinder/Modules/EditImage/Tools/PresetsTool","CKFinder/Modules/EditImage/Tools/ResizeTool"],function(e,t,i,n,r,o,s,a){"use strict";return i.Collection.extend({initialize:function(){this.needRender=!1,this.isRendering=!1,this.on("add",function(e){e.set("name",e.get("tool").get("name"))})},setupDefault:function(t,i){this.finder=t,this.Caman=i;var l=40;this.add({title:t.lang.EditImage.resize,icon:"ckf-resize",tool:new a({tabindex:l},{collection:this}),tabindex:l}),this.add({title:t.lang.EditImage.crop,icon:"ckf-crop",tool:new n({tabindex:l+=10},{collection:this}),tabindex:l}),this.add({title:t.lang.EditImage.rotate,icon:"ckf-rotate",tool:new r({tabindex:l+=10},{collection:this}),tabindex:l});var d=t.config.editImageAdjustments;if(d&&d.length){var c=new o({tabindex:l+=10},{collection:this});this.add({title:t.lang.EditImage.adjust,icon:"ckf-adjust",tool:c,tabindex:l}),e.forEach(c.get("filters"),function(e){e.label=t.lang.EditImage.filters[e.name]})}var u=t.config.editImagePresets;if(u&&u.length){var f=new s({Caman:i,tabindex:l+=10},{collection:this});this.add({title:t.lang.EditImage.presets,icon:"ckf-presets",tool:f,tabindex:l}),e.forEach(f.get("presets"),function(e){e.label=t.lang.EditImage.preset[e.name]})}return this},setImageData:function(e){this.editImageData=e,e.on("change:renderHeight",function(){this.checkReady()},this),this.forEach(function(t){t.get("tool").set("editImageData",e)})},setImageInfo:function(e){this.editImageData.set("imageInfo",e),this.editImageData.set("imageWidth",e.width),this.editImageData.set("imageHeight",e.height),this.checkReady()},checkReady:function(){this.editImageData&&this.editImageData.has("imageInfo")&&this.editImageData.has("renderWidth")&&this.trigger("imageData:ready")},resetTool:function(e){var t;e?this.trigger("tool:reset:"+e):(this.trigger("tool:reset:all"),t=this.editImageData.get("caman"),t.reset(),t.render(),this.editImageData.get("actions").reset()),this.trigger("tool:reset:after")},doSave:function(i){var n=this,r=e.uniqueId("edit-image-canvas"),o=t("<canvas>").attr("id",r).css("display","none").appendTo("body"),s=this.editImageData.get("actions"),a=this.Caman,l=new t.Deferred,d=new t.Deferred,c=l.promise();return a("#"+r,i,function(){var e=this,t=s.findWhere({tool:"Adjust"});t&&(s.remove(t),s.push(t));var i=s.findWhere({tool:"Presets"});i&&(s.remove(i),s.push(i)),s.forEach(function(e){var t=this.findWhere({name:e.get("tool")}).get("tool");c=t.saveDeferred(e.get("data"),c)},n),c.then(function(){d.resolve(e.toBase64()),o.remove()}),l.resolve(e)}),d.promise()},requestThrottler:function(){var e=this;this.needRender=!0,this.throttleID||(this.throttleID=setInterval(function(){if(e.needRender&&!e.isRendering){e.isRendering=!0;var t=e.editImageData.get("caman");try{t.revert(!1)}catch(e){}e.trigger("throttle",t),t.render(function(){return!1}),e.isRendering=!1,e.needRender=!1}},200))},destroy:function(){this.throttleID&&clearInterval(this.throttleID)},hasDataToSave:function(){return!!this.editImageData.get("actions").length}})}),CKFinder.define("CKFinder/Common/Models/ProgressModel",["backbone"],function(e){"use strict";var t=e.Model.extend({defaults:{state:"ok",message:"",value:0},stateOk:function(){this.set("state","ok")},stateError:function(){this.set("state","error")},stateIndeterminate:function(){this.set("state","indeterminate")}});return t}),CKFinder.define("CKFinder/Modules/EditImage/Models/ProgressModel",["CKFinder/Common/Models/ProgressModel"],function(e){"use strict";var t=e.extend({defaults:{value:0,state:"ok",message:"",eta:"",speed:"",bytes:0,bytesTotal:0,time:0,transfer:""},initialize:function(){this.on("change",function(e){var t,i;if(e.changed.time&&(t=e.previous("time"))){var n=e.get("time")-t,r=e.get("bytes")-e.previous("bytes");i=(r/n).toFixed(1),this.set({eta:((e.get("bytesTotal")-e.get("bytes"))/(100*i)).toFixed(),speed:i})}})}});return t}),CKFinder.define("text!CKFinder/Templates/Common/Progress.dot",[],function(){return'<div class="ckf-progress-message {{? !it.message }}ckf-hidden{{?}}">{{= it.message }}</div><div class="ckf-progress-wrap ckf-progress-{{= it.state }}" role="progressbar" aria-valuenow="{{= it.value }}" aria-valuemin="0" aria-valuemax="100"><div class="ckf-progress-bar" style="width:{{= it.value }}%;" ></div></div>'}),CKFinder.define("CKFinder/Common/Views/ProgressView",["CKFinder/Views/Base/ItemView","text!CKFinder/Templates/Common/Progress.dot"],function(e,t){"use strict";var i=e.extend({name:"ProgressView",template:t,className:"ckf-progress",modelEvents:{"change:message":"updateMessage","change:state":"updateState","change:value":"updateValue"},ui:{bar:".ckf-progress-bar",message:".ckf-progress-message",wrap:".ckf-progress-wrap"},onRender:function(){this.$el.trigger("create")},updateMessage:function(e,t){this.ui.message.text(t).toggleClass("ckf-hidden",!t)},updateState:function(e,t){this.ui.wrap.toggleClass("ckf-progress-ok","ok"===t).toggleClass("ckf-progress-error","error"===t).toggleClass("ckf-progress-indeterminate","indeterminate"===t)},updateValue:function(e,t){this.isDestroyed||(this.ui.bar.css({width:t+"%"}),this.ui.wrap.attr("aria-valuenow",t))}});return i}),CKFinder.define("text!CKFinder/Templates/EditImage/ProgressDialog.dot",[],function(){return'<div id="ckf-ei-progress"></div><div class="ckf-ei-transfer">{{= it.transfer }}</div>'}),CKFinder.define("CKFinder/Modules/EditImage/Views/ProgressDialogView",["underscore","jquery","CKFinder/Views/Base/LayoutView","CKFinder/Common/Views/ProgressView","text!CKFinder/Templates/EditImage/ProgressDialog.dot"],function(e,t,i,n,r){"use strict";var o=i.extend({name:"EditImageProgressDialogView",template:r,regions:{progress:"#ckf-ei-progress"},ui:{transfer:".ckf-ei-transfer"},modelEvents:{change:"updateTransfer"},onRender:function(){this.$el.trigger("create"),this.progress.show(new n({finder:this.finder,model:this.model}))},updateTransfer:function(){this.ui.transfer.text(this.model.get("transfer"))}});return o}),CKFinder.define("CKFinder/Models/File",["backbone"],function(e){"use strict";var t=e.Model.extend({defaults:{name:"",date:"",size:-1,folder:null,"view:isFolder":!1},initialize:function(){this._extenstion=!1,this.on("change:name",function(){this._extenstion=!1},this)},getExtension:function(){return this._extension||(this._extenstion=this.constructor.extensionFromFileName(this.get("name"))),this._extenstion},getUrl:function(){if(!this.has("url")){var e=this.get("folder").getUrl();this.set("url",e&&e+encodeURIComponent(this.get("name")),{silent:!0})}return this.get("url")},isImage:function(){return this.constructor.isExtensionOfImage(this.getExtension())},refresh:function(){this.trigger("refresh")}},{isValidName:function(e){var t=/[\\\/:\*\?"<>\|]/;return!t.test(e)},isExtensionOfImage:function(e){return/jpeg|jpg|gif|png/.test(e.toLowerCase())},extensionFromFileName:function(e){return e.substr(e.lastIndexOf(".")+1)},trimFileName:function(e){var t=e.lastIndexOf(".");return 0>t?e.trim():e.substr(0,t).trim()+"."+e.substr(t+1).trim()}});return t}),CKFinder.define("text!CKFinder/Templates/EditImage/ConfirmDialog.dot",[],function(){return'{{? !it.onlyOverwrite }}<label>{{= it.lang.EditImage.saveDialogOverwrite }}<input tabindex="1" type="checkbox" name="ckfEditImageOverwrite" {{? it.overwrite }}checked="checked"{{?}}></label>{{?}}<div class="filename-input-area" {{? it.overwrite }}style="display:none" aria-hidden="true"{{?}}>{{= it.lang.EditImage.saveDialogSaveAs }}<div><span class="filename-extension-label">.{{! it.extension }}</span><div class="ui-input-text ui-body-inherit ui-corner-all ui-shadow-inset"><input tabindex="1" data-enhanced="true" type="text" name="ckfEditImageFileName" value="{{! it.name }}" aria-required="true" dir="auto" /></div></div><p class="ckf-ei-confirm-error error-message"></p></div>'}),CKFinder.define("CKFinder/Modules/EditImage/Views/ConfirmDialogView",["CKFinder/Views/Base/ItemView","CKFinder/Models/File","text!CKFinder/Templates/EditImage/ConfirmDialog.dot"],function(e,t,i){"use strict";return e.extend({name:"CropView",template:i,className:"ckf-ei-crop-controls",ui:{error:".ckf-ei-confirm-error",overwrite:'input[name="ckfEditImageOverwrite"]',fileName:'input[name="ckfEditImageFileName"]',fileNameInputArea:".filename-input-area"},events:{"change @ui.overwrite":function(e){e.stopPropagation(),e.preventDefault();var t=this.ui.overwrite.is(":checked");t?(this.model.set("name",this.model.get("originalName")),this.model.unset("error"),this.ui.fileNameInputArea.hide().attr("aria-hidden","true")):this.ui.fileNameInputArea.show().removeAttr("aria-hidden"),this.model.set("overwrite",t)},"input @ui.fileName":function(){var e=this.ui.fileName.val().toString();t.isValidName(e)?this.model.unset("error"):this.model.set("error",this.finder.lang.ErrorMsg.FileInvChar),this.model.set("name",e)}},modelEvents:{"change:error":function(e,t){t?(this.ui.fileName.attr("aria-invalid","true"),this.ui.error.show().removeAttr("aria-hidden").html(t)):(this.ui.error.hide().attr("aria-hidden","true"),this.ui.fileName.removeAttr("aria-invalid"))}}})}),CKFinder.define("CKFinder/Modules/EditImage/EditImage",["underscore","jquery","backbone","CKFinder/Modules/EditImage/Views/EditImageLayout","CKFinder/Modules/EditImage/Views/ImagePreviewView","CKFinder/Modules/EditImage/Views/ActionsView","CKFinder/Modules/EditImage/Models/EditImageData","CKFinder/Modules/EditImage/Tools","CKFinder/Modules/EditImage/Models/ProgressModel","CKFinder/Modules/EditImage/Views/ProgressDialogView","CKFinder/Modules/EditImage/Views/ConfirmDialogView"],function(e,t,i,n,r,o,s,a,l,d,c){"use strict";function u(e){var t=this;this.finder=e,e.on("contextMenu:file:edit",f,this),e.on("toolbar:reset:Main:file",function(i){var n=i.data.file;y(n)&&i.data.toolbar.push({type:"button",name:"EditImage",priority:50,icon:"ckf-file-edit",label:i.finder.lang.Fileeditor.contextMenuName,action:function(){h(t,e.request("files:getSelected").first())}})}),e.on("toolbar:reset:EditImage",function(t){var n=this;t.data.toolbar.push({icon:"ltr"===e.lang.dir?"ckf-back":"ckf-forward",name:"Close",iconOnly:!0,label:t.finder.lang.CloseBtn,type:"button",alwaysVisible:!0,action:function(){return t.data.tools.hasDataToSave()?void e.request("dialog:confirm",{name:"ConfirmEditImageExit",msg:e.lang.EditImage.confirmExit}):void e.request("page:destroy",{name:"EditImage"})}}),t.data.toolbar.push({type:"text",name:"Filename",className:"ckf-ei-toolbar-filename",label:e.util.escapeHtml(t.data.tools.editImageData.get("file").get("name"))}),t.data.toolbar.push({name:"Save",label:e.lang.EditImage.save,icon:"ckf-save",alignment:"secondary",alwaysVisible:!0,type:"button",action:function(){m(n,t.data.tools)}}),this.resetButton=new i.Model({name:"Reset",label:e.lang.EditImage.reset,icon:"ckf-reset",alignment:"secondary",alwaysVisible:!0,isDisabled:!0,type:"button",action:function(){t.data.tools.resetTool()}}),t.data.toolbar.push(this.resetButton)},this,null,40),e.on("dialog:EditImageConfirm:ok",function(i){var n=i.data.context;if(!n.viewModel.get("error")){var r=n.viewModel.get("name"),o=r+"."+n.viewModel.get("extension"),s=n.viewModel.get("overwrite");return!s&&e.request("files:getCurrent").where({name:o}).length?void n.viewModel.set("error",i.finder.lang.EditImage.saveDialogFileExists):void v(t,n.tools,n.viewModel.get("oldName")!==o&&o)}}),e.on("dialog:ConfirmEditImageExit:ok",function(){e.request("page:destroy",{name:"EditImage"})}),e.on("command:error:SaveImage",function(){e.request("page:destroy",{name:"EditImage"})},null,null,5)}function f(e){var t=this,i=e.data.context.file.get("folder").get("acl");y(e.data.context.file)&&e.data.items.add({name:"EditImage",label:t.finder.lang.Fileeditor.contextMenuName,isActive:i.fileView&&i.fileRename,icon:"ckf-file-edit",action:function(){h(t,e.data.context.file)}})}function h(t,i){if(e.isUndefined(b)){var n=CKFinder.require.toUrl(t.finder.config.caman||"libs/caman")+".js?ver=js6uhv";CKFinder.require([n],function(e){b=e||window.Caman,g(t,i)})}else g(t,i)}function g(e,t){var i=e.finder,l=new a;l.setupDefault(i,b),l.on("throttle",function(){i.fire("editImage:renderPreview",{actions:f.get("actions").clone()},i)});var d=new n({finder:i}),c=new r({finder:i}),u=new o({finder:i,collection:l});i.once("page:show:EditImage",function(){d.preview.show(c),d.actions.show(u),d.$el.trigger("create"),i.request("toolbar:reset",{name:"EditImage",context:{tools:l}});var e=b(c.ui.canvas.selector,f.get("imagePreview"),function(){i.request("loader:hide"),u.focusFirst(),f.set({renderWidth:c.ui.canvas.width(),renderHeight:c.ui.canvas.height()})});f.set("caman",e)});var f=new s({file:t,imagePreview:i.request("image:previewUrl",{file:t,maxWidth:.8*window.innerWidth,maxHeight:.8*window.innerHeight,noCache:!0}),fullImagePreview:i.request("image:previewUrl",{file:t,maxWidth:1e6,maxHeight:1e6,noCache:!0})});l.setImageData(f);var h=f.get("actions");h.on("add",function(){e.resetButton&&e.resetButton.set("isDisabled",!1)}),h.on("reset",function(){e.resetButton&&e.resetButton.set("isDisabled",!0)}),i.request("loader:show",{text:i.lang.EditImage.loading}),i.request("command:send",{name:"ImageInfo",folder:t.get("folder"),params:{fileName:t.get("name")}}).done(function(e){function n(){l.trigger("ui:resize")}if(e.error&&117===e.error.number)return i.once("command:error:ImageInfo",function(e){e.cancel()}),i.request("loader:hide"),i.request("folder:refreshFiles"),void i.request("dialog:info",{msg:i.lang.ErrorMsg.MissingFile});var r={width:e.width,height:e.height,size:e.size};t.set("imageInfo",r),l.setImageInfo(r),i.util.isWidget()&&p(i),i.once("page:create:EditImage",function(){i.request("toolbar:create",{name:"EditImage",page:"EditImage"})}),i.request("page:create",{view:d,title:i.lang.EditImage.title,name:"EditImage",className:"ckf-ei-page"}),i.request("page:show",{name:"EditImage"}),i.request("loader:show",{text:i.lang.EditImage.loading}),u.on("childview:expand",function(){d.onActionsExpand()}).on("childview:collapse",function(){d.onActionsCollapse()}),i.on("ui:resize",n),i.once("page:destroy:EditImage",function(){i.removeListener("ui:resize",n)})})}function p(e){function t(){n=!1,e.removeListener("minimized",t)}function i(){n&&e.request("minimize"),e.removeListener("page:destroy:EditImage",i),e.removeListener("minimized",t)}var n=!1;e.request("isMaximized")||(e.request("maximize"),n=!0),e.once("minimized",t),e.once("page:destroy:EditImage",i)}function m(e,t){if(t.hasDataToSave()){var n=e.finder,r=t.editImageData.get("file"),o=r.getExtension(),s=r.get("name");if(o){var a=s.lastIndexOf("."+o);a>0&&(s=s.substr(0,a))}var l=r.get("folder").get("acl").fileDelete,d=new i.Model({onlyOverwrite:!l,overwrite:l,oldName:r.get("name"),name:s,originalName:s,extension:o,tools:t,error:!1}),u=n.request("dialog",{view:new c({finder:n,model:d}),title:n.lang.EditImage.saveDialogTitle,name:"EditImageConfirm",buttons:["ok","cancel"],context:{viewModel:d,tools:t}});d.on("change:error",function(e,t){t?u.disableButton("ok"):u.enableButton("ok")})}}function v(e,t,i){function n(){c&&c.abort(),r.request("dialog:destroy")}var r=e.finder,o=t.editImageData,s=new l,a=new d({finder:r,model:s});if(r.request("dialog",{view:a,title:r.lang.EditImage.saveDialogTitle,name:"EditImageSaveProgress",buttons:["cancel"]}),r.on("dialog:EditImageSaveProgress:cancel",n),s.set("message",r.lang.EditImage.downloadAction),!window.URL||!window.URL.createObjectURL)return s.stateIndeterminate(),void w(o.get("fullImagePreview"),t,r,s,i);s.set({bytes:0,bytesTotal:0,value:0,time:(new Date).getTime()});var c=new XMLHttpRequest;c.onprogress=function(e){e.lengthComputable&&(s.set({state:"normal",bytes:e.loaded,bytesTotal:e.total,value:e.loaded/e.total*C,time:(new Date).getTime()}),s.set("transfer",r.lang.formatTransfer(s.get("speed")))),e.lengthComputable||s.set({value:F,state:"indeterminate",transfer:""})},c.onload=function(){return r.removeListener("dialog:EditImageSaveProgress:cancel",n),200!==this.status?(r.request("folder:refreshFiles"),r.request("page:destroy",{name:"EditImage"}),void r.request("dialog:info",{msg:r.lang.ErrorMsg.MissingFile})):(s.set({value:C,eta:!1,speed:!1,time:0}),void w(window.URL.createObjectURL(new Blob([this.response])),t,r,s,i))},c.open("GET",o.get("fullImagePreview"),!0),c.responseType="arraybuffer",c.send(null)}function w(e,t,i,n,r){n.set({value:C,message:i.lang.EditImage.transformationAction}),t.doSave(e).then(function(e){function o(){l&&l.abort(),i.request("dialog:destroy")}n.set({value:x,message:i.lang.EditImage.uploadAction});var s=t.editImageData.get("file"),a=s.get("folder");i.once("command:after:SaveImage",function(e){e.data.response.error||(n.set({state:"normal",value:M,message:""}),s.set({date:e.data.response.date,size:e.data.response.size}),i.once("page:show:Main",function(){e.data.context.isFileNameChanged?i.request("folder:refreshFiles"):s.refresh()}),i.request("page:destroy",{name:"EditImage"}))}),n.set({bytes:0,bytesTotal:0,value:x,message:i.lang.EditImage.uploadAction,time:(new Date).getTime()}),i.on("dialog:EditImageSaveProgress:cancel",o);var l=i.request("command:send",{name:"SaveImage",type:"post",folder:a,params:{fileName:r?r:s.get("name")},post:{content:e},context:{file:s,isFileNameChanged:!!r},returnTransport:!0,uploadProgress:function(e){e.lengthComputable&&(n.set({bytes:e.loaded,bytesTotal:e.total,value:e.loaded/e.total*(k-x)+x,time:(new Date).getTime()}),n.set("transfer",i.lang.formatTransfer(n.get("speed")))),e.lengthComputable||n.set({state:"indeterminate",transfer:!1})},uploadEnd:function(){n.set("state","normal"),i.removeListener("dialog:EditImageSaveProgress:cancel",o)}});t.destroy()})}function y(e){return e.isImage()&&e.get("folder").get("acl").fileRename&&e.get("folder").get("acl").fileUpload}var b,C=33,F=20,x=35,k=98,M=100;return u}),CKFinder.define("CKFinder/Modules/FileDownload/FileDownload",["underscore","jquery"],function(e,t){"use strict";function i(i){var o=e.uniqueId("ckf-download-frame");i.setHandler("file:download",function(e){var n=e.file.get("folder"),r=i.request("command:url",{command:"DownloadFile",folder:n,params:{fileName:e.file.get("name")}}),s=t("#"+o);s.length||(s=t("<iframe>"),s.attr("id",o),s.css("display","none"),s.on("load",function(){var e=t(s.get(0).contentDocument).text();if(e.length)try{var n=JSON.parse(e);n.error&&117===n.error.number&&(i.request("folder:refreshFiles"),i.request("dialog:info",{msg:i.lang.ErrorMsg.MissingFile}))}catch(e){}}),t("body").append(s)),s.attr("src",r)}),i.on("toolbar:reset:Main:file",n),i.on("contextMenu:file",function(e){e.data.groups.add({name:"view"})},null,null,20),i.on("contextMenu:file:view",r,null,null,20)}function n(e){var t={name:"Download",priority:70,icon:"ckf-file-download",label:e.finder.lang.Download};if(o){var i=e.finder.request("files:getSelected").first(),n=e.finder.request("command:url",{command:"DownloadFile",folder:i.get("folder"),params:{fileName:i.get("name")}});t.type="link-button",t.href=n,t.attributes={target:"_blank"}}else t.type="button",t.action=function(){e.finder.request("file:download",{file:e.finder.request("files:getSelected").first()})};e.data.toolbar.push(t)}function r(e){var t=e.data,i=t.context.file,n=i.get("folder").get("acl"),r=e.finder.request("files:getSelected");r.length&&!r.contains(i)&&e.finder.request("files:deselectAll"),e.finder.request("files:select",{files:i});var s={name:"Download",label:e.finder.lang.Download,isActive:n.fileView,icon:"ckf-file-download"};o?(s.allowClick=!0,s.linkAttributes=[{name:"target",value:"_blank"},{name:"href",value:e.finder.request("command:url",{command:"DownloadFile",folder:i.get("folder"),params:{fileName:i.get("name")}})}]):s.action=function(){e.finder.request("file:download",{file:i})},t.items.add(s)}var o=/iPad|iPhone|iPod/.test(navigator.platform);return i}),CKFinder.define("text!CKFinder/Templates/FilePreview/Gallery.dot",[],function(){return'<div class="ckf-file-preview-root" style="position:fixed;top:0;left:0;bottom:0;right:0;background:rgba(0,0,0,0.8);z-index:9010;font-family:Arial, Helvetica, Tahoma, Verdana, sans-serif;" tabindex="0" role="application"><div class="ckf-file-preview" style="position:absolute;top:0;left:0;bottom:2em;right:0;margin:auto;"></div><div class="ckf-file-preview-info" style="position:absolute;left:0;bottom:0;right:0;margin:auto;color:#fff;background:#000;padding:0.5em 1em;max-height:2em;line-height:1em;font-size:1em;"><div class="ckf-file-preview-info-name" style="float:left;"></div><div class="ckf-file-preview-info-count" style="float:right;"></div></div><button class="ckf-file-preview-button-prev" style="position:absolute;top:50%;background:linear-gradient(to bottom, #fff 0, #e4e4e4 100%);border-radius:.3125em;border:1px solid #b6b6b6;box-shadow:0 1px 0 rgba(255, 255, 255, 0.5), 0 0 2px rgba(255, 255, 255, 0.15) inset, 0 1px 0 rgba(255, 255, 255, 0.15) inset;box-sizing:border-box;color:#333;font-size:12.5px;font-weight:bold;line-height:1.3em;margin:5px 3px;padding:5px 10px;text-shadow:0 1px 0 #f3f3f3;-webkit-appearance:none;-moz-appearance:none;display:inline-block;vertical-align:middle;">&laquo;</button><button class="ckf-file-preview-button-next" style="position:absolute;top:50%;background:linear-gradient(to bottom, #fff 0, #e4e4e4 100%);border-radius:.3125em;border:1px solid #b6b6b6;box-shadow:0 1px 0 rgba(255, 255, 255, 0.5), 0 0 2px rgba(255, 255, 255, 0.15) inset, 0 1px 0 rgba(255, 255, 255, 0.15) inset;box-sizing:border-box;color:#333;font-size:12.5px;font-weight:bold;line-height:1.3em;margin:5px 3px;padding:5px 10px;text-shadow:0 1px 0 #f3f3f3;-webkit-appearance:none;-moz-appearance:none;display:inline-block;vertical-align:middle;">&raquo;</button></div>'}),CKFinder.define("CKFinder/Modules/FilePreview/FilePreview",["underscore","jquery","doT","backbone","CKFinder/Util/KeyCode","text!CKFinder/Templates/FilePreview/Gallery.dot","CKFinder/Models/File"],function(e,t,i,n,r,o,s){
"use strict";function a(e){e.setHandlers({"image:previewUrl":function(t){var i,n;return i=t.file.get("folder"),n={fileName:t.file.get("name"),size:Math.round(t.maxWidth)+"x"+Math.round(t.maxHeight),date:t.file.get("date")},t.noCache&&(n.d=(new Date).getTime()),e.request("command:url",{command:"ImagePreview",params:n,folder:i})},"file:preview":function(t){var i=t&&t.file||e.request("files:getCurrent").first();i&&l(e,i.get("name"))}}),e.on("file:preview",function(i){function n(e,t){t.find("iframe").attr("src",e).css("display",""),t.find("img").remove()}var r=i.data.url;if(s.isExtensionOfImage(i.data.extension)&&(i.stop(),i.data.templateData.url=e.hasHandler("image:previewUrl")?e.request("image:previewUrl",{file:i.data.file,maxWidth:.95*t(window.top).width(),maxHeight:.95*t(window.top).height()}):r,i.data.template=v,i.data.events={load:function(e){e.target.id&&t(e.target).css("display","").prev().remove()}}),/^(flac|mp3|ogg|opus|wav|weba)$/.test(i.data.extension)&&c(i.data.extension)&&(i.stop(),i.data.templateData.url=r,i.data.template=w,i.data.events={click:function(e){e.stopPropagation()}}),/^(mp4|ogv|webm)$/.test(i.data.extension)&&u(i.data.extension)&&(i.stop(),i.data.templateData.url=r,i.data.template=y,i.data.events={click:function(e){e.stopPropagation()}}),/^(pdf)/.test(i.data.extension)&&(i.stop(),i.data.template=r?b:C,i.data.templateData.url=r?r:"",i.data.afterRender=function(e){setTimeout(function(){e.closest("[tabindex]").focus()},500)},!r)){var o=i.data.file;i.data.events={load:function(i){if(i.currentTarget.alt)if(o.get("folder").getResourceType().get("useProxyCommand")){var r=e.request("file:getProxyUrl",{file:o,cache:86400,params:{d:o.get("date")}});n(r,t(i.currentTarget).parent())}else e.request("file:getUrl",{file:o}).then(function(e){n(e,t(i.currentTarget).parent())})}}}},null,null,90),e.on("contextMenu:file:view",function(t){t.data.items.add({name:"View",label:t.finder.lang.View,isActive:t.data.context.file.get("folder").get("acl").fileView,icon:"ckf-view",action:function(){l(e,t.data.context.file.get("name"))}})},null,null,10),e.on("toolbar:reset:Main:file",function(e){var t=e.finder;e.data.toolbar.push({name:"View",icon:"ckf-view",label:t.lang.View,type:"button",priority:80,action:function(){l(t,e.data.file.get("name"))}})})}function l(n,s){function a(){var r,o,s,a,l,d;k.current<=0?(k.current=0,y.hide()):y.show(),k.current>=k.last?(k.current=k.last,w.hide()):w.show(),o=k.files[k.current],s=o.url,a=o.name,l=a.substr(a.lastIndexOf(".")+1),d=n.fire("file:preview",{templateData:{fileIcon:function(){var e=t(f).width(),i=t(f).height();return n.request("file:getIcon",{size:e>i?e:i,file:o.file})},fileName:a},file:o.file,url:s,extension:l,template:F},n),b.text(o.name),C.text(k.current+1+" / "+k.files.length),n.request("files:deselectAll"),n.request("files:select",{files:c[k.current]}),r=t(i.template(d.template)(d.templateData),f),d.events&&e.forEach(d.events,function(e,t){r.on(t,e)}),v.append(r),e.isFunction(d.afterRender)&&d.afterRender(r),n.request("focus:trap",{node:p})}function l(e,t){v.html(""),e.stopPropagation(),k.current+=t,a()}function d(){x&&x.remove(),p.remove(),c[k.current].trigger("focus")}var c=n.request("files:getDisplayed").where({"view:isFolder":!1}),u=[],f=window.top.document,h=i.template(o),g=0,p=t(h(),f);p.attr("dir",n.lang.dir);var v=p.find(".ckf-file-preview"),w=p.find(".ckf-file-preview-button-next"),y=p.find(".ckf-file-preview-button-prev"),b=p.find(".ckf-file-preview-info-name"),C=p.find(".ckf-file-preview-info-count");"ltr"===n.lang.dir?(w.css("right","0.5em"),y.css("left","0.5em")):(w.css("left","0.5em"),y.css("right","0.5em")),c.forEach(function(e,t){var i=e.getUrl(),n=e.get("name");u.push({url:i,name:n,file:e}),n===s&&(g=t)});var x,k={files:u,current:g,last:u.length-1};n.util.isWidget()&&(x=t(m).appendTo(t("body",f))),p.append(v).append(y).append(w).appendTo(t("body",f)),p.focus(),p.on("click",function(){d()}),t(p).on("keydown",function(e){e.keyCode===r.left&&l(e,"ltr"===n.lang.dir?-1:1),e.keyCode===r.right&&l(e,"ltr"===n.lang.dir?1:-1),e.keyCode===r.escape&&(e.stopPropagation(),d())}),y.on("click",function(e){l(e,-1)}),w.on("click",function(e){l(e,1)}),a()}function d(e,t,i){var n=document.createElement(e);return!!n.canPlayType&&""!==n.canPlayType(t[i])}function c(e){return d("audio",{flac:"audio/flac",mp3:"audio/mpeg",ogg:"audio/ogg",opus:'audio/ogg; codecs="opus',wav:"audio/wav",weba:"audio/webm"},e)}function u(e){return d("video",{mp4:"video/mp4",ogv:"video/ogg",webm:"video/webm"},e)}var f="calc(100% - 6em)",h="calc(100% - 2em)",g="position:absolute;top:0;left:0;bottom:0;right:0;margin:auto;max-width:"+f+";max-height:"+h+";",p=g+"width:"+f+";height:"+h+";",m="<style>.ckf-file-preview-root :focus,.ckf-file-preview-root:focus .ckf-file-preview {-webkit-box-shadow:inset 0 0 0 2px #FFCD32 !important;-moz-box-shadow:inset 0 0 0 2px #FFCD32 !important;box-shadow:inset 0 0 0 2px #FFCD32 !important;}</style>",v='<img alt="{{! it.fileName }}" src="{{= it.fileIcon() }}" style="'+g+'"><img alt={{! it.fileName }}" src="{{= it.url }}" id="ckf-image-preview" style="display:none;'+g+'">',w='<audio src="{{= it.url }}" controls="controls" style="'+g+'">',y='<video src="{{= it.url }}" controls="controls" style="'+g+'">',b='<iframe src="{{= it.url }}" style="'+p+'">',C='<img alt="{{= it.fileName }}" src="{{= it.fileIcon() }}" style="'+g+'"><iframe src="{{= it.url }}" style="display:none;'+p+'">',F='<img alt="{{= it.fileName }}" src="{{= it.fileIcon() }}" style="'+g+'">';return a}),CKFinder.define("CKFinder/Modules/Files/FilesFilter",["backbone"],function(e){"use strict";return{attachTo:function(t){var i=new e.Collection;return i.search=function(e){var n;t.length&&(""===e?(n=t.toArray(),i.isFiltered=!1,i.filter=e):(n=t.filter(function(t){return new RegExp(e.replace(/[\\^$*+?.()|[\]{}-]/g,"\\$&"),"gi").test(t.get("name"))}),i.isFiltered=!0),i.reset(n))},i.listenTo(t,"reset",function(){i.reset(t.toArray()),i.isFiltered=!1}),i.listenTo(t,"remove",function(e){i.remove(e)}),i.listenTo(t,"add",function(e){i.add(e)}),i.isFiltered=!1,i.comparators={},i.sortFiledName=void 0,i.sortAscending=!0,i.on("change:name",function(){"name"===i.sortFiledName&&i.sort()}),i.comparator=function(e,t){if(!this.sortFiledName||!this.comparators[this.sortFiledName])return 1;if(e.get("view:isFolder")===t.get("view:isFolder")){if(e.get("view:isFolder")===!1){var i=this.comparators[this.sortFiledName],n=i(e,t);return 0===n?n:this.isSortAscending?n:-n}return e.get("name").localeCompare(t.get("name"))}return e.get("view:isFolder")?-1:1},i.addComparator=function(e,t){this.comparators[e]=t},i.sortByField=function(e){this.sortFiledName=e,this.sort()},i.sortAscending=function(){this.isSortAscending=!0,this.sort()},i.sortDescending=function(){this.isSortAscending=!1,this.sort()},i.addComparator("name",function(e,t){return e.get("name").localeCompare(t.get("name"))}),i.addComparator("size",function(e,t){var i=e.get("size"),n=t.get("size");return i===n?0:i>n?1:-1}),i.addComparator("date",function(e,t){return e.get("date").localeCompare(t.get("date"))}),i}}}),CKFinder.define("text!CKFinder/Templates/Files/ChooseResizedImageItem.dot",[],function(){return'<label>{{= it.label }}<span class="ckf-choose-resized-image-size">{{= it.size }}</span><input type="radio" name="ckfChooseResized" tabindex="1" value="{{= it.name }}"{{? !it.isActive }} disabled="disabled"{{?}}{{? it.isDefault }} checked="checked"{{?}}></label>'}),CKFinder.define("text!CKFinder/Templates/Files/ChooseResizedImageInputItem.dot",[],function(){return'<label>{{= it.lang.ChooseResizedImageSizes.Custom }}<input type="radio" name="ckfChooseResized" tabindex="1" value="{{= it.name }}"></label><div class="ckf-choose-resized-image-custom-fields ui-state-disabled"><div class="ckf-choose-resized-image-custom-block"><label class="ckf-choose-resized-image-label">Width</label></div><div class="ckf-choose-resized-image-custom-block ckf-choose-resized-image-input"><input type="text" name="ckfCustomWidth" tabindex="1" disabled="disabled" value="{{= it.width }}"></div><div class="ckf-choose-resized-image-custom-block"><label class="ckf-choose-resized-image-label">Height</label></div><div class="ckf-choose-resized-image-custom-block ckf-choose-resized-image-input"><input type="text" name="ckfCustomHeight" tabindex="1" disabled="disabled" value="{{= it.height }}"></div></div>'}),CKFinder.define("CKFinder/Modules/Files/Views/ChooseResizedImageView",["underscore","jquery","CKFinder/Util/KeyCode","CKFinder/Views/Base/CollectionView","CKFinder/Views/Base/ItemView","text!CKFinder/Templates/Files/ChooseResizedImageItem.dot","text!CKFinder/Templates/Files/ChooseResizedImageInputItem.dot"],function(e,t,i,n,r,o,s){"use strict";var a=n.extend({name:"ContextMenu",template:"",tagName:"form",events:{'change [name="ckfChooseResized"]':function(e){var i=t(e.currentTarget).val();"__custom"===i?(this.$el.find(".ckf-choose-resized-image-custom-fields").removeClass("ui-state-disabled"),this.$el.find(".ckf-choose-resized-image-input input").textinput("enable").removeAttr("disabled").first().focus()):(this.$el.find(".ckf-choose-resized-image-custom-fields").addClass("ui-state-disabled"),this.$el.find(".ckf-choose-resized-image-input input").textinput("disable").attr("disabled","disabled"))}},childEvents:{keydown:function(e,t){if(t.evt.keyCode===i.down||t.evt.keyCode===i.up||t.evt.keyCode===i.tab){if(t.evt.preventDefault(),t.evt.stopPropagation(),t.evt.keyCode===i.down||t.evt.keyCode===i.up){var n=this.collection.where({isActive:!0}),r=n.indexOf(e.model),o=r+(t.evt.keyCode===i.down?1:-1);0>o&&(o=n.length-1),o>n.length-1&&(o=0);var s=this.children.findByModel(n[o]);s&&s.focus()}t.evt.keyCode===i.tab&&e.$el.closest(".ckf-dialog").find("[data-ckf-button]").eq(this.finder.util.isShortcut(t.evt,"shift")?-1:0).focus()}}},collectionEvents:{reset:function(){this.$el.html("")}},onRender:function(){var e=this;setTimeout(function(){e.$el.enhanceWithin()},0)},getChildView:function(e){var t={name:"ChooseResizedItem",finder:this.finder,template:o,tagName:"div",events:{'keydown input[type="radio"]':function(e){this.trigger("keydown",{evt:e})}},focus:function(){this.$el.find("input").focus()}};return e.get("custom")&&this.addCustomSizeViewConfig(t),r.extend(t)},addCustomSizeViewConfig:function(e){e.className="ckf-choose-resized-image-custom",e.template=s,e.tagName="div",e.ui={width:'input[name="ckfCustomWidth"]',height:'input[name="ckfCustomHeight"]'},e.setSize=function(e,t){var i=0>=e?1:e,n=0>=t?1:t;this.ui.height.val(i),this.ui.width.val(n),this.model.set({size:n+"x"+i})},e.events["input @ui.width"]=function(){var e=this.model.get("width"),t=this.model.get("height"),i=t,n=this.ui.width.val();n.length||(n=1);var r=parseInt(n);e>r?i=r*(t/e):r=e,i=Math.round(i),this.setSize(i,r)},e.events["input @ui.height"]=function(){var e=this.model.get("width"),t=this.model.get("height"),i=e,n=this.ui.height.val(),r=parseInt(n);n.length||(r=1),t>r?i=r*(e/t):r=t,i=Math.round(i),this.setSize(r,i)}},getSelected:function(){return this.collection.findWhere({name:this.$el.find('input[name="ckfChooseResized"]:checked').val()})}});return a}),CKFinder.define("CKFinder/Modules/Files/ChooseFiles",["underscore","jquery","backbone","CKFinder/Modules/Files/Views/ChooseResizedImageView"],function(e,t,i,n){"use strict";function r(e){this.finder=e,this.isEnabled=e.config.chooseFiles,e.config.ckeditor&&(e.on("files:choose",function(t){var i=t.data.files.pop(),n={fileUrl:i.getUrl(),fileSize:i.get("size"),fileDate:i.get("date")};e.config.ckeditor.callback(n.fileUrl,n)}),e.on("file:choose:resizedImage",function(t){var i=t.data.file,n={fileUrl:t.data.resizedUrl,fileSize:0,fileDate:i.get("date")};e.config.ckeditor.callback(t.data.resizedUrl,n)})),this.isEnabled&&(e.on("contextMenu:file",function(e){e.data.groups.add({name:"choose"})},null,null,10),e.on("contextMenu:file:choose",o),e.on("toolbar:reset:Main:file",s),e.on("toolbar:reset:Main:files",a),e.on("command:ok:SaveImage",function(e){e.data.context.file.set("imageResizeData",new i.Model)}),e.setHandlers({"image:getResized":{callback:c,context:this},"image:resize":{callback:u,context:this},"image:getResizedUrl":{callback:g,context:this},"files:choose":{context:this,callback:function(t){l(e,t.files)}}})),e.setHandlers({"file:getUrl":{callback:h,context:this},"file:getProxyUrl":{callback:f,context:this}}),e.on("command:after:GetFileUrl",function(e){e.data.context.thumbnail||e.data.context.file.set("url",e.data.response.url),e.data.context.dfd.resolve(e.data.response.url)}),e.on("dialog:ChooseResizedImage:ok",function(t){var i=t.data.view.getSelected();v(e,i.get("name"),i.get("size"),t.data.context.file),e.request("dialog:destroy")})}function o(e){function t(){new i.Model({name:"ChooseResizedImage",label:e.finder.lang.ChooseResizedImage,isActive:n.get("folder").get("acl").imageResize||b(n),icon:"ckf-choose-resized",action:function(){d(e.finder,n)}}).set("active",b(n))}var n=e.data.context.file;if(e.data.items.add({name:"Choose",label:e.finder.lang.Choose,isActive:n.get("folder").get("acl").fileView,icon:"ckf-choose",action:function(){var t=e.finder.request("files:getSelected");t.length>1?l(e.finder,t):w(e.finder,n)}}),n.isImage()&&e.finder.config.resizeImages){var r=n.has("imageResizeData")&&n.get("imageResizeData").has("originalSize");r||n.once("change:imageResizeData",t),e.data.items.add(new i.Model({name:"ChooseResizedImage",label:e.finder.lang.ChooseResizedImage,isActive:n.get("folder").get("acl").imageResize||b(n),icon:"ckf-choose-resized",action:function(){d(e.finder,n)}}))}}function s(e){function t(){w(e.finder,n)}var n=e.data.file;if(y(e,t),n.isImage()&&e.finder.config.resizeImages){var r=n.has("imageResizeData")&&n.get("imageResizeData").has("originalSize"),o=new i.Model({name:"ChooseResizedImage",type:"button",priority:k,alignment:"primary",icon:"ckf-choose-resized",label:e.finder.lang.ChooseResizedImage,isDisabled:!(n.get("folder").get("acl").imageResize||b(n)),action:function(){d(e.finder,n)}});r||(n.once("change:imageResizeData",function(){o.set("isDisabled",!b(n))}),e.finder.request("image:getResized",{file:n})),e.data.toolbar.push(o)}}function a(e){function t(){l(e.finder,e.finder.request("files:getSelected"))}y(e,t)}function l(e,t){var i=t.clone();i.forEach(function(t){!t.getUrl()&&t.get("folder").getResourceType().get("useProxyCommand")&&t.set("url",e.request("file:getProxyUrl",{file:t}))}),e.fire("files:choose",{files:i},e),F(e)}function d(e,t){var r=new i.Collection,o=e.config.initConfigInfo.images;p(r,e,t,o),t.on("change:imageResizeData",function(){r.reset(),p(r,e,t,o)}),e.request("dialog",{title:e.lang.ChooseResizedImage,name:"ChooseResizedImage",buttons:["ok","cancel"],view:new n({finder:e,collection:r}),context:{file:t}})}function c(n){var r=this.finder,o=n.file,s=new t.Deferred;if(o.has("imageResizeData")&&o.get("imageResizeData").has("originalSize"))s.resolve(o);else{var a=o.get("folder");r.once("command:after:GetResizedImages",function(t){var n=t.data.context.file,r=new i.Model;t.data.response.resized&&r.set("resized",t.data.response.resized),t.data.response.originalSize&&r.set("originalSize",t.data.response.originalSize),e.forEach(t.data.response.resized,function(t,i){if(i===x)return void e.forEach(t,function(e){var t=e.name?e.name:e,n=t.match(E);if(n){var o={fileName:t};e.url&&(o.url=e.url),r.set(C(i,n[1]),o,{silent:!0})}});var n={fileName:t.name?t.name:t};t.url&&(n.url=t.url),r.set(C(i),n,{silent:!0})}),n.set("imageResizeData",r),t.data.context.dfd.resolve(n)});var l={fileName:o.get("name")};e.isArray(r.config.resizeImages)&&r.config.resizeImages.length&&(l.sizes=r.config.resizeImages.join(",")),r.request("command:send",{name:"GetResizedImages",folder:a,params:l,context:{dfd:s,file:o}})}return s.promise()}function u(e){var n=this.finder,r=e.file,o=new t.Deferred,s=e.size;if(!e.name)throw"The data.name parameter is required";if(e.name===x){if(!e.size)throw'The data.size parameter is required when using "{name}".'.replace("{name}",x);s=e.size}else{if(!n.config.initConfigInfo.images.sizes[e.name])throw'The name "{name}" is not configured for resized images'.replace("{name}",e.name);s=n.config.initConfigInfo.images.sizes[e.name]}if(r.has("imageResizeData")&&r.get("imageResizeData").has("resizedUrl"+s))o.resolve(r);else{var a=r.get("folder");n.once("command:after:ImageResize",function(t){var n=t.data.context.file,r=t.data.response.url,o=n.get("imageResizeData");if(o||(o=new i.Model,n.set("imageResizeData",o)),e.save){var s=o.get("resized");s||(s={},o.set("resized",s)),s.__custom||(s.__custom=[]),s.__custom.push(r.match(K)[0])}o.set(C(e.name,e.size),{url:r}),t.data.context.dfd.resolve(n)}),n.request("command:send",{name:"ImageResize",folder:a,type:"post",params:{fileName:r.get("name"),size:s},context:{dfd:o,file:r}})}return o.promise()}function f(t){var i=this.finder,n=t.file,r=e.extend({fileName:n.get("name")},t.params);return t.cache?r.cache=t.cache:i.config.initConfigInfo.proxyCache&&(r.cache=i.config.initConfigInfo.proxyCache),i.request("command:url",{command:"Proxy",params:r,folder:n.get("folder")})}function h(e){var i=this.finder,n=e.file,r=new t.Deferred,o=n.getUrl();return n.get("folder").getResourceType().get("useProxyCommand")&&(o=i.request("file:getProxyUrl",e)),o?r.resolve(o):i.request("command:send",{name:"GetFileUrl",folder:n.get("folder"),params:{fileName:n.get("name")},context:{dfd:r,file:n}}),r.promise()}function g(e){var i=this.finder,n=e.file,r=new t.Deferred;return i.request("command:send",{name:"GetFileUrl",folder:n.get("folder"),params:{fileName:n.get("name"),thumbnail:e.thumbnail},context:{dfd:r,file:n,thumbnail:e.thumbnail}}),r.promise()}function p(t,i,n,r){var o=n.get("imageResizeData"),s=o&&o.get("originalSize")||"",a=n.get("folder").get("acl").imageResize,l=n.get("folder").get("acl").imageResizeCustom,d=t.add({label:i.lang.OriginalSize,size:s,name:"original",isActive:!0,isDefault:!1}),c=o&&o.get("resized"),u=!0;if(e.forEach(r.sizes,function(n,r){var o=n,l=a;if(!e.isArray(i.config.resizeImages)||!i.config.resizeImages.length||e.contains(i.config.resizeImages,r)){if(c&&c[r]){var d=c[r].match(E);2===d.length&&(o=d[1]),l=!0}else if(s){var f=s.split("x"),h=n.split("x"),g=parseInt(h[0]),p=parseInt(h[1]),v=parseInt(f[0]),w=parseInt(f[1]),y=m(g,p,v,w);v<=y.width&&w<=y.height?l=!1:o=y.width+"x"+y.height}t.add({label:i.lang.ChooseResizedImageSizes[r]?i.lang.ChooseResizedImageSizes[r]:r,size:o,name:r,isActive:l,isDefault:u&&l}),u=!1}}),c&&c.__custom){var f=[];e.forEach(c.__custom,function(e){var t=e.match(E);t&&(t=t[1],f.push({label:t,size:t,width:parseInt(t.split("x")[0]),name:x+"_"+t,url:e,isActive:!0}))}),e.chain(f).sortBy("width").forEach(function(e){t.add(e)})}if(l){var h=0,g=0;if(s){var p=s.split("x");h=p[0],g=p[1]}t.add({name:x,custom:!0,isActive:l,isDefault:!1,width:h,height:g,size:h+"x"+g})}t.findWhere({isDefault:!0})||d.set("isDefault",!0)}function m(e,t,i,n){var r={width:e,height:t},o=e/i,s=t/n;return(1!==o||1!==s)&&(s>o?r.height=parseInt(Math.round(n*o)):o>s&&(r.width=parseInt(Math.round(i*s)))),r.height<=0&&(r.height=1),r.width<=0&&(r.width=1),r}function v(e,t,i,n,r){function o(t,i){e.request("loader:hide"),e.fire("file:choose:resizedImage",{file:t,resizedUrl:i},e),F(e)}if("original"===t)return void w(e,n);0===t.indexOf(x+"_")&&(t=x);var s=n.get("imageResizeData"),a=C(t,i);if(s&&s.has(a)){var l=s.get(a),d={file:n};if(l.url)return void o(n,l.url);var c="file:getUrl";return"original"!==t&&l.fileName&&(c="image:getResizedUrl",d.thumbnail=l.fileName),e.request("loader:show",{text:e.lang.GettingFileData}),void e.request(c,d).then(function(e){o(n,e)})}e.request("loader:show",{text:e.lang.GettingFileData}),e.request("image:resize",{file:n,size:i,name:t,save:r}).then(function(e){o(e,e.get("imageResizeData").get(a).url)})}function w(e,t){var n=t.getUrl(),r=new i.Collection([t]);return n?void l(e,r):(e.request("loader:show",{text:e.lang.GettingFileData}),void e.request("file:getUrl",{file:t}).then(function(){e.request("loader:hide"),l(e,r)}))}function y(e,t){e.data.toolbar.push({name:"Choose",type:"button",priority:M,icon:"ckf-choose",label:e.finder.lang.Choose,action:t})}function b(t){var i=t.get("folder").get("acl"),n=t.has("imageResizeData")&&!!e.size(t.get("imageResizeData").get("resized"));return i.imageResize||i.imageResizeCustom||n}function C(e,t){var i;return i=e===x?"resizedUrl_custom"+t:"resizedUrl_"+e}function F(e){e.config.chooseFilesClosePopup&&e.request("closePopup")}var x="__custom",k=100,M=110,E="([0-9]+x[0-9]+)[.][a-zA-Z]{1,5}$",K="/([^/]+$)";return r}),CKFinder.define("CKFinder/Modules/Files/Views/Common/FilesViewMixin",["CKFinder/Util/KeyCode"],function(e){"use strict";var t={getMethods:function(){return{shouldFocusFirstChild:function(){return!(this.el!==document.activeElement||!this.collection.length)&&(this.collection.first().trigger("focus"),!0)},getEmptyViewData:function(){var e,t=!1;return this.collection.isLoading?(e=this.finder.lang.FilesLoading,t=!0):e=this.collection.isFiltered?this.finder.lang.FilterFilesEmpty:this.finder.lang.FilesEmpty,{msg:e,displayLoader:t}},updateHeightForBorders:function(e){var t=parseInt(getComputedStyle(this.el).getPropertyValue("padding-top")),i=parseInt(getComputedStyle(this.el).getPropertyValue("padding-bottom")),n=parseInt(getComputedStyle(this.el).getPropertyValue("border-top-width")),r=parseInt(getComputedStyle(this.el).getPropertyValue("border-bottom-width"));this.$el.css({"min-height":e.height-t-i-n-r})}}},getEvents:function(){return{keydown:function(t){t.keyCode===e.tab&&(this.finder.util.isShortcut(t,"")||this.finder.util.isShortcut(t,"shift"))&&this.finder.request(this.finder.util.isShortcut(t,"")?"focus:next":"focus:prev",{node:this.$el,event:t}),this.trigger("keydown",{evt:t})},focus:function(e){setTimeout(function(){(window.scrollY||window.pageYOffset)&&window.scrollTo(0,0)},20),e.target===e.currentTarget&&this.collection.length&&(e.preventDefault(),e.stopPropagation(),this.trigger("focused"))}}}};return t}),CKFinder.define("text!CKFinder/Templates/Files/FilesInfo.dot",[],function(){return'{{? it.displayLoader }}<div class="ui-loader ui-loader-verbose ui-content ui-body-{{= it.swatch }} ui-corner-all"><span class="ui-icon-loading"></span><h1>{{= it.title }}</h1></div>{{??}}<div class="ckf-files-info-body ui-content ui-body-{{= it.swatch }} ui-corner-all"><h2>{{= it.title }}</h2>{{? it.displayLoader }}<p>{{= it.text }}</p>{{?}}</div>{{?}}'}),CKFinder.define("CKFinder/Modules/Files/Views/Common/FilesInfoView",["backbone","CKFinder/Views/Base/ItemView","text!CKFinder/Templates/Files/FilesInfo.dot"],function(e,t,i){"use strict";var n=t.extend({name:"FilesInfoView",template:i,className:"ckf-files-info",templateHelpers:function(){return{swatch:this.finder.config.swatch}},initialize:function(){this.model=new e.Model({title:this.msg.title,text:this.msg.text,displayLoader:this.displayLoader})}});return n}),CKFinder.define("CKFinder/Modules/Files/Views/Common/FileViewMixin",["underscore","CKFinder/Util/KeyCode"],function(e,t){"use strict";var i=700,n=500,r={getEvents:function(n){var r={},o={touchstart:function(e){this.isInTouch=!0,this.longTouchTimeout&&clearTimeout(this.longTouchTimeout);var t=this;this.longTouchTimeout=setTimeout(function(){t.isInTouch&&(t.triggerEvent("longtouch",{evt:e,view:t,model:t.model}),t.isInTouch=!1)},i)},touchend:function(e){this.checkDoubleTap(e),this.isInTouch&&this.triggerEvent("click",{evt:e,view:this,model:this.model}),this.isInTouch=!1},touchcancel:function(){this.isInTouch=!1},touchmove:function(){this.isInTouch=!1},contextmenu:function(e){this.isInTouch?e.preventDefault():this.triggerEvent("contextmenu",{evt:e,view:this,model:this.model})},dblclick:function(e){this.triggerEvent("dblclick",{evt:e,view:this,model:this.model})},click:function(e){var t={evt:e,view:this,model:this.model};if(2===e.button||3===e.button)this.triggerEvent("contextmenu",t);else{if(0!==e.button)return!1;this.triggerEvent("click",t)}},keydown:function(e){return e.keyCode===t.menu||e.keyCode===t.f10&&this.finder.util.isShortcut(e,"shift")?void this.triggerEvent("contextmenu",{evt:e,view:this,model:this.model}):void this.triggerEvent("keydown",{evt:e,view:this,model:this.model})},dragstart:function(e){this.triggerEvent("dragstart",{evt:e,view:this,model:this.model})},dragend:function(e){function t(e){e.cancel()}var i=this;i.finder.on("ui:swipeleft",t,null,null,1),i.finder.on("ui:swiperight",t,null,null,1),setTimeout(function(){i.finder.removeListener("ui:swipeleft",t),i.finder.removeListener("ui:swiperight",t)},500),this.triggerEvent("dragend",{evt:e,view:this,model:this.model})},blur:function(){this.getActiveElement().attr("tabindex",-1)},focus:function(){this.getActiveElement().attr("tabindex",0)}};return e.forEach(o,function(e,t){r[t+" "+n]=e}),r},getModelEvents:function(){return{focus:function(){this.getActiveElement().focus(),this.trigger("focused")},refresh:function(){this.render(),this.trigger("rerender")},selected:function(){this.getActiveElement().addClass("ui-btn-active")},deselected:function(){this.getActiveElement().removeClass("ui-btn-active")},change:function(e){e.changed.name&&(this.render(),this.trigger("rerender"))}}},getMethods:function(){return{checkDoubleTap:function(e){var t=this.touchStartAt;this.touchStartAt=e.timeStamp;var i=t&&this.touchStartAt-t<n;this.triggerEvent(i?"dbltap":"touch",{evt:e,view:this,model:this.model})}}}};return r}),CKFinder.define("text!CKFinder/Templates/Files/FileView.dot",[],function(){return'<a href="javascript:void(0)" class="ckf-files-inner" tabindex="-1" draggable="true" role="listitem" aria-label="{{! it.name }}" aria-describedby="{{! it.descriptionId }}" data-ckf-drag-preview="{{= it.dragPreviewId }}"><img id="{{= it.dragPreviewId }}" class="ui-li-thumb" alt="" src="{{= it.getIcon() }}" draggable="true" data-ckf-drag-preview="{{= it.dragPreviewId }}" />{{? it.displayName || it.displayDate || it.displaySize }}<div class="ckf-file-desc ui-bar-{{= it.config.swatch}}" draggable="true">{{? it.displayName }}<h2 title="{{! it.name }}" dir="auto">{{! it.name }}</h2>{{?}}<p draggable="true" id="{{! it.descriptionId }}" data-ckf-drag-preview="{{= it.dragPreviewId }}">{{? it.displayDate }}{{! it.lang.formatDateString( it.date ) }}{{?}}{{? it.displaySize }}{{? it.displayDate }}<br>{{?}}{{! it.lang.formatFileSize( it.size * 1024 ) }}{{?}}</p></div>{{?}}</a>'}),CKFinder.define("CKFinder/Modules/Files/Views/ThumbnailsView/FileView",["underscore","jquery","CKFinder/Views/Base/ItemView","CKFinder/Modules/Files/Views/Common/FileViewMixin","text!CKFinder/Templates/Files/FileView.dot"],function(e,t,i,n,r){"use strict";var o=1e3,s={tagName:"li",lazyLoad:!0,name:"FileThumb",template:r,className:"ckf-file-item",eventPrefix:"file",ui:{activeElem:".ckf-files-inner",img:"img"},attributes:{"data-icon":!1,role:"presentation"},templateHelpers:function(){return{getIcon:this.getIcon.bind(this),displayName:this.getOption("displayName"),displaySize:this.getOption("displaySize"),displayDate:this.getOption("displayDate"),descriptionId:e.uniqueId("ckf-"),dragPreviewId:e.uniqueId("ckf-")}},initialize:function(){this.hasPreview()&&this.finder.config.initConfigInfo.thumbs&&this.updateLazyConfig(),this.on("sizeUpdate",function(e){this.options.thumbSize=e.thumbSize,this.options.thumbSizeString=e.thumbSizeString,this.hasPreview()&&this.finder.config.initConfigInfo.thumbs?this.updateLazyConfig():this.loadThumbnail(this.getIcon()),this.trigger("rerender")})},onRender:function(){var e;"thumbs"===this.getOption("mode")&&(e=this.getOption("thumbSize"),this.$el.css({width:e+"px",height:e+"px"})),this.showDescription()},getIcon:function(){return this.finder.request("file:getIcon",{size:this.getOption("thumbSize"),file:this.model})},triggerEvent:function(e,t){this.trigger(this.getOption("eventPrefix")+":"+e,t)},loadThumbnail:function(e){this.ui.img.after(t('<img style="display:none;">').attr("src",e).on("load",function(){t(this).prev("img").attr("src",t(this).attr("src")),t(this).remove()}))},hasPreview:function(){return!this.model.get("view:isFolder")&&this.model.isImage()},updateLazyConfig:function(){this.options.lazyThumb=this.finder.request("file:getThumb",{file:this.model,size:this.getOption("thumbSizeString")})},showDescription:function(){clearTimeout(this.hideDescriptionTimeout),this.$el.removeClass("ckf-file-show-thumb")},hideDescription:function(){var e=this;this.hideDescriptionTimeout=setTimeout(function(){e.$el.addClass("ckf-file-show-thumb")},o)},getActiveElement:function(){return this.ui.activeElem}};s.events=e.extend({"mouseenter @ui.img":"hideDescription","mouseleave @ui.img":"showDescription"},n.getEvents("@ui.activeElem")),s.modelEvents=e.extend({"change:date":"updateLazyConfig"},n.getModelEvents()),e.extend(s,n.getMethods());var a=i.extend(s);return a}),CKFinder.define("text!CKFinder/Templates/Files/FolderInFile.dot",[],function(){return'<a class="ckf-files-inner" tabindex="-1" draggable="false" data-ckf-drop="true"><img class="ui-li-thumb" alt="{{! it.label || it.name }}" src="{{= it.getIcon() }}" data-ckf-drop="true"><div class="ckf-file-desc ui-bar-{{= it.config.swatch }}"><h2 title="{{! it.label || it.name }}" data-ckf-drop="true">{{! it.label || it.name }}</h2></div></a>'}),CKFinder.define("CKFinder/Modules/Files/Views/ThumbnailsView/FolderView",["underscore","CKFinder/Modules/Files/Views/ThumbnailsView/FileView","text!CKFinder/Templates/Files/FolderInFile.dot"],function(e,t,i){"use strict";var n=t.extend({name:"FolderThumb",template:i,className:"ckf-file-item ckf-folders-item",eventPrefix:"folder",ui:{img:"img",activeElem:".ckf-files-inner",label:".ckf-files-inner"},events:e.extend({},t.prototype.events,{"dragstart @ui.activeElem":function(e){e.preventDefault()},"dragend @ui.activeElem":function(e){e.preventDefault()},"ckfdrop @ui.activeElem":function(e){e.stopPropagation(),this.trigger("folder:drop",{evt:e,view:this,model:this.model})}}),getIcon:function(){return this.finder.request("folder:getIcon",{size:this.getOption("thumbSize"),folder:this.model})},loadThumbnail:function(e){this.ui.img.attr("src",e)},getLabel:function(){return this.ui.label}});return n}),CKFinder.define("CKFinder/Util/Throttlers",["underscore","jquery"],function(e,t){"use strict";function i(){this.reset()}var n={};return i.prototype={reset:function(){var e=this;e.dfd&&e.dfd.reject(),e.dfd=new t.Deferred,e.dfd.done(function(){e.callback&&e.callback(),e.reset()}),e.timeOutId=-1},assignJob:function(e){this.callback=e},runAfter:function(e){var t=this;t.timeOutId&&clearTimeout(t.timeOutId),t.timeOutId=setTimeout(function(){t.dfd.resolve()},e)}},{getOrCreate:function(t,r){return e.has(n,t)||(n[t]=new i),n[t].reset(),n[t].assignJob(r),n[t]}}}),CKFinder.define("CKFinder/Modules/Files/Views/ThumbnailsView",["underscore","CKFinder/Views/Base/CollectionView","CKFinder/Modules/Files/Views/Common/FilesViewMixin","CKFinder/Modules/Files/Views/Common/FilesInfoView","CKFinder/Modules/Files/Views/ThumbnailsView/FileView","CKFinder/Modules/Files/Views/ThumbnailsView/FolderView","CKFinder/Util/Throttlers"],function(e,t,i,n,r,o,s){"use strict";var a=400,l=500,d=500,c={name:"ThumbnailsView",reorderOnSort:!0,className:"ckf-files-view ckf-files-view-borders ui-body-inherit",childView:r,attributes:{"data-role":"listview",tabindex:30,role:"list"},tagName:"ul",childEvents:{focused:function(e){var t=this;setTimeout(function(){var i=t.$el.closest('[data-role="page"]'),n=parseInt(t.$el.offset().top),r=t.collection.indexOf(e.model),o=t.getThumbsInRow();if(o>r&&(window.scrollY||window.pageYOffset)&&n)return void window.scrollTo(0,0);var s=t.collection.length%o,a=t.collection.length-(s?s:o);r>=a&&window.scrollTo(0,i.outerHeight())},20)}},initialize:function(t){function i(){n.$el.listview().listview("refresh")}var n=this;t.displayConfig.set({mode:"list",thumbSizeString:null,currentThumbConfigSize:0,thumbClassName:""}),"thumbs"===t.mode?n.setThumbsMode():n.setListMode(),n.once("render",function(){n.$el.trigger("create"),n.$el.attr("aria-label",n.finder.lang.FilesPane),n.on("render",function(){n.$el.listview().listview("refresh"),
n.applySizeClass(this.getOption("displayConfig").get("thumbSize"))}),n.on("childview:rerender",function(){n.$el.listview().listview("refresh")}),n.on("childview:render",e.debounce(i,30))}),n.once("show",function(){function e(e){n.trigger("click",{evt:e})}var t=n.$el.closest(".ckf-page-regions");t.on("click",e),n.once("destroy",function(){t.off("click",e)})}),n.on("render",function(){var e=n.finder.request("folder:getActive"),t=e&&e.cid;n.finder.config.displayFoldersPanel||n.lastFolderCid||n.focus(),n.lastFolderCid=t,"list"===n.getOption("displayConfig").get("mode")?n.setListMode():n.setThumbsMode()}),n.on("maximize",n.updateHeightForBorders,n)},childViewOptions:function(){return this.getOption("displayConfig").toJSON()},getChildView:function(e){return e.get("view:isFolder")?o:r},applySizeClass:function(t){var i=this,n=!1;e.forEach(i.finder.config.thumbnailClasses,function(e,r){!n&&r>t?(i.$el.addClass("ckf-files-thumbs-"+e),n=!0):i.$el.removeClass("ckf-files-thumbs-"+e)})},calculateThumbSizeConfig:function(t){if(t&&this.getOption("displayConfig").get("areThumbnailsResizable")){var i=this.getOption("displayConfig").get("serverThumbs"),n=e.filter(i,function(e){return e>=t}),r=e.isEmpty(n)?e.max(i):e.min(n),o=this.getOption("displayConfig").get("thumbnailConfigs")[r];return this.getOption("displayConfig").set("thumbSizeString",o.thumb),this.getOption("displayConfig").set("currentThumbConfigSize",r),o}},resizeThumbs:function(e){this.$el.find(".ckf-file-item").css({width:e+"px",height:e+"px"}),this.saveThumbsSize(e)},saveThumbsSize:e.debounce(function(e){var t=this.calculateThumbSizeConfig(e);this.children.invoke("trigger","sizeUpdate",{thumbSize:e,thumbSizeString:t.thumb})},d),applyBiggerThumbs:function(e){var t=this;if(e&&"thumbs"===t.getOption("displayConfig").get("mode")){e=parseInt(e,10),this.applySizeClass(e);var i=this.getOption("displayConfig").get("currentThumbConfigSize");if(!i||e>i){var n=this.calculateThumbSizeConfig(e);s.getOrCreate("files:resize",function(){t.children.invoke("trigger","sizeUpdate",{thumbSize:e,thumbSizeString:n.thumb}),t.trigger("sizeUpdate:after")}).runAfter(l)}else setTimeout(function(){t.trigger("sizeUpdate:after")},a)}},setListMode:function(){this.getOption("displayConfig").set("mode","list"),this.$el.removeClass("ckf-files-thumbs").addClass("ckf-files-list"),this.$el.find(".ckf-file-item").css({width:"auto",height:"auto"})},setThumbsMode:function(){this.getOption("displayConfig").set("mode","thumbs"),this.$el.removeClass("ckf-files-list").addClass("ckf-files-thumbs")},getThumbsInRow:function(){if("list"===this.getOption("displayConfig").get("mode")||this.children.length<2)return 1;var e,t,i=this.children.findByModel(this.collection.first()),n=i.$el.offset().top,r=1;for(e=1;e<this.collection.length&&(t=this.children.findByModel(this.collection.at(e)),t.$el.offset().top===n);e++)r+=1;return r},focus:function(){this.$el.focus()},getEmptyView:function(){var e=this.getEmptyViewData();return n.extend({msg:e.msg,displayLoader:e.displayLoader,displayInfo:!this.finder.config.readOnly})}};e.extend(c,i.getMethods()),c.events=i.getEvents();var u=t.extend(c);return u}),CKFinder.define("text!CKFinder/Templates/Files/List/FileIconCell.dot",[],function(){return'<img id="{{= it.getDragPreview() }}" class="ui-li-thumb" alt="" src="{{= it.getIcon() }}" draggable="true" data-ckf-drag-preview="{{= it.getDragPreview() }}" />'}),CKFinder.define("CKFinder/Modules/Files/Views/ListView/FileIconCellView",["CKFinder/Views/Base/ItemView","text!CKFinder/Templates/Files/List/FileIconCell.dot"],function(e,t){"use strict";var i=e.extend({name:"FileIconCellView",tagName:"td",template:t,templateHelpers:function(){var e=this;return{getIcon:this.getIcon.bind(this),getDragPreview:function(){return e.getOption("dragPreviewId")}}},getIcon:function(){return this.finder.request("file:getIcon",{size:this.getOption("listViewIconSize"),file:this.model})}});return i}),CKFinder.define("text!CKFinder/Templates/Files/List/FileNameCell.dot",[],function(){return'<a class="ui-btn" href="" tabindex="-1" draggable="true" data-ckf-drag-preview="{{= it.getDragPreview() }}" title="{{! it.name }}"><span dir="auto" class="ckf-files-inner">{{! it.name }}</span></a>'}),CKFinder.define("CKFinder/Modules/Files/Views/ListView/FileNameCellView",["CKFinder/Views/Base/ItemView","text!CKFinder/Templates/Files/List/FileNameCell.dot"],function(e,t){"use strict";var i=e.extend({name:"FileNameCellView",tagName:"td",template:t,className:"ckf-files-list-view-col-name ui-body-inherit",templateHelpers:function(){var e=this;return{getDragPreview:function(){return e.getOption("dragPreviewId")}}}});return i}),CKFinder.define("CKFinder/Modules/Files/Views/ListView/DateCellView",["CKFinder/Views/Base/ItemView"],function(e){"use strict";var t=e.extend({name:"DateCellView",tagName:"td",template:"{{! it.lang.formatDateString( it.date ) }}"});return t}),CKFinder.define("CKFinder/Modules/Files/Views/ListView/SizeCellView",["CKFinder/Views/Base/ItemView"],function(e){"use strict";var t=e.extend({name:"SizeCellView",tagName:"td",template:"{{! it.lang.formatFileSize( it.size * 1024 ) }}"});return t}),CKFinder.define("CKFinder/Modules/Files/Views/ListView/EmptyCellView",["CKFinder/Views/Base/ItemView"],function(e){"use strict";var t=e.extend({name:"EmptyCellView",tagName:"td",template:""});return t}),CKFinder.define("CKFinder/Modules/Files/Views/ListView/FileRowView",["underscore","backbone","CKFinder/Views/Base/CollectionView","CKFinder/Modules/Files/Views/Common/FileViewMixin","CKFinder/Modules/Files/Views/ListView/FileIconCellView","CKFinder/Modules/Files/Views/ListView/FileNameCellView","CKFinder/Modules/Files/Views/ListView/DateCellView","CKFinder/Modules/Files/Views/ListView/SizeCellView","CKFinder/Modules/Files/Views/ListView/EmptyCellView"],function(e,t,i,n,r,o,s,a,l){"use strict";var d={tagName:"tr",lazyLoad:!0,name:"FileListView",eventPrefix:"file",className:"ckf-file-item",initialize:function(){this.dragPreviewId=e.uniqueId("ckf-")},triggerEvent:function(e,t){this.trigger(this.getOption("eventPrefix")+":"+e,t)},getChildView:function(e){var t=e.get("name");if("icon"===t)return r;if("name"===t)return o;if("date"===t)return s;if("size"===t)return a;if("empty"===t)return l;var i={view:void 0};return this.finder.fire("listView:file:column:"+t,i),i.view?i.view:l},childViewOptions:function(){return{dragPreviewId:this.dragPreviewId,listViewIconSize:this.getOption("listViewIconSize"),model:this.model}},getActiveElement:function(){return this.$el.find("td > a")}};d.events=n.getEvents("td"),d.modelEvents=n.getModelEvents(),e.extend(d,n.getMethods());var c=i.extend(d);return c}),CKFinder.define("CKFinder/Modules/Files/Views/ListView/FolderIconCellView",["CKFinder/Modules/Files/Views/ListView/FileIconCellView"],function(e){"use strict";var t=e.extend({getIcon:function(){return this.finder.request("folder:getIcon",{size:this.getOption("listViewIconSize"),folder:this.model})}});return t}),CKFinder.define("text!CKFinder/Templates/Files/List/FolderNameCell.dot",[],function(){return'<a class="ui-btn" href="" tabindex="-1" draggable="false" data-ckf-drop="true" title="{{! it.label || it.name }}"><span dir="auto" class="ckf-files-inner">{{! it.label || it.name }}</span></a>'}),CKFinder.define("CKFinder/Modules/Files/Views/ListView/FolderNameCellView",["CKFinder/Views/Base/ItemView","text!CKFinder/Templates/Files/List/FolderNameCell.dot"],function(e,t){"use strict";var i=e.extend({name:"FolderNameCellView",tagName:"td",template:t,className:"ckf-files-list-view-col-name ui-body-inherit"});return i}),CKFinder.define("CKFinder/Modules/Files/Views/ListView/FolderRowView",["underscore","CKFinder/Modules/Files/Views/ListView/FileRowView","CKFinder/Modules/Files/Views/ListView/FolderIconCellView","CKFinder/Modules/Files/Views/ListView/FolderNameCellView","CKFinder/Modules/Files/Views/ListView/EmptyCellView"],function(e,t,i,n,r){"use strict";var o=t.extend({name:"FolderRowView",eventPrefix:"folder",className:"ckf-folder-item",events:e.extend({},t.prototype.events,{"dragstart td > a":function(e){e.preventDefault()},"dragend td > a":function(e){e.preventDefault()},"ckfdrop td > a":function(e){e.stopPropagation(),this.trigger("folder:drop",{evt:e,view:this,model:this.model})}}),getChildView:function(e){var t=e.get("name");if("icon"===t)return i;if("name"===t)return n;if("date"===t)return r;if("size"===t)return r;var o={view:void 0};return this.finder.fire("listView:folder:column:"+t,o),o.view?o.view:r},getLabel:function(){return this.$el.find('[data-ckf-drop="true"]')}});return o}),CKFinder.define("text!CKFinder/Templates/Files/List/ListView.dot",[],function(){return'<table class="ckf-files-view ckf-files-list-view"><thead><tr>{{~ it.columns.models : column }}<th{{? column.get("sort") }} data-ckf-sort="{{= column.get("sort") }}"{{?}}>{{= column.get( "label" ) }}{{? column.get("sort") === it.sortBy }}<span class="ckf-files-list-view-sorter">{{? it.sortByOrder === \'asc\' }}{{= it.asc }}{{?? it.sortByOrder === \'desc\' }}{{= it.desc }}{{?}}</span>{{?}}</th>{{~}}</tr></thead><tbody></tbody></table>'}),CKFinder.define("text!CKFinder/Templates/Files/FilesInfoInListView.dot",[],function(){return'<td><div class="ckf-files-info">{{? it.displayLoader }}<div class="ui-loader ui-loader-verbose ui-content ui-body-{{= it.swatch }} ui-corner-all"><span class="ui-icon-loading"></span><h1>{{= it.title }}</h1></div>{{??}}<div class="ckf-files-info-body ui-content ui-body-{{= it.swatch }} ui-corner-all"><h2>{{= it.title }}</h2>{{? it.displayLoader }}<p>{{= it.text }}</p>{{?}}</div>{{?}}</div></td>'}),CKFinder.define("CKFinder/Modules/Files/Views/ListView",["underscore","jquery","backbone","CKFinder/Views/Base/CompositeView","CKFinder/Modules/Files/Views/Common/FilesViewMixin","CKFinder/Modules/Files/Views/ListView/FileRowView","CKFinder/Modules/Files/Views/ListView/FolderRowView","CKFinder/Modules/Files/Views/Common/FilesInfoView","text!CKFinder/Templates/Files/List/ListView.dot","text!CKFinder/Templates/Files/FilesInfoInListView.dot"],function(e,t,i,n,r,o,s,a,l,d){"use strict";var c={name:"ListView",attributes:{tabindex:30},tagName:"div",className:"ckf-files-view-borders ui-body-inherit",reorderOnSort:!0,childViewContainer:"tbody",template:l,initialize:function(e){this.columns=new i.Collection([],{comparator:"priority"}),this.model=new i.Model,this.model.set("asc","&#9650;"),this.model.set("desc","&#9660;"),this.updateColumns(),this.listenTo(e.displayConfig,"change:sortBy",this.updateSortIndicator),this.listenTo(e.displayConfig,"change:sortByOrder",this.updateSortIndicator),this.on("maximize",this.updateHeightForBorders,this)},getChildView:function(e){return e.get("view:isFolder")?s:o},childViewOptions:function(){var e=this.getOption("displayConfig").toJSON();return e.collection=this.columns,e},onBeforeRender:function(){this.updateColumns()},isEmpty:function(){var e=!this.collection.length;return this.$el.toggleClass("ckf-files-list-empty",e),e},getEmptyView:function(){var e=this.getEmptyViewData();return a.extend({msg:e.msg,displayLoader:e.displayLoader,displayInfo:!this.finder.config.readOnly,template:d,tagName:"tr",className:""})},updateColumns:function(){var e=new i.Collection;e.add({name:"icon",label:"",priority:10}),e.add({name:"name",label:this.finder.lang.SetDisplayName,priority:20,sort:"name"}),this.getOption("displayConfig").get("displaySize")&&e.add({name:"size",label:this.finder.lang.SetDisplaySize,priority:30,sort:"size"}),this.getOption("displayConfig").get("displayDate")&&e.add({name:"date",label:this.finder.lang.SetDisplayDate,priority:40,sort:"date"}),this.finder.fire("listView:columns",{columns:e}),this.columns.reset(e.toArray()),this.model.set("columns",this.columns),this.model.set("sortBy",this.getOption("displayConfig").get("sortBy")),this.model.set("sortByOrder",this.getOption("displayConfig").get("sortByOrder"))},getThumbsInRow:function(){return 1},updateSortIndicator:function(){var e=this.getOption("displayConfig").get("sortBy"),t=this.getOption("displayConfig").get("sortByOrder");this.$el.find("th .ckf-files-list-view-sorter").html("asc"===t?this.model.get("asc"):this.model.get("desc")).appendTo(this.$el.find('th[data-ckf-sort="'+e+'"]'))}},u=r.getMethods();e.extend(c,u),c.events=e.extend({selectstart:function(e){e.preventDefault(),e.stopPropagation()},"mousedown th[data-ckf-sort]":function(e){e.stopPropagation(),e.stopImmediatePropagation(),e.preventDefault();var i=t(e.currentTarget).attr("data-ckf-sort"),n=this.getOption("displayConfig").get("sortBy");if(i===n){var r=this.getOption("displayConfig").get("sortByOrder");this.finder.request("settings:setValue",{group:"files",name:"sortByOrder",value:"asc"===r?"desc":"asc"})}else this.finder.request("settings:setValue",{group:"files",name:"sortBy",value:i})}},r.getEvents());var f=n.extend(c);return f}),CKFinder.define("CKFinder/Modules/Files/LazyLoader",["jquery","backbone"],function(e,t){"use strict";function i(e){this.finder=e,this.items=new t.Collection}function n(e,t,i,n){t.length&&t.chain().filter(function(e){return r(e,i)&&!e.has("timeoutId")}).forEach(function(o,s){var a=setTimeout(function(){r(o,i)?(t.remove(o),o.get("view").loadThumbnail(n.util.jsCssEntities(o.get("view").options.lazyThumb))):o.unset("timeoutId")},s*e);o.set("timeoutId",a)})}function r(e,t){var i=e.get("view").el.getBoundingClientRect(),n=i.top+i.height-t;return n>=0&&i.top<=(window.innerHeight||document.documentElement.clientHeight)}var o=50;return i.prototype.registerView=function(t){function i(){clearTimeout(r),r=setTimeout(function(){n(l.config.thumbnailDelay,d,s,l)},o)}var r,s,a=this,l=a.finder,d=a.items;a.items.reset(),t.on("render",function(){s=e(".ui-page-active .ui-header").height()||0,n(l.config.thumbnailDelay,d,s,l)}),t.once("show",function(){this.finder.util.isWidget()&&/iPad|iPhone|iPod/.test(navigator.platform)&&t.$el.closest('[data-ckf-page="Main"]').on("scroll",i)}),t.on("before:render",function(){d.chain().filter(function(e){return e.has("timeoutId")}).forEach(function(e){clearTimeout(e.get("timeoutId"))}),d.reset()}),t.on("add:child",function(e){e.options.lazyThumb&&(d.add({view:e}),i())}),t.on("sizeUpdate:after",i),t.on("childview:rerender",function(e){e.options.lazyThumb&&d.add({view:e}),i()}),e(document).on("scroll",i),e(window).on("resize",i),this.throttle=i},i.prototype.disable=function(){e(document).off("scroll",this.throttle),e(window).off("resize",this.throttle)},i}),CKFinder.define("CKFinder/Modules/Files/Views/ViewManager",["underscore","jquery","CKFinder/Util/KeyCode","CKFinder/Modules/Files/Views/ThumbnailsView","CKFinder/Modules/Files/Views/ListView","CKFinder/Modules/Files/LazyLoader"],function(e,t,i,n,r,o){"use strict";function s(e){var t;e.data.modeChanged&&("desktop"===e.data.mode?(this.view.setThumbsMode(),e.finder.request("settings:enable",{group:"files",name:"thumbSize"}),t=e.finder.request("settings:getValue",{group:"files",name:"thumbSize"}),this.view.resizeThumbs(t),this.view.applyBiggerThumbs(t)):(e.finder.request("settings:disable",{group:"files",name:"thumbSize"}),this.view.setListMode()))}function a(e){var t=e.data.value;this.view.resizeThumbs(t),this.view.applyBiggerThumbs(t)}function l(e,i){function n(e){e.preventDefault(),e.stopPropagation()}function r(e){t(document).off("mousemove",o),t(document).off("mouseup",r),setTimeout(function(){document.removeEventListener("click",n,!0)},50),d.remove();var i=t(e.target);i.data("ckf-drop")&&i.trigger(new t.Event("ckfdrop",{ckfFilesSelection:!0}))}function o(e){s(d,e)}function s(e,i){var n=t(i.target);n.data("ckf-drop")&&n.trigger("ckfdragover"),e.css({top:i.originalEvent.clientY+10,left:i.originalEvent.clientX+10})}var a=i.request("files:getSelected"),l=a.length;e.originalEvent.stopPropagation(),e.originalEvent.preventDefault();var d=t('<div class="ckf-drag">'),c="#"+t(e.target).attr("data-ckf-drag-preview"),u='<img alt="" src="'+t(c).attr("src")+'">';l>1?d.append(t(u).addClass("ckf-drag-first")).append(t(u).addClass("ckf-drag-second")).append(t(u).addClass("ckf-drag-third")).append('<div class="ckf-drag-info">'+l+"</div>"):d.append(t(u)),d.appendTo("body"),s(d,e),d.on("mousemove",o),d.on("mouseup",r),t(document).on("mousemove",o),t(document).one("mouseup",r),document.addEventListener("click",n,!0)}var d=function(t,n){this.finder=t,this.config=n;var r=this;t.on("settings:change:files",function(t){n.set(t.data.settings),e.contains(["displayDate","displayName","displaySize"],t.data.changed)&&r.view.render()}),t.request("key:listen",{key:i.f9}),t.on("keydown:"+i.f9,function(e){t.util.isShortcut(e.data.evt,"alt")&&(e.data.evt.preventDefault(),e.data.evt.stopPropagation(),r.view.$el.focus())}),t.on("shortcuts:list:general",function(e){e.data.shortcuts.add({label:e.finder.lang.Shortcuts.general.focusFilesPane,shortcuts:"{alt}+{f9}"})},null,null,40)};return d.prototype.createView=function(t){function i(e,t){t.evt.preventDefault(),c.request("folder:openPath",{path:t.model.getPath({full:!0})})}var d,c=this.finder,u={finder:c,collection:t,displayConfig:this.config},f=this.config.get("viewType");if("thumbnails"===f){d=new n(e.extend(u,{mode:"desktop"===c.request("ui:getMode")?"thumbs":"list"}));var h=new o(c);h.registerView(d),c.on("ui:resize",s,this),c.on("settings:change:files:thumbSize",a,this),d.on("destroy",function(){h.disable()})}else{if("list"!==f)throw"Wrong view type";d=new r(u)}return d.on("childview:file:contextmenu",function(e,t){t.evt.preventDefault(),c.request("contextMenu",{name:"file",evt:t.evt,positionToEl:e.$el,context:{file:e.model}})}),d.on("childview:folder:contextmenu",function(e,t){t.evt.preventDefault(),c.request("contextMenu",{name:"folder",evt:t.evt,positionToEl:e.$el,context:{folder:t.model}})}),d.on("childview:file:keydown",function(e,t){c.fire("file:keydown",{evt:t.evt,file:t.model,source:"filespane"},c)}),d.on("childview:file:dragstart",function(e,t){var i=c.request("files:getSelected");i.contains(t.model)||(c.request("files:deselectAll"),c.request("files:select",{files:[t.model]})),l(t.evt,c)}),d.on("childview:folder:keydown",function(e,t){c.fire("folder:keydown",{evt:t.evt,folder:t.model,source:"filespane"},c)}),d.on("childview:folder:click",function(e,t){t.model.get("isRoot")||c.request("toolbar:reset",{name:"Main",event:"folder",context:{folder:t.model}})}),d.on("childview:folder:dblclick",i),d.on("childview:folder:dbltap",i),d.on("childview:file:dblclick",function(e,t){c.fire("file:dblclick",{evt:t.evt,file:t.model})}),d.on("childview:file:dbltap",function(e,t){c.fire("file:dbltap",{evt:t.evt,file:t.model})}),d.on("childview:folder:drop",function(e,t){c.fire("folder:drop",{evt:t.evt,folder:t.model,view:t.view},c)}),this.view=d,c.request("page:showInRegion",{page:"Main",region:"main",view:d}),d},d.prototype.destroyList=function(){this.finder.request("settings:enable",{group:"files",name:"displayName"}),"desktop"===this.finder.request("ui:getMode")&&this.finder.request("settings:enable",{group:"files",name:"thumbSize"})},d.prototype.destroyThumbnails=function(){this.finder.removeListener("ui:resize",s),this.finder.removeListener("settings:change:files:thumbSize",a),this.finder.request("settings:disable",{group:"files",name:"thumbSize"}),this.finder.request("settings:disable",{group:"files",name:"displayName"})},d}),CKFinder.define("CKFinder/Modules/Files/SelectionHandler",["underscore","backbone","CKFinder/Util/KeyCode"],function(e,t,i){"use strict";function n(e,i,n){function r(t){o.isInSelectionMode&&(t.data.toolbar.push({name:"ClearSelection",type:"button",priority:105,icon:"ckf-cancel",iconOnly:!0,title:t.finder.lang.Choose,action:function(){o.isInSelectionMode=!1,t.finder.request("files:getSelected").length?t.finder.request("files:deselectAll"):t.finder.request("toolbar:reset",{name:"Main",event:"folder",context:{folder:t.finder.request("folder:getActive")}})}}),t.data.toolbar.push({name:"ClearSelectionText",type:"text",priority:100,label:e.lang.formatFilesCount(e.request("files:getSelected").length)}))}this.filesModule=i,this.finder=e,this.selectedFiles=new t.Collection,this.displayedFiles=n,this.lastFolderCid=null,this.isInSelectionMode=!1,this.focusedFile=null,this.rangeSelectionStart=l;var o=this;e.on("toolbar:reset:Main:folder",r,null,null,20),e.on("toolbar:reset:Main:file",r,null,null,20),e.on("toolbar:reset:Main:files",r,null,null,20)}function r(e,t){var i=t.lastFolderCid,n=e.request("folder:getActive"),r=n&&n.cid,o=!i||i===r;if(o){var s=t.getSelectedFiles(t);e.fire("files:selected",{files:s},e)}t.filesModule.view.shouldFocusFirstChild()&&t.selectFiles(0),t.lastFolderCid=r}function o(t,n){var o=n.evt,a=o.keyCode;if(e.contains([i.space,i.left,i.right,i.up,i.down],a)){o.preventDefault(),o.stopPropagation();var l,d=this.displayedFiles.indexOf(this.focusedFile);if(a===i.space&&(l=d,this.selectedFiles.length>1))return s(this),this.resetRangeSelection(),void r(this.finder,this);var c={isAddToRange:!!o.shiftKey};a===i.up&&(l=d-this.filesModule.view.getThumbsInRow()),a===("ltr"===this.finder.lang.dir?i.left:i.right)&&(l=d-1),a===("ltr"===this.finder.lang.dir?i.right:i.left)&&(l=d+1),a===i.down&&(l=d+this.filesModule.view.getThumbsInRow()),this.selectFiles(l,c)}}function s(e){e.selectedFiles.forEach(function(e){e.trigger("deselected")}),e.selectedFiles.reset([],{silent:!0})}function a(e){e.request("key:listen",{key:i.a}),e.on("keydown:"+i.a,function(e){e.finder.util.isShortcut(e.data.evt,"ctrl")&&(e.data.evt.preventDefault(),e.finder.request("files:selectAll"))}),e.on("shortcuts:list:files",function(e){e.data.shortcuts.add({label:e.finder.lang.Shortcuts.files.selectAll,shortcuts:"{ctrl}+{a}"}),e.data.shortcuts.add({label:e.finder.lang.Shortcuts.files.addToSelectionLeft,shortcuts:"{shift}+{leftArrow}"}),e.data.shortcuts.add({label:e.finder.lang.Shortcuts.files.addToSelectionRight,shortcuts:"{shift}+{rightArrow}"}),e.data.shortcuts.add({label:e.finder.lang.Shortcuts.files.addToSelectionAbove,shortcuts:"{shift}+{upArrow}"}),e.data.shortcuts.add({label:e.finder.lang.Shortcuts.files.addToSelectionBelow,shortcuts:"{shift}+{downArrow}"})},null,null,50)}var l=-1;return n.prototype.resetRangeSelection=function(){this.rangeSelectionStart=l},n.prototype.selectFiles=function(t,i){var n=this,r=this.displayedFiles,o=n.displayedFiles.indexOf(n.focusedFile),a=e.extend({},i),d=r.at(t);if(d){if(a.resetSelection&&s(n),a.isAddToRange||this.resetRangeSelection(),o||(o=0),o===t&&!a.forceSelect||a.isToggle)return this.filesSelectToggleHandler({files:[d]}),void this.focusFile(d);var c={files:d};if(a.isAddToRange){this.rangeSelectionStart===l&&(this.rangeSelectionStart=o);var u=t>this.rangeSelectionStart?this.rangeSelectionStart:t,f=t>this.rangeSelectionStart?t:this.rangeSelectionStart;c={files:r.slice(u,f+1)}}s(n),this.filesSelectHandler(c),this.focusFile(d)}},n.prototype.filesSelectHandler=function(t){e.isArray(t.files)||(t.files=[t.files]),this.selectedFiles.add(t.files),1===t.files.length&&(this.focusedFile=t.files[0]),r(this.finder,this)},n.prototype.filesSelectToggleHandler=function(t){e.isArray(t.files)&&(e.forEach(t.files,function(e){this.selectedFiles.indexOf(e)<0?this.selectedFiles.add(e):(e.trigger("deselected"),this.selectedFiles.remove(e))},this),r(this.finder,this))},n.prototype.getSelectedFiles=function(){return new t.Collection(this.selectedFiles.where({"view:isFolder":!1}))},n.prototype.registerHandlers=function(){var e=this,t=e.finder,i=e.filesModule;e.selectedFiles.on("reset",function(){r(t,e)}),i.view.on("click",function(e){e.evt.stopPropagation(),t.request("files:deselectAll")}),t.setHandlers({"files:select":{callback:this.filesSelectHandler,context:this},"files:select:toggle":{callback:this.filesSelectToggleHandler,context:this},"files:getSelected":{callback:this.getSelectedFiles,context:this},"files:selectAll":function(){e.selectedFiles.reset(i.files.toArray()),e.selectedFiles.forEach(function(e){e.trigger("selected")}),r(t,e)},"files:deselectAll":function(){e.selectedFiles.length&&(e.selectedFiles.forEach(function(e){e.trigger("deselected")}),e.selectedFiles.reset())}}),t.on("folder:selected",function(){e.isInSelectionMode=!1},null,null,1),t.on("folder:getFiles:after",function(){e.isInSelectionMode=!1,e.selectedFiles.reset(),e.resetRangeSelection()}),t.on("files:selected",function(e){e.data.files.forEach(function(e){e.trigger("selected")})}),a(t),t.on("shortcuts:list:general",function(e){e.data.shortcuts.add({label:e.finder.lang.Shortcuts.general.nextItem,shortcuts:"{rightArrow}|{downArrow}"}),e.data.shortcuts.add({label:e.finder.lang.Shortcuts.general.previousItem,shortcuts:"{leftArrow}|{upArrow}"}),e.data.shortcuts.add({label:e.finder.lang.Shortcuts.general.firstItem,shortcuts:"{home}"}),e.data.shortcuts.add({label:e.finder.lang.Shortcuts.general.lastItem,shortcuts:"{end}"})},null,null,80)},n.prototype.registerView=function(e){function t(e,t){t.evt.preventDefault(),t.evt.stopPropagation(),n.isInSelectionMode?n.selectFiles(n.displayedFiles.indexOf(t.model),{isAddToRange:!1,isToggle:!0}):n.selectFiles(n.displayedFiles.indexOf(t.model),{isAddToRange:!!t.evt.shiftKey,isToggle:!!t.evt.ctrlKey||!!t.evt.metaKey})}this.finder,e.on("childview:file:click",t),e.on("childview:folder:click",t),e.on("childview:file:longtouch",function(e,t){n.isInSelectionMode||(n.isInSelectionMode=!0,n.selectFiles(n.displayedFiles.indexOf(t.model),{isAddToRange:!1,isToggle:!0,resetSelection:!0}))}),e.on("childview:folder:keydown",o.bind(this)),e.on("childview:file:keydown",o.bind(this)),e.on("keydown",function(e){var t,r=e.evt;if((r.keyCode===("ltr"===this.finder.lang.dir?i.left:i.right)||r.keyCode===i.end)&&(t=n.displayedFiles.last()),(r.keyCode===("ltr"===this.finder.lang.dir?i.right:i.left)||r.keyCode===i.home)&&(t=n.displayedFiles.first()),t){r.stopPropagation(),r.preventDefault();var o=r.keyCode===i.left||r.keyCode===i.right||r.keyCode===i.down||r.keyCode===i.up;n.selectFiles(n.displayedFiles.indexOf(t),{forceSelect:o,isAddToRange:!!r.shiftKey,isToggle:!!e.evt.ctrlKey||!!e.evt.metaKey})}});var n=this;e.on("focused",function(){var e=n.focusedFile?n.focusedFile:n.filesModule.displayedFiles.first();setTimeout(function(){n.focusedFile||n.selectFiles(0),e.trigger("focus")},0)})},n.prototype.focusFile=function(e){e.trigger("focus"),this.focusedFile=e},n}),CKFinder.define("CKFinder/Modules/Files/FilesCache",["underscore","backbone"],function(e,t){"use strict";function i(e){this.maxFiles=e&&e.maxFiles||100,this.cache=new n}var n=t.Collection.extend({sort:"updated",initialize:function(){this.on("add",function(){var e=0;this.forEach(function(t){e+=t.get("files").length}),this.size=e},this),this.on("remove",function(){var e=0;this.forEach(function(t){e+=t.get("files").length}),this.size=e},this)}});return i.prototype.add=function(e,t,i){var n=this.cache.findWhere({cid:e});n&&this.cache.remove(n);var r={cid:e,files:t,response:i,updated:(new Date).getTime()};for(this.cache.add(r);this.cache.size>this.maxFiles&&this.cache.length>1;)this.cache.shift()},i.prototype.get=function(e){var t=this.cache.findWhere({cid:e});return!!t&&t.toJSON()},i}),CKFinder.define("CKFinder/Modules/Files/Views/ViewConfig",["underscore","backbone"],function(e,t){"use strict";var i=t.Model.extend({defaults:{isInitialized:!1,areThumbnailsResizable:!1,serverThumbs:[],thumbnailConfigs:{},thumbnailMinSize:null,thumbnailMaxSize:null,thumbnailSizeStep:1,listViewIconSize:32},updateThumbsConfig:function(t,i){e.forEach(t,function(e){var t=e.split("x"),i=t[0]>t[1]?t[0]:t[1];this.get("serverThumbs").push(parseInt(i,10)),this.get("thumbnailConfigs")[i]={width:t[0],height:t[1],thumb:e}},this);var n=parseInt(i.thumbnailMaxSize,10),r=parseInt(i.thumbnailMinSize,10);this.get("serverThumbs").length&&(r||(r=e.min(this.get("serverThumbs"))),n||(n=e.max(this.get("serverThumbs")))),this.set("areThumbnailsResizable",!(!r||!n));var o=e.max(this.get("serverThumbs"));this.set("thumbnailMaxSize",n>o?o:n),this.set("thumbnailMinSize",r),this.set("thumbnailSizeStep",i.thumbnailSizeStep),this.set("listViewIconSize",i.listViewIconSize)},createSettings:function(e,t,i){var n={group:"files",label:e.SetDisplay,settings:[{name:"displayName",label:e.SetDisplayName,type:"checkbox",defaultValue:t.defaultDisplayFileName},{name:"displayDate",label:e.SetDisplayDate,type:"checkbox",defaultValue:t.defaultDisplayDate},{name:"displaySize",label:e.SetDisplaySize,type:"checkbox",defaultValue:t.defaultDisplayFileSize},{name:"viewType",label:e.SetView,type:"radio",defaultValue:t.defaultViewType,attributes:{options:{list:e.SetViewList,thumbnails:e.SetViewThumbnails}}},{name:"sortBy",label:e.SetSortBy,type:"select",defaultValue:t.defaultSortBy,attributes:{options:{name:e.SetDisplayName,size:e.SetDisplaySize,date:e.SetDisplayDate}}},{name:"sortByOrder",label:e.SetSortByOrder,type:"radio",defaultValue:t.defaultSortByOrder,attributes:{options:{asc:e.SetSortAscending,desc:e.SetSortDescending}}}]},r={name:"thumbSize",label:e.SetDisplayThumbnailSize,type:"hidden",defaultValue:t.thumbnailDefaultSize};return this.get("areThumbnailsResizable")&&(r.type="range",r.isEnabled=i,r.attributes={min:this.get("thumbnailMinSize"),max:this.get("thumbnailMaxSize"),step:this.get("thumbnailSizeStep")}),n.settings.push(r),n}});return i}),CKFinder.define("CKFinder/Modules/Files/Files",["underscore","jquery","backbone","CKFinder/Models/File","CKFinder/Models/Folder","CKFinder/Util/KeyCode","CKFinder/Modules/Files/FilesFilter","CKFinder/Modules/Files/ChooseFiles","CKFinder/Modules/Files/Views/ViewManager","CKFinder/Modules/Files/SelectionHandler","CKFinder/Modules/Files/FilesCache","CKFinder/Modules/Files/Views/ViewConfig"],function(e,t,i,n,r,o,s,a,l,d,c,u){"use strict";function f(n){var r=this;r.finder=n,r.initDfd=new t.Deferred,r.config=new u,r.files=new i.Collection,r.displayedFiles=s.attachTo(r.files),r.displayedFiles.isLoading=!0,r.filesCache=new c({maxFiles:2e3}),r.viewManager=new l(n,r.config),new a(n),n.once("command:ok:Init",F,r,null,30),n.setHandlers({"file:getThumb":{callback:m,context:r},"file:getIcon":{callback:w,context:r},"folder:getIcon":{callback:v,context:r},"files:filter":{callback:p,context:r},"file:getActive":function(){return r.selection.focusedFile},"files:getCurrent":function(){return r.files.clone()},"files:getDisplayed":function(){return r.displayedFiles.clone()},"folder:getFiles":{callback:g,context:r},"folder:refreshFiles":{callback:b,context:r},"resources:show":{callback:C,context:r}}),n.on("contextMenu:file",function(e){e.data.groups.add({name:"edit"})},null,null,30),n.on("files:deleted",function(t){var i=r.files.length;if(e.forEach(t.data.files,function(e){var t=r.files.indexOf(e);i>t&&(i=t)}),i>0&&(i-=1),r.files.remove(t.data.files),r.finder.request("files:deselectAll"),r.files.length){var n=r.files.at(i);r.selection.focusFile(n)}else r.view.focus()}),n.config.displayFoldersPanel||(n.on("folder:deleted",function(e){r.files.remove(e.data.folder),r.finder.request("files:deselectAll")}),n.on("command:after:GetFolders",function(e){r.doAfterInit(function(){var t=n.request("folder:getActive");if(t&&t.isPath(e.data.response.currentFolder.path,e.data.response.resourceType)){r.files.add(t.get("children").toArray());var i=r.filesCache.get(t.cid);r.filesCache.add(t.cid,r.files.toArray(),i?i.response:"")}})},null,null,30)),n.on("command:after:GetFiles",x,this),n.on("file:dblclick",h,r),n.on("file:dbltap",h,r),n.on("file:keydown",function(e){n.util.isShortcut(e.data.evt,"")&&e.data.evt.keyCode===o.enter&&(e.stop(),e.data.evt.preventDefault(),h.call(r,e))}),n.on("command:error:RenameFile",M,null,null,5),n.on("shortcuts:list",function(e){e.data.groups.add({name:"files",priority:20,label:e.finder.lang.Shortcuts.files.title})}),n.on("folder:selected",function(e){var t=e.data.folder,i=e.data.previousFolder;t!==i?e.finder.request("folder:getFiles",{folder:t}):r.displayedFiles.search("")}),n.on("settings:change:files:viewType",function(e){var t=e.data.value;"list"===t?r.viewManager.destroyThumbnails(r):"thumbnails"===t&&r.viewManager.destroyList(r),r.view=r.viewManager.createView(r.displayedFiles),r.selection.registerView(r.view)}),n.on("settings:change:files:sortBy",function(e){
r.displayedFiles.sortByField(e.data.value),r.config.set("sortBy",e.data.value)}),n.on("settings:change:files:sortByOrder",function(e){r.config.set("sortByOrder",e.data.value),"asc"===e.data.value?r.displayedFiles.sortAscending():r.displayedFiles.sortDescending()}),K(n)}function h(e){var t=this.finder,i=e.data.file;t.request("files:select",{files:i}),t.config.chooseFiles&&t.config.chooseFilesOnDblClick?t.request("files:choose",{files:t.request("files:getSelected")}):t.request("file:preview",{file:i})}function g(t){var i=t.folder,n=this.finder,r=e.extend({folder:i},t.context);this.displayedFiles.isLoading=!0,this.files.reset();var o=this.filesCache.get(i.cid);return o!==!1&&(this.displayedFiles.isLoading=!1,this.files.reset(o.files)),n.fire("folder:getFiles:before",r,n)?n.request("command:send",{name:"GetFiles",folder:i,context:r}):void 0}function p(e){var t=this;t._lastFilterTimeout&&(clearTimeout(t._lastFilterTimeout),t._lastFilterTimeout=null),t.displayedFiles.length<200?t.displayedFiles.search(e.text):t._lastFilterTimeout=setTimeout(function(){t.displayedFiles.search(e.text)},1e3)}function m(e){var t=e.file,i={fileName:t.get("name"),date:t.get("date"),fileSize:t.get("size")};return e.size&&(i.size=e.size),this.finder.request("command:url",{command:"Thumbnail",folder:t.get("folder"),params:i})}function v(e){return y(this.finder,"folder",e.size)}function w(e){return y(this.finder,e.file.getExtension(),e.size)}function y(t,i,n){function r(e){for(var t=o.length,i=t-1;e>parseInt(o[--t])&&t>=0;)i=t;return o[i]}var o=t.config.fileIconsSizes.split(",");i=i.toLocaleLowerCase();var s=t.config.fileIcons[e.has(t.config.fileIcons,i)?i:"default"],a="?ver=js6uhv";return t.util.url(t.config.fileIconsPath+r(n)+"/"+s+a)}function b(t){var i=this.finder;i.request("loader:show",{text:i.lang.FilesRefresh});var n=i.request("folder:getActive"),r=i.request("command:send",{name:"GetFiles",folder:n,context:e.extend({folder:n},t&&t.context)});return r.then(function(){i.request("loader:hide")}),r}function C(){var e=this,t=e.finder;e.doAfterInit(function(){t.fire("resources:show:before",{resources:e.resources},t),e.files.reset(t.request("resources:get").toArray()),t.config.rememberLastFolder&&t.request("settings:setValue",{group:"folders",name:"lastFolder",value:"/"}),t.fire("resources:show",{resources:e.resources},t)})}function F(e){var t=this,i=t.finder;e.data.response.thumbs&&t.config.updateThumbsConfig(e.data.response.thumbs,i.config);var n=i.request("settings:define",t.config.createSettings(i.lang,i.config,"desktop"===i.request("ui:getMode")));if(t.config.set(n),t.config.get("thumbSize")&&"thumbnails"===t.config.get("viewType")){var r=t.config.get("thumbSize"),o=null;r>t.config.get("thumbnailMaxSize")?o=t.config.get("thumbnailMaxSize"):r<t.config.get("thumbnailMinSize")&&(o=t.config.get("thumbnailMinSize")),o&&(t.config.set("thumbSize",o),t.finder.request("settings:setValue",{group:"files",name:"thumbSize",value:o}))}"list"===t.config.get("viewType")&&(i.request("settings:disable",{group:"files",name:"thumbSize"}),i.request("settings:disable",{group:"files",name:"displayName"})),t.displayedFiles.sortByField(t.config.get("sortBy")),"asc"===t.config.get("sortByOrder")?t.displayedFiles.sortAscending():t.displayedFiles.sortDescending(),k.call(t,i),i.request("page:create",{name:"Main",mainRegionAutoHeight:!0,className:"ckf-files-page"+(i.config.displayFoldersPanel?"":" ckf-files-no-tree")}),i.request("page:show",{name:"Main"}),t.view=t.viewManager.createView(t.displayedFiles),t.selection=new d(i,t,t.displayedFiles),t.selection.registerHandlers(),t.selection.registerView(t.view),t.initDfd.resolve()}function x(t){var i=this,r=t.data.response,o=t.finder,s=o.request("folder:getActive");if(!t.data.response.error&&s&&s.isPath(r.currentFolder.path,r.resourceType)){var a=r.files,l=[];o.config.displayFoldersPanel||s.get("children").forEach(function(e){l.push(e)});var d=i.filesCache.get(s.cid);if(!d||d.response!==t.data.rawResponse){var c=i.files.filter(function(t){if(t.get("view:isFolder"))return!1;var i=e.findWhere(a,{name:t.get("name")});return!i||(t.set(i),i.isParsed=!0,!1)});i.displayedFiles.isLoading=!1,c&&i.files.remove(c);var u=i.files.length>0;e.forEach(a,function(e){if(!e.isParsed){var t=new n(e);t.set("folder",s),u?i.files.add(t):l.push(t)}}),u||i.files.reset(l),i.filesCache.add(s.cid,i.files.toArray(),t.data.rawResponse)}o.fire("folder:getFiles:after",{folder:s},o),(window.scrollY||window.pageYOffset)&&window.scrollTo(0,0)}}function k(e){var t=this;e.on("page:create:Main",function(e){e.finder.request("toolbar:create",{name:"Main",page:"Main"})}),e.on("resources:show",function(){e.request("toolbar:reset",{name:"Main",event:"resources"})}),e.on("files:selected",function(e){var t=e.data.files;if(!t.length){var i=e.finder.request("folder:getActive");return i?void e.finder.request("toolbar:reset",{name:"Main",event:"folder",context:{folder:i}}):void e.finder.request("toolbar:reset",{name:"Main",event:"resources"})}return t.length>1?void e.finder.request("toolbar:reset",{name:"Main",event:"files",context:{files:t}}):void e.finder.request("toolbar:reset",{name:"Main",event:"file",context:{file:t.at(0)}})},t)}function M(e){117===e.data.response.error.number&&(e.cancel(),e.finder.request("dialog:info",{msg:e.finder.lang.ErrorMsg.MissingFile}),e.finder.request("folder:refreshFiles"))}function E(e){e.data.evt.preventDefault(),e.data.evt.stopPropagation();var t=e.finder.request("folder:getActive");e.finder.request("folder:refreshFiles"),e.finder.request("command:send",{name:"GetFolders",folder:t,context:{parent:t}})}function K(e){e.request("key:listen",{key:o.f5}),e.request("key:listen",{key:o.r}),e.on("keydown:"+o.f5,function(t){(e.util.isShortcut(t.data.evt,"")||e.util.isShortcut(t.data.evt,"ctrl")||e.util.isShortcut(t.data.evt,"shift")||e.util.isShortcut(t.data.evt,"ctrl+shift"))&&E(t)}),e.on("keydown:"+o.r,function(t){(e.util.isShortcut(t.data.evt,"ctrl")||e.util.isShortcut(t.data.evt,"ctrl+shift"))&&E(t)}),e.on("shortcuts:list:files",function(e){e.data.shortcuts.add({label:e.finder.lang.Shortcuts.files.refresh,shortcuts:"{f5}|{ctrl}+{r}"})},null,null,60)}f.prototype.doAfterInit=function(e){this.initDfd.promise().done(e)};return f}),CKFinder.define("text!CKFinder/Templates/Folders/FolderTreeNodeView.dot",[],function(){return'<a role="treeitem" class="ckf-folders-tree-label {{? !it.hasChildren }}ckf-folders-tree-no-children{{?}}" tabindex="-1" data-ckf-drop="true"><span>{{! it.label || it.name }}</span></a><a class="ckf-folders-tree-expander {{? !it.hasChildren }}ckf-folders-tree-no-children{{?}}" data-icon="custom" data-iconpos="notext"></a><div class="ckf-folders-tree-body"><ul data-role="listview" style="display:none;"></ul></div>'}),CKFinder.define("CKFinder/Modules/Folders/Views/FolderTreeNodeView",["underscore","CKFinder/Views/Base/CompositeView","text!CKFinder/Templates/Folders/FolderTreeNodeView.dot","CKFinder/Util/KeyCode","ckf-jquery-mobile"],function(e,t,i,n){"use strict";var r=t.extend({name:"FolderTreeNode",tagName:"li",className:"ckf-folders-tree",childViewContainer:"ul:first",template:i,bubbleEvents:["folder:expand","folder:click","folder:contextmenu","folder:keydown","folder:drop","folder:before:remove:child","selected:before","focus"],modelEvents:{selected:"onModelSelected",deselected:"deselect",change:"onModelChange","ui:expand":"expand"},onBeforeRemoveChild:function(e){this.trigger("folder:before:remove:child",{origin:this,removedView:e})},collectionEvents:{remove:function(){0===this.collection.length&&this.collapse()}},attributes:{role:"presentation"},ui:{subTree:"ul:first",expander:".ckf-folders-tree-expander:first",label:".ckf-folders-tree-label:first"},events:{"vmousedown @ui.expander":function(){this.trigger("focus",{origin:this})},"click @ui.expander":function(e){e.stopPropagation(),this.requestExpand()},"contextmenu @ui.label":function(e){e.stopPropagation(),this.triggerContextMenu(e)},"click @ui.label":function(e){e.stopPropagation(),2===e.button||3===e.button?this.triggerContextMenu(e):this.trigger("folder:click",{view:this})},"keydown @ui.label":function(e){return e.keyCode===n.menu||e.keyCode===n.f10&&this.finder.util.isShortcut(e,"shift")?(e.stopPropagation(),void this.triggerContextMenu(e)):void this.trigger("folder:keydown",{evt:e,view:this,model:this.model})},"mouseout @ui.label":function(){this.model.get(this.viewMetadataPrefix+":isSelected")||this.ui.label.removeClass("ui-btn-active")},"ckfdragover @ui.label":function(e){e.stopPropagation(),e.preventDefault(),this.ui.label.addClass("ui-btn-active")},"ckfdrop @ui.label":function(e){e.stopPropagation(),this.model.get(this.viewMetadataPrefix+":isSelected")||this.ui.label.removeClass("ui-btn-active"),this.trigger("folder:drop",{evt:e,view:this,model:this.model})},"focus @ui.expander":function(e){e.preventDefault(),e.stopPropagation()}},initialize:function(t){var i=this;i.collection=i.model.get("children"),i.viewMetadataPrefix=t.viewMetadataPrefix||"view",i.options=e.extend({workingIcon:"ui-icon-ckf-rotate",expandedIcon:"ui-icon-ckf-arrow-d",collapsedIcon:"ui-icon-ckf-arrow-"+("ltr"===i.finder.lang.dir?"r":"l")},t),i.model.has(i.viewMetadataPrefix+":isExpanded")||i.model.set(i.viewMetadataPrefix+":isExpanded",!1)},onModelSelected:function(){this.trigger("selected:before"),this.ui.label.addClass("ui-btn-active"),this.model.set(this.viewMetadataPrefix+":isSelected",!0),this.expandParents(),this.focus()},deselect:function(){this.ui.label.removeClass("ui-btn-active"),this.model.set(this.viewMetadataPrefix+":isSelected",!1),this.children.call("deselect")},onModelChange:function(t){var i=this,n=!1,r=["name","parent"];if(e.keys(t.changed).forEach(function(t){e.contains(r,t)&&(n=!0)}),e.isUndefined(t.changed.hasChildren)||t.changed.hasChildren||(n=!0),t.get("hasChildren")||t.set(i.viewMetadataPrefix+":isExpanded",!1,{silent:!0}),n){var o=!!this.$el.find(":focus").length;i.render(),o&&this.ui.label.focus()}else t.changed.hasChildren&&(i.ui.label.removeClass("ckf-folders-tree-no-children"),i.ui.expander.removeClass("ckf-folders-tree-no-children")),i.refreshUI()},onRender:function(){var t=this;t.refreshUI(),t.model.get(t.viewMetadataPrefix+":isExpanded")?t.expand():t.collapse(),t.model.get(t.viewMetadataPrefix+":isSelected")&&this.ui.label.addClass("ui-btn-active"),this.ui.label.attr("aria-level",this.calculateLevel());var i=this.$el.attr("id")||e.uniqueId();this.ui.label.attr("aria-labelledby",i),this.ui.label.find("span").attr("id",i)},refreshUI:function(){var e=this;e.$el.closest("ul").listview().listview("refresh"),this.ui.subTree.listview().listview("refresh"),e.model.get("isPending")?(e.ui.expander.addClass(e.options.workingIcon).addClass("ckf-tree-loading"),e.$el.find("> .ckf-folders-tree-label, > .ckf-folders-tree-expander").addClass("ui-state-disabled").attr("aria-disabled","true"),e.ui.label.attr("aria-busy","true")):(e.ui.expander.removeClass(e.options.workingIcon).removeClass("ckf-tree-loading"),e.$el.find("> .ckf-folders-tree-label, > .ckf-folders-tree-expander").removeClass("ui-state-disabled").attr("aria-disabled","false"),e.ui.label.attr("aria-busy","false")),e.model.get(e.viewMetadataPrefix+":isExpanding")?(e.ui.expander.addClass(e.options.workingIcon).addClass("ckf-tree-loading"),e.ui.label.attr("aria-busy","true")):e.model.get("isPending")||(e.ui.expander.removeClass(e.options.workingIcon).removeClass("ckf-tree-loading"),e.ui.label.attr("aria-busy","false"))},childViewOptions:function(){return{viewMetadataPrefix:this.viewMetadataPrefix}},onAddChild:function(t){var i=this;this.refreshUI(),i.model.get(i.viewMetadataPrefix+":isExpanding")&&i.expand(),e.each(i.bubbleEvents,function(e){t.on(e,function(t){i.trigger(e,t)})}),t.parentView=this},collapse:function(){this.children.each(function(e){e.collapse()}),this.ui.subTree.hide().attr("aria-hidden","true"),this.ui.expander.removeClass(this.options.workingIcon).removeClass(this.options.expandedIcon).removeClass("ckf-tree-loading").addClass(this.options.collapsedIcon),this.model.get("hasChildren")?this.ui.label.attr("aria-expanded",!1):this.ui.label.removeAttr("aria-expanded"),this.$el.removeClass("ckf-tree-expanded"),this.model.set(this.viewMetadataPrefix+":isExpanded",!1)},expand:function(){this.ui.subTree.show().attr("aria-hidden","false"),this.ui.expander.removeClass(this.options.workingIcon).removeClass(this.options.collapsedIcon).removeClass("ckf-tree-loading").addClass(this.options.expandedIcon),this.model.get("hasChildren")?this.ui.label.attr("aria-expanded",!0):this.ui.label.removeAttr("aria-expanded"),this.$el.addClass("ckf-tree-expanded"),this.model.set(this.viewMetadataPrefix+":isExpanded",!0),this.model.set(this.viewMetadataPrefix+":isExpanding",!1),this.refreshUI()},requestExpand:function(){this.refreshUI(),this.ui.expander.hasClass(this.options.collapsedIcon)?(this.ui.expander.removeClass(this.options.collapsedIcon).addClass(this.options.workingIcon).addClass("ckf-tree-loading"),this.model.get("hasChildren")&&this.model.get("children").length&&this.expand(),this.model.get("children").length||this.model.set(this.viewMetadataPrefix+":isExpanding",!0),this.trigger("folder:expand",{view:this})):(this.collapse(),this.trigger("folder:collapse",{view:this}))},next:function(){var e=this.parentView.collection,t=e.indexOf(this.model);return t+1===e.length?null:this.parentView.children.findByModel(e.at(t+1))},prev:function(){var e=this.parentView.collection,t=e.indexOf(this.model);return 0===t?null:this.parentView.children.findByModel(e.at(t-1))},focus:function(){this.ui.label.focus(),this.trigger("focus",{origin:this})},expandParents:function(){for(var e=this;e.parentView&&e.parentView.expand;)e=e.parentView,e.expand()},calculateLevel:function(){for(var e=1,t=this.model,i=this.model.get("parent");i;)e+=1,t=i,i=t.get("parent");return e},triggerContextMenu:function(e){this.trigger("folder:contextmenu",{evt:e,view:this,model:this.model})},getLabel:function(){return this.ui.label}});return r}),CKFinder.define("CKFinder/Modules/Folders/Views/FoldersTreeView",["CKFinder/Views/Base/CompositeView","CKFinder/Modules/Folders/Views/FolderTreeNodeView","CKFinder/Util/KeyCode"],function(e,t,i){"use strict";function n(e,t){function n(){t.evt.preventDefault(),t.evt.stopPropagation()}var l=t.view,d=t.evt.keyCode,c=t.model,u=c.get(l.viewMetadataPrefix+":isExpanded"),f=c.get("hasChildren");d===i.up&&(n(),a(l)),d===("ltr"===this.finder.lang.dir?i.right:i.left)&&(n(),r(f,u,l)),d===i.down&&(n(),o(f,u,l)),d===("ltr"===this.finder.lang.dir?i.left:i.right)&&(n(),s(f,u,l))}function r(e,t,i){if(e){if(e&&!t)return void i.requestExpand();var n=i.children.first();n&&n.focus()}}function o(e,t,i){if(e&&t)return void i.children.findByModel(i.collection.first()).focus();var n=i.next();if(n||!i.model.get("isRoot")){var r;if(!n){for(r=i.parentView,n=r.next();!n&&!r.model.get("isRoot");)n=r.next(),r=r.parentView;!n&&r.model.get("isRoot")&&(n=r.next())}n&&n.focus()}}function s(e,t,i){e&&t?i.collapse():i.model.get("isRoot")||i.parentView.focus()}function a(e){var t=e.prev();if(t)for(;t.model.get(e.viewMetadataPrefix+":isExpanded")&&t.model.get("children").length>0;)t=t.children.findByModel(t.collection.last());else e.model.get("isRoot")||(t=e.parentView);t&&t.focus()}function l(e,t){var i=e.model;if(!i.get("children").length)return e;var n=i.get("children").findWhere({name:t.shift()});return n?l(e.children.findByModel(n),t):e}var d=e.extend({name:"FoldersTree",childView:t,tagName:"ul",className:"ckf-tree",attributes:{role:"tree","data-role":"listview",tabindex:20},template:"",events:{keydown:function(e){if(e.keyCode===i.tab&&(this.finder.util.isShortcut(e,"")||this.finder.util.isShortcut(e,"shift")))return void this.trigger("keydown:tab",e);var t;if(e.keyCode===i.up||e.keyCode===i.end)for(t=this.children.last();t.model.get(t.viewMetadataPrefix+":isExpanded")&&t.model.get("children").length>0;)t=t.children.findByModel(t.collection.last());(e.keyCode===i.down||e.keyCode===i.home)&&(t=this.children.first()),t&&(e.stopPropagation(),e.preventDefault(),t.focus())},focus:function(e){e.target===e.currentTarget&&(e.preventDefault(),e.stopPropagation(),this.findFolderToFocus().focus())}},childEvents:{"folder:keydown":n,"selected:before":function(){this.children.call("deselect")},focus:function(e,t){this.lastFocusedPath=t.origin.model.getPath({full:!0})},"folder:before:remove:child":function(e,t){var i=t.origin.model.getPath({full:!0})+t.removedView.model.get("name")+"/";i===this.lastFocusedPath&&t.origin.focus()}},initialize:function(e){this.viewMetadataPrefix=e.viewMetadataPrefix||"view"},onRender:function(){this.$el.attr("aria-label",this.finder.lang.FoldersTree)},childViewOptions:function(){return{viewMetadataPrefix:this.viewMetadataPrefix}},onAddChild:function(e){e.parentView=this,this.refreshUI()},refreshUI:function(){this.$el.listview().listview("refresh")},findFolderToFocus:function(){var e=this.children.first();if(this.lastFocusedPath){var t=this.lastFocusedPath.split(":"),i=t[0],n=t[1],r=this.children.findByModel(this.collection.findWhere({name:i}));if(e=r,"/"!==n){var o=n.replace(/^\//,"").split("/").filter(function(e){return!!e.length});e=l(r,o)}}return e}});return d}),CKFinder.define("CKFinder/Modules/FilesMoveCopy/Models/MoveCopyData",["underscore","backbone"],function(e,t){"use strict";return t.Model.extend({defaults:{done:0,lastCommandResponse:!1},initialize:function(){this.set({fileExistsErrors:new t.Collection,otherErrors:[]})},processResponse:function(t){this.set("lastResponse",{done:"Copy"===this.get("type")?t.copied:t.moved,response:t});var i=this.get("done"),n=parseInt("Copy"===this.get("type")?t.copied:t.moved);if(this.set("done",i+n),t.error&&(300===t.error.number||301===t.error.number)){var r=this.get("fileExistsErrors"),o=this.get("otherErrors");e.forEach(t.error.errors,function(t){if(115===t.number)r.push(t);else{var i=e.findWhere(o,{number:t.number});i||(i={number:t.number,files:[]},o.push(i)),i.files.push(t.name)}})}},hasFileExistErrors:function(){return!!this.get("fileExistsErrors").length},hasOtherErrors:function(){return!!this.get("otherErrors").length},nextError:function(){var e=this.get("fileExistsErrors").shift();return this.set("current",e),e},getFilesForPost:function(e){var t=[];if(t.push(this.get("current").toJSON()),e)for(;this.hasFileExistErrors();)t.push(this.nextError().toJSON());return t},addErrorMessages:function(t){e.forEach(this.get("otherErrors"),function(e){e.msg=t[e.number]})}})}),CKFinder.define("text!CKFinder/Templates/FilesMoveCopy/ChooseFolder.dot",[],function(){return'<div data-role="header"><h2>{{= it.lang.DestinationFolder }}</h2><a class="ui-btn ui-corner-all ui-btn-icon-notext ui-icon-ckf-back" id="ckf-move-copy-close" title="{{= it.lang.CloseBtn }}" tabindex="10"></a></div><div id="ckf-move-copy-content"></div>'}),CKFinder.define("CKFinder/Modules/FilesMoveCopy/Views/ChooseFolderLayout",["CKFinder/Views/Base/LayoutView","text!CKFinder/Templates/FilesMoveCopy/ChooseFolder.dot"],function(e,t){"use strict";return e.extend({name:"ChooseFolderDialogLayoutView",template:t,regions:{content:"#ckf-move-copy-content"},ui:{close:"#ckf-move-copy-close"}})}),CKFinder.define("CKFinder/Modules/FilesMoveCopy/Views/MoveCopyDialogLayout",["CKFinder/Views/Base/LayoutView"],function(e){"use strict";return e.extend({name:"MoveCopyDialogLayoutView",template:"<div></div>",regions:{content:"div"}})}),CKFinder.define("text!CKFinder/Templates/FilesMoveCopy/MoveCopyFileActionsTemplate.dot",[],function(){return'<h3 class="ckf-move-copy-filename">{{= it.current.get( \'name\' ) }}</h3><p class="ckf-move-copy-error">{{= it.lang.Errors[ 115 ] }}</p><button class="ckf-move-copy-button" id="ckf-move-overwrite">{{= it.lang.FileOverwrite }}</button><button class="ckf-move-copy-button" id="ckf-move-rename">{{= it.lang.FileAutorename }}</button><button class="ckf-move-copy-button" id="ckf-move-skip">{{= it.lang.common.skip }}</button><div class="ckf-move-copy-checkbox"><label><input name="processAll" type="checkbox">{{= it.lang.common.rememberDecision }}</label></div>{{? it.showCancel }}<div class="ui-grid-solo"><div class="ui-block-a"><div><button id="ckf-move-cancel">{{= it.lang.common.cancel }}</button></div></div></div>{{?}}'}),CKFinder.define("CKFinder/Modules/FilesMoveCopy/Views/MoveCopyFileActionsView",["CKFinder/Views/Base/ItemView","text!CKFinder/Templates/FilesMoveCopy/MoveCopyFileActionsTemplate.dot"],function(e,t){"use strict";return e.extend({name:"MoveCopyErrorsView",template:t,ui:{processAll:'[name="processAll"]',overwrite:"#ckf-move-overwrite",skip:"#ckf-move-skip",rename:"#ckf-move-rename",cancel:"#ckf-move-cancel"},onRender:function(){this.$el.enhanceWithin()}})}),CKFinder.define("text!CKFinder/Templates/FilesMoveCopy/MoveCopyResultTemplate.dot",[],function(){return'<p>{{= it.msg }}</p><hr><p class="ckf-move-copy-failures-title ui-body-inherit">{{= it.errorsTitle }}</p><div class="ckf-move-copy-failures">{{~ it.otherErrors: errorGroup }}<p>{{= errorGroup.msg }}</p><ul>{{~ errorGroup.files: error }}<li>{{= error }}</li>{{~}}</ul>{{~}}</div>{{? it.showCancel }}<div class="ui-grid-solo"><div class="ui-block-a"><div><button id="ckf-move-copy-ok">{{= it.lang.OkBtn }}</button></div></div></div>{{?}}'}),CKFinder.define("CKFinder/Modules/FilesMoveCopy/Views/MoveCopyResultView",["CKFinder/Views/Base/ItemView","text!CKFinder/Templates/FilesMoveCopy/MoveCopyResultTemplate.dot"],function(e,t){"use strict";return e.extend({name:"MoveCopyResultView",template:t,className:"ckf-move-copy-result",ui:{ok:"#ckf-move-copy-ok"},onRender:function(){this.$el.enhanceWithin()}})}),CKFinder.define("CKFinder/Modules/FilesMoveCopy/FilesMoveCopy",["underscore","jquery","backbone","CKFinder/Views/MessageView","CKFinder/Modules/Folders/Views/FoldersTreeView","CKFinder/Modules/FilesMoveCopy/Models/MoveCopyData","CKFinder/Modules/FilesMoveCopy/Views/ChooseFolderLayout","CKFinder/Modules/FilesMoveCopy/Views/MoveCopyDialogLayout","CKFinder/Modules/FilesMoveCopy/Views/MoveCopyFileActionsView","CKFinder/Modules/FilesMoveCopy/Views/MoveCopyResultView","CKFinder/Util/KeyCode"],function(e,t,i,n,r,o,s,a,l,d,c){"use strict";function u(e){function t(t){e.setHandler("files:"+t.toLowerCase(),function(i){f(i,t,e)}),e.on("command:after:"+t+"Files",function(e){g(e,t,i,"Move"===t)}),e.on("command:error:"+t+"Files",p),e.on("toolbar:reset:Main:files",function(e){v(e,t,i)}),e.on("toolbar:reset:Main:file",function(e){v(e,t,i)})}var i=this;i.finder=e,e.on("folder:drop",w,i),e.on("contextMenu:folderDrop",function(e){e.data.groups.add({name:"moveCopy"})}),e.on("contextMenu:folderDrop:moveCopy",y),t("Copy"),t("Move")}function f(e,t,n){var r=[],s=e.files instanceof i.Collection?e.files:new i.Collection(e.files);s.forEach(function(t){var i=t.get("folder");r.push({options:e.options?e.options:"",name:t.get("name"),type:i.get("resourceType"),folder:i.getPath()})});var a=new o({type:t,currentFolder:e.toFolder,lastIndex:n.request("files:getCurrent").indexOf(e.files.last()),postFiles:r});h(n,r,a)}function h(t,i,n,r){r&&e.forEach(i,function(e,t){i[t].options=r});var o=n.get("type"),s=i.length,a=1===s?"OneFileWait":"ManyFilesWait";t.request("loader:show",{text:t.lang[o+a].replace("%1",s)}),t.request("command:send",{name:o+"Files",type:"post",post:{files:i},sendPostAsJson:!0,folder:n.get("currentFolder"),context:{moveCopyData:n}})}function g(t,i,n,r){function s(){n.finder.request("page:destroy",{name:F}),n.finder.request("dialog:destroy")}var a=[103,116],c=t.data.response;if(!c.error||!e.contains(a,c.error.number)){var u=n.finder,f=t.data.context,g=f&&f.moveCopyData?f.moveCopyData:new o;g.get("type")||g.set("type",i),g.processResponse(t.data.response),u.request("loader:hide");var p,v=("Copy"===g.get("type")?"Copied":"Moved")+"FilesNumber";if(g.set("msg",u.lang[v].replace("%1",g.get("done"))),g.set("errorsTitle",u.lang[g.get("type")+"FilesErrorTitle"]),g.set("showCancel",b(u)),!g.hasFileExistErrors()){u.request("page:destroy",{name:k}),u.request("page:destroy",{name:F});var w=u.lang[g.hasFileExistErrors()?"OperationCompletedErrors":g.get("type")+"Operation"];return g.hasOtherErrors()&&(g.set("msg",u.lang.OperationCompletedErrors+" "+g.get("msg")),p=new d({finder:u,model:g,events:{"click @ui.ok":function(){n.finder.request("page:destroy",{name:x}),n.finder.request("dialog:destroy")}},className:function(){return"mobile"==this.finder.request("ui:getMode")?"ui-content":""}}),g.addErrorMessages(u.lang.Errors)),p?b(u)?(u.request("page:create",{view:p,title:w,name:x,uiOptions:{dialog:"mobile"!==u.request("ui:getMode"),theme:u.config.swatch,overlayTheme:u.config.swatch}}),u.request("page:show",{name:x}),u.request("page:destroy",{name:F})):u.request("dialog",{name:g.get("type")+"Success",title:w,buttons:["okClose"],minWidth:"400px",view:p}):u.request("dialog:info",{title:w,msg:g.get("msg"),name:"MoveCopySummaryInfo"}),void(r&&("Move"===i&&C(u),u.request("folder:refreshFiles")))}g.nextError(),g.addErrorMessages(u.lang.Errors);var y=m(g,u,i);y.content.show(new l({finder:u,model:g,events:{"click @ui.skip":function(){this.model.hasFileExistErrors()&&!this.ui.processAll.is(":checked")?(this.model.nextError(),this.render()):s()},"click @ui.overwrite":function(){h(n.finder,this.model.getFilesForPost(this.ui.processAll.is(":checked")),this.model,"overwrite")},"click @ui.rename":function(){h(n.finder,this.model.getFilesForPost(this.ui.processAll.is(":checked")),this.model,"autorename")},"click @ui.cancel":s},className:function(){return"mobile"==this.finder.request("ui:getMode")?"ui-content":""}}))}}function p(e){var t=e.data.response;switch(t.error.number){case 300:case 301:e.cancel();break;case 116:e.cancel(),e.finder.request("loader:hide"),e.finder.request("dialog:info",{msg:e.finder.lang.ErrorMsg.MissingFolder});var i=e.data.context.moveCopyData.get("currentFolder"),n=i.get("parent");n.get("children").remove(i);var r=e.finder.request("folder:getActive");r===i&&e.finder.request("folder:openPath",{path:n.getPath({full:!0}),expand:!0});break;case 103:e.cancel(),e.finder.request("loader:hide"),e.finder.request("dialog:info",{msg:e.finder.lang.Errors[103]})}}function m(e,t,i){var n=e.get("view");if(!n){n=new a({finder:t});var r=t.lang[i+"Operation"];b(t)?(t.request("page:create",{view:n,title:r,name:F,uiOptions:{dialog:"mobile"!==t.request("ui:getMode"),theme:t.config.swatch,overlayTheme:t.config.swatch}}),t.request("page:show",{name:F}),t.request("page:destroy",{name:k})):t.request("dialog",{name:F,title:r,buttons:["cancel"],view:n})}return n}function v(e,t,i){("Move"!==t||e.finder.request("folder:getActive").get("acl").fileDelete)&&e.data.toolbar.push({name:t+"Files",type:"button",priority:40,icon:"ckf-file-"+("Copy"===t?"copy":"move"),label:i.finder.lang[t+"ToolbarButton"],action:function(){var n=new r({finder:i.finder,collection:i.finder.request("resources:get"),viewMetadataPrefix:"moveCopy"});n.on("childview:folder:expand",function(e,t){i.finder.fire("folder:expand",{view:t.view,folder:t.view.model},i.finder)}),n.on("childview:folder:click",function(e,n){i.finder.request("files:"+t.toLowerCase(),{files:i.finder.request("files:getSelected"),toFolder:n.view.model})}),n.on("childview:folder:keydown",function(e,n){(n.evt.keyCode===c.enter||n.evt.keyCode===c.space)&&(n.evt.preventDefault(),n.evt.stopPropagation(),i.finder.request("files:"+t.toLowerCase(),{files:i.finder.request("files:getSelected"),toFolder:n.view.model}))}),n.on("keydown:tab",function(e){e.preventDefault(),e.stopPropagation(),b(i.finder)?n.$el.closest('[data-role="page"]').find("#ckf-move-copy-close").focus():n.$el.closest(".ckf-dialog").find(".ckf-dialog-buttons").find(".ui-btn").focus()});var o=e.data.file?e.finder.lang[t+"OneFileDialogTitle"]:e.finder.lang[t+"ManyFilesDialogTitle"].replace("{count}",e.data.files.length);if(b(i.finder)){i.finder.on("page:show:"+k,function(){n.refreshUI()});var a=new s({finder:i.finder,events:{"click @ui.close":function(){i.finder.request("page:destroy",{name:k})}}});a.on("show",function(){this.content.show(n)}),i.finder.request("page:create",{view:a,title:o,name:k,className:"ckf-move-copy-dialog",uiOptions:{theme:i.finder.config.swatch,overlayTheme:i.finder.config.swatch}}),i.finder.request("page:show",{name:k})}else i.finder.request("dialog",{name:k,title:o,buttons:["cancel"],contentClassName:"ckf-move-copy-dialog",restrictHeight:!0,focusItem:".ckf-tree",uiOptions:{positionTo:'[data-ckf-toolbar="Main"]',create:function(){setTimeout(function(){n.refreshUI()},0)},afterclose:function(){a&&a.destroy(),n&&n.destroy()}},view:n})}})}function w(e){e.data.evt.ckfFilesSelection&&this.finder.request("contextMenu",{name:"folderDrop",evt:e.data.evt,positionToEl:e.data.view.getLabel(),context:{folder:e.data.folder}})}function y(e){var t=e.data.context.folder,i=t.get("acl");e.data.items.add({name:"MoveFiles",label:e.finder.lang.MoveDragDrop,isActive:i.fileUpload,icon:"ckf-file-move",action:function(){e.finder.request("files:move",{files:e.finder.request("files:getSelected"),toFolder:t})}}),e.data.items.add({name:"CopyFiles",label:e.finder.lang.CopyDragDrop,isActive:i.fileUpload,icon:"ckf-file-copy",action:function(){e.finder.request("files:copy",{files:e.finder.request("files:getSelected"),toFolder:t})}})}function b(e){return"mobile"===e.request("ui:getMode")}function C(e){var i=e.request("files:getCurrent"),n=e.request("files:getSelected"),r=e.request("file:getActive");r||(r=n.last());for(var o=i.indexOf(r);n.indexOf(i.at(o))>-1&&o<i.length;)o++;if(-1!=n.indexOf(i.at(o))||o===i.length)for(o=i.indexOf(r)-1;n.indexOf(i.at(o))>-1&&o>=0;)o--;var s=i.at(o);e.once("dialog:close:MoveCopySummaryInfo",function(){var i=e.request("files:getCurrent");s&&i.indexOf(s)>-1?(s.trigger("focus"),e.request("files:select",{files:[s]})):t(".ckf-files-view").focus()})}var F="MoveCopyDialogPage",x="MoveCopySuccessDialogPage",k="ChooseFolder";return u}),CKFinder.define("CKFinder/Modules/FocusManager/FocusManager",["jquery","underscore","CKFinder/Util/KeyCode"],function(e,t,i){"use strict";function n(n){var o=[];n.setHandlers({"focus:remember":function(){o.push(document.activeElement)},"focus:restore":function(){e(o.pop()).focus()},"focus:next":function(e){r(e,1)},"focus:prev":function(e){r(e,-1)},"focus:trap":function(n){n.node&&n.node.on("keydown",function(n){var r=n.keyCode;if(r===i.tab){n.preventDefault(),n.stopPropagation();var o=e(this).find("[tabindex],input,a,button,select").not('[tabindex="-1"]').filter(":visible"),s=t.indexOf(o,n.target),a=s+(n.shiftKey?-1:1);a>=o.length?a=0:0>a&&(a=o.length-1),o.eq(a).focus()}})}})}function r(i,n){var r=0,o=t.chain(e("[tabindex]")).filter(function(t){var i=e(t);if(parseInt(i.attr("tabindex"))<0)return!1;if(i.closest(".ckf-page").length)return i.closest(".ckf-page").hasClass("ui-page-active");var n=i.closest(".ui-panel");if(n.length){var r=!n.hasClass("ui-panel-closed"),o=i.hasClass("ckf-tree");return o&&e("body").hasClass("ckf-ui-mode-desktop")?e('[data-ckf-page="Main"]').hasClass("ui-page-active"):r}return i.is(":visible")}).sortBy(function(t){return parseInt(e(t).attr("tabindex"))}).forEach(function(e,t){e===i.node.get(0)&&(r=t)}).value(),s=r+n;return s>=o.length||0>s?void 0:(i.event.preventDefault(),i.event.stopPropagation(),e(o[s]).focus())}return n}),CKFinder.define("CKFinder/Models/ResourceType",["underscore","backbone","CKFinder/Models/Folder"],function(e,t,i){"use strict";var n;return n=i.extend({initialize:function(){i.prototype.initialize.call(this);var e=this.get("allowedExtensions");e&&"string"==typeof e&&this.set("allowedExtensions",e.split(","),{silent:!0});var t=this.get("allowedExtensions");t&&"string"==typeof t&&this.set("allowedExtensions",e.split(","),{silent:!0})},isAllowedExtension:function(t){t=t.toLocaleLowerCase();var i=this.get("allowedExtensions"),n=this.get("deniedExtensions"),r=i&&!e.contains(i,t),o=n&&e.contains(n,t);return!(r||o)},isOperationTracked:function(t){var i=this.get("trackedOperations");return!!i&&e.contains(i,t)}})}),CKFinder.define("text!CKFinder/Templates/Breadcrumbs/Breadcrumbs.dot",[],function(){return'<a class="ui-btn{{? it.current }} ui-btn-active{{?}}" data-ckf-path="{{! it.path }}" href="#" tabindex="-1" data-ckf-drop="true">{{! it.label || it.name }}</a>';
}),CKFinder.define("CKFinder/Modules/Folders/Views/BreadcrumbView",["jquery","CKFinder/Views/Base/ItemView","text!CKFinder/Templates/Breadcrumbs/Breadcrumbs.dot"],function(e,t,i){"use strict";var n=t.extend({name:"ToolbarFolder",tagName:"li",template:i,ui:{btn:".ui-btn",label:".ui-btn"},events:{click:function(e){this.trigger("click",{evt:e,view:this,model:this.model})},dragenter:function(e){this.model.get("current")||"/"===this.model.get("path")||(e.stopPropagation(),e.preventDefault(),this.ui.btn.addClass("ui-btn-active"))},dragover:function(e){this.model.get("current")||"/"===this.model.get("path")||(e.stopPropagation(),e.preventDefault(),this.ui.btn.addClass("ui-btn-active"))},dragleave:function(e){this.model.get("current")||"/"===this.model.get("path")||(e.stopPropagation(),this.ui.btn.removeClass("ui-btn-active"))},ckfdrop:function(e){if(!this.model.get("current")&&"/"!==this.model.get("path")){e.stopPropagation(),this.ui.btn.removeClass("ui-btn-active");var t=this.model.get("folder");this.finder.fire("folder:drop",{evt:e,folder:t,view:this},this.finder)}},keydown:function(e){this.trigger("keydown",{evt:e,view:this,model:this.model})}},focus:function(){this.ui.btn.focus()},getLabel:function(){return this.ui.label}});return n}),CKFinder.define("CKFinder/Modules/Folders/Views/BreadcrumbsView",["underscore","jquery","CKFinder/Modules/Folders/Views/BreadcrumbView","CKFinder/Views/Base/CompositeView","CKFinder/Util/KeyCode"],function(e,t,i,n,r){"use strict";var o=n.extend({name:"ToolbarFolders",className:"ckf-folders-breadcrumbs ui-body-inherit",template:'<ul tabindex="20"></ul>',childViewContainer:"ul",attributes:{role:"navigation"},childView:i,ui:{container:"ul:first"},events:{touchstart:function(e){e.stopPropagation()},keydown:function(t){if(t.keyCode===r.tab&&(this.finder.util.isShortcut(t,"")||this.finder.util.isShortcut(t,"shift")))return void this.finder.request(this.finder.util.isShortcut(t,"")?"focus:next":"focus:prev",{node:this.ui.container,event:t});var i;return e.contains([r.left,r.end,r.right,r.home],t.keyCode)?(t.stopPropagation(),t.preventDefault(),i=t.keyCode===r.left||t.keyCode===r.end?this.children.last():this.children.first(),void i.focus()):void((t.keyCode===r.up||t.keyCode===r.down)&&t.preventDefault())},"focus @ui.container":function(e){e.target===this.ui.container.get(0)&&(e.stopPropagation(),this.children.first().focus())}},initialize:function(){function e(e,t,i,n){e.preventDefault(),e.stopPropagation(),n.collection.last().cid!==i.cid&&t.request("folder:openPath",{path:i.get("path")})}this.listenTo(this.collection,"reset",function(){this.$el[this.collection.length?"show":"hide"]()}),this.on("childview:keydown",function(t,i){var n=i.evt;if(n.keyCode===r.left||n.keyCode===r.right){n.stopPropagation(),n.preventDefault();var o=this.collection.indexOf(i.model);o=n.keyCode===("ltr"===this.finder.lang.dir?r.left:r.right)?0>=o?0:o-1:o>=this.collection.length-1?o:o+1,this.children.findByModel(this.collection.at(o)).focus()}(n.keyCode===r.space||n.keyCode===r.enter)&&e(n,this.finder,i.model,this)},this),this.on("childview:click",function(t,i){e(i.evt,this.finder,i.model,this)},this)},onRenderCollection:function(){this.$childViewContainer.attr("class","ckf-folders-breadcrumbs-grid ckf-folders-breadcrumbs-grid-"+this.collection.length);var e=this.$childViewContainer.prop("scrollWidth")-this.$childViewContainer.width();e&&this.$childViewContainer.scrollLeft(e)},focus:function(){this.ui.container.focus(),setTimeout(function(){window.scrollTo(0,0)},0)}});return o}),CKFinder.define("CKFinder/Modules/Folders/Breadcrumbs",["jquery","backbone","CKFinder/Modules/Folders/Views/BreadcrumbsView"],function(e,t,i){"use strict";function n(e,t){var n=new i({finder:e,collection:t});return e.on("page:show:Main",function(){e.request("page:addRegion",{page:"Main",name:"breadcrumbs",id:e._.uniqueId("ckf-"),priority:30}),e.request("page:showInRegion",{view:n,page:"Main",region:"breadcrumbs"})}),n}function r(e,t){e.on("folder:selected",function(e){var i=[],n=e.data.folder;for(i.unshift({name:n.get("name"),path:n.getPath({full:!0}),label:n.get("label"),folder:n,current:!0});n.has("parent");)n=n.get("parent"),i.unshift({folder:n,name:n.get("name"),path:n.getPath({full:!0}),label:n.get("label")});i.unshift({name:"/",path:"/"}),t.reset(i)}),e.on("resources:show",function(){t.reset([])})}var o={start:function(e){this.breadcrumbs=new t.Collection,this.breadcrumbsView=n(e,this.breadcrumbs),r(e,this.breadcrumbs)},focus:function(){this.breadcrumbsView&&this.breadcrumbsView.focus()}};return o}),CKFinder.define("CKFinder/Util/parseAcl",[],function(){"use strict";function e(e){return{folderView:(e&t)===t,folderCreate:(e&i)===i,folderRename:(e&n)===n,folderDelete:(e&r)===r,fileView:(e&o)===o,fileUpload:(e&s)===s,fileRename:(e&a)===a,fileDelete:(e&l)===l,imageResize:(e&d)===d,imageResizeCustom:(e&c)===c}}var t=1,i=2,n=4,r=8,o=16,s=32,a=64,l=128,d=256,c=512;return e}),CKFinder.define("CKFinder/Modules/Folders/Folders",["underscore","jquery","CKFinder/Models/Folder","CKFinder/Models/ResourceType","CKFinder/Models/FoldersCollection","CKFinder/Modules/Folders/Views/FoldersTreeView","CKFinder/Modules/Folders/Breadcrumbs","CKFinder/Util/parseAcl","CKFinder/Util/KeyCode"],function(e,t,i,n,r,o,s,a,l){"use strict";function d(e){var t=this;t.finder=e,t.resources=new r,e.config.displayFoldersPanel?(c(t),e.on("toolbar:reset:Main",b),e.on("shortcuts:list:folders",function(t){t.data.shortcuts.add({label:t.finder.lang.Shortcuts.folders.expandOrSubfolder,shortcuts:"ltr"===e.lang.dir?"{rightArrow}":"{leftArrow}"}),t.data.shortcuts.add({label:t.finder.lang.Shortcuts.folders.collapseOrParent,shortcuts:"ltr"===e.lang.dir?"{leftArrow}":"{rightArrow}"})},null,null,40)):s.start(e),e.setHandlers({"folder:openPath":{callback:h,context:t},"folder:select":{callback:g,context:t},"folder:getActive":function(){return t.currentFolder},"resources:get":function(){return t.resources.clone()}}),e.on("command:error:GetFolders",function(e){116!==e.data.response.error.number||e.data.context.silentConnectorErrors||(e.cancel(),e.finder.request("dialog:info",{msg:e.finder.lang.ErrorMsg.MissingFolder}),e.finder.request("folder:openPath",{path:e.data.context.parent.get("parent").getPath({full:!0}),expand:!0}))},null,null,5),e.on("command:error:RenameFolder",F,null,null,5),e.on("command:error:DeleteFolder",F,null,null,5),e.on("command:error:CreateFolder",F,null,null,5),e.on("command:error:GetFiles",function(e){116===e.data.response.error.number&&e.cancel()},null,null,5),e.on("command:ok:Init",p,t),e.on("folder:keydown",C,t),e.on("folder:expand",v,t),e.on("app:start",w,t),e.on("command:after:GetFolders",y,t),e.on("resources:show:before",function(){t.currentFolder=null}),e.on("folder:selected",function(t){e.request("toolbar:reset",{name:"Main",event:"folder",context:{folder:t.data.folder}})});var i="ltr"===e.lang.dir?"ui:swiperight":"ui:swipeleft";e.on(i,function(){"Main"===e.request("page:current")&&"desktop"!==e.request("ui:getMode")&&e.request("panel:open",{name:"folders"})},null,null,20),e.request("key:listen",{key:l.f8}),e.on("keydown:"+l.f8,function(i){e.util.isShortcut(i.data.evt,"alt")&&(e.config.displayFoldersPanel?(i.finder.request("panel:open",{name:"folders"}),i.data.evt.preventDefault(),i.data.evt.stopPropagation(),t.view.$el.focus()):s.focus())}),e.on("shortcuts:list:general",function(e){e.data.shortcuts.add({label:e.finder.lang.Shortcuts.general.focusFoldersPane,shortcuts:"{alt}+{f8}"})},null,null,30),e.on("shortcuts:list",function(e){e.data.groups.add({name:"folders",priority:30,label:e.finder.lang.Shortcuts.folders.title})})}function c(e){var i=e.finder,n=new o({finder:i,collection:e.resources});e.view=n,n.on("childview:folder:expand",function(e,t){i.fire("folder:expand",{view:t.view,folder:t.view.model},i)}),n.on("childview:folder:click",function(e,t){i.request("folder:select",{folder:t.view.model})}),n.on("childview:folder:contextmenu",function(t,i){i.evt.preventDefault(),e.finder.request("contextMenu",{name:"folder",evt:i.evt,positionToEl:i.view.ui.label,context:{folder:i.view.model}})}),n.on("childview:folder:keydown",function(e,t){return t.evt.keyCode===l.enter||t.evt.keyCode===l.space?(i.request("folder:select",{folder:t.view.model}),t.evt.preventDefault(),void t.evt.stopPropagation()):void i.fire("folder:keydown",{evt:t.evt,view:t.view,folder:t.model,source:"folderstree"},i)}),n.on("childview:folder:drop",function(e,t){i.fire("folder:drop",{evt:t.evt,folder:t.model,view:t.view},i)}),n.on("keydown:tab",function(e){this.finder.request(this.finder.util.isShortcut(e,"")?"focus:next":"focus:prev",{node:this.$el,event:e})}),i.on("contextMenu:folder",function(e){e.data.groups.add({name:"edit"})},null,null,10),i.on("app:loaded",function(){function n(){t('[data-ckf-page="Main"] .ui-panel-wrapper').css("ltr"===i.lang.dir?{"margin-right":"",left:""}:{"margin-left":"",right:""})}function r(){t('[data-ckf-page="Main"] .ui-panel-wrapper').css("ltr"===i.lang.dir?{"margin-right":i.config.primaryPanelWidth,left:i.config.primaryPanelWidth}:{"margin-left":i.config.primaryPanelWidth,right:i.config.primaryPanelWidth})}function o(){a.isOpen()?a.$el.removeAttr("aria-hidden"):a.$el.attr("aria-hidden","true")}var s=!1,a=i.request("panel:create",{name:"folders",view:e.view,position:"primary",scrollContent:!0,panelOptions:{animate:!1,positionFixed:!0,dismissible:!1,swipeClose:!1,display:"push",beforeopen:function(){r(),s=!0},beforeclose:function(){n(),s=!1}}});i.on("page:show:Main",function(){a.$el.addClass("ckf-folders-panel"),i.config.primaryPanelWidth||a.$el.addClass("ckf-folders-panel-default"),"desktop"===i.request("ui:getMode")?a.$el.removeAttr("aria-hidden"):o(),i.on("ui:resize",function(e){e.data.modeChanged&&o()})}),i.config.primaryPanelWidth&&(i.on("page:show:Main",function(){"desktop"===i.request("ui:getMode")&&r()}),i.on("ui:resize",function(e){if(e.data.modeChanged){var t=i.request("ui:getMode");"desktop"===t&&r(),"mobile"===t&&(s?r():n())}})),i.on("page:hide:Main",function(){a.$el.removeClass("ckf-folders-panel")})})}function u(e,t,n,o){function s(){g=!1}function l(t){if(t.error){var i=e.resources.findWhere({name:h.get("resourceType")});return i.get("children").reset(),void d.request("folder:select",{folder:i})}h.set("acl",a(t.currentFolder.acl)),h===d.request("folder:getActive")&&g&&d.request("toolbar:reset",{name:"Main",event:"folder",context:{folder:h}})}var d=e.finder,c=n.replace(/^\//,"").split("/").filter(function(e){return!!e.length}),u=t,f=u;c.length&&(u.set("isPending",!0),c.forEach(function(e){var t=new i({name:e,resourceType:u.get("resourceType"),hasChildren:!0,acl:a(0),isPending:!0,children:new r,parent:f});f.get("children").add(t),f=t}));var h=f;e.currentFolder&&e.currentFolder.cid!==h.cid&&e.currentFolder.trigger("deselected"),e.currentFolder=h,d.once("toolbar:reset:Main:files",s),d.once("toolbar:reset:Main:file",s),d.request("command:send",{name:"GetFolders",folder:h,context:{silentConnectorErrors:!0,parent:h}}).done(l),h.trigger("selected"),d.fire("folder:selected",{folder:h},d),c.length||h.set("isPending",!1,{silent:!0}),o&&h.trigger("ui:expand");var g=!0}function f(e,t,i,n,r){function o(){var o=i.replace(/^\//,"").split("/");if(o.length){var s=t.get("children").findWhere({name:o[0].toString()});s?f(e,s,o.slice(1).join("/"),n,r):r||(l.request("folder:select",{folder:t}),n&&t.trigger("ui:expand"))}}var s=i.length,l=e.finder,d=t.get("children").size()>0;t.get("isPending")||t.get("hasChildren")&&s&&!d?l.request("command:send",{name:"GetFolders",folder:t,context:{parent:t}},null,null,30).done(function(e){e.error||(t.set("acl",a(e.currentFolder.acl)),o())}):o()}function h(e){var t=e.expand,i=e.expandStubs,n=(e.path||"").split(":");if("/"===e.path)return void this.finder.request("resources:show");var r;n[1]&&(r=n[1]);var o=this.resources.findWhere({name:n[0]});o||(o=this.resources.first()),i&&u(this,o,r,t),f(this,o,r.replace(/\/$/,""),t,i)}function g(e){var t=this,i=t.finder,n=e.folder,r=t.currentFolder,o=r&&r.cid===n.cid;!o&&r&&r.trigger("deselected"),t.currentFolder=n,i.request("command:send",{name:"GetFolders",folder:n,context:{parent:n}}),n.trigger("selected"),i.fire("folder:selected",{folder:n,previousFolder:r},i)}function p(t){function r(t){return e.extend(t,{path:"/",isRoot:!0,resourceType:t.name,acl:a(t.acl)}),new n(t)}var o=this,s=t.data.response;if(s&&!s.error){var l=s.resourceTypes,d=[];e.isArray(l)&&e.forOwn(l,function(e,t){d.push(r(l[t]))}),o.finder.fire("createResources:before",{resources:d},o.finder),e.forEach(d,function(e){e instanceof i||(e=new i(e)),o.resources.add(e)}),o.finder.fire("createResources:after",{resources:o.resources},o.finder)}}function m(t,n,o){var s,l,d,c=t.name.toString(),u=n.where({name:c}),f={name:c,resourceType:o.get("resourceType"),hasChildren:t.hasChildren,acl:a(t.acl)};u.length?(s=u[0],l={},d=!1,e.forEach(f,function(e,t){s.get(t)!==e&&(l[t]=e,d=!0)}),d&&s.set(l)):(s=new i(f),s.set({children:new r,parent:o}),n.add(s))}function v(e){e.data.folder.get("hasChildren")&&e.data.folder.get("children").size()<=0&&e.finder.request("command:send",{name:"GetFolders",folder:e.data.folder,context:{parent:e.data.folder}})}function w(){function e(e,i){t.request("folder:openPath",{path:e,expand:i,expandStubs:!0})}var t,i,n,r,o;if(t=this.finder,r=t.config.rememberLastFolder,r&&(t.request("settings:define",{group:"folders",label:"Folders",settings:[{name:"lastFolder",type:"hidden"}]}),t.on("folder:selected",function(e){t.request("settings:setValue",{group:"folders",name:"lastFolder",value:e.data.folder.get("resourceType")+":"+e.data.folder.getPath()}),o=t.request("settings:getValue",{group:"folders",name:"lastFolder"})})),r){var s=t.request("settings:getValue",{group:"folders",name:"lastFolder"});t.config.displayFoldersPanel&&"/"===s||(o=s)}i=t.config.resourceType,n=t.config.startupPath;var a=i;!a&&this.resources.length&&(a=this.resources.at(0).get("name"));var l=r&&o?o.split(":")[0]:a,d=this.resources.where({lazyLoad:!0});d.length&&d.forEach(function(e){var i=e.get("name");e.set("hasChildren",!0),e.set("isPending",!0),i!==l&&t.request("command:send",{name:"GetFolders",folder:e,context:{parent:e}})}),r&&o?e(o):!i&&n||0===n.search(i+":")?e(n,t.config.startupFolderExpanded):(!i&&this.resources.length&&(i=this.resources.at(0).get("name")),e(i+":/"))}function y(t){var i=t.data.context.parent,n=t.data.response.folders;i.set("isPending",!1);var r=i.get("children");if(e.isEmpty(n))return i.set("hasChildren",!1),void(r&&r.reset());var o=[];r.forEach(function(t){e.findWhere(n,{name:t.get("name")})||o.push(t)}),o.length&&r.remove(o),e.forEach(n,function(e){m(e,r,i)})}function b(e){function t(){return"desktop"===e.finder.request("ui:getMode")}e.data.toolbar.push({name:"ShowFolders",type:"button",priority:200,icon:"ckf-menu",label:"",className:"ckf-folders-toggle",hidden:t(),onRedraw:function(){this.set("hidden",t())},action:function(){e.finder.request("panel:toggle",{name:"folders"})}})}function C(e){var t=e.data.folder;(e.data.evt.keyCode===l.space||e.data.evt.keyCode===l.enter)&&(e.data.evt.preventDefault(),e.data.evt.stopPropagation(),this.finder.request("folder:openPath",{path:t.getPath({full:!0})}))}function F(e){if(116===e.data.response.error.number){e.cancel(),e.finder.request("dialog:info",{msg:e.finder.lang.ErrorMsg.MissingFolder});var t=e.data.context.folder,i=t.get("parent");i.get("children").remove(t);var n=e.finder.request("folder:getActive");n===t&&e.finder.request("folder:openPath",{path:i.getPath({full:!0}),expand:!0})}}return d}),CKFinder.define("text!CKFinder/Templates/UploadFileForm/UploadFileForm.dot",[],function(){return'<div class="ui-content"><form enctype="multipart/form-data" method="post" target="{{= it.ids.iframe }}" action="{{= it.url }}"><label for="{{= it.ids.input }}">{{= it.lang.UploadSelectLbl }}</label><div class="ui-responsive"><div class="ckf-upload-form-part"><input id="{{= it.ids.input }}" type="file" name="upload"></div><div class="ckf-upload-form-part"><button type="button" data-inline="true" data-mini="true" data-icon="ckf-back">{{= it.lang.UploadBtnCancel }}</button><button type="submit" data-inline="true" data-mini="true" data-icon="ckf-upload">{{= it.lang.UploadSend }}</button></div></div><input type="hidden" name="ckCsrfToken" value="{{= it.ckCsrfToken }}" /></form><iframe id="{{= it.ids.iframe }}" name="{{= it.ids.iframe }}" style="display:none" tabIndex="-1" allowTransparency="true" {{? it.isCustomDomain }} src="javascript:void((function(){document.open();document.domain=\'{{= it.domain }}\';document.destroy();})())" {{?}}></iframe></div>'}),CKFinder.define("CKFinder/Modules/FormUpload/Views/UploadFileFormView",["underscore","CKFinder/Util/KeyCode","CKFinder/Views/Base/ItemView","text!CKFinder/Templates/UploadFileForm/UploadFileForm.dot"],function(e,t,i,n){"use strict";var r=i.extend({name:"UploadFileForm",template:n,className:"ckf-upload-form",attributes:{tabindex:20},ui:{cancel:'button[type="button"]',input:'input[type="file"]',submit:'button[type="submit"]',form:"form"},events:{"click @ui.cancel":function(){this.destroy()},submit:function(){this.trigger("submit")},click:function(e){e.stopPropagation()},"keydown @ui.input":function(e){e.keyCode===t.left&&(this.ui.submit.focus(),e.stopPropagation()),e.keyCode===t.right&&(e.stopPropagation(),this.ui.cancel.focus())},"keydown @ui.cancel":function(e){e.keyCode===t.left&&(e.stopPropagation(),this.ui.input.focus()),e.keyCode===t.right&&(e.stopPropagation(),this.ui.submit.focus())},"keydown @ui.submit":function(e){e.keyCode===t.left&&(e.stopPropagation(),this.ui.cancel.focus()),e.keyCode===t.right&&(e.stopPropagation(),this.ui.input.focus())},keydown:function(e){return e.keyCode===t.tab&&(this.finder.util.isShortcut(e,"")||this.finder.util.isShortcut(e,"shift"))?void this.finder.request(this.finder.util.isShortcut(e,"")?"focus:next":"focus:prev",{node:this.$el,event:e}):((e.keyCode===t.right||e.keyCode===t.home)&&this.ui.input.focus(),void((e.keyCode===t.left||e.keyCode===t.end)&&this.ui.submit.focus()))}},templateHelpers:function(){var t=this.finder.request("folder:getActive");return{ids:{iframe:e.uniqueId("ckf-"),cid:this.cid,input:e.uniqueId("ckf-")},domain:"",isCustomDomain:!1,url:this.finder.request("command:url",{command:"FileUpload",folder:t,params:{asPlainText:!0}}),ckCsrfToken:this.finder.request("csrf:getToken")}},onShow:function(){var e=this,t=navigator.userAgent.toLowerCase().indexOf("trident/")>-1;t||this.finder.config.test||this.ui.input.trigger("click");var i=this.$el.find("iframe");i.load(function(){var t=i.contents().find("body").text();if(t.length){var n;try{n=JSON.parse(t)}catch(e){n={error:{number:109,message:t}}}e.trigger("upload:response",n)}})}});return r}),CKFinder.define("CKFinder/Modules/FormUpload/FormUpload",["underscore","CKFinder/Modules/FormUpload/Views/UploadFileFormView"],function(e,t){"use strict";function i(i){function n(){r&&r.destroy(),r=null}var r;i.hasHandler("upload")||(i.on("page:create:Main",function(){i.request("page:addRegion",{page:"Main",name:"upload",id:e.uniqueId("ckf-"),priority:20})}),i.setHandler("upload",function(){r=new t({finder:i}),r.on("submit",function(){i.request("loader:show",{text:i.lang.UploadProgressLbl})}),r.on("upload:response",function(e){var t=!!e.uploaded;n(),i.request("loader:hide"),e.error&&i.request("dialog:info",{msg:e.error.message}),t&&(i.once("folder:getFiles:after",function(){var t=i.request("files:getCurrent"),n=t.where({name:e.fileName});if(n.length){i.request("files:select",{files:n});var r=n[n.length-1];r.trigger("focus")}}),i.request("folder:refreshFiles"))}),i.request("page:showInRegion",{view:r,page:"Main",region:"upload"})}),i.on("folder:selected",function(e){r&&!e.data.folder.get("acl").fileUpload&&n()}))}return i}),CKFinder.define("CKFinder/Modules/Html5Upload/Queue",["underscore","backbone"],function(e,t){"use strict";function i(e,t){e.items.length?(e.state.set("currentItem",e.state.get("currentItem")+1),n(e.items.shift(),e,t)):(e.state.set("currentItem",e.state.get("totalFiles")),e.state.set("isStarted",!1),e.state.trigger("stop"))}function n(e,t,i){var n=new XMLHttpRequest;e.set("xhr",n),n.upload&&(n.upload.onprogress=function(i){var n=i.position||i.loaded;e.set("value",Math.round(n/i.total*100)),t.state.set("currentItemBytes",n)}),n.onreadystatechange=function(){4===this.readyState&&r(t,e,this,i)};var o=new FormData;n.open("post",i,!0),o.append("upload",e.get("file")),o.append("ckCsrfToken",t.finder.request("csrf:getToken")),n.send(o)}function r(e,t,n,r){var a=e.state,l={totalFiles:a.get("totalFiles"),totalBytes:a.get("totalBytes"),processedFiles:a.get("processedFiles"),processedBytes:a.get("processedBytes"),errorFiles:a.get("errorFiles"),errorBytes:a.get("errorBytes"),uploadedFiles:a.get("uploadedFiles"),uploadedBytes:a.get("uploadedBytes"),currentItem:a.get("currentItem"),currentItemBytes:0},d=o(l,n,e,t.get("file").size);s(e,t),a.set(d.state),t.set(d.item),t.trigger("done"),i(e,r)}function o(e,t,i,n){var r=!1,o={};if(t.responseType||t.responseText?(e.processedFiles=e.processedFiles+1,e.processedBytes=e.processedBytes+n):(e.totalFiles=e.totalFiles?e.totalFiles-1:0,e.totalBytes=e.totalBytes?e.totalBytes-n:0,e.currentItem=e.currentItem?e.currentItem-1:0),t.responseText)try{r=JSON.parse(t.responseText)}catch(e){r={uploaded:0,error:{number:109,message:i.finder.lang.UploadUnknError}}}return r&&(r.uploaded&&(o.uploaded=!0,e.uploadedFiles=e.uploadedFiles+1,e.uploadedBytes=e.uploadedBytes+n,e.lastUploaded=r.fileName),r.error&&(o.uploadMessage=r.error.message,r.uploaded?o.isWarning=!0:(o.isError=!0,o.state="error",o.value=100,e.errorFiles=e.errorFiles+1,e.errorBytes=e.errorBytes+n))),{item:o,state:e}}function s(t,i){var n=e.indexOf(t.items,i);n>=0&&t.items.splice(n,1)}var a={totalFiles:0,totalBytes:0,uploadedFiles:0,uploadedBytes:0,errorFiles:0,errorBytes:0,processedFiles:0,processedBytes:0,currentItemBytes:0,currentItem:0,isStarted:!1,lastUploaded:void 0},l=function(e){this.finder=e,this.state=new t.Model(a),this.items=[]};return l.prototype.getState=function(){return this.state},l.prototype.add=function(t){var i=this,n=0,r=0,o=0;e.forEach(t,function(e){var t=e.get("file").size;n+=t,e.get("isError")?(r+=t,o+=1):i.items.push(e)}),this.state.get("isStarted")?this.state.set({totalFiles:this.state.get("totalFiles")+t.length,totalBytes:this.state.get("totalBytes")+n,errorFiles:this.state.get("errorFiles")+o,errorBytes:this.state.get("errorBytes")+r,processedFiles:this.state.get("processedFiles")+o,processedBytes:this.state.get("processedBytes")+r}):(this.state.set({totalFiles:t.length,totalBytes:n,uploadedFiles:0,uploadedBytes:0,errorFiles:o,errorBytes:r,processedFiles:o,processedBytes:r,currentItem:0}),this.start())},l.prototype.start=function(){this.state.get("isStarted")||this.state.trigger("start"),this.state.set("isStarted",!0);var e=this.finder.request("command:url",{command:"FileUpload",folder:this.finder.request("folder:getActive"),params:{responseType:"json"}});i(this,e)},l.prototype.cancelItem=function(e){var t=e.get("xhr");if(t)return void t.abort();s(this,e);var i=this.state,n=e.get("file").size,r=i.get("totalFiles"),o=i.get("totalBytes");i.set({totalFiles:r?r-1:0,totalBytes:o?o-n:0}),i.get("processedFiles")===i.get("totalFiles")&&i.trigger("stop")},l.prototype.cancel=function(){var t=this.items;this.items=[],e.forEach(t,function(e){this.cancelItem(e)},this),this.state.set(a)},l}),CKFinder.define("CKFinder/Modules/Html5Upload/Models/UploadCollection",["backbone"],function(e){"use strict";var t=e.Collection.extend({comparator:function(e,t){return e.get("isSummary")?-1:t.get("isSummary")?1:0}});return t}),CKFinder.define("CKFinder/Modules/Html5Upload/Models/UploadItem",["CKFinder/Common/Models/ProgressModel"],function(e){"use strict";var t=e.extend({defaults:{uploaded:!1,isError:!1,isWarning:!1,uploadMessage:""}});return t}),CKFinder.define("text!CKFinder/Templates/Html5Upload/UploadListItem.dot",[],function(){return'<a class="ckf-upload-item{{? it.uploaded && !it.isError}} ckf-upload-item-ok{{?}}{{? it.isError }} ckf-upload-item-error{{?}}"><h3>{{! it.file.name }}</h3><div class="ckf-upload-progress"></div><p class="ckf-upload-message">{{= it.uploadMessage }}</p></a><a class="ckf-upload-item ckf-upload-item-button{{? it.uploaded && !it.isError }} ckf-upload-item-ok{{?}}{{? it.isError }} ckf-upload-item-error{{?}}"></a>'}),CKFinder.define("CKFinder/Modules/Html5Upload/Views/UploadListItem",["underscore","CKFinder/Views/Base/LayoutView","CKFinder/Common/Views/ProgressView","text!CKFinder/Templates/Html5Upload/UploadListItem.dot"],function(e,t,i,n){"use strict";var r=t.extend({name:"UploadListItem",tagName:"li",attributes:{"data-icon":"ckf-cancel"},template:n,regions:{progress:".ckf-upload-progress"},events:{"click .ckf-upload-item":function(e){e.preventDefault(),this.trigger("upload-cancel")}},ui:{items:"a.ckf-upload-item",msg:".ckf-upload-message",split:".ckf-upload-item-button"},modelEvents:{"change:uploaded":function(){this.setStatus("ok"),this.setHideIcon()},"change:isError":function(e,t){this.ui.msg.removeClass("ckf-hidden").text(e.get("uploadMessage")),t&&this.setStatus("error")},"change:isWarning":function(){this.ui.msg.removeClass("ckf-hidden").text(this.model.get("uploadMessage")),this.setHideIcon()}},onRender:function(){this.setTitle(),this.progress.show(new i({finder:this.finder,model:this.model})),(this.model.get("uploaded")||this.model.get("isError"))&&this.setHideIcon()},setStatus:function(e){this.isDestroyed||this.ui.items.addClass("ckf-upload-item-"+e)},setHideIcon:function(){this.isDestroyed||(this.$el.attr("data-icon","ckf-tick"),this.ui.split.addClass("ui-icon-ckf-tick"),this.setTitle())},setTitle:function(){var e=this.model.get("uploaded")||this.model.get("isError")?this.finder.lang.CloseBtn:this.finder.lang.CancelBtn;this.isDestroyed||(this.ui.split.attr("data-ckf-title",e),this.updateSplitTitle())},updateSplitTitle:function(){this.isDestroyed||this.ui.split.attr("title",this.ui.split.attr("data-ckf-title"))}});return r}),CKFinder.define("text!CKFinder/Templates/Html5Upload/UploadForm.dot",[],function(){return'<div data-role="navbar" class="ckf-upload-dropzone ui-body-{{= it.swatch }}" tabindex="20"><div class="ui-content"><div class="ckf-upload-dropzone-grid"><div class="ckf-upload-dropzone-grid-a"><p id="{{= it.labelId }}" class="ckf-upload-status">{{= it.lang.UploadLabel.UploadSelect }}</p><p class="ckf-upload-progress-text"><span class="ckf-upload-progress-text-files"></span> <span class="ckf-upload-progress-text-bytes"></span></p></div><div class="ckf-upload-dropzone-grid-b"><input type="button" tabindex="-1" data-icon="ckf-plus" data-ckf-button="add" value="{{= it.lang.UploadAddFiles }}"><input type="button" tabindex="-1" data-icon="ckf-cancel" data-ckf-button="cancel" value="{{= it.lang.CloseBtn }}"><input type="button" tabindex="-1" data-icon="ckf-details" data-ckf-button="details" value="{{= it.lang.UploadDetails }}"></div></div><div id="ckf-upload-progress"></div><div class="ckf-upload-input-wrap"><input class="ckf-upload-input" type="file" multiple="multiple"></div></div></div>'}),CKFinder.define("CKFinder/Modules/Html5Upload/Views/UploadForm",["underscore","jquery","CKFinder/Util/KeyCode","CKFinder/Views/Base/LayoutView","CKFinder/Modules/Html5Upload/Views/UploadListItem","text!CKFinder/Templates/Html5Upload/UploadForm.dot","CKFinder/Common/Views/ProgressView","CKFinder/Common/Models/ProgressModel"],function(e,t,i,n,r,o,s,a){"use strict";function l(e){var i;if(e.data){if(!e.data.modeChanged)return;i="desktop"===e.data.mode}else i="desktop"===e;t([this.ui.cancelButton,this.ui.detailsButton,this.ui.addButton]).each(function(){this.parent().toggleClass("ui-btn-icon-notext",!i).toggleClass("ui-btn-icon-left",i)})}var d=n.extend({name:"UploadForm",template:o,ui:{input:".ckf-upload-input",dropZone:".ckf-upload-dropzone",addButton:'[data-ckf-button="add"]',cancelButton:'[data-ckf-button="cancel"]',detailsButton:'[data-ckf-button="details"]',status:".ckf-upload-status",progressText:".ckf-upload-progress-text",progressTextFiles:".ckf-upload-progress-text-files",progressTextBytes:".ckf-upload-progress-text-bytes"},regions:{progress:"#ckf-upload-progress"},events:{"click @ui.input":"setStatusSelect",click:function(e){e.stopPropagation()},selectstart:function(e){e.preventDefault()},"keydown @ui.addButton":function(e){e.keyCode===("ltr"===this.finder.lang.dir?i.left:i.right)&&(this.ui.addButton.focus(),e.stopPropagation()),e.keyCode===("ltr"===this.finder.lang.dir?i.right:i.left)&&(e.stopPropagation(),this.ui.cancelButton.focus())},"keydown @ui.cancelButton":function(e){e.keyCode===("ltr"===this.finder.lang.dir?i.left:i.right)&&(e.stopPropagation(),this.ui.addButton.focus()),e.keyCode===("ltr"===this.finder.lang.dir?i.right:i.left)&&(e.stopPropagation(),this.isDetailsEnabled?this.ui.detailsButton.focus():this.ui.cancelButton.focus())},"keydown @ui.detailsButton":function(e){e.keyCode===("ltr"===this.finder.lang.dir?i.left:i.right)&&(e.stopPropagation(),this.ui.cancelButton.focus()),e.keyCode===("ltr"===this.finder.lang.dir?i.right:i.left)&&(e.stopPropagation(),this.ui.detailsButton.focus())},"keydown @ui.dropZone":function(e){(e.keyCode===("ltr"===this.finder.lang.dir?i.right:i.left)||e.keyCode===i.home)&&this.ui.addButton.focus(),(e.keyCode===("ltr"===this.finder.lang.dir?i.left:i.right)||e.keyCode===i.end)&&(this.isDetailsEnabled?this.ui.detailsButton.focus():this.ui.cancelButton.focus())},"focus @ui.dropZone":function(e){e.target===this.ui.dropZone.get(0)&&this.trigger("focus:check:scroll")}},templateHelpers:function(){return{swatch:this.finder.config.swatch}},initialize:function(){this.listenTo(this.model,"change",this.updateView),this.finder.on("ui:resize",l,this),this.progressModel=new a,this.progressModel.stateIndeterminate()},onRender:function(){this.isDetailsEnabled=!1,this.$el.enhanceWithin(),l.call(this,this.finder.request("ui:getMode")),this.disableDetailsButton(),this.progress.show(new s({finder:this.finder,model:this.progressModel}))},updateView:function(){this.ui.progressTextBytes[0].innerHTML=this.formatBytes(this.model.get("processedBytes")+this.model.get("currentItemBytes")),this.ui.progressTextFiles[0].innerHTML=this.formatFiles(this.model.get("currentItem")),this.setStatusProgress(100*(this.model.get("processedBytes")+this.model.get("currentItemBytes"))/this.model.get("totalBytes")),e.isUndefined(this.model.changed.isStarted)||this.model.changed.isStarted||(this.model.get("errorFiles")?this.setStatusError():this.setStatusOk())},formatBytes:function(e){return this.finder.lang.UploadBytesCountProgress.replace("{bytesUploaded}",this.finder.lang.formatFileSize(e)).replace("{bytesTotal}",this.finder.lang.formatFileSize(this.model.get("totalBytes")))},formatFiles:function(e){return this.finder.lang.UploadFilesCountProgress.replace("{filesUploaded}",e).replace("{filesTotal}",this.model.get("totalFiles"))},onDestroy:function(){this.finder.removeListener("ui:resize",l)},setProgressbarValue:function(e){this.progressModel.set("value",e),100==e&&this.model.get("errorFiles")?this.progressModel.stateError():e>=100?this.progressModel.stateOk():this.progressModel.stateIndeterminate()},showProgressText:function(){this.ui.progressText.css("display","")},hideProgressText:function(){this.ui.progressText.css("display","none")},setStatusText:function(e){this.ui.status.html(e)},setStatusSelect:function(){this.setStatusText(this.finder.lang.UploadLabel.UploadSelect),this.setProgressbarValue(0),this.hideProgressText()},setStatusProgress:function(e){this.setStatusText(this.finder.lang.UploadLabel.UploadProgress),this.setProgressbarValue(e),this.showProgressText()},setStatusOk:function(){this.setStatusText(this.finder.lang.UploadLabel.UploadOk),this.setProgressbarValue(100),this.showProgressText()},setStatusError:function(){this.setStatusText(this.finder.lang.UploadLabel.UploadError),this.setProgressbarValue(100),this.showProgressText()},showUploadSummary:function(){this.ui.progressTextFiles[0].innerHTML=this.finder.lang.UploadSummary.replace("%1",this.formatFiles(this.model.get("uploadedFiles"))),
this.ui.progressTextBytes[0].innerHTML=this.formatBytes(this.model.get("uploadedBytes"))},enableDetailsButton:function(){this.ui.detailsButton.button("enable").attr("aria-disabled","false"),this.isDetailsEnabled=!0},disableDetailsButton:function(){this.ui.detailsButton.button("disable").attr("aria-disabled","true"),this.isDetailsEnabled=!1},cancelButtonAsCancel:function(){this.ui.cancelButton.val(this.finder.lang.CancelBtn).button("refresh")},cancelButtonAsClose:function(){this.ui.cancelButton.val(this.finder.lang.CloseBtn).button("refresh")}});return d}),CKFinder.define("text!CKFinder/Templates/Html5Upload/UploadListSummary.dot",[],function(){return'<div class="ckf-upload-item ckf-upload-item-ok ui-btn"><p class="ckf-upload-message">{{= it.uploadMessage }}</p></div>'}),CKFinder.define("CKFinder/Modules/Html5Upload/Views/UploadListSummary",["CKFinder/Views/Base/ItemView","text!CKFinder/Templates/Html5Upload/UploadListSummary.dot"],function(e,t){"use strict";var i=e.extend({name:"UploadListSummary",tagName:"li",attributes:{"data-icon":"false"},className:"ckf-upload-summary",template:t,modelEvents:{"change:uploadMessage":"render"}});return i}),CKFinder.define("CKFinder/Modules/Html5Upload/Views/UploadList",["CKFinder/Views/Base/CollectionView","CKFinder/Modules/Html5Upload/Views/UploadListItem","CKFinder/Modules/Html5Upload/Views/UploadListSummary"],function(e,t,i){"use strict";var n=e.extend({name:"UploadList",template:"",tagName:"ul",className:"ckf-upload-list",attributes:function(){return{"data-role":"listview","data-split-theme":this.finder.config.swatch}},initialize:function(){function e(){setTimeout(function(){t.$el.listview().listview("refresh"),t.updateChildrenSplitTitle()},0)}this.on("attachBuffer",e,this),this.on("childview:render",e,this);var t=this},getChildView:function(e){return e.get("isSummary")?i:t},updateChildrenSplitTitle:function(){this.children.forEach(function(e){e.updateSplitTitle&&e.updateSplitTitle()})}});return n}),CKFinder.define("CKFinder/Modules/Html5Upload/Html5Upload",["underscore","CKFinder/Modules/Html5Upload/Queue","CKFinder/Modules/Html5Upload/Models/UploadCollection","CKFinder/Modules/Html5Upload/Models/UploadItem","CKFinder/Modules/Html5Upload/Views/UploadForm","CKFinder/Modules/Html5Upload/Views/UploadList","CKFinder/Models/File"],function(e,t,i,n,r,o,s){"use strict";function a(n){function s(){n.removeListener("panel:open:html5upload",a),n.removeListener("panel:close:html5upload",c),f&&f.cancel(),f=null,h&&h.destroy(),h=null,g&&g.destroy(),g=null,p&&p.destroy(),p=null,u(),n.request("panel:destroy",{name:"html5upload"}),v=null}function a(){v&&v.$el.find('[data-ckf-role="closePanel"]').focus(),u(),w=!0}function c(){h&&(h.isDetailsEnabled?h.ui.detailsButton.focus():h.ui.cancelButton.focus()),w=!1}function u(){m&&clearTimeout(m),m=null}var f,h,g,p,m,v,w=!1;d()&&(n.on("page:create:Main",function(){n.request("page:addRegion",{page:"Main",name:"uploadFiles",id:e.uniqueId("ckf-"),priority:20})}),n.on("view:ThumbnailsView",function(e){var t=e.data.view;t.once("render",function(){var e=t.$el;e.on("dragover",function(e){e.preventDefault(),e.stopPropagation()}),e.on("drop",function(e){e.stopPropagation(),e.preventDefault(),e.originalEvent.dataTransfer.files.length&&n.request("upload",{files:e.originalEvent.dataTransfer.files})})})}),n.on("folder:selected",function(e){e.data.folder.get("acl").fileUpload||s()}),n.setHandler("upload",function(d){u();var p=n.request("folder:getActive");if(!p)return void n.request("dialog:info",{msg:n.lang.UploadNoFolder});if(!p.get("acl").fileUpload)return void n.request("dialog:info",{msg:n.lang.UploadNoPerms});w=!1;var y=new i;y.summary=null,f=new t(n);var b=f.getState();y.on("reset",function(){h.disableDetailsButton(),y.once("add",function(){h.enableDetailsButton()})}),b.on("start",function(){h.cancelButtonAsCancel()}),b.on("stop",function(){n.once("command:after:GetFiles",function(){var e=n.request("files:getCurrent").where({name:b.get("lastUploaded")}).pop();e&&e.trigger("focus")}),h.cancelButtonAsClose(),h.showUploadSummary(),n.request("folder:refreshFiles");var t=!e.isBoolean(n.config.autoCloseHTML5Upload)||n.config.autoCloseHTML5Upload,i=b.get("totalFiles")===b.get("uploadedFiles")&&!w;i&&t&&(u(),m=setTimeout(s,1e3*parseFloat(n.config.autoCloseHTML5Upload||0)))}),b.on("change:isStarted",function(){b.get("isStarted")&&u()}),n.on("panel:open:html5upload",a),n.on("panel:close:html5upload",c),g=new o({collection:y,finder:n}),g.on("childview:upload-cancel",function(e){e.model.get("uploaded")||e.model.get("isError")||f.cancelItem(e.model),g.removeChildView(e),g.children.length||(h.disableDetailsButton(),n.request("panel:close",{name:"html5upload"}))}),g.on("render",function(){g.$el.trigger("updatelayout")}),b.set("labelId",e.uniqueId("ckf-label-")),h=new r({finder:n,model:b,events:e.extend({},r.prototype.events,{"click @ui.destroyButton":s,"click @ui.cancelButton":s,"click @ui.addButton":function(){u(),h.ui.input.trigger("click")},"change @ui.input":function(e){u(),l(e.dataTransfer&&e.dataTransfer.files||e.target.files||[],y,f,n)},"dragover @ui.dropZone":function(e){e.preventDefault(),e.stopPropagation()},"drop @ui.dropZone":function(e){e.stopPropagation(),e.preventDefault(),u(),l(e.originalEvent.dataTransfer?e.originalEvent.dataTransfer.files:[],y,f,n)},"click @ui.detailsButton":function(){v||(v=n.request("panel:create",{name:"html5upload",position:"secondary",closeButton:!0,view:g,panelOptions:{positionFixed:!0,display:"overlay"}})),n.request("panel:toggle",{name:"html5upload"}),g.$el.listview().listview("refresh")}})}),d&&d.files||h.on("show",function(){h.ui.dropZone.focus(),n.config.test||h.ui.input.trigger("click")}),n.request("page:showInRegion",{view:h,page:"Main",region:"uploadFiles"}),d&&d.files&&l(d.files,y,f,n)}))}function l(e,t,i,r){function o(e,t){e.set({state:"error",isError:!0,uploadMessage:r.lang.Errors[t],value:100,uploaded:!0})}var a=[];if(e.length){var l=r.request("folder:getActive"),d=l.getResourceType(),f=d.get("maxSize"),h=r.config.initConfigInfo.uploadCheckImages;r.util.asyncArrayTraverse(e,function(e){var l=new n({file:e,state:"ok",value:0}),g=s.extensionFromFileName(e.name).toLowerCase();(!s.isExtensionOfImage(g)||h)&&e.size>f&&o(l,c),d.isAllowedExtension(g)||o(l,u),l.on("change:uploaded",function(e){e.get("isWarning")||t.remove(e),t.summary||(t.summary=new n({isSummary:!0,uploadMessage:""}),t.add(t.summary)),t.summary.set("uploadMessage",r.lang.UploadSummary.replace("%1",i.state.get("uploadedFiles")))}),a.push(l)}),i.state.get("isStarted")||(t.summary&&(t.summary=null),t.reset()),t.add(a),i.add(a)}}function d(){var e=new XMLHttpRequest;return!!window.FormData&&!!e&&!!e.upload}var c=203,u=105;return a}),CKFinder.define("CKFinder/Modules/KeyListener/KeyListener",["underscore","jquery"],function(e,t){"use strict";function i(i){this.finder=i;var n={};t("body").on("keydown",function(t){var r=t.keyCode;e.has(n,r)&&i.fire("keydown:"+r,{evt:t},i)}).on("keyup",function(t){var r=t.keyCode;e.has(n,r)&&i.fire("keyup:"+r,{evt:t},i)}),i.setHandler("key:listen",function(e){n[e.key]=!0}),i.setHandler("key:listen:stop",function(e){delete n[e.key]})}return i}),CKFinder.define("CKFinder/Modules/Loader/Loader",["underscore","jquery"],function(e,t){"use strict";function i(i){function n(){i.config.loaderOverlaySwatch&&t("#ckf-loader-overlay").remove()}this.finder=i,i.setHandlers({"loader:show":function(r){n(),t.mobile.loading("show",{text:r.text,textVisible:!!r.text,theme:i.config.swatch});var o=i.config.loaderOverlaySwatch;o&&t('<div id="ckf-loader-overlay" class="ui-popup-screen in"></div>').addClass("ui-overlay-"+(e.isBoolean(o)?i.config.swatch:o)).appendTo("body"),t(".ui-loader").find("h1").attr("role","alert")},"loader:hide":function(){t.mobile.loading("hide"),n()}})}return i}),CKFinder.define("CKFinder/Modules/Maximize/Maximize",["underscore","jquery","backbone"],function(e,t,i){"use strict";function n(e){if(!e.util.isPopup()&&!e.util.isModal()&&!e.util.isWidget())return void e.setHandlers({isMaximized:function(){return!0}});e.util.isPopup()||e.on("toolbar:reset:Main:folder",function(n){var r=new i.Model({name:"Maximize",type:"button",alignment:"primary",priority:30,icon:t?"ckf-minimize":"ckf-maximize",label:t?e.lang.Maximize.minimize:e.lang.Maximize.maximize,action:function(){r.set("focus",!0),e.request(t?"minimize":"maximize"),r.set("label",t?e.lang.Maximize.minimize:e.lang.Maximize.maximize),r.set("icon",t?"ckf-minimize":"ckf-maximize")}});n.data.toolbar.push(r)});var t=!1,n=r(e);e.setHandlers({maximize:function(){n.max(),t=!0,e.fire("maximized",null,e)},minimize:function(){n.min(),t=!1,e.fire("minimized",null,e)},isMaximized:function(){return t}})}function r(e){function i(){c.popup={x:l.screenLeft||l.screenX,y:l.screenTop||l.screenY,width:l.outerWidth||l.document.body.scrollWidth,height:l.outerHeight||l.document.body.scrollHeight},l.moveTo(0,0),l.resizeTo?l.resizeTo(l.screen.availWidth,l.screen.availHeight):(l.outerHeight=l.screen.availHeight,l.outerWidth=l.screen.availWidth)}function n(){var e=c.popup;l.resizeTo?l.resizeTo(e.width,e.height):(l.outerWidth=e.width,l.outerHeight=e.height),l.moveTo(e.x,e.y),delete c.popup}function r(){t(d.document).css({overflow:"hidden",width:0,height:0}),c.frame=t(l.frameElement).css(["position","left","top","width","height"]),t(l.frameElement).css({position:"fixed",top:0,left:0,bottom:0,right:0,width:"100%",height:"100%","z-index":9001}),d.scrollTo(0,0)}function o(){c.frame&&t(l.frameElement).css(c.frame),delete c.frame}var s,a,l=window,d=window.parent,c={};return e.util.isPopup()?(a=n,s=i):e.util.isModal()?(a=function(){d.CKFinder.modal("minimize")},s=function(){d.CKFinder.modal("maximize")}):(a=o,s=r),{min:a,max:s}}return n}),CKFinder.define("CKFinder/Views/Base/DynamicLayoutView",["jquery","underscore","CKFinder/Views/Base/LayoutView"],function(e,t,i){"use strict";var n=i.extend({createRegion:function(t){var i=e("<div>").attr("id",t.id).attr("data-ckf-priority",t.priority);t.className&&i.addClass(t.className);var n=!1;this.ui.regions.find("[data-ckf-priority]").each(function(r,o){if(!n){var s=e(o),a=s.data("ckf-priority");t.priority<=a&&(s.before(i),n=!0)}}),n||this.ui.regions.append(i),this.addRegion(t.name,{selector:"#"+t.id,priority:t.priority})},getFirstRegion:function(){var e=this.$el.find("[data-ckf-priority]").toArray(),i={};this.regionManager.each(function(n){i[t.indexOf(e,n.$el.get(0))]=n});var n;return t.forEach(i,function(e){!n&&e.hasView()&&(n=e)}),n}});return n}),CKFinder.define("text!CKFinder/Templates/Pages/PageLayout.dot",[],function(){return'<div class="ckf-page-regions ui-content" role="main"><div class="ckf-main-region" data-ckf-priority="50"></div></div>'}),CKFinder.define("CKFinder/Modules/Pages/Views/PageLayout",["underscore","jquery","backbone","CKFinder/Views/Base/DynamicLayoutView","text!CKFinder/Templates/Pages/PageLayout.dot"],function(e,t,i,n,r){"use strict";function o(e){e.data.page===this.options.name&&this.doAutoHeight()}return n.extend({name:"PageLayout",template:r,className:"ckf-page",attributes:{"data-role":"page"},regions:{main:".ckf-main-region"},ui:{regions:".ckf-page-regions"},childEvents:{show:function(e){this.listenTo(e,"focus:check:scroll",function(){var t=this.getFirstRegion(),i=t&&t.currentView.cid===e.cid;i&&(window.scrollY||window.pageYOffset)&&window.scrollTo(0,0)},this)}},initialize:function(){var e=this;e.main.on("show",function(t){e.listenTo(t,"render",e.doAutoHeight),e.doAutoHeight()}),e.listenTo(e.regionManager,"add:region",function(t,i){i.on("show",function(t){t._isRendered&&e.doAutoHeight(),e.listenTo(t,"render",e.doAutoHeight),e.listenToOnce(t,"destroy",e.doAutoHeight)})}),e.finder.on("toolbar:create",o,e),e.finder.on("toolbar:reset",o,e),e.finder.on("page:show:"+e.getOption("name"),function(){e.doAutoHeight()}),e.finder.on("ui:resize",e.doAutoHeight,e)},onRender:function(){var e=this;this.$el.one("create",function(){e.$el.removeAttr("tabindex")}),this.finder.util.isWidget()&&/iPad|iPhone|iPod/.test(navigator.platform)&&(this.doIOSWidgetFix(),this.finder.on("ui:resize",this.doIOSWidgetFix,this,null,20))},doIOSWidgetFix:function(){this.$el.css("max-height",this.finder.config._iosWidgetHeight+"px"),this.$el.css("max-width",this.finder.config._iosWidgetWidth+"px")},onDestroy:function(){this.finder.removeListener("toolbar:create",o),this.finder.removeListener("toolbar:reset",o),this.finder.removeListener("ui:resize",this.doAutoHeight),this.finder.util.isWidget()&&/iPad|iPhone|iPod/.test(navigator.platform)&&this.finder.removeListener("ui:resize",this.doIOSWidgetFix)},setAutoHeightRegion:function(e){this.autoHeightRegion=e},doAutoHeight:function(){function i(e){var t=n.$el.find(e);t.length&&t.toolbar().toolbar("updatePagePadding")}var n=this;setTimeout(function(){t.mobile.resetActivePageHeight(),i("[data-ckf-toolbar]"),i('[data-role="footer"]');var r=n.regionManager.get(n.autoHeightRegion);if(r&&r.currentView){var o=n.calculateMinHeight();e.forEach(n.regionManager.without(r),function(e){var t=e.$el.outerHeight();o-=t}),r.$el.css({"min-height":o+"px"}),r.currentView.trigger("maximize",{height:o})}},10)},calculateMinHeight:function(){var e=parseInt(getComputedStyle(this.el).getPropertyValue("padding-top")),t=parseInt(getComputedStyle(this.el).getPropertyValue("padding-bottom")),i=parseInt(getComputedStyle(this.el).getPropertyValue("border-top-width")),n=parseInt(getComputedStyle(this.el).getPropertyValue("border-bottom-width"));return window.innerHeight-e-t-i-n}})}),CKFinder.define("CKFinder/Modules/Pages/Pages",["underscore","jquery","CKFinder/Modules/Pages/Views/PageLayout"],function(e,t,i){"use strict";function n(e){this.finder=e,this.pages={},this.pageStack=[],this.started=!1}var r=50,o=":mobile-pagecontainer";return n.prototype={getHandlers:function(){var e=this;return t("body").on("pagecontainerbeforehide",function(i,n){var r=n.prevPage&&!!n.prevPage.length&&t(n.prevPage[0]).data("ckfPage");r&&(e.finder.fire("page:hide",{page:r},e.finder),e.finder.fire("page:hide:"+r,e.finder))}).on("pagecontainershow",function(i,n){var r=t(n.toPage[0]).data("ckfPage");e.currentPage=r,e.finder.fire("page:show:"+r,e.finder),e.finder.fire("page:show",{page:r},e.finder)}),{"page:current":{callback:this.pageCurrentHandler,context:this},"page:create":{callback:this.pageCreateHandler,context:this},"page:show":{callback:this.pageShowHandler,context:this},"page:hide":{callback:this.pageHideHandler,context:this},"page:destroy":{callback:this.pageDestroyHandler,context:this},"page:addRegion":{callback:this.pageAddRegionHandler,context:this},"page:showInRegion":{callback:this.pageShowInRegionHandler,context:this}}},setFinder:function(e){this.finder=e},pageCurrentHandler:function(){return this.getCurrentPage()},pageDestroyHandler:function(e){function i(){s&&(s.destroy(),r.fire("page:destroy",{page:e.name},r),r.fire("page:destroy:"+e.name,null,r),delete n.pages[e.name])}var n,r,s,a,l;n=this,r=this.finder,s=this.getPage(e.name),e.name===this.getCurrentPage()?(t(o).one("pagecontainershow",i),l=this.popPrevPage(),a=this.getPage(l),a&&this.showPage(a)):i()},pageHideHandler:function(e){var t,i;e.name===this.getCurrentPage()&&(t=this.popPrevPage(),i=this.getPage(t),this.showPage(i))},pageCreateHandler:function(n){var r=e.extend({},n.uiOptions),o=this,s=n.name;if(!this.pages[s]){var a=new i({finder:this.finder,name:s,attributes:e.extend({},i.prototype.attributes,{"data-ckf-page":s}),className:i.prototype.className+(n.className?" "+n.className:"")});n.mainRegionAutoHeight&&a.setAutoHeightRegion("main"),this.pages[s]=a,a.render(),a.$el.attr("data-theme",this.finder.config.swatch),a.$el.appendTo("body"),this.started||(r.create=function(){t.mobile.initializePage(),o.started=!0}),a.$el.page(r),n.view&&a.main.show(n.view),this.finder.fire("page:create:"+n.name,{},this.finder)}},pageShowHandler:function(e){var t=this.getPage(e.name);if(t){var i=this.getCurrentPage();i&&i!==e.name&&(this.pageStack.push(i),this.finder.fire("page:hide:"+i,null,this.finder)),this.showPage(t)}},pageAddRegionHandler:function(e){var t=this.getPage(e.page);return!!t&&(t.createRegion({name:e.name,id:e.id,priority:e.priority?e.priority:r,className:e.className}),!0)},pageShowInRegionHandler:function(e){var t=this.getPage(e.page);t[e.region].show(e.view),t[e.region].$el.trigger("create")},showPage:function(e){t(o).pagecontainer("change",e.$el),this.currentPage=e.attributes["data-ckf-page"],e.$el.trigger("create").trigger("updatelayout")},getCurrentPage:function(){return this.currentPage},getPage:function(e){return this.pages[e]},popPrevPage:function(){for(;this.pageStack.length;){var e=this.pageStack.pop();if(this.getPage(e))return e}return this.pageStack=[],!1}},n}),CKFinder.define("text!CKFinder/Templates/Panels/PanelLayout.dot",[],function(){return'{{? it.closeButton }}<div role="banner" data-role="header" class="ckf-toolbar-items"><button data-ckf-role="closePanel" data-icon="ckf-cancel" data-iconpos="notext" title="{{= it.lang.CloseBtn }}">{{= it.lang.CloseBtn }}</button></div>{{?}}<div class="ckf-panel-contents"></div>'}),CKFinder.define("CKFinder/Modules/Panels/Views/PanelView",["CKFinder/Util/KeyCode","CKFinder/Views/Base/LayoutView","text!CKFinder/Templates/Panels/PanelLayout.dot"],function(e,t,i){"use strict";var n=t.extend({name:"PanelLayout",template:i,regions:{contents:".ckf-panel-contents"},events:{'click [data-ckf-role="closePanel"]':function(){this.hide()},'keydown [data-ckf-role="closePanel"]':function(t){(t.keyCode===e.enter||t.keyCode===e.space)&&this.hide()},panelclose:function(){this.trigger("closed"),this.$el.attr("aria-hidden","true"),this._isOpen=!1},panelopen:function(){this.trigger("opened"),this.$el.removeAttr("aria-hidden"),this._isOpen=!0},keydown:function(t){t.keyCode===e.escape&&(t.stopPropagation(),this.hide())}},templateHelpers:function(){return{closeButton:!!this.options.closeButton}},initialize:function(e){function t(){var t=this.$el.find(".ui-panel-inner");if(t.length){var i=getComputedStyle(t[0]).getPropertyValue("padding-top"),n=0;if(e.closeButton){var r=this.$el.find('[data-role="header"]');r.length&&(n=r.outerHeight())}this.contents.$el.css({height:this.$el.height()-parseInt(i)-n+"px",overflow:"auto"})}}this._isOpen=!1,this.$el.attr("data-ckf-panel",e.name).attr("data-position",e.position).attr("data-theme",this.finder.config.swatch).attr("aria-hidden","true").attr("data-display",e.display).addClass("ckf-panel-"+e.position);var i=this;e.overrideWidth&&(this.$el.css({width:e.overrideWidth}),this.$el.on("panelbeforeopen",function(){i.$el.css({width:e.overrideWidth})}),"overlay"===e.display&&(this.$el.on("panelbeforeclose",function(){i.$el.css("left"===e.position?{left:0,transform:"translate3d(-"+i.finder.config.secondaryPanelWidth+", 0, 0)"}:{right:0,transform:"translate3d("+i.finder.config.secondaryPanelWidth+", 0, 0)"})}),this.$el.on("panelclose",function(){i.$el.css("left"===e.position?{left:"",transform:""}:{right:"",transform:""})}))),e.scrollContent&&(this.contents.on("show",t,this),this.finder.on("toolbar:create",t,this),this.finder.on("toolbar:destroy",t,this),this.finder.on("ui:resize",t,this),this.on("destroy",function(){this.finder.removeListener("toolbar:create",t),this.finder.removeListener("toolbar:destroy",t),this.finder.removeListener("ui:resize",t)},this))},display:function(){this.$el.panel("open")},toggle:function(){this.$el.panel("toggle")},hide:function(){this.$el.panel().panel("close")},isOpen:function(){return this._isOpen}});return n}),CKFinder.define("CKFinder/Modules/Panels/Panels",["underscore","jquery","CKFinder/Views/Base/ItemView","CKFinder/Views/Base/LayoutView","CKFinder/Modules/Panels/Views/PanelView","CKFinder/Util/KeyCode"],function(e,t,i,n,r,o){"use strict";function s(){this.panels={},this.opened=null}return s.prototype={getHandlers:function(){return{"panel:create":{callback:this.panelCreateHandler,context:this},"panel:open":{callback:this.panelOpenHandler,context:this},"panel:close":{callback:this.panelCloseHandler,context:this},"panel:toggle":{callback:this.panelToggleHandler,context:this},"panel:destroy":{callback:this.panelDestroyHandler,context:this}}},setFinder:function(e){this.finder=e,e.request("key:listen",{key:o.escape}),e.on("keyup:"+o.escape,function(e){e.data.evt.stopPropagation()},null,null,30),e.on("ui:swipeleft",function(e){this.onSwipe("left",e)},this,null,10),e.on("ui:swiperight",function(e){this.onSwipe("right",e)},this,null,10)},panelCreateHandler:function(e){var t,i=this.finder,n="primary"===e.position?"ltr"===i.lang.dir?"left":"right":"ltr"===i.lang.dir?"right":"left",o="primary"===e.position?i.config.primaryPanelWidth:i.config.secondaryPanelWidth,s={finder:i,position:n,closeButton:e.closeButton,name:e.name,scrollContent:!!e.scrollContent,overrideWidth:o,display:e.panelOptions&&e.panelOptions.display?e.panelOptions.display:"overlay"};e.scrollContent&&(t="ckf-panel-scrollable"),e.className&&(t=(t?t+" ":"")+e.className),t&&(s.className=t);var a=new r(s);return a.on("closed",function(){i.fire("panel:close:"+e.name,null,i),this.opened=null},this),a.on("opened",function(){i.fire("panel:open:"+e.name,null,i),this.opened=e.name},this),a.render(),a.$el.appendTo("body").panel(e.panelOptions||{}).trigger("create"),a.contents.show(e.view),a.on("destroy",function(){i.fire("panel:destroy:"+e.name,null,i),delete a[e.name]}),this.panels[e.name]=a,this.finder.request("focus:trap",{node:a.$el}),a},panelOpenHandler:function(e){var t=this.panels[e.name];t&&t.display()},panelToggleHandler:function(e){this.panels[e.name]&&this.panels[e.name].toggle()},panelCloseHandler:function(e){this.panels[e.name]&&this.panels[e.name].hide()},panelDestroyHandler:function(e){this.panels[e.name]&&(this.panels[e.name].hide(),this.panels[e.name].destroy(),delete this.panels[e.name])},onSwipe:function(e,t){var i=this.panels[this.opened];i&&i.getOption("position")===e&&(t.cancel(),i.hide())}},s}),CKFinder.define("text!CKFinder/Templates/Files/FileNameDialogTemplate.dot",[],function(){return'<form action="#"><label>{{! it.dialogMessage }}<input tabindex="1" name="newFileName" value="{{! it.fileName }}" aria-required="true" dir="auto"></label></form><p class="error-message"></p>'}),CKFinder.define("CKFinder/Modules/Files/Views/FileNameDialogView",["CKFinder/Views/Base/ItemView","CKFinder/Models/File","text!CKFinder/Templates/Files/FileNameDialogTemplate.dot"],function(e,t,i){"use strict";return e.extend({name:"FileNameDialogView",template:i,ui:{error:".error-message",fileName:'input[name="newFileName"]'},events:{"input @ui.fileName":function(){var e=this.ui.fileName.val().toString();if(e=t.trimFileName(e),!e.length)return void this.model.set("error",this.finder.lang.ErrorMsg.FileNameNotEmpty);if(!t.isValidName(e))return void this.model.set("error",this.finder.lang.ErrorMsg.FileInvChar);this.model.unset("error");var i=t.extensionFromFileName(this.model.get("originalFileName")).toLowerCase(),n=t.extensionFromFileName(e).toLowerCase();if(i!==n){var r=this.model.get("resourceType");if(!r.isAllowedExtension(n))return void this.model.set("error",this.finder.lang.UploadExtIncorrect);this.model.set("extensionChanged",!0)}else this.model.set("extensionChanged",!1);this.model.set("fileName",e)},submit:function(e){this.trigger("submit:form"),e.preventDefault()}},modelEvents:{"change:error":function(e,t){t?(this.ui.fileName.attr("aria-invalid","true"),this.ui.error.show().removeAttr("aria-hidden").html(t)):(this.ui.error.hide().attr("aria-hidden","true"),this.ui.fileName.removeAttr("aria-invalid"))}}})}),CKFinder.define("CKFinder/Modules/RenameFile/RenameFile",["backbone","CKFinder/Models/File","CKFinder/Util/KeyCode","CKFinder/Modules/Files/Views/FileNameDialogView"],function(e,t,i,n){"use strict";function r(e){this.finder=e,e.setHandler("file:rename",s,this),e.on("contextMenu:file:edit",o,this,null,50),e.on("file:keydown",function(t){t.data.evt.keyCode===i.f2&&e.request("file:rename",{file:t.data.file})}),e.on("toolbar:reset:Main:file",function(e){e.data.file.get("folder").get("acl").fileRename&&e.data.toolbar.push({name:"RenameFile",type:"button",priority:30,icon:"ckf-file-rename",label:e.finder.lang.Rename,action:function(){e.finder.request("file:rename",{file:e.finder.request("files:getSelected").toArray()[0]})}})}),e.on("dialog:RenameFile:ok",function(t){var i=t.data.view.model;if(!i.get("error")){var n=t.data.context.file,r=i.get("fileName"),o=n.get("name"),s={file:n,newFileName:r};t.finder.request("dialog:destroy"),i.get("extensionChanged")?e.request("dialog:confirm",{name:"renameFileConfirm",msg:e.lang.FileRenameExt,context:s}):r!==o&&a(s,e)}}),e.on("dialog:renameFileConfirm:ok",function(t){a(t.data.context,e)}),l(e)}function o(e){var t=this,i=e.data.context.file,n=i.get("folder").get("acl");e.data.items.add({name:"RenameFile",label:t.finder.lang.Rename,isActive:n.fileRename,icon:"ckf-file-rename",action:function(){t.finder.request("file:rename",{file:i})}})}function s(t){var i=this.finder,r=i.lang,o=t.file.get("folder"),s=new e.Model({dialogMessage:i.lang.FileRename,fileName:t.file.get("name").trim(),originalFileName:t.file.get("name"),resourceType:o.getResourceType(),extensionChanged:!1,error:!1}),a=i.request("dialog",{view:new n({finder:i,model:s}),name:"RenameFile",title:r.Rename,context:{file:t.file}});s.on("change:error",function(e,t){t?a.disableButton("ok"):a.enableButton("ok")})}function a(e,t){var i=e.file,n=i.get("folder"),r={fileName:i.get("name"),newFileName:e.newFileName};t.request("loader:show",{text:t.lang.PleaseWait}),t.once("command:after:RenameFile",function(e){t.request("loader:hide");var n=e.data.response;n.error||i.set("name",n.newName);var r=t.request("files:getCurrent").where({name:n.newName}).pop();r&&r.trigger("focus")}),t.request("command:send",{name:"RenameFile",folder:n,params:r,type:"post"})}function l(e){e.on("file:keydown",function(t){t.data.evt.keyCode===i.f2&&e.request("file:rename",{file:t.data.file})}),e.on("shortcuts:list:files",function(e){e.data.shortcuts.add({label:e.finder.lang.Shortcuts.files.rename,shortcuts:"{f2}"})},null,null,20)}return r}),CKFinder.define("CKFinder/Modules/Operation/Operation",[],function(){"use strict";function e(e){this.finder=e,this.id=e.util.randomString(16)}var t=3e3;return e.prototype.getId=function(){return this.id},e.prototype.trackProgress=function(e){var i=this,n=!0;this.probingInterval=setInterval(function(){n&&(n=!1,i.finder.request("command:send",{name:"Operation",params:{operationId:i.id}}).done(function(t){n=!0,e&&e(t)}))},t)},e.prototype.abort=function(){this.finish(),this.finder.request("command:send",{name:"Operation",params:{operationId:this.id,abort:!0}})},e.prototype.finish=function(){this.probingInterval&&(clearInterval(this.probingInterval),this.probingInterval=null)},e}),CKFinder.define("CKFinder/Modules/RenameFolder/RenameFolder",["backbone","CKFinder/Modules/Folders/Views/FolderNameDialogView","CKFinder/Util/KeyCode","CKFinder/Modules/Operation/Operation","CKFinder/Common/Models/ProgressModel","CKFinder/Common/Views/ProgressView"],function(e,t,i,n,r,o){"use strict";function s(i){i.setHandler("folder:rename",function(s){var a=s.folder,d=s.newFolderName;if(d){var c=a.getResourceType(),u={type:a.get("resourceType"),currentFolder:a.getPath(),newFolderName:d};if(c.isOperationTracked("RenameFolder")){var f=new n(i);u.operationId=f.getId();var h=new r({message:i.lang.PleaseWait}),g=new o({finder:i,model:h});i.request("dialog",{view:g,title:i.lang.Operations.renameFolder,name:"RenameFolderProgress",buttons:[{name:"abort",label:i.lang.Abort}]});var p=function(){f.abort(),i.request("dialog:destroy")};i.on("dialog:RenameFolderProgress:abort",p),f.trackProgress(function(e){e.current&&e.total&&h.set("value",e.current/e.total*100)}),i.once("command:ok:RenameFolder",function(){h.set("value",100),setTimeout(function(){i.request("dialog:destroy")},l)}),i.once("command:after:RenameFolder",function(){f.finish(),i.removeListener("dialog:RenameFolderProgress:abort",p)})}else i.request("loader:show",{text:i.lang.PleaseWait});i.request("command:send",{name:"RenameFolder",type:"post",params:u,context:{folder:a,newFolderName:d}})}else{var m=new e.Model({dialogMessage:i.lang.FolderRename,folderName:a.get("name").trim(),error:!1}),v=i.request("dialog",{view:new t({finder:i,model:m}),name:"RenameFolder",title:i.lang.RenameDlgTitle,context:{folder:a}});m.on("change:error",function(e,t){t?v.disableButton("ok"):v.enableButton("ok")})}}),i.on("dialog:RenameFolder:ok",function(e){var t=e.data.view.model;if(!t.get("error")){var n=t.get("folderName");e.finder.request("dialog:destroy"),i.request("folder:rename",{folder:e.data.context.folder,newFolderName:n})}}),i.on("command:after:RenameFolder",function(e){i.request("loader:hide");var t=e.data.response;if(!t.error&&!t.aborted){var n=e.data.context.folder;n.set("name",e.data.context.newFolderName),i.fire("folder:selected",{folder:n},i),n.trigger("selected")}}),i.on("contextMenu:folder:edit",function(e){var t=e.finder,i=e.data.context.folder,n=i.get("isRoot"),r=i.get("acl");e.data.items.add({name:"RenameFolder",label:t.lang.Rename,isActive:!n&&r.folderRename,icon:"ckf-folder-rename",action:function(){t.request("folder:rename",{folder:i})}})}),i.on("toolbar:reset:Main:folder",function(e){var t=e.data.folder;!t.get("isRoot")&&t.get("acl").folderRename&&e.data.toolbar.push({name:"RenameFolder",type:"button",priority:30,label:e.finder.lang.Rename,icon:"ckf-folder-rename",action:function(){i.request("folder:rename",{folder:t})}})}),a(i)}function a(e){e.on("folder:keydown",function(t){t.data.folder.get("isRoot")||t.data.evt.keyCode===i.f2&&t.finder.util.isShortcut(t.data.evt,"")&&(t.data.evt.preventDefault(),t.data.evt.stopPropagation(),e.request("folder:rename",{folder:t.data.folder}))}),e.on("shortcuts:list:folders",function(e){e.data.shortcuts.add({label:e.finder.lang.Shortcuts.folders.rename,shortcuts:"{f2}"})},null,null,20)}var l=1e3;return s}),CKFinder.define("CKFinder/Modules/FilterFiles/FilterFiles",["doT","marionette","CKFinder/Util/KeyCode"],function(e,t,i){"use strict";function n(n){var o="",s={"input input":function(){var e=this.$el.find("input").val();o!==e&&n.request("files:filter",{text:e}),o=e},"keydown input":function(e){e.keyCode===i.tab&&(n.util.isShortcut(e,"")||n.util.isShortcut(e,"shift"))&&n.request(n.util.isShortcut(e,"")?"focus:next":"focus:prev",{node:this.$el.find("input"),event:e}),e.stopPropagation()}};r()&&(s["keyup input"]=function(e){(e.keyCode===i.backspace||e.keyCode===i.delete)&&this.$el.find("input").trigger("input")}),n.on("toolbar:reset:Main:folder",function(i){i.data.toolbar.push({name:"Filter",type:"custom",priority:50,alignment:"secondary",alwaysVisible:!0,view:t.ItemView.extend({className:"ckf-files-filter",template:e.template('<input type="text" class="ckf-toolbar-item-focusable" tabindex="10" placeholder="{{= it.placeholder }}" value="{{= it.value }}" data-prevent-focus-zoom="true">'),events:s}),placeholder:n.lang.Filter.filterPlaceholder,value:o})}),n.on("folder:selected",function(){o=""},null,null,5)}function r(){var e,t,i=-1;return"Microsoft Internet Explorer"==navigator.appName&&(e=navigator.userAgent,t=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})"),null!==t.exec(e)&&(i=parseFloat(RegExp.$1))),9===i}return n}),CKFinder.define("CKFinder/Modules/Settings/Views/SettingView",["underscore","CKFinder/Views/Base/ItemView"],function(e,t){"use strict";var i=t.extend({initialize:function(){this.model.set("id",e.uniqueId("ckf-"))}});return i}),CKFinder.define("text!CKFinder/Templates/Settings/Checkbox.dot",[],function(){return'<label for="{{= it.id }}"><input id="{{= it.id }}" type="checkbox" name="{{= it.name }}" data-iconpos="{{? it.lang.dir == \'ltr\'}}left{{??}}right{{?}}" {{? it.value }}checked="checked"{{?}}>{{= it.label }}</label>'}),CKFinder.define("CKFinder/Modules/Settings/Views/CheckboxView",["underscore","jquery","CKFinder/Util/KeyCode","CKFinder/Modules/Settings/Views/SettingView","text!CKFinder/Templates/Settings/Checkbox.dot"],function(e,t,i,n,r){"use strict";var o=n.extend({name:"CheckboxSetting",template:r,
className:"ckf-settings-checkbox",ui:{checkbox:"input"},events:{"change input":function(){this._isExt=!0,this.model.set("value",!!(this.ui.checkbox.is(":checked")?1:0)),this._isExt=!1},"keyup input":function(e){(e.keyCode===i.enter||e.keyCode===i.space)&&(e.preventDefault(),e.stopPropagation(),this.ui.checkbox.prop("checked",!this.ui.checkbox.is(":checked")).checkboxradio("refresh").trigger("change"))},checkboxradiocreate:function(){this.model.get("isEnabled")||this.disable()}},modelEvents:{"change:value":function(e,t){this._isExt||this.ui.checkbox.prop("checked",t).checkboxradio("refresh")}},focus:function(){this.ui.checkbox.focus()},enable:function(){this.ui.checkbox.checkboxradio("enable").removeAttr("tabindex").removeAttr("aria-disabled")},disable:function(){this.ui.checkbox.checkboxradio("disable").attr("tabindex",-1).attr("aria-disabled",!0)}});return o}),CKFinder.define("text!CKFinder/Templates/Settings/Radio.dot",[],function(){return'<label>{{= it.label }}</label>{{ it._.each(it.attributes.options, function(optionLabel, optionValue){ }}<input name="{{= it.name }}" id="{{= it.name }}{{= optionValue }}" value="{{= optionValue }}" {{? it.value == optionValue }}checked="checked"{{?}} data-iconpos="{{? it.lang.dir == \'ltr\'}}left{{??}}right{{?}}" type="radio"><label for="{{= it.name }}{{= optionValue }}">{{= optionLabel }}</label>{{ }); }}'}),CKFinder.define("CKFinder/Modules/Settings/Views/RadioView",["underscore","jquery","CKFinder/Util/KeyCode","CKFinder/Modules/Settings/Views/SettingView","text!CKFinder/Templates/Settings/Radio.dot"],function(e,t,i,n,r){"use strict";var o=n.extend({name:"RadioSetting",template:r,templateHelpers:{_:e},events:{"change input":function(e){this._isExt=!0,this.model.set("value",t(e.currentTarget).val()),this._isExt=!1},"keyup input":function(e){(e.keyCode===i.enter||e.keyCode===i.space)&&(e.preventDefault(),e.stopPropagation(),this.$el.find("input").each(function(){t(this).prop("checked",this===e.target).checkboxradio("refresh")}),t(e.target).trigger("change"))}},modelEvents:{"change:value":function(){this._isExt||(this.render(),this.$el.enhanceWithin())}},focus:function(){this.$el.find('input[value="'+this.model.get("value")+'"]').focus()},enable:function(){this.$el.find("input").each(function(){t(this).checkboxradio("enable").removeAttr("tabindex").removeAttr("aria-disabled")})},disable:function(){this.$el.find("input").each(function(){t(this).checkboxradio("disable").attr("tabindex",-1).attr("aria-disabled",!0)})}});return o}),CKFinder.define("text!CKFinder/Templates/Settings/Select.dot",[],function(){return'<label>{{= it.label }}</label><select type="text" name="{{= it.name }}" value="{{= it.value }}">{{ it._.each(it.attributes.options, function(name, key){ }}<option value="{{= key }}" {{? it.value == key }}selected="selected"{{?}}>{{= name }}</option>{{ }); }}</select>'}),CKFinder.define("CKFinder/Modules/Settings/Views/SelectView",["underscore","jquery","CKFinder/Modules/Settings/Views/SettingView","text!CKFinder/Templates/Settings/Select.dot"],function(e,t,i,n){"use strict";var r=i.extend({tagName:"div",name:"SelectSetting",template:n,templateHelpers:{_:e},ui:{select:"select"},events:{"change select":function(){this._isExt=!0,this.model.set("value",t(this.ui.select).val()),this._isExt=!1;var e=this;setTimeout(function(){e.focus()},10)}},modelEvents:{"change:value":function(e,t){this._isExt||(this.ui.select.val(t),this.ui.select.selectmenu("refresh"))}},focus:function(){this.ui.select.focus()},enable:function(){this.ui.select.select("enable").removeAttr("tabindex").removeAttr("aria-disabled").parent().removeClass("ui-state-disabled")},disable:function(){this.ui.select.select("disable").attr("tabindex",-1).attr("aria-disabled",!0).parent().addClass("ui-state-disabled")}});return r}),CKFinder.define("text!CKFinder/Templates/Settings/Text.dot",[],function(){return'{{= it.label }}<input type="text" name="{{= it.name }}" value="{{= it.value }}" dir="auto">'}),CKFinder.define("CKFinder/Modules/Settings/Views/TextView",["underscore","jquery","CKFinder/Modules/Settings/Views/SettingView","text!CKFinder/Templates/Settings/Text.dot"],function(e,t,i,n){"use strict";var r=i.extend({tagName:"label",name:"TextSetting",template:n,ui:{input:"input"},events:{"change input":function(e){this._isExt=!0,this.model.set("value",t(e.currentTarget).val()),this._isExt=!1}},modelEvents:{"change:value":function(e,t){this._isExt||this.ui.input.val(t)}},focus:function(){this.$el.find("input").first().focus()},enable:function(){this.ui.input.textinput("enable").removeAttr("tabindex").removeAttr("aria-disabled")},disable:function(){this.ui.input.textinput("disable").attr("tabindex",-1).attr("aria-disabled",!0)}});return r}),CKFinder.define("text!CKFinder/Templates/Settings/Range.dot",[],function(){return'<label for="{{= it.name }}">{{= it.label }}</label><input type="range" name="{{= it.name }}" id="{{= it.name }}" min="{{= it.attributes.min }}" max="{{= it.attributes.max }}" step="{{= it.attributes.step }}" value="{{= it.value }}">'}),CKFinder.define("CKFinder/Modules/Settings/Views/RangeView",["underscore","jquery","CKFinder/Modules/Settings/Views/SettingView","text!CKFinder/Templates/Settings/Range.dot"],function(e,t,i,n){"use strict";var r=i.extend({tagName:"div",name:"RangeSetting",template:n,events:{"change input":function(e){this._isExt=!0,this.model.set("value",parseFloat(t(e.currentTarget).val())),this._isExt=!1},slidecreate:function(){this.$el.find(".ui-slider-handle").attr("tabindex","0")}},modelEvents:{"change:value":function(e,t){this._isExt||this.$el.find("input").val(t).slider("refresh")}},focus:function(){this.$el.find("input").first().focus()},enable:function(){this.$el.find("input").slider("enable").removeAttr("tabindex").removeAttr("aria-disabled")},disable:function(){this.$el.find("input").slider("disable").attr("tabindex",-1).attr("aria-disabled",!0)}});return r}),CKFinder.define("text!CKFinder/Templates/Settings/SettingsGroup.dot",[],function(){return'<fieldset tabindex="-1"><legend>{{= it.label }}</legend><div class="items"></div></fieldset>'}),CKFinder.define("CKFinder/Modules/Settings/Views/SettingsGroupView",["marionette","CKFinder/Views/Base/CompositeView","CKFinder/Modules/Settings/Views/CheckboxView","CKFinder/Modules/Settings/Views/RadioView","CKFinder/Modules/Settings/Views/SelectView","CKFinder/Modules/Settings/Views/TextView","CKFinder/Modules/Settings/Views/RangeView","text!CKFinder/Templates/Settings/SettingsGroup.dot"],function(e,t,i,n,r,o,s,a){"use strict";var l=t.extend({name:"SettingsGroupView",attributes:{"data-role":"controlgroup"},tagName:"div",template:a,childViewContainer:".items",className:"ckf-settings-group",collectionEvents:{"change:isEnabled":function(e,t){var i=this.children.findByModelCid(e.cid);t?i.enable():i.disable()}},events:{"focus fieldset":function(e){e.target===this.$el.find("fieldset").get(0)&&(e.preventDefault(),e.stopPropagation(),this.focus())}},initialize:function(e){this.collection=e.model.get("settings")},addChild:function(t){"hidden"!==t.get("type")&&e.CollectionView.prototype.addChild.apply(this,arguments)},getChildView:function(e){var t={checkbox:i,range:s,text:o,select:r,radio:n},a=e.get("type");return t[a]||(a="text"),t[a]},focus:function(){var e=this.children.findByModel(this.collection.filter(function(e){return e.get("isEnabled")&&"hidden"!==e.get("type")}).shift());e&&e.focus()}});return l}),CKFinder.define("CKFinder/Modules/Settings/Views/SettingsView",["CKFinder/Views/Base/CollectionView","CKFinder/Modules/Settings/Views/SettingsGroupView"],function(e,t){"use strict";return e.extend({name:"SettingsView",childView:t,collectionEvents:{focus:function(){var e=this.children.findByModel(this.collection.first());e&&e.focus()}},onShow:function(){this.$el.parent().trigger("create")},onRender:function(){this.$el.enhanceWithin()}})}),CKFinder.define("CKFinder/Modules/Settings/Models/Setting",["backbone"],function(e){"use strict";var t=e.Model.extend({defaults:{type:"text",value:"",label:""}});return t}),CKFinder.define("CKFinder/Modules/Settings/Models/SettingsGroup",["backbone","CKFinder/Modules/Settings/Models/Setting"],function(e,t){"use strict";var i=e.Model.extend({defaults:{displayTitle:"",title:"",group:""},initialize:function(){var i=this,n=new(e.Collection.extend({model:t}));n.on("change",function(){i.trigger("change")}),this.set("settings",n)},getSettings:function(){var e={};return this.get("settings").forEach(function(t){e[t.get("name")]=t.get("value")}),e},forSave:function(){return{group:this.get("group"),settings:this.getSettings()}}});return i}),CKFinder.define("CKFinder/Modules/Settings/Models/SettingsStorage",["underscore","backbone","CKFinder/Modules/Settings/Models/SettingsGroup"],function(e,t,i){"use strict";var n=t.Collection.extend({model:i,initialize:function(){var e=this;e.on("change",e.saveToStorage,e),e.on("add",e.saveToStorage,e),e.on("remove",e.saveToStorage,e),e.storageKey="ckf.settings",e.dataInStorage={}},loadStorage:function(){localStorage[this.storageKey]&&(this.dataInStorage=JSON.parse(localStorage[this.storageKey]))},hasValueInStorage:function(t,i){return!e.isUndefined(this.dataInStorage[t])&&!e.isUndefined(this.dataInStorage[t].settings[i])},getValueFromStorage:function(e,t){return this.hasValueInStorage(e,t)?JSON.parse(localStorage[this.storageKey])[e].settings[t]:void 0},saveToStorage:function(){var t={};this.forEach(function(e){t[e.get("group")]=e.forSave()}),e.merge(this.dataInStorage,t);try{localStorage[this.storageKey]=JSON.stringify(this.dataInStorage)}catch(e){}}});return n}),CKFinder.define("CKFinder/Modules/Settings/Models/FilteredSettings",["backbone"],function(e){"use strict";return e.Collection.extend({initialize:function(e,t){this._original=t.settings,this.listenTo(this._original,"update",function(){var e=this._original.filter(function(e){return!!e.get("settings").filter(function(e){return"hidden"!==e.get("type")}).length});this.reset(e)})}})}),CKFinder.define("CKFinder/Modules/Settings/Settings",["underscore","backbone","CKFinder/Modules/Settings/Views/SettingsView","CKFinder/Modules/Settings/Models/SettingsStorage","CKFinder/Modules/Settings/Models/FilteredSettings"],function(e,t,i,n,r){"use strict";function o(o){function s(e){return d.findWhere({group:e})}function a(e,t){var i=s(e);return!!i&&i.get("settings").findWhere({name:t})}function l(e){f=new t.Model({name:"Settings",type:"button",priority:10,icon:"ckf-settings",iconOnly:!0,label:e.finder.lang.Settings,alignment:"secondary",alwaysVisible:!0,action:function(){o.request("panel:toggle",{name:"settings"})}}),e.data.toolbar.push(f)}var d=new n,c=new r([],{settings:d});this.finder=o,o.config.id&&(d.storageKey="ckf.settings_"+o.config.id),d.loadStorage(),o.on("app:loaded",function(){o.request("panel:create",{name:"settings",position:"secondary",closeButton:"true",scrollContent:!0,panelOptions:{positionFixed:!0,display:"overlay"},view:new i({collection:c,finder:o})})},null,null,909);var u="ltr"===o.lang.dir?"ui:swipeleft":"ui:swiperight";o.on(u,function(){"Main"===o.request("page:current")&&o.request("panel:open",{name:"settings"})},null,null,20),o.on("panel:open:settings",function(){c.trigger("focus")}),o.setHandlers({"settings:define":function(t){function i(e,t){var i=n.get("group"),r=e.get("name");o.fire("settings:change:"+i,{settings:n.getSettings(),changed:r},o),o.fire("settings:change:"+i+":"+r,{value:t},o)}var n=s(t.group);n||(d.add({label:t.label,group:t.group}),n=s(t.group));var r=n.get("settings");return e.forEach(t.settings,function(n){var o,s;n=e.extend({},{isEnabled:!0},n),s=r.findWhere({name:n.name}),s&&d.remove(s),d.hasValueInStorage(t.group,n.name)?n.value=d.getValueFromStorage(t.group,n.name):n.value=n.defaultValue,o=r.add(n),o.on("change:value",i)}),d.trigger("update"),n.getSettings()},"settings:setValue":function(e){var t=a(e.group,e.name);t&&t.set("value",e.value)},"settings:getValue":function(t){var i;return e.isUndefined(t.name)||!t.name?s(t.group).getSettings():(i=a(t.group,t.name),i?i.get("value"):"")},"settings:enable":function(e){var t=a(e.group,e.name);t&&t.set("isEnabled",!0)},"settings:disable":function(e){var t=a(e.group,e.name);t&&t.set("isEnabled",!1)}});var f;o.on("toolbar:reset:Main",l),o.on("panel:close:settings",function(){f&&f.trigger("focus")})}return o}),CKFinder.define("CKFinder/Modules/Shortcuts/Models/Shortcuts",["underscore","backbone"],function(e,t){"use strict";var i=t.Collection.extend({comparator:"priority"}),n={createColumns:function(i,n){function r(e){var t=o.at(d).get("size");if(t>l)return!0;if(0===t||e.get("shortcuts").length+t<=l)return!1;var n=(2-d)*l,r=i.indexOf(e),s=i.reduce(function(e,t,i){return r>i?e:e+t.get("shortcuts").length},0);return n>=s}var o=new t.Collection;e.forEach(n,function(e){o.add({column:e,groups:new t.Collection,size:0})});var s=i.reduce(function(e,t){return e+t.get("shortcuts").length},0),a=o.length,l=Math.ceil(s/a),d=0,c=s;return i.forEach(function(e){a-1>d&&r(e)&&(d+=1);var t=o.at(d);t.get("groups").push(e),t.set("size",t.get("size")+e.get("shortcuts").length),c-=e.get("shortcuts").length}),o},createCollection:function(e){return new i(e)}};return n}),CKFinder.define("text!CKFinder/Templates/Shortcuts/Group.dot",[],function(){return'<thead><tr><th></th><th class="ckf-shortcuts-title" data-ckf-shortcut-group="{{= it.name }}">{{! it.label }}</th></tr></thead><tbody></tbody>'}),CKFinder.define("text!CKFinder/Templates/Shortcuts/Shortcut.dot",[],function(){return'<td class="ckf-shortcuts-keys">{{~ it.shortcuts:definition }}<span class="ckf-shortcuts-shortcut ui-bar-inherit">{{~ definition:key:i }}{{? i > 0 }}&nbsp;+&nbsp;{{?}}<kbd>{{? it.keys[ key ] }}<span class="ckf-shortcuts-reader-only" aria-hidden="false">{{= it.keys[ key ].text }}</span><span role="presentation" aria-hidden="true">{{? it.lang.Shortcuts.keysAbbreviations[ it.keys[ key ].display ] }}{{= it.lang.Shortcuts.keysAbbreviations[ it.keys[ key ].display ] }}{{??}}{{= it.keys[ key ].display }}{{?}}</span>{{??}}{{? it.lang.Shortcuts.keysAbbreviations[ key ] }}{{= it.lang.Shortcuts.keysAbbreviations[ key ] }}{{??}}{{= key }}{{?}}{{?}}</kbd>{{~}}</span> {{ /* single space left intentionally is here to make spans separate on compile */ }}{{~}}</td><td class="ckf-shortcuts-description">{{! it.label }}</td>'}),CKFinder.define("CKFinder/Modules/Shortcuts/Views/ShortcutsDialogView",["CKFinder/Views/Base/ItemView","CKFinder/Views/Base/CollectionView","CKFinder/Views/Base/CompositeView","text!CKFinder/Templates/Shortcuts/Group.dot","text!CKFinder/Templates/Shortcuts/Shortcut.dot"],function(e,t,i,n,r){"use strict";var o=e.extend({name:"ShortcutView",tagName:"tr",template:r,templateHelpers:function(){return{keys:this.getOption("keys")}}}),s=i.extend({name:"ShortcutsGroupView",childViewContainer:"tbody",childView:o,tagName:"table",className:"ckf-shortcuts",template:n,initialize:function(e){this.collection=e.model.get("shortcuts")},childViewOptions:function(){return{keys:this.getOption("keys")}}}),a=t.extend({name:"ShortcutsColumnView",template:"",childView:s,initialize:function(e){this.collection=e.model.get("groups"),this.once("render",function(){this.$el.addClass("ui-block-"+this.model.get("column"))},this)},childViewOptions:function(){return{keys:this.getOption("keys")}}}),l=t.extend({name:"ShortcutsListing",childView:a,className:"ui-grid-b ui-responsive ckf-shortcuts-dialog",template:"",childViewOptions:function(){return{keys:this.getOption("keys")}}});return l}),CKFinder.define("CKFinder/Modules/Shortcuts/Shortcuts",["underscore","backbone","CKFinder/Util/KeyCode","CKFinder/Modules/Shortcuts/Models/Shortcuts","CKFinder/Modules/Shortcuts/Views/ShortcutsDialogView","CKFinder/Views/Base/CollectionView","CKFinder/Views/Base/CompositeView"],function(e,t,i,n,r){"use strict";function o(o){o.request("key:listen",{key:i.slash}),o.on("keydown:"+i.slash,function(i){if(i.finder.util.isShortcut(i.data.evt,"shift")){var s=n.createCollection();i.finder.fire("shortcuts:list",{groups:s},i.finder);var a={esc:{display:"esc",text:o.lang.Shortcuts.keys.escape},del:{display:"del",text:o.lang.Shortcuts.keys.delete},ctrl:{display:"ctrl",text:o.lang.Shortcuts.keys.ctrl},downArrow:{display:"&darr;",text:o.lang.Shortcuts.keys.downArrow},leftArrow:{display:"&larr;",text:o.lang.Shortcuts.keys.leftArrow},question:{display:"?",text:o.lang.Shortcuts.keys.question},rightArrow:{display:"&rarr;",text:o.lang.Shortcuts.keys.rightArrow},upArrow:{display:"&uarr;",text:o.lang.Shortcuts.keys.upArrow}};s.forEach(function(e){var n=new t.Collection;i.finder.fire("shortcuts:list:"+e.get("name"),{keys:a,shortcuts:n},i.finder),e.set("shortcuts",n)}),s.forEach(function(t){t.get("shortcuts").forEach(function(t){var i=[];e.forEach(t.get("shortcuts").split("|"),function(e){i.push(e.replace(/{|}/g,"").split("+"))}),t.set("shortcuts",i)})}),i.finder.request("dialog",{name:"ShortcutsDialog",title:i.finder.lang.Shortcuts.title,view:new r({finder:o,collection:n.createColumns(s,["a","b","c"]),keys:a}),buttons:["okClose"],restrictHeight:!0})}}),o.on("shortcuts:list:general",function(e){e.data.shortcuts.add({label:e.finder.lang.Shortcuts.general.listShortcuts,shortcuts:"{question}"})},null,null,70)}return o}),CKFinder.define("CKFinder/Modules/StatusBar/Views/StatusBarView",["jquery","CKFinder/Util/KeyCode","CKFinder/Views/Base/DynamicLayoutView"],function(e,t,i){"use strict";var n=i.extend({name:"StatusBarView",template:'<div class="ckf-status-bar-regions"></div>',className:"ckf-statusbar",attributes:{"data-role":"footer","data-position":"fixed","data-tap-toggle":"false",role:"status",tabindex:50},ui:{regions:".ckf-status-bar-regions"},events:{keydown:function(e){e.keyCode===t.tab&&(this.finder.util.isShortcut(e,"")||this.finder.util.isShortcut(e,"shift"))&&this.finder.request(this.finder.util.isShortcut(e,"")?"focus:next":"focus:prev",{node:this.$el,event:e})}},initialize:function(e){this.once("render",function(){this.$el.attr("aria-label",e.label)},this)},onRender:function(){var t=this;setTimeout(function(){t.$el.toolbar(),t.$el.toolbar("updatePagePadding"),e.mobile.resetActivePageHeight()},0)}});return n}),CKFinder.define("CKFinder/Modules/StatusBar/StatusBar",["jquery","backbone","CKFinder/Modules/StatusBar/Views/StatusBarView"],function(e,t,i){"use strict";function n(e){this.bars=new t.Collection;var n=this;n.finder=e,e.setHandlers({"statusBar:create":function(t){if(!t.name)throw"Request statusBar create needs name parameter";if(!t.page)throw"Request statusBar:create needs page parameter";var r=new i({finder:n.finder,name:t.name,label:t.label});return n.bars.add({name:t.name,page:t.page,bar:r}),r.render().$el.appendTo('[data-ckf-page="'+t.page+'"]'),e.fire("statusBar:create",{name:t.name,page:t.page},e),r},"statusBar:destroy":function(t){var i=n.bars.findWhere({name:t.name});i&&(e.fire("statusBar:destroy:"+t.name,null,e),i.get("bar").destroy(),n.bars.remove(i))},"statusBar:addRegion":function(e){var t=n.bars.findWhere({name:e.name});t&&t.get("bar").createRegion({id:e.id,name:e.id,priority:e.priority?e.priority:50})},"statusBar:showView":function(e){var t=n.bars.findWhere({name:e.name});t&&t.get("bar")[e.region].show(e.view)}})}return n}),CKFinder.define("CKFinder/Modules/Toolbars/Views/ToolbarButtonView",["underscore","CKFinder/Views/Base/ItemView"],function(e,t){"use strict";var i=t.extend({tagName:"button",name:"ToolbarItemButton",template:"{{= it.label }}",modelEvents:{"change:isDisabled":function(e){e.get("isDisabled")?this.$el.addClass("ui-state-disabled").attr("aria-disabled","true"):this.$el.removeClass("ui-state-disabled").attr("aria-disabled","false")},focus:function(){this.$el.focus()}},events:{click:"runAction",keydown:function(e){this.trigger("itemkeydown",{evt:e,view:this,model:this.model})},keyup:function(e){e.preventDefault(),e.stopPropagation()},focus:function(){this.$el.attr("tabindex",1)},blur:function(){this.$el.attr("tabindex",-1)}},onRender:function(){this.$el.button()},runAction:function(){var t=this.model.get("action");e.isFunction(t)&&t(this)}});return i}),CKFinder.define("CKFinder/Modules/Toolbars/Views/ToolbarView",["underscore","jquery","CKFinder/Views/Base/CompositeView","CKFinder/Views/Base/ItemView","CKFinder/Modules/Toolbars/Views/ToolbarButtonView","CKFinder/Util/KeyCode"],function(e,t,i,n,r,o){"use strict";function s(t,i){var n=t.finder.request("ui:getMode"),o=["ckf-toolbar-item","ckf-toolbar-button","ckf-toolbar-item-focusable ui-btn ui-corner-all"];i.has("className")&&o.push(i.get("className")),"desktop"!==n||i.get("iconOnly")?o.push("ui-btn-icon-notext"):o.push("ui-btn-icon-"+("ltr"===t.finder.lang.dir?"left":"right")),o.push("ui-icon-"+i.get("icon"));var s={"data-ckf-name":i.get("name"),title:i.get("label"),tabindex:-1};return i.get("isDisabled")&&(o.push("ui-state-disabled"),s["aria-disabled"]="true"),i.has("attributes")&&(s=e.extend(s,i.get("attributes"))),r.extend({attributes:s,className:o.join(" ")})}function a(e,t){var i="ckf-toolbar-item ckf-toolbar-text";return t.has("className")&&(i+=" "+t.get("className")),n.extend({finder:e.finder,name:"ToolbarItemText",tagName:"div",template:"{{= it.label }}",className:i,attributes:{"data-ckf-name":t.get("name")}})}function l(e,t){return t.set({attributes:{"data-show-more":!0},alwaysVisible:!0}),s(e,t)}function d(t,i){var r=t.finder.request("ui:getMode"),s=["ckf-toolbar-item","ckf-toolbar-button","ckf-toolbar-item-focusable ui-btn ui-corner-all"];i.has("className")&&s.push(i.get("className")),"desktop"!==r||i.get("iconOnly")?s.push("ui-btn-icon-notext"):s.push("ui-btn-icon-"+("ltr"===t.finder.lang.dir?"left":"right")),s.push("ui-icon-"+i.get("icon"));var a={"data-ckf-name":i.get("name"),title:i.get("label"),tabindex:-1,href:i.get("href"),role:"button"};return i.get("isDisabled")&&(s.push("ui-state-disabled"),a["aria-disabled"]="true"),i.has("attributes")&&(a=e.extend(a,i.get("attributes"))),n.extend({finder:t.finder,name:"ToolbarItemButtonButton",tagName:"a",className:s.join(" "),template:"{{= it.label }}",attributes:a,events:{keyup:function(e){e.keyCode!==o.enter&&e.keyCode!==o.space&&this.trigger("itemkeydown",{evt:e,view:this,model:this.model})},keydown:function(e){this.trigger("itemkeydown",{evt:e,view:this,model:this.model})}}})}function c(){var t=this,i=t.$el.find('[data-show-more="true"]');if(i.hide(),i.attr("aria-hidden","true"),t.$el.enhanceWithin(),t.$el.toolbar(t.toolbarOptions),t.children.each(h),!(t.collection.length<=2)){var n=0,r=0,o=Math.floor(t.ui.items.width());e.forEach(t.collection.where({alwaysVisible:!0}),function(e){var i=t.children.findByModelCid(e.cid).$el;i.is(":visible")&&(r+=Math.ceil(i.outerWidth(!0)))}),t.$el.find(".ckf-toolbar-item").addClass(v),t.$el.css("min-width",r);var s,a;e.forEach(t.collection.sortBy(f),function(e){var i=e.get("type");if("showMore"===i||e.get("alwaysVisible"))return void("showMore"===i&&(a=e));var l=t.children.findByModelCid(e.cid),d=Math.ceil(l.$el.outerWidth(!0));e.get("hidden")?u(l):d+r>=o?("button"===i&&(n+=1),u(l),e.set("showMore",!0)):r+=d,n||(s=l)}),n&&(a.set("hidden",!1),i.show(),i.removeAttr("aria-hidden"),s&&r+Math.ceil(i.outerWidth(!0))>o&&(u(s),s.model.set("showMore",!0))),t.$el.find(".ckf-toolbar-item").removeClass(v);var l=t.collection.findWhere({focus:!0});if(l){var d=t.children.findByModelCid(l.cid);d&&d.$el.focus()}}}function u(e){e.$el.hide(),e.$el.attr("aria-hidden","true"),e.trigger("hidden")}function f(e){var t=e.get("alwaysVisible")?m:0;return t-e.get("priority")}function h(e){"primary"!==e.model.get("alignment")&&e.$el.addClass("ckf-toolbar-secondary"),"custom"===e.model.get("type")&&e.$el.addClass("ckf-toolbar-item"),e.model.get("alwaysVisible")&&e.$el.attr("data-ckf-always-visible","true")}function g(e){var t=e.collection.filter(function(e){return!(e.get("hidden")===!0||"custom"===e.get("type")||"text"===e.get("type"))}),i=[],n=[];return t.forEach(function(t){t.get("alignment")===("ltr"===e.finder.lang.dir?"primary":"secondary")?i.push(t):n.unshift(t)}),i.concat(n)}var p,m=9e5,v="ckf-toolbar-item-hidden";return p=i.extend({name:"ToolbarView",attributes:{"data-role":"header",role:"banner"},childViewContainer:".ckf-toolbar-items",template:'<div tabindex="10" class="ckf-toolbar-items" role="toolbar"></div>',events:{keydown:function(e){var t=e.keyCode;if(t===o.tab&&this.finder.util.isShortcut(e,""))return void this.finder.request("focus:next",{node:this.ui.items,event:e});if(t>=o.left&&t<=o.down||t===o.home||t===o.end){e.stopPropagation(),e.preventDefault();var i=g(this);if(!i.length)return;var n="ltr"===this.finder.lang.dir?o.end:o.home,r=t===o.left||t===o.up||t===n?i.length-1:0;this.children.findByModel(i[r]).$el.focus()}},"focus @ui.items":function(e){if(e.target===e.currentTarget){e.preventDefault(),e.stopPropagation();var t=g(this);if(t.length){var i="ltr"===this.finder.lang.dir?0:t.length-1;this.children.findByModel(t[i]).$el.focus()}}}},ui:{items:".ckf-toolbar-items"},onRender:function(){var e=this;setTimeout(function(){e.$el.toolbar(e.toolbarOptions),e.$el.toolbar("updatePagePadding"),t.mobile.resetActivePageHeight(),e.$el.attr("data-ckf-toolbar",e.name),e.finder.fire("toolbar:create",{name:e.name,page:e.page},e.finder)},0)},initialize:function(t){var i=this;i.name=t.name,i.page=t.page,i.toolbarOptions={position:"fixed",tapToggle:!1,updatePagePadding:!0},i.on("render:collection",function(){i.$el.addClass("ckf-toolbar")}),i.on("attachBuffer",c,i),i.on("childview:itemkeydown",function(t,n){var r,s,a=n.evt;if(a.keyCode===o.up||a.keyCode===o.left||a.keyCode===o.down||a.keyCode===o.right){a.stopPropagation(),a.preventDefault();var l=g(i);r=e.indexOf(l,t.model),a.keyCode===o.down||a.keyCode===o.right?(s=r+1,s=s<=l.length-1?s:0):(s=r-1,s=s>=0?s:l.length-1),this.children.findByModel(l[s]).$el.focus()}(a.keyCode===o.enter||a.keyCode===o.space)&&(a.stopPropagation(),a.preventDefault(),e.isFunction(t.runAction)&&t.runAction())})},getChildView:function(e){var t=e.get("type");return"custom"===t?e.get("view"):"showMore"===t?l(this,e):"text"===t?a(this,e):"link-button"===t?d(this,e):s(this,e)},focus:function(){t(this.childViewContainer).focus()}})}),CKFinder.define("CKFinder/Modules/Toolbars/Toolbar",["underscore","jquery","backbone","CKFinder/Modules/Toolbars/Views/ToolbarView","CKFinder/Modules/ContextMenu/Views/ContextMenuView"],function(e,t,i,n,r){"use strict";function o(e,t){this.name=t,this.finder=e,this.currentToolbar=new l}var s=30,a=i.Model.extend({defaults:{type:"button",alignment:"primary",priority:s,alwaysVisible:!1}}),l=i.Collection.extend({model:a,comparator:function(e,t){var i=e.get("alignment");if(i!==t.get("alignment"))return"primary"===i?-1:1;var n=e.get("priority"),r=t.get("priority");if(n===r)return 0;var o="primary"===i?1:-1;return r>n?o:-1*o}});return o.prototype.reset=function(t,n){var o=this,s=e.extend({toolbar:new l},n);o.finder.fire("toolbar:reset:"+o.name,s,o.finder),t&&o.finder.fire("toolbar:reset:"+o.name+":"+t,s,o.finder),s.toolbar.push({name:"ShowMore",icon:"ckf-more-vertical",iconOnly:!0,type:"showMore",label:o.finder.lang.ShowMore,priority:-10,hidden:!0,action:function(){var e=new i.Collection;o.currentToolbar.chain().filter(function(e){return!!e.get("showMore")}).forEach(function(t){e.push({action:t.get("action"),isActive:!0,icon:t.get("icon"),label:t.get("label"),hidden:!1})});var t=o.toolbarView.children.findByModel(o.currentToolbar.findWhere({type:"showMore"}));o.currentToolbar.showMore=new r({finder:o.finder,collection:e,positionToEl:t.$el}).render(),o.currentToolbar.showMore.once("destroy",function(){o.currentToolbar.showMore=!1,t.$el.focus()})}}),o.currentToolbar.reset(s.toolbar.toArray())},o.prototype.init=function(e,t){var i=this;i.toolbarView=new n({finder:e,collection:i.currentToolbar,name:i.name,page:t}),i.toolbarView.on("childview:hidden",function(e){e.model.set("hidden",!0)}),i.toolbarView.render().$el.prependTo('[data-ckf-page="'+t+'"]')},o.prototype.destroy=function(){this.toolbarView.destroy(),this.currentToolbar.reset()},o.prototype.redraw=function(){this.currentToolbar.forEach(function(t){if("showMore"!==t.get("type")&&t.set("hidden",!1),t.has("onRedraw")){var i=t.get("onRedraw");e.isFunction(i)&&i.call(t)}}),this.toolbarView.render()},o.prototype.hideMore=function(){this.currentToolbar.showMore&&this.currentToolbar.showMore.destroy()},o}),CKFinder.define("CKFinder/Modules/Toolbars/Toolbars",["jquery","underscore","backbone","CKFinder/Modules/Toolbars/Toolbar","CKFinder/Util/KeyCode"],function(e,t,i,n,r){"use strict";function o(){this.toolbars=new i.Collection}function s(e){e.get("toolbar").destroy(),this.toolbars.remove(e),this.finder.fire("toolbar:destroy",{name:e.get("name")},this.finder)}function a(t){t.request("key:listen",{key:r.f7}),t.on("keydown:"+r.f7,function(i){t.util.isShortcut(i.data.evt,"alt")&&(i.data.evt.preventDefault(),i.data.evt.stopPropagation(),e(".ui-page-active .ckf-toolbar-items").focus())}),t.on("shortcuts:list:general",function(e){e.data.shortcuts.add({label:e.finder.lang.Shortcuts.general.focusToolbar,shortcuts:"{alt}+{f7}"})},null,null,20)}var l="ckf-toolbar-visible";return o.prototype={getHandlers:function(){return{"toolbar:create":{callback:this.toolbarCreateHandler,context:this},"toolbar:reset":{callback:this.toolbarResetHandler,context:this},"toolbar:destroy":{callback:this.toolbarDestroyHandler,context:this}}},setFinder:function(i){function n(t){o.toolbars.where({page:t}).forEach(function(e){e.get("toolbar").redraw()}),r=e(document).width()}this.finder=i,a(i);var r=0;i.on("ui:resize",function(){var t=e(document).width();if(r!==t){var o=i.request("page:current");n(o)}}),i.on("ui:blur",function(){o.toolbars.where({page:i.request("page:current")}).forEach(function(e){e.get("toolbar").hideMore()})});var o=this;i.on("page:show",function(t){var i=t.data.page;n(i),o.toolbars.where({page:i}).length?e("body").addClass(l):e("body").removeClass(l)}),i.on("page:destroy",function(e){t.forEach(this.toolbars.where({page:e.data.page}),s,this)},this)},toolbarCreateHandler:function(t){this.toolbarDestroyHandler(t);var i=new n(this.finder,t.name);this.toolbars.add({page:t.page,name:t.name,toolbar:i}),i.init(this.finder,t.page);var r=this.finder.request("page:current");t.page===r&&e("body").addClass(l)},toolbarDestroyHandler:function(t){var i=this.toolbars.where({name:t.name})[0];i&&(s.call(this,i),i.page===this.finder.request("page:current")&&e("body").removeClass(l))},toolbarResetHandler:function(e){var i=this.toolbars.where({name:e.name})[0];if(i){var n=t.extend({},e.context);i.get("toolbar").reset(e.event,n)}}},o}),CKFinder.define("CKFinder/Modules/UploadFileButton/UploadFileButton",["CKFinder/Util/KeyCode"],function(e){"use strict";function t(e){e.on("toolbar:reset:Main:folder",i),e.on("toolbar:reset:Main:file",i),e.on("toolbar:reset:Main:files",i),n(e)}function i(e){var t=e.finder.request("folder:getActive");t.get("acl").fileUpload&&e.data.toolbar.push({name:"Upload",type:"button",priority:80,icon:"ckf-upload",label:e.finder.lang.Upload,action:function(){e.finder.request("upload")}})}function n(t){t.request("key:listen",{key:e.u}),t.on("keydown:"+e.u,function(e){t.util.isShortcut(e.data.evt,"alt")&&t.request("upload")}),t.on("shortcuts:list:files",function(e){e.data.shortcuts.add({label:e.finder.lang.Shortcuts.files.upload,shortcuts:"{alt}+{u}"})},null,null,40)}return t}),CKFinder.define("CKFinder/Modules/Modules",["underscore","backbone","CKFinder/Modules/CsrfTokenManager/CsrfTokenManager","CKFinder/Modules/Connector/Connector","CKFinder/Modules/ContextMenu/ContextMenu","CKFinder/Modules/CreateFolder/CreateFolder","CKFinder/Modules/DeleteFile/DeleteFile","CKFinder/Modules/DeleteFolder/DeleteFolder","CKFinder/Modules/Dialogs/Dialogs","CKFinder/Modules/EditImage/EditImage","CKFinder/Modules/FileDownload/FileDownload","CKFinder/Modules/FilePreview/FilePreview","CKFinder/Modules/Files/Files","CKFinder/Modules/FilesMoveCopy/FilesMoveCopy","CKFinder/Modules/FocusManager/FocusManager","CKFinder/Modules/Folders/Folders","CKFinder/Modules/FormUpload/FormUpload","CKFinder/Modules/Html5Upload/Html5Upload","CKFinder/Modules/KeyListener/KeyListener","CKFinder/Modules/Loader/Loader","CKFinder/Modules/Maximize/Maximize","CKFinder/Modules/Pages/Pages","CKFinder/Modules/Panels/Panels","CKFinder/Modules/RenameFile/RenameFile","CKFinder/Modules/RenameFolder/RenameFolder","CKFinder/Modules/FilterFiles/FilterFiles","CKFinder/Modules/Settings/Settings","CKFinder/Modules/Shortcuts/Shortcuts","CKFinder/Modules/StatusBar/StatusBar","CKFinder/Modules/Toolbars/Toolbars","CKFinder/Modules/UploadFileButton/UploadFileButton"],function(e,t,i,n,r,o,s,a,l,d,c,u,f,h,g,p,m,v,w,y,b,C,F,x,k,M,E,K,S,V,I){
"use strict";function T(t,i,n){if(q[t]&&(!n||!e.contains(n,t))){var r=new q[t](i.finder);i.add(r),r.getHandlers&&i.finder.setHandlers(r.getHandlers()),r.setFinder&&r.setFinder(i.finder)}}var _=["CreateFolder","DeleteFile","DeleteFolder","EditImage","FilesMoveCopy","FormUpload","Html5Upload","RenameFile","RenameFolder","UploadFileButton"],q={CsrfTokenManager:i,Connector:n,ContextMenu:r,CreateFolder:o,DeleteFile:s,DeleteFolder:a,Dialogs:l,EditImage:d,FileDownload:c,FilePreview:u,Files:f,FilesMoveCopy:h,Folders:p,FocusManager:g,FormUpload:m,Html5Upload:v,KeyListener:w,Loader:y,Maximize:b,Pages:C,Panels:F,RenameFile:x,RenameFolder:k,FilterFiles:M,Settings:E,Shortcuts:K,StatusBar:S,Toolbars:V,UploadFileButton:I},R=t.Collection.extend({init:function(t){var i=this;i.finder=t;var n=t.config.readOnlyExclude.length?t.config.readOnlyExclude.split(","):[],r=!!t.config.readOnly&&e.union(_,n);t.config.removeModules&&(r=e.union(r?r:[],t.config.removeModules.split(","))),T("Loader",i,r),T("FocusManager",i,r),T("KeyListener",i,r),T("CsrfTokenManager",i,r),T("Connector",i,r),T("Settings",i,r),T("Panels",i,r),T("Dialogs",i,r),T("ContextMenu",i,r),T("Pages",i,r),T("Toolbars",i,r),T("StatusBar",i,r),T("Files",i,r),T("Folders",i,r),T("CreateFolder",i,r),T("DeleteFolder",i,r),T("RenameFolder",i,r),T("FilesMoveCopy",i,r),T("RenameFile",i,r),T("DeleteFile",i,r),T("Html5Upload",i,r),T("FormUpload",i,r),T("UploadFileButton",i,r),T("FilterFiles",i,r),T("Maximize",i,r),T("FilePreview",i,r),T("FileDownload",i,r),T("EditImage",i,r),T("Shortcuts",i,r)}});return R}),CKFinder.define("CKFinder/Application",["underscore","jquery","doT","backbone","CKFinder/Config","CKFinder/Event","CKFinder/Util/Util","CKFinder/Util/Lang","CKFinder/UI/UIHacks","CKFinder/Plugins/Plugins","CKFinder/Modules/Modules"],function(e,t,i,n,r,o,s,a,l,d,c){"use strict";function u(){var e,t,i;i=this,f(i),i._modules.init(i),t=i.config.resourceType,e={name:"Init"},t&&(e.params={type:t}),i.once("command:ok:Init",function(e){i.config.initConfigInfo=e.data.response},null,null,1),i.once("command:ok:Init",function(){i.fire("app:start",{},i)},null,null,999),i.once("command:ok:GetFiles",function(){i.fire("app:ready",{},i)},null,null,999),i.fire("app:loaded",{},i),i.request("command:send",e)}function f(t){var i,n=t.config,r={ckfinder:t},o="ckfinderReady";try{i=new CustomEvent(o,{detail:r})}catch(e){i=document.createEvent("Event"),i.initEvent(o,!0,!1),i.detail=r}window.dispatchEvent(i),e.isFunction(n.onInit)?n.onInit(t):"object"==typeof n.onInit&&n.onInit.call(void 0,t)}function h(e){var t,i=e.data.response.error.number;t=e.data.response.error.message?e.data.response.error.message:i&&this.lang.Errors[i]?this.lang.Errors[i]:this.lang.ErrorUnknown.replace("%1",i),this.request("dialog:info",{msg:t,name:"CommandError"})}return i.templateSettings.doNotSkipEncoded=!0,{start:function(r){r.type&&(r.resourceType=r.type);var f={_reqres:new n.Wreqr.RequestResponse,_plugins:new d,_modules:new c,config:r,util:s,Backbone:n,_:e,doT:i};return f.hasHandler=function(){return this._reqres.hasHandler.apply(f._reqres,arguments)},f.getHandler=function(){return this._reqres.getHandler.apply(f._reqres,arguments)},f.setHandler=function(){return this._reqres.setHandler.apply(f._reqres,arguments)},f.setHandlers=function(){return this._reqres.setHandlers.apply(f._reqres,arguments)},f.request=function(){return this._reqres.request.apply(f._reqres,arguments)},e.extend(f,o.prototype),f.on("command:error",h,f),f.on("command:error:Init",function(){t("html").removeClass("ui-mobile-rendering")}),f.on("app:error",function(e){alert("Could not start CKFinder: "+e.data.msg)}),f.on("shortcuts:list",function(e){e.data.groups.add({name:"general",priority:10,label:e.finder.lang.Shortcuts.general.title})}),f.on("shortcuts:list:general",function(e){e.data.shortcuts.add({label:e.finder.lang.Shortcuts.general.action,shortcuts:"{enter}"}),e.data.shortcuts.add({label:e.finder.lang.Shortcuts.general.focusNext,shortcuts:"{tab}"}),e.data.shortcuts.add({label:e.finder.lang.Shortcuts.general.closeButton,shortcuts:"{esc}"})},null,null,60),f.once("plugin:allReady",u,f),a.init(f.config).fail(function(){f.fire("app:error",{msg:"Language file is missing or broken"},f)}).done(function(t){f.lang=t;var i=r.skin;i.indexOf("/")<0&&(i="skins/"+i+"/skin"),window.CKFinder.require([i],function(t){e.isFunction(t.init)&&(t.path=f.util.parentFolder(i)+"/",t.init(f)),l.init(f),f._plugins.load(f)})}),f}}}),CKFinder.define("skins/jquery-mobile/skin",{config:function(e){return e.iconsCSS||(e.iconsCSS="skins/jquery-mobile/icons.css"),e.themeCSS||(e.themeCSS="libs/jquery.mobile.theme.css"),e},init:function(){CKFinder.require(["jquery"],function(e){e("body").addClass("ui-icon-alt")})}}),CKFinder.define("skins/moono/skin",{config:function(e){return e.swatch="a",e.dialogOverlaySwatch=!0,e.loaderOverlaySwatch=!0,e.themeCSS||(e.themeCSS="skins/moono/ckfinder.css"),e.iconsCSS||(e.iconsCSS="skins/moono/icons.css"),e},init:function(){CKFinder.require(["jquery"],function(e){e("body").addClass("ui-alt-icon")})}}),window.CKFinder=window.CKFinder||{},window.CKFinder.require=CKFinder.require||window.require||require,window.CKFinder.requirejs=CKFinder.requirejs||window.requirejs||requirejs,window.CKFinder.define=CKFinder.define||window.define||define,window.CKFinder.basePath&&window.CKFinder.requirejs.config({baseUrl:window.CKFinder.basePath}),window.CKFinder.requirejs.config({waitSeconds:0}),window.CKFinder.define("ckf_global",function(){return window.CKFinder});var event,eventType="ckfinderRequireReady";try{event=new CustomEvent(eventType)}catch(e){event=document.createEvent("Event"),event.initEvent(eventType,!0,!1)}window.dispatchEvent(event),window.CKFinder.start=function(e){function t(e){[e.jqueryMobileStructureCSS,e.coreCSS,e.jqueryMobileIconsCSS,e.iconsCSS,e.themeCSS].forEach(function(e){if(e){var t=window.document.createElement("link");t.setAttribute("rel","stylesheet"),t.setAttribute("href",CKFinder.require.toUrl(e)+"?ver=js6uhv"),window.document.head.appendChild(t)}})}e=e||{},window.CKFinder.require(["underscore","CKFinder/Config","CKFinder/Util/Util"],function(i,n,r){function o(e,t,n){var o,a,l=["id","type","resourceType","langCode","CKEditor","CKEditorFuncNum"];if(a=i.pick(r.getUrlParams(),l),a.langCode&&(a.language=a.langCode),a.type&&(a.resourceType=a.type),a.CKEditor){a.chooseFiles=!0;var d=a.CKEditorFuncNum;a.ckeditor={id:a.CKEditor,funcNumber:d,callback:function(e,t){window.opener.CKEDITOR.tools.callFunction(d,e,t),window.close()}}}delete a.langCode,delete a.CKEditor,delete a.CKEditorFuncNum;var c;c=window!==window.parent&&window.opener||window.isCKFinderPopup?window.opener:window.parent.CKFinder&&window.parent.CKFinder.modal&&window.parent.CKFinder.modal("visible")||window!==window.parent&&!window.opener?window.parent:window,o=i.extend({},e,t,c.CKFinder?c.CKFinder._config:{},n,a),s(o,function(e){e.start(o)})}function s(e,n){var r=e.skin;r.indexOf("/")<0&&(r="skins/"+r+"/skin"),window.CKFinder.require([r],function(n){var r=i.isFunction(n.config)?n.config(e):n.config;t(i.extend(e,r))}),window.jQuery&&/1|2\.[0-9]+.[0-9]+/.test(window.jQuery.fn.jquery)?a(e,n):window.CKFinder.require([window.CKFinder.require.toUrl(e.jquery)+"?ver=js6uhv"],function(){a(e,n)})}function a(e,t){window.CKFinder.define("jquery",function(){return window.jQuery}),window.jQuery(window.document).bind("mobileinit",function(){window.jQuery.mobile.linkBindingEnabled=!1,window.jQuery.mobile.hashListeningEnabled=!1,window.jQuery.mobile.autoInitializePage=!1,window.jQuery.mobile.ignoreContentEnabled=!0}),window.CKFinder.require([window.CKFinder.require.toUrl(e.jqueryMobile)+"?ver=js6uhv"],function(){window.CKFinder.define("ckf-jquery-mobile",function(){return window.jQuery.mobile}),window.CKFinder.require(["CKFinder/Application"],t)})}var l=i.isUndefined(e.configPath)?n.configPath:e.configPath;return l?void window.CKFinder.require([window.CKFinder.require.toUrl(l)],function(t){o(n,t,e)},function(){o(n,{},e)}):void o(n,{},e)})}}}}();